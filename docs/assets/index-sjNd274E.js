var Ie=Object.defineProperty;var Oe=(o,n,e)=>n in o?Ie(o,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[n]=e;var f=(o,n,e)=>Oe(o,typeof n!="symbol"?n+"":n,e);import{P as k}from"./phaser-0RJB29YE.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const t of a)if(t.type==="childList")for(const s of t.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function e(a){const t={};return a.integrity&&(t.integrity=a.integrity),a.referrerPolicy&&(t.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?t.credentials="include":a.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function i(a){if(a.ep)return;a.ep=!0;const t=e(a);fetch(a.href,t)}})();class Me extends k.Scene{constructor(){super({key:"BootScene"})}init(){console.log("[BootScene] Initializing...")}preload(){}create(){console.log("[BootScene] Created - transitioning to PreloadScene"),this.registry.set("initialized",!0),this.registry.set("gameVersion","1.0.0"),this.scene.start("PreloadScene")}}const j=3,me="bloodline_arena_save",pe={reduceMotion:!1,screenShake:!0,bloodFX:!0,grainFX:!0,soundEnabled:!0,musicVolume:.7,sfxVolume:.8,showDamageNumbers:!0,showTimingRing:!0,autoSave:!0},re={totalDamageDealt:0,totalDamageTaken:0,totalPerfectParries:0,totalItemsUsed:0,totalGoldEarned:0,totalFameEarned:0,highestStreak:0,championsDefeated:0,rivalsDefeated:0,fightsWithNoDamage:0,bleedDeaths:0,maxSingleDamage:0},Q={seed:0,week:0,league:"bronze",fightsInLeague:0,fightsToNextLeague:3,gold:50,fame:0,fighter:null,archetypeId:"gladiator",promise:null,rivalId:null,friendId:null,completedVignettes:[],lettersWritten:[],lastCampAction:null,inProgress:!1,relics:[],relicPityCounter:0,activeModifiers:[],fightsSinceRelic:0,consecutiveWins:0,debt:0,debtFightsRemaining:0,fatigue:0,techniques:{},sparringInjuries:[],seals:0,savedLetters:[]},ee={promoterXP:0,promoterLevel:1,bloodlinePoints:0,letterStamps:0,unlockedPerks:[],unlockedArchetypes:["gladiator"],hallOfLegends:[],heirlooms:[],totalRuns:0,totalWins:0,totalDeaths:0,ghostMoments:[],lifetimeStats:{...re},letterCounts:{},unlockedLetterRewards:[],purchasedStampRewards:[]};class Ee{constructor(){f(this,"data");f(this,"autoSaveInterval",null);this.data=this.getDefaultData()}getDefaultData(){return{version:j,settings:{...pe},run:{...Q},meta:{...ee},lastSaved:Date.now()}}load(){try{const n=localStorage.getItem(me);if(n){const e=JSON.parse(n);return e.version!==j?(console.log(`Migrating save from v${e.version} to v${j}`),this.migrate(e)):this.data=this.mergeWithDefaults(e),console.log("Save data loaded successfully"),!0}}catch(n){console.error("Failed to load save data:",n)}return this.data=this.getDefaultData(),!1}mergeWithDefaults(n){var e,i,a,t,s,r,l,c,h,d,g;return{version:j,settings:{...pe,...n.settings},run:{...Q,...n.run,relics:((e=n.run)==null?void 0:e.relics)||[],lettersWritten:((i=n.run)==null?void 0:i.lettersWritten)||[],activeModifiers:((a=n.run)==null?void 0:a.activeModifiers)||[],sparringInjuries:((t=n.run)==null?void 0:t.sparringInjuries)||[],savedLetters:((s=n.run)==null?void 0:s.savedLetters)||[],techniques:((r=n.run)==null?void 0:r.techniques)||{},fatigue:((l=n.run)==null?void 0:l.fatigue)||0,seals:((c=n.run)==null?void 0:c.seals)||0},meta:{...ee,...n.meta,lifetimeStats:{...re,...(h=n.meta)==null?void 0:h.lifetimeStats},letterCounts:((d=n.meta)==null?void 0:d.letterCounts)||{},unlockedArchetypes:((g=n.meta)==null?void 0:g.unlockedArchetypes)||["gladiator"]},lastSaved:n.lastSaved||Date.now()}}migrate(n){let e=n;if(e.version===1){if(console.log("Migrating v1 -> v2: Adding relics, archetypes, letters"),e.run={...Q,...e.run,relics:[],relicPityCounter:0,activeModifiers:[],fightsSinceRelic:0,consecutiveWins:0,debt:0,debtFightsRemaining:0,archetypeId:"gladiator",lettersWritten:[]},e.meta={...ee,...e.meta,letterStamps:0,unlockedArchetypes:["gladiator"],lifetimeStats:{...re},letterCounts:{},unlockedLetterRewards:[],purchasedStampRewards:[]},Array.isArray(e.run.lettersWritten)){const i=e.run.lettersWritten;i.length>0&&typeof i[0]=="string"&&(e.run.lettersWritten=[])}e.version=2}e.version===2&&(console.log("Migrating v2 -> v3: Adding training system and seals"),e.run={...e.run,fatigue:0,techniques:{},sparringInjuries:[],seals:0,savedLetters:[]},e.version=3),this.data=this.mergeWithDefaults(e),this.data.version=j,this.save()}save(){try{return this.data.lastSaved=Date.now(),localStorage.setItem(me,JSON.stringify(this.data)),!0}catch(n){return console.error("Failed to save game:",n),!1}}startAutoSave(n=3e4){this.stopAutoSave(),this.data.settings.autoSave&&(this.autoSaveInterval=window.setInterval(()=>{this.save()},n))}stopAutoSave(){this.autoSaveInterval!==null&&(clearInterval(this.autoSaveInterval),this.autoSaveInterval=null)}getSettings(){return{...this.data.settings}}updateSettings(n){this.data.settings={...this.data.settings,...n},this.save()}getRun(){return{...this.data.run}}updateRun(n){this.data.run={...this.data.run,...n},this.save()}hasActiveRun(){return this.data.run.inProgress&&this.data.run.fighter!==null}startNewRun(n,e="gladiator"){this.data.run={...Q,seed:n??Math.floor(Math.random()*2147483647),archetypeId:e,inProgress:!0},this.data.meta.totalRuns++,this.save()}endRun(n){n?this.data.meta.totalWins++:this.data.meta.totalDeaths++,this.data.run.consecutiveWins>this.data.meta.lifetimeStats.highestStreak&&(this.data.meta.lifetimeStats.highestStreak=this.data.run.consecutiveWins),this.data.run.inProgress=!1,this.save()}getMeta(){return{...this.data.meta}}updateMeta(n){this.data.meta={...this.data.meta,...n},this.save()}updateLifetimeStat(n,e){this.data.meta.lifetimeStats[n]+=e,this.save()}getLifetimeStats(){return{...this.data.meta.lifetimeStats}}addPromoterXP(n){this.data.meta.promoterXP+=n;const e=Math.floor(this.data.meta.promoterXP/100)+1;e>this.data.meta.promoterLevel&&(this.data.meta.promoterLevel=e,this.data.meta.bloodlinePoints+=e),this.save()}addBloodlinePoints(n){this.data.meta.bloodlinePoints+=n,this.save()}spendBloodlinePoints(n){return this.data.meta.bloodlinePoints>=n?(this.data.meta.bloodlinePoints-=n,this.save(),!0):!1}addLetterStamps(n){this.data.meta.letterStamps+=n,this.save()}spendLetterStamps(n){return this.data.meta.letterStamps>=n?(this.data.meta.letterStamps-=n,this.save(),!0):!1}getLetterStamps(){return this.data.meta.letterStamps}incrementLetterCount(n){this.data.meta.letterCounts[n]=(this.data.meta.letterCounts[n]||0)+1,this.save()}getLetterCount(n){return this.data.meta.letterCounts[n]||0}unlockLetterReward(n){this.data.meta.unlockedLetterRewards.includes(n)||(this.data.meta.unlockedLetterRewards.push(n),this.save())}hasLetterReward(n){return this.data.meta.unlockedLetterRewards.includes(n)}addRelic(n){this.data.run.relics.includes(n)||(this.data.run.relics.push(n),this.data.run.fightsSinceRelic=0,this.data.run.relicPityCounter=0,this.save())}getRelics(){return[...this.data.run.relics]}incrementRelicPity(){this.data.run.relicPityCounter++,this.data.run.fightsSinceRelic++,this.save()}unlockArchetype(n){this.data.meta.unlockedArchetypes.includes(n)||(this.data.meta.unlockedArchetypes.push(n),this.save())}isArchetypeUnlocked(n){return this.data.meta.unlockedArchetypes.includes(n)}getUnlockedArchetypes(){return[...this.data.meta.unlockedArchetypes]}unlockPerk(n){this.data.meta.unlockedPerks.includes(n)||(this.data.meta.unlockedPerks.push(n),this.save())}hasPerk(n){return this.data.meta.unlockedPerks.includes(n)}addToHallOfLegends(n){this.data.meta.hallOfLegends.push(n),this.save()}getHallOfLegends(){return[...this.data.meta.hallOfLegends]}addHeirloom(n){this.data.meta.heirlooms.push(n),this.save()}getHeirlooms(){return[...this.data.meta.heirlooms]}addGhostMoment(n){this.data.meta.ghostMoments.push(n),this.save()}getUntriggeredGhostMoments(){return this.data.meta.ghostMoments.filter(n=>!n.triggered)}triggerGhostMoment(n,e){const i=this.data.meta.ghostMoments.find(a=>a.fighterId===n&&a.type===e&&!a.triggered);i&&(i.triggered=!0,this.save())}addDebt(n,e){this.data.run.debt+=n,this.data.run.debtFightsRemaining=Math.max(this.data.run.debtFightsRemaining,e),this.save()}collectDebt(){if(this.data.run.debt>0&&this.data.run.debtFightsRemaining>0){const n=Math.ceil(this.data.run.debt/this.data.run.debtFightsRemaining);return this.data.run.debt-=n,this.data.run.debtFightsRemaining--,this.save(),n}return 0}resetAllData(){this.data=this.getDefaultData(),this.save(),console.log("All save data has been reset")}exportSave(){return JSON.stringify(this.data,null,2)}importSave(n){try{const e=JSON.parse(n);return e.version!==j?this.migrate(e):this.data=this.mergeWithDefaults(e),this.save(),!0}catch(e){return console.error("Failed to import save:",e),!1}}getSaveVersion(){return this.data.version}addFatigue(n){this.data.run.fatigue=Math.min(100,Math.max(0,this.data.run.fatigue+n)),this.save()}reduceFatigue(n){this.data.run.fatigue=Math.max(0,this.data.run.fatigue-n),this.save()}getFatigue(){return this.data.run.fatigue}setTechniqueLevel(n,e){this.data.run.techniques[n]=e,this.save()}getTechniqueLevel(n){return this.data.run.techniques[n]||0}getTechniques(){return{...this.data.run.techniques}}addSparringInjury(n){this.data.run.sparringInjuries.includes(n)||(this.data.run.sparringInjuries.push(n),this.save())}clearSparringInjuries(){this.data.run.sparringInjuries=[],this.save()}getSparringInjuries(){return[...this.data.run.sparringInjuries]}addSeals(n){this.data.run.seals+=n,this.save()}spendSeals(n){return this.data.run.seals>=n?(this.data.run.seals-=n,this.save(),!0):!1}getSeals(){return this.data.run.seals}saveLetter(n){this.data.run.savedLetters.includes(n)||(this.data.run.savedLetters.push(n),this.save())}useSavedLetter(n){const e=this.data.run.savedLetters.indexOf(n);return e>-1?(this.data.run.savedLetters.splice(e,1),this.save(),!0):!1}getSavedLetters(){return[...this.data.run.savedLetters]}}const m=new Ee;class Ge{constructor(n){f(this,"scene");this.scene=n}generateUIAssets(){this.generateParchmentOverlay(),this.generateVignette(),this.generateParticle()}generatePortraitAssets(){}generateArenaAssets(){this.generateArenaOverlay(),this.generateCrowdSilhouette()}generateEffectAssets(){this.generateSpark(),this.generateBloodDrop(),this.generateDustPuff()}generateIconAssets(){}generateParchmentOverlay(){const e=this.scene.make.graphics({x:0,y:0});for(let i=0;i<512;i+=4)for(let a=0;a<512;a+=4){const t=Math.random()*.1,s=k.Display.Color.GetColor(Math.floor(180+t*30),Math.floor(160+t*30),Math.floor(120+t*30));e.fillStyle(s,.02+Math.random()*.03),e.fillRect(a,i,4,4)}for(let i=0;i<20;i++){const a=Math.random()*512,t=Math.random()*512,s=20+Math.random()*40;e.fillStyle(9139029,.02),e.fillCircle(a,t,s)}e.generateTexture("parchment_overlay",512,512),e.destroy()}generateVignette(){const e=this.scene.make.graphics({x:0,y:0}),i=512/2,a=512/2,t=512*.7;for(let s=t;s>0;s-=2){const r=Math.pow(1-s/t,2)*.8;e.fillStyle(0,r*.1),e.fillCircle(i,a,s)}e.fillStyle(0,.3),e.fillRect(0,0,512,30),e.fillRect(0,482,512,30),e.fillRect(0,0,30,512),e.fillRect(482,0,30,512),e.generateTexture("vignette",512,512),e.destroy()}generateParticle(){const e=this.scene.make.graphics({x:0,y:0});for(let i=16/2;i>0;i--){const a=i/8;e.fillStyle(16777215,a),e.fillCircle(16/2,16/2,i)}e.generateTexture("particle",16,16),e.destroy()}generateArenaOverlay(){const i=this.scene.make.graphics({x:0,y:0});i.fillGradientStyle(0,0,1709072,1709072,.3),i.fillRect(0,0,512,512);for(let a=0;a<5;a++){const t=102.4*a;i.fillStyle(0,.05+a*.02),i.fillRect(0,t,512,512/10)}i.fillStyle(16753920,.03),i.fillCircle(50,100,80),i.fillCircle(462,100,80),i.generateTexture("arena_overlay",512,512),i.destroy()}generateCrowdSilhouette(){const i=this.scene.make.graphics({x:0,y:0});i.fillStyle(1709072,1);for(let a=0;a<256;a+=20){const t=8+Math.random()*6,s=44+Math.random()*10;i.fillCircle(a+10,s,t),i.fillRect(a+2,s+t-2,16,20)}i.generateTexture("crowd_silhouette",256,64),i.destroy()}generateSpark(){const e=this.scene.make.graphics({x:0,y:0});e.fillStyle(16776960,1),e.fillCircle(8/2,8/2,8/4),e.fillStyle(16753920,.5),e.fillCircle(8/2,8/2,8/2),e.generateTexture("spark",8,8),e.destroy()}generateBloodDrop(){const e=this.scene.make.graphics({x:0,y:0});e.fillStyle(9109504,1),e.fillCircle(12/2,12/2+2,12/3),e.fillTriangle(12/2,0,12/2-12/4,12/2,12/2+12/4,12/2),e.generateTexture("blood_drop",12,12),e.destroy()}generateDustPuff(){const e=this.scene.make.graphics({x:0,y:0});for(let i=0;i<5;i++){const a=16+(Math.random()-.5)*32*.4,t=32/2+(Math.random()-.5)*32*.4,s=4+Math.random()*6;e.fillStyle(9139029,.2),e.fillCircle(a,t,s)}e.generateTexture("dust_puff",32,32),e.destroy()}static generateIcon(n,e,i,a=32){const t=n.make.graphics({x:0,y:0});i(t,a),t.generateTexture(e,a,a),t.destroy()}}function Fe(o){return`./${o.replace(/^\/+/,"")}`}class _e extends k.Scene{constructor(){super({key:"PreloadScene"});f(this,"diag",{totalToLoad:0,totalComplete:0,totalFailed:0,lastFileKey:"",lastFileUrl:"",failedFiles:[],startTime:0});f(this,"progressBar");f(this,"diagText");f(this,"statusText");f(this,"failedText");f(this,"retryBtn");f(this,"continueBtn");f(this,"loadComplete",!1);f(this,"timedOut",!1);f(this,"transitionStarted",!1);f(this,"timeoutTimer");f(this,"TIMEOUT_MS",8e3);f(this,"BAR_WIDTH",260);f(this,"BAR_HEIGHT",18)}init(){this.diag={totalToLoad:0,totalComplete:0,totalFailed:0,lastFileKey:"",lastFileUrl:"",failedFiles:[],startTime:Date.now()},this.loadComplete=!1,this.timedOut=!1,this.transitionStarted=!1,console.log("═══════════════════════════════════════"),console.log("[PRELOAD] Scene initialized"),console.log('[PRELOAD] BASE_URL = "./"'),console.log("═══════════════════════════════════════")}preload(){this.createDiagnosticUI(),this.setupLoaderEvents(),this.startTimeout(),this.queueAssets(),this.generateProceduralAssets(),this.diag.totalToLoad=this.load.totalToLoad,this.updateDiagnostics(),console.log(`[PRELOAD] Queued ${this.diag.totalToLoad} files`)}createDiagnosticUI(){const{width:e,height:i}=this.cameras.main,a=e/2,t=i/2;this.add.rectangle(a,t,e,i,1709072),this.add.text(a,t-120,"BLOODLINE ARENA",{fontFamily:"Georgia, serif",fontSize:"24px",color:"#c9a959",stroke:"#000000",strokeThickness:3}).setOrigin(.5),this.add.text(a,t-90,"Loading...",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b7355",fontStyle:"italic"}).setOrigin(.5);const s=a-this.BAR_WIDTH/2,r=t-30,l=this.add.graphics();l.fillStyle(3811866,1),l.fillRoundedRect(s-2,r-2,this.BAR_WIDTH+4,this.BAR_HEIGHT+4,4),l.fillStyle(1709072,1),l.fillRoundedRect(s,r,this.BAR_WIDTH,this.BAR_HEIGHT,3),this.progressBar=this.add.graphics(),this.statusText=this.add.text(a,t+10,"Initializing...",{fontFamily:"monospace",fontSize:"11px",color:"#8b7355"}).setOrigin(.5),this.diagText=this.add.text(a,t+45,"",{fontFamily:"monospace",fontSize:"10px",color:"#6a6a5a",align:"center"}).setOrigin(.5),this.failedText=this.add.text(a,t+90,"",{fontFamily:"monospace",fontSize:"9px",color:"#aa6666",align:"center",wordWrap:{width:e-40}}).setOrigin(.5,0)}setupLoaderEvents(){this.load.on("progress",e=>{this.updateProgressBar(e)}),this.load.on("filestart",e=>{this.diag.lastFileKey=e.key;const i=typeof e.src=="string"?e.src:String(e.src??e.url??"(unknown)");this.diag.lastFileUrl=i,this.statusText.setText(`Loading: ${e.key}`),console.log(`[PRELOAD] Loading: ${e.key} -> ${i}`)}),this.load.on("filecomplete",e=>{this.diag.totalComplete++,console.log(`[PRELOAD] ✓ Complete: ${e}`),this.updateDiagnostics()}),this.load.on("loaderror",e=>{this.diag.totalFailed++;const i=typeof e.src=="string"?e.src:String(e.src??e.url??"(unknown)");this.diag.failedFiles.push({key:e.key,url:i}),console.error(`[PRELOAD] ✗ FAILED: ${e.key} -> ${i}`),this.updateDiagnostics(),this.updateFailedList(),this.createFallbackTexture(e.key)}),this.load.once("complete",()=>{this.loadComplete=!0,console.log("[PRELOAD] ═══ LOADER COMPLETE ═══"),console.log(`[PRELOAD] Success: ${this.diag.totalComplete}, Failed: ${this.diag.totalFailed}`),this.clearTimeout(),this.diag.totalFailed>0?this.showErrorUI():this.startTransition()})}startTimeout(){console.log(`[PRELOAD] Starting ${this.TIMEOUT_MS}ms timeout`),this.timeoutTimer=this.time.delayedCall(this.TIMEOUT_MS,()=>{!this.loadComplete&&!this.transitionStarted&&(this.timedOut=!0,console.error("[PRELOAD] ⚠ TIMEOUT - Loading took too long!"),console.error("[PRELOAD] Pending files may have 404ed or stalled"),this.showErrorUI())})}clearTimeout(){this.timeoutTimer&&(this.timeoutTimer.destroy(),this.timeoutTimer=void 0)}queueAssets(){[{key:"ui_panel",path:"assets/ui/panel.svg"},{key:"ui_button",path:"assets/ui/button.svg"},{key:"ui_frame",path:"assets/ui/frame.svg"},{key:"overlay_vignette",path:"assets/overlays/vignette.svg"},{key:"overlay_grain",path:"assets/overlays/grain.svg"},{key:"arena_bg",path:"assets/arena/background.svg"},{key:"icon_main",path:"assets/icons/icon.svg"}].forEach(({key:i,path:a})=>{const t=Fe(a);console.log(`[PRELOAD] Queue: ${i} -> ${t}`),this.load.svg(i,t)})}generateProceduralAssets(){try{const e=new Ge(this);e.generateUIAssets(),e.generatePortraitAssets(),e.generateArenaAssets(),e.generateEffectAssets(),e.generateIconAssets(),console.log("[PRELOAD] Procedural assets generated")}catch(e){console.error("[PRELOAD] Procedural asset error:",e)}}updateProgressBar(e){if(!this.progressBar)return;const{width:i,height:a}=this.cameras.main,t=i/2-this.BAR_WIDTH/2,s=a/2-30,r=Math.max(0,(this.BAR_WIDTH-4)*e);this.progressBar.clear(),r>0&&(this.progressBar.fillStyle(13216089,1),this.progressBar.fillRoundedRect(t+2,s+2,r,this.BAR_HEIGHT-4,2))}updateDiagnostics(){const e=((Date.now()-this.diag.startTime)/1e3).toFixed(1),i=[`Files: ${this.diag.totalComplete}/${this.diag.totalToLoad} loaded, ${this.diag.totalFailed} failed`,`Time: ${e}s`,`Last: ${this.diag.lastFileKey||"(none)"}`];this.diagText.setText(i.join(`
`))}updateFailedList(){if(this.diag.failedFiles.length===0){this.failedText.setText("");return}const e=`⚠ FAILED FILES (${this.diag.failedFiles.length}):
`,i=this.diag.failedFiles.slice(-5).map(a=>`${a.key}: ${a.url}`).join(`
`);this.failedText.setText(e+i)}createFallbackTexture(e){if(this.textures.exists(e))return;const i=this.make.graphics({x:0,y:0});i.fillStyle(3811866,1),i.fillRect(0,0,64,64),i.lineStyle(2,5917242,1),i.strokeRect(2,2,60,60),i.lineStyle(1,9127187,.5),i.moveTo(8,8),i.lineTo(56,56),i.moveTo(56,8),i.lineTo(8,56),i.strokePath(),i.generateTexture(e,64,64),i.destroy(),console.log(`[PRELOAD] Created fallback texture: ${e}`)}createAllFallbacks(){["ui_panel","ui_button","ui_frame","overlay_vignette","overlay_grain","arena_bg","icon_main","parchment_overlay","vignette","particle"].forEach(i=>{this.textures.exists(i)||this.createFallbackTexture(i)})}showErrorUI(){const{width:e,height:i}=this.cameras.main,a=e/2;this.clearTimeout();const t=this.timedOut?"TIMEOUT":`${this.diag.totalFailed} file(s) failed`;this.statusText.setText(`Loading issue: ${t}`),this.statusText.setColor("#cc8866"),this.createAllFallbacks(),this.retryBtn=this.createButton(a,i/2+150,"Retry Loading",()=>{console.log("[PRELOAD] User clicked Retry"),this.scene.restart()}),this.continueBtn=this.createButton(a,i/2+195,"Continue (Safe Mode)",()=>{console.log("[PRELOAD] User clicked Continue (Safe Mode)"),this.startTransition(!0)})}createButton(e,i,a,t){const s=this.add.container(e,i),r=this.add.graphics();r.fillStyle(3811866,1),r.fillRoundedRect(-90,-16,180,32,6),r.lineStyle(2,9139029,1),r.strokeRoundedRect(-90,-16,180,32,6);const l=this.add.text(0,0,a,{fontFamily:"Georgia, serif",fontSize:"12px",color:"#c9a959"}).setOrigin(.5);return s.add([r,l]),r.setInteractive(new k.Geom.Rectangle(-90,-16,180,32),k.Geom.Rectangle.Contains),r.on("pointerdown",t),r.on("pointerover",()=>{r.clear(),r.fillStyle(4864554,1),r.fillRoundedRect(-90,-16,180,32,6),r.lineStyle(2,13216089,1),r.strokeRoundedRect(-90,-16,180,32,6)}),r.on("pointerout",()=>{r.clear(),r.fillStyle(3811866,1),r.fillRoundedRect(-90,-16,180,32,6),r.lineStyle(2,9139029,1),r.strokeRoundedRect(-90,-16,180,32,6)}),s}startTransition(e=!1){if(this.transitionStarted)return;this.transitionStarted=!0,this.clearTimeout(),this.retryBtn&&this.retryBtn.setVisible(!1),this.continueBtn&&this.continueBtn.setVisible(!1),e&&this.createAllFallbacks();try{m.load(),m.startAutoSave(3e4)}catch(a){console.warn("[PRELOAD] SaveSystem error:",a)}const i=document.getElementById("loading-screen");i&&(i.style.opacity="0",i.style.pointerEvents="none"),this.statusText.setText("Loading complete, entering MainMenu..."),this.statusText.setColor("#8b7355"),this.updateProgressBar(1),console.log("═══════════════════════════════════════"),console.log("[PRELOAD] Starting transition to MainMenuScene"),console.log("═══════════════════════════════════════"),this.time.delayedCall(400,()=>{console.log('[PRELOAD] >>> this.scene.start("MainMenuScene")'),this.scene.start("MainMenuScene")})}create(){console.log("[PRELOAD] create() called"),!this.transitionStarted&&this.loadComplete&&(this.diag.totalFailed>0?this.showErrorUI():this.startTransition())}update(){this.transitionStarted||this.updateDiagnostics()}}class b{static createButton(n,e,i,a,t,s={}){const{width:r=180,height:l=45,fontSize:c="14px",primary:h=!1}=s,d=n.add.container(e,i),g=n.add.graphics(),y=h?4864554:2760474,w=h?13216089:5917242;g.fillStyle(y,1),g.fillRoundedRect(-r/2,-l/2,r,l,8),g.lineStyle(2,w,1),g.strokeRoundedRect(-r/2,-l/2,r,l,8),d.add(g);const S=n.add.text(0,0,a,{fontFamily:"Georgia, serif",fontSize:c,color:h?"#c9a959":"#8b7355"}).setOrigin(.5);return d.add(S),g.setInteractive(new k.Geom.Rectangle(-r/2,-l/2,r,l),k.Geom.Rectangle.Contains),g.on("pointerover",()=>{g.clear(),g.fillStyle(y+1118481,1),g.fillRoundedRect(-r/2,-l/2,r,l,8),g.lineStyle(2,13216089,1),g.strokeRoundedRect(-r/2,-l/2,r,l,8),S.setColor("#c9a959")}),g.on("pointerout",()=>{g.clear(),g.fillStyle(y,1),g.fillRoundedRect(-r/2,-l/2,r,l,8),g.lineStyle(2,w,1),g.strokeRoundedRect(-r/2,-l/2,r,l,8),S.setColor(h?"#c9a959":"#8b7355")}),g.on("pointerdown",()=>{n.tweens.add({targets:d,scaleX:.95,scaleY:.95,duration:50,yoyo:!0,onComplete:t})}),d}static showNotification(n,e,i=2e3){const{width:a,height:t}=n.cameras.main,s=n.add.container(a/2,100);s.setDepth(1e3);const r=20,l=n.add.text(0,0,e,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#c9a959"}).setOrigin(.5),c=l.width+r*2,h=l.height+r,d=n.add.graphics();return d.fillStyle(2760474,.95),d.fillRoundedRect(-c/2,-h/2,c,h,8),d.lineStyle(2,13216089,.5),d.strokeRoundedRect(-c/2,-h/2,c,h,8),s.add(d),s.add(l),s.setAlpha(0),s.y=80,n.tweens.add({targets:s,alpha:1,y:100,duration:200,ease:"Back.out"}),n.time.delayedCall(i,()=>{n.tweens.add({targets:s,alpha:0,y:80,duration:200,onComplete:()=>s.destroy()})}),s}static showConfirmDialog(n,e,i,a,t,s="CONFIRM"){const{width:r,height:l}=n.cameras.main,c=n.add.container(r/2,l/2);c.setDepth(1e3);const h=n.add.rectangle(0,0,r,l,0,.7);h.setInteractive(),c.add(h);const d=320,g=280,y=n.add.graphics();y.fillStyle(1709072,1),y.fillRoundedRect(-d/2,-g/2,d,g,12),y.lineStyle(3,13216089,1),y.strokeRoundedRect(-d/2,-g/2,d,g,12),c.add(y);const w=n.add.text(0,-g/2+30,e,{fontFamily:"Georgia, serif",fontSize:"18px",color:"#c9a959"}).setOrigin(.5);c.add(w);const S=n.add.text(0,-20,i,{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b7355",wordWrap:{width:d-40},align:"center"}).setOrigin(.5);c.add(S);const v=this.createButton(n,-70,g/2-50,"CANCEL",()=>{c.destroy(),t()},{width:100,height:40,fontSize:"12px"});c.add(v);const R=this.createButton(n,70,g/2-50,s,()=>{c.destroy(),a()},{width:100,height:40,fontSize:"12px",primary:!0});return c.add(R),c.setScale(.8),c.setAlpha(0),n.tweens.add({targets:c,scale:1,alpha:1,duration:200,ease:"Back.out"}),c}static createProgressBar(n,e,i,a,t,s,r,l=13216089){const c=n.add.container(e,i),h=n.add.graphics();h.fillStyle(2760474,1),h.fillRoundedRect(0,0,a,t,t/4),c.add(h);const d=n.add.graphics(),g=s/r*(a-4);return d.fillStyle(l,1),d.fillRoundedRect(2,2,Math.max(0,g),t-4,(t-4)/4),c.add(d),c}static createPanel(n,e,i,a,t){const s=n.add.graphics();return s.fillStyle(2760474,.95),s.fillRoundedRect(e,i,a,t,10),s.lineStyle(2,5917242,1),s.strokeRoundedRect(e,i,a,t,10),s.lineStyle(1,3811866,.5),s.strokeRoundedRect(e+5,i+5,a-10,t-10,8),s}static createDivider(n,e,i,a){const t=n.add.graphics();return t.lineStyle(1,5917242,.5),t.moveTo(e-a/2,i),t.lineTo(e+a/2,i),t.strokePath(),t.fillStyle(13216089,.5),t.fillCircle(e,i,3),t}}class He extends k.Scene{constructor(){super({key:"MainMenuScene"});f(this,"menuContainer")}create(){const{width:e,height:i}=this.cameras.main;this.createBackground(),this.createTitle(),this.createMenu(),this.createAmbientEffects(),this.cameras.main.fadeIn(500,0,0,0),this.playAmbience()}createBackground(){const{width:e,height:i}=this.cameras.main,a=this.add.graphics();if(a.fillGradientStyle(1709072,1709072,2760474,2760474),a.fillRect(0,0,e,i),this.textures.exists("parchment_overlay")){const t=this.add.image(e/2,i/2,"parchment_overlay");t.setAlpha(.1),t.setDisplaySize(e,i)}if(this.textures.exists("vignette")){const t=this.add.image(e/2,i/2,"vignette");t.setDisplaySize(e,i),t.setAlpha(.5)}}createTitle(){const{width:e}=this.cameras.main,i=e/2;this.add.text(i,120,"BLOODLINE",{fontFamily:"Georgia, serif",fontSize:"48px",color:"#c9a959",stroke:"#000000",strokeThickness:6}).setOrigin(.5),this.add.text(i,175,"ARENA",{fontFamily:"Georgia, serif",fontSize:"36px",color:"#8b7355",stroke:"#000000",strokeThickness:4,letterSpacing:8}).setOrigin(.5);const a=this.add.graphics();a.lineStyle(2,13216089,.5),a.moveTo(i-100,210),a.lineTo(i+100,210),a.strokePath(),this.add.text(i,235,"Blood. Honor. Legacy.",{fontFamily:"Georgia, serif",fontSize:"14px",color:"#5a4a3a",fontStyle:"italic"}).setOrigin(.5)}createMenu(){const{width:e,height:i}=this.cameras.main,a=e/2,t=320,s=70;this.menuContainer=this.add.container(0,0);const r=m.hasActiveRun();if(r){const S=b.createButton(this,a,t,"CONTINUE RUN",()=>this.continueRun(),{width:260,height:55,primary:!0});this.menuContainer.add(S)}const l=r?t+s:t,c=b.createButton(this,a,l,r?"NEW RUN":"BEGIN YOUR LEGEND",()=>this.startNewRun(),{width:260,height:55,primary:!r});this.menuContainer.add(c);const h=b.createButton(this,a,l+s,"HALL OF LEGENDS",()=>this.openHallOfLegends(),{width:260,height:55});this.menuContainer.add(h);const d=b.createButton(this,a,l+s*2,"BLOODLINE PERKS",()=>this.openBloodlinePerks(),{width:260,height:55});this.menuContainer.add(d);const g=b.createButton(this,a,l+s*3,"SETTINGS",()=>this.openSettings(),{width:260,height:55});this.menuContainer.add(g);const y=m.getMeta(),w=`Runs: ${y.totalRuns} | Wins: ${y.totalWins} | Deaths: ${y.totalDeaths}`;this.add.text(a,i-60,w,{fontFamily:"Georgia, serif",fontSize:"12px",color:"#5a4a3a"}).setOrigin(.5),this.add.text(a,i-35,"v1.0.0",{fontFamily:"Georgia, serif",fontSize:"10px",color:"#3a3025"}).setOrigin(.5)}createAmbientEffects(){const{width:e,height:i}=this.cameras.main;if(!m.getSettings().reduceMotion){if(this.textures.exists("particle"))try{this.add.particles(0,0,"particle",{x:{min:0,max:e},y:{min:0,max:i},scale:{start:.5,end:0},alpha:{start:.3,end:0},speed:{min:10,max:30},angle:{min:-90,max:-90},lifespan:4e3,frequency:200,blendMode:"ADD"})}catch(t){console.warn("[MainMenu] Particle effect failed:",t)}this.tweens.add({targets:this.cameras.main,alpha:{from:1,to:.95},duration:100,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}}playAmbience(){m.getSettings().soundEnabled}continueRun(){this.cameras.main.fadeOut(300,0,0,0),this.cameras.main.once("camerafadeoutcomplete",()=>{const e=m.getRun();e.fighter&&e.lastCampAction==="fight"?this.scene.start("FightScene"):this.scene.start("CampScene")})}startNewRun(){m.hasActiveRun()?b.showConfirmDialog(this,"Abandon Current Run?","Starting a new run will end your current fighter's journey. This cannot be undone.",()=>{m.endRun(!1),this.beginNewRun()},()=>{}):this.beginNewRun()}beginNewRun(){m.startNewRun(),this.cameras.main.fadeOut(300,0,0,0),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("RecruitScene")})}openHallOfLegends(){this.cameras.main.fadeOut(300,0,0,0),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("HallOfLegendsScene")})}openBloodlinePerks(){this.cameras.main.fadeOut(300,0,0,0),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("BloodlinePerksScene")})}openSettings(){this.cameras.main.fadeOut(300,0,0,0),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("SettingsScene")})}}class oe{constructor(n){f(this,"seed");f(this,"initialSeed");this.initialSeed=n??Math.floor(Math.random()*2147483647),this.seed=this.initialSeed}reset(){this.seed=this.initialSeed}setSeed(n){this.initialSeed=n,this.seed=n}getSeed(){return this.initialSeed}mulberry32(){let n=this.seed+=1831565813;return n=Math.imul(n^n>>>15,n|1),n^=n+Math.imul(n^n>>>7,n|61),((n^n>>>14)>>>0)/4294967296}random(){return this.mulberry32()}randomInt(n,e){return Math.floor(this.random()*(e-n+1))+n}randomFloat(n,e){return this.random()*(e-n)+n}chance(n){return this.random()<n}pick(n){if(n.length===0)throw new Error("Cannot pick from empty array");return n[this.randomInt(0,n.length-1)]}pickMultiple(n,e){if(e>n.length)throw new Error("Cannot pick more elements than array length");const i=[...n],a=[];for(let t=0;t<e;t++){const s=this.randomInt(0,i.length-1);a.push(i[s]),i.splice(s,1)}return a}shuffle(n){const e=[...n];for(let i=e.length-1;i>0;i--){const a=this.randomInt(0,i);[e[i],e[a]]=[e[a],e[i]]}return e}weightedPick(n){const e=n.reduce((a,[,t])=>a+t,0);let i=this.random()*e;for(const[a,t]of n)if(i-=t,i<=0)return a;return n[n.length-1][0]}randomId(n=8){const e="abcdefghijklmnopqrstuvwxyz0123456789";let i="";for(let a=0;a<n;a++)i+=e[this.randomInt(0,e.length-1)];return i}roll(n){const e=n.match(/^(\d+)d(\d+)([+-]\d+)?$/);if(!e)throw new Error(`Invalid dice notation: ${n}`);const i=parseInt(e[1],10),a=parseInt(e[2],10);let s=e[3]?parseInt(e[3],10):0;for(let r=0;r<i;r++)s+=this.randomInt(1,a);return s}bellCurve(n,e,i=3){let a=0;for(let t=0;t<i;t++)a+=this.randomFloat(n,e);return a/i}}let I=new oe;const p={init(o){I=new oe(o)},getSeed(){return I.getSeed()},reset(){I.reset()},random(){return I.random()},int(o,n){return I.randomInt(o,n)},float(o,n){return I.randomFloat(o,n)},chance(o){return I.chance(o)},pick(o){return I.pick(o)},pickMultiple(o,n){return I.pickMultiple(o,n)},shuffle(o){return I.shuffle(o)},weightedPick(o){return I.weightedPick(o)},id(o){return I.randomId(o)},roll(o){return I.roll(o)},bellCurve(o,n,e){return I.bellCurve(o,n,e)},create(o){return new oe(o)}},te={firstNames:["Aldric","Bjorn","Cassius","Doran","Edric","Falco","Gareth","Harald","Ivan","Jorik","Kael","Lothar","Milo","Nils","Osric","Pavel","Quinn","Ragnar","Soren","Theron","Ulric","Viktor","Werner","Xander","Yoren","Zephyr","Edda","Freya","Greta","Helga","Ingrid","Jutta","Katla","Liv","Mira","Nessa","Olga","Petra","Runa","Sigrid","Thora","Una","Vera","Wren","Ylva","Zara","Brynn","Astrid"],lastNames:["Ashford","Blackwood","Coldstream","Dunmore","Elderstone","Fairweather","Grimshaw","Hartwell","Ironside","Jarvik","Korvin","Lockwood","Moorland","Northcott","Oakhart","Pembrook","Queensbury","Ravencroft","Stonebridge","Thornwood","Underhill","Varr","Windermere","Yarwood","Brann","Voss","Krenn","Dahl","Falk","Griff"],nicknames:["Tin Smile","Left Hook","The Silent","Red Fist","Iron Jaw","The Gentle","Blood Eye","One Shot","The Grim","Lucky","The Bear","Swift Blade","The Butcher","Old Bones","The Crow","Steel Shin","Thunder","The Wall","Widow Maker","The Ghost","Bone Breaker","The Hound","Scarface","The Ox","Quickdraw","The Jackal","Stone Cold","Fury","The Serpent","Nightshade","Pale Death","The Anvil","Copperhead","The Reaper","Mercy","Grudge"]},ye={birthplaces:["Nordheim","the Dustlands","Port Veras","the Iron Hills","Greymarsh","Ashenvale","the Frozen Coast","Thornwick","the Capital","Saltmere","the Border Wastes","Kingsridge","the Outer Reaches","Mirefall","Stonehaven"],snippets:["Born in {birthplace}, {age} winters have hardened this fighter. Sold into the arena to pay family debts.","A former soldier from {birthplace}, discharged after {age} years. The arena is all that remains.","Once a farmer's child in {birthplace}. At {age}, the crops failed, and fighting became the only trade.","Raised in the slums of {birthplace}. At {age}, the arena offers a chance at something more than survival.","A disgraced noble from {birthplace}, now {age} and fighting to reclaim lost honor.","Born to arena champions in {birthplace}. At {age}, the bloodline demands its due.","An orphan of {birthplace}'s plague years. Now {age}, with nothing left to lose.","A freed slave from {birthplace}, {age} years old. The arena is freedom, strange as it seems.","A wanderer from {birthplace} who found purpose at {age}. The roar of crowds calls.","Convicted of a crime in {birthplace} at a young age. Now {age}, fighting for redemption.","A blacksmith's apprentice from {birthplace}, {age} years old. Strong arms, stronger will.","Born during the siege of {birthplace}. {age} years of war made a natural fighter."]},De=[{id:"mothers_coin",name:"Mother's Coin",backstory:'A worn copper coin, pressed into small hands on the day of departure. "For luck," she said.',effect:"+5 starting Focus",statBonus:{maxFocus:5},upgradeEffect:"+10 starting Focus, +5% gold gain"},{id:"broken_whistle",name:"Broken Whistle",backstory:"Once called the family dog. Now only a memory of simpler times rattles inside.",effect:"+5 max Stamina",statBonus:{maxStamina:5},upgradeEffect:"+10 max Stamina"},{id:"old_ribbon",name:"Old Ribbon",backstory:"Faded blue, from someone who promised to wait. They probably moved on.",effect:"+1 Trust per camp rest",statBonus:{},upgradeEffect:"+2 Trust per rest, reduced injury severity"},{id:"clay_figurine",name:"Clay Figurine",backstory:"A child's crude sculpture of a warrior. Made with love, if not skill.",effect:"+5% crowd hype gain",statBonus:{},upgradeEffect:"+15% crowd hype gain"},{id:"tooth_necklace",name:"Tooth Necklace",backstory:"A beast's fang from a hunt that almost ended everything. A reminder of survival.",effect:"+3 Attack",statBonus:{attack:3},upgradeEffect:"+5 Attack, +5% crit chance"},{id:"prayer_beads",name:"Prayer Beads",backstory:"Worn smooth by generations of whispered hopes. The gods may be listening.",effect:"+8 max HP",statBonus:{maxHP:8},upgradeEffect:"+15 max HP"},{id:"lucky_dice",name:"Lucky Dice",backstory:"Won these from a dying man. He said they always rolled true. Hasn't failed yet.",effect:"+5% critical chance",statBonus:{critChance:5},upgradeEffect:"+10% critical chance"},{id:"faded_letter",name:"Faded Letter",backstory:"The ink has run, the words nearly lost. But the feeling remains.",effect:"Start with 10 extra Trust",statBonus:{},upgradeEffect:"Start with 25 extra Trust"},{id:"iron_ring",name:"Iron Ring",backstory:"A wedding band? A slave's mark? Both have the same weight now.",effect:"+3 Defense",statBonus:{defense:3},upgradeEffect:"+5 Defense, reduced bleed duration"},{id:"dried_flower",name:"Dried Flower",backstory:"Picked the morning of recruitment. Already dead, but still beautiful.",effect:"Injuries heal 1 week faster",statBonus:{},upgradeEffect:"Injuries heal 2 weeks faster, +10 HP when resting"}],ie={signature:[{id:"tin_smile",name:"Tin Smile",description:"Cannot be intimidated. Fear effects have no power here.",type:"positive",effect:"Immune to Fear",evolutionNames:["Tin Smile","Iron Grin","Steel Sneer"]},{id:"gentle_giant",name:"Gentle Giant",description:"The crowd loves a merciful warrior. Showing mercy grants bonus hype.",type:"positive",effect:"+20 Hype on merciful actions",evolutionNames:["Gentle Giant","Noble Warrior","The Beloved"]},{id:"vengeful",name:"Vengeful",description:"Pain fuels rage. Damage taken increases attack power temporarily.",type:"positive",effect:"+2 Attack per 10% HP lost",evolutionNames:["Vengeful","Wrathful","Avatar of Vengeance"]},{id:"crowd_pleaser",name:"Crowd Pleaser",description:"Fighting is an art. Style matters as much as substance.",type:"positive",effect:"+50% Hype gain",evolutionNames:["Crowd Pleaser","Fan Favorite","Legend of the Arena"]},{id:"survivors_instinct",name:"Survivor's Instinct",description:"Near-death awakens hidden reserves. Low health grants bonuses.",type:"positive",effect:"+20% Evasion below 25% HP",evolutionNames:["Survivor's Instinct","Death Defier","Unkillable"]},{id:"quick_study",name:"Quick Study",description:"Learns from every blow. Accuracy improves throughout the fight.",type:"positive",effect:"+3% Accuracy per round",evolutionNames:["Quick Study","Adaptable","Master Tactician"]},{id:"berserker_rage",name:"Berserker Rage",description:"Abandon defense for overwhelming offense.",type:"positive",effect:"+30% damage, -15% defense",evolutionNames:["Berserker Rage","Blood Frenzy","Unstoppable Force"]},{id:"iron_defense",name:"Iron Defense",description:"An immovable object. Blocking is second nature.",type:"positive",effect:"+25% block effectiveness",evolutionNames:["Iron Defense","Stone Wall","Impenetrable"]},{id:"opportunist",name:"Opportunist",description:"Strikes when the enemy falters. Bonus damage to stunned enemies.",type:"positive",effect:"+40% damage to debuffed enemies",evolutionNames:["Opportunist","Exploiter","Weakness Hunter"]},{id:"last_stand",name:"Last Stand",description:"Refuses to fall. Once per fight, survive a killing blow at 1 HP.",type:"positive",effect:"Survive fatal (1x per fight)",evolutionNames:["Last Stand","Deathless","The Immortal"]},{id:"patient_fighter",name:"Patient Fighter",description:"Conserves energy. Stamina regenerates faster.",type:"positive",effect:"+50% Stamina regen",evolutionNames:["Patient Fighter","Enduring","Tireless"]},{id:"intimidating_presence",name:"Intimidating Presence",description:"Enemies falter before the fight begins.",type:"positive",effect:"Enemies start with -10 Accuracy",evolutionNames:["Intimidating Presence","Terrifying Aura","Walking Nightmare"]}],positive:[{id:"strong_arm",name:"Strong Arm",description:"Natural strength grants bonus damage.",type:"positive",effect:"+3 Attack",statModifier:{attack:3}},{id:"thick_skin",name:"Thick Skin",description:"Hardened by years of punishment.",type:"positive",effect:"+5 Defense",statModifier:{defense:5}},{id:"light_feet",name:"Light Feet",description:"Quick and agile in the arena.",type:"positive",effect:"+8 Evasion",statModifier:{evasion:8}},{id:"keen_eyes",name:"Keen Eyes",description:"Rarely misses a strike.",type:"positive",effect:"+10 Accuracy",statModifier:{accuracy:10}},{id:"endless_stamina",name:"Endless Stamina",description:"Can fight all day without tiring.",type:"positive",effect:"+15 Max Stamina",statModifier:{maxStamina:15}},{id:"born_fighter",name:"Born Fighter",description:"Combat comes naturally.",type:"positive",effect:"+10 Max HP, +2 Attack",statModifier:{maxHP:10,attack:2}},{id:"focused_mind",name:"Focused Mind",description:"Clarity in chaos.",type:"positive",effect:"+10 Max Focus",statModifier:{maxFocus:10}},{id:"quick_reflexes",name:"Quick Reflexes",description:"Reacts before thinking.",type:"positive",effect:"+3 Speed",statModifier:{speed:3}}],negative:[{id:"old_injury",name:"Old Injury",description:"An old wound that never quite healed.",type:"negative",effect:"-10 Max HP",statModifier:{maxHP:-10}},{id:"poor_eyesight",name:"Poor Eyesight",description:"Struggles to land precise hits.",type:"negative",effect:"-8 Accuracy",statModifier:{accuracy:-8}},{id:"glass_jaw",name:"Glass Jaw",description:"One good hit to the head, and it's over.",type:"negative",effect:"+50% damage from head hits",statModifier:{}},{id:"brittle_bones",name:"Brittle Bones",description:"Injuries are more severe.",type:"negative",effect:"+1 week injury heal time",statModifier:{}},{id:"slow_starter",name:"Slow Starter",description:"Takes time to warm up.",type:"negative",effect:"-20% damage rounds 1-2",statModifier:{}},{id:"arrogant",name:"Arrogant",description:"Overconfidence leads to mistakes.",type:"negative",effect:"-5 Evasion when HP > 70%",statModifier:{}},{id:"nervous",name:"Nervous",description:"Crowds make mistakes more likely.",type:"negative",effect:"-5 Accuracy at high Hype",statModifier:{}},{id:"weak_constitution",name:"Weak Constitution",description:"Tires quickly in prolonged fights.",type:"negative",effect:"-10 Max Stamina",statModifier:{maxStamina:-10}},{id:"scarred_lungs",name:"Scarred Lungs",description:"Breathes heavy, moves slow.",type:"negative",effect:"-2 Speed",statModifier:{speed:-2}},{id:"cowardly",name:"Cowardly",description:"Fear takes hold too easily.",type:"negative",effect:"+20% Fear effect duration",statModifier:{}},{id:"reckless",name:"Reckless",description:"Attacks without thinking.",type:"negative",effect:"-5 Defense",statModifier:{defense:-5}},{id:"bad_knee",name:"Bad Knee",description:"An old injury that flares up.",type:"negative",effect:"+30% damage from leg hits",statModifier:{}}]},Le={stoic:{battle_start:['"..."',`"Let's get this done."`,'"Another day."'],taking_damage:['"Tch."',`"I've had worse."`,'"..."'],dealing_damage:['"..."','"Down."','"Fall."'],low_health:['"Not yet."','"Still standing."','"..."'],victory:[`"It's done."`,'"..."','"Next."'],defeat:['"..."','"So it ends."'],rest:[`"A moment's peace."`,'"..."'],training:['"Again."','"..."'],shop:['"What do you have?"','"..."'],idle:['"..."','"Waiting."']},aggressive:{battle_start:['"Blood! Blood! BLOOD!"','"COME ON!"',`"I'll tear you apart!"`],taking_damage:['"Is that all?!"','"MORE!"','"HA! Again!"'],dealing_damage:['"YES!"','"FEEL IT!"','"DIE!"'],low_health:[`"I'm not done!"`,'"NEVER!"','"MORE BLOOD!"'],victory:[`"WHO'S NEXT?!"`,'"WEAK!"','"HA HA HA!"'],defeat:['"No... MORE!"',`"This isn't..."`],rest:['"Bah, wasting time."','"When do we fight?"'],training:['"Hit me harder!"','"AGAIN!"'],shop:['"Give me something deadly."','"Sharper. Deadlier."'],idle:[`"Where's the fight?"`,'"Boring..."']},honorable:{battle_start:['"May the best warrior win."','"I fight with honor."','"Ancestors, guide my blade."'],taking_damage:['"A fair blow."','"Well struck."','"Nngh... honorable."'],dealing_damage:['"Forgive me."','"For glory!"','"Stand down, with honor."'],low_health:['"I will not yield."','"Honor demands I stand."','"Not like this..."'],victory:['"A good fight. You have my respect."','"The ancestors smile."','"Glory earned."'],defeat:['"I die... with honor."','"A worthy opponent."'],rest:['"I must center myself."','"Quiet contemplation."'],training:['"Discipline makes the warrior."','"Honor in preparation."'],shop:['"A fine blade for a fair price."','"Quality, not trickery."'],idle:['"Patience is a virtue."','"The fight will come."']},cunning:{battle_start:['"I already know how this ends."',`"You've already lost."`,'"Interesting..."'],taking_damage:['"As expected."','"I let you have that one."','"Clever. But not clever enough."'],dealing_damage:['"Predictable."','"Just as planned."','"Too easy."'],low_health:['"All part of the plan."',`"You think you've won?"`,'"Not yet..."'],victory:['"Exactly as I foresaw."','"Was there ever any doubt?"','"Outplayed."'],defeat:['"Impossible... how did..."','"I miscalculated."'],rest:['"Time to think."','"Planning the next move."'],training:['"Mind over muscle."','"Knowing the enemy."'],shop:['"What advantages can I gain?"','"Everything has a use."'],idle:['"Observing. Always observing."','"Everyone has a weakness."']},fearful:{battle_start:['"Oh gods, oh gods..."',`"I don't want to do this."`,'"Please... I just want to live."'],taking_damage:['"AHHH!"','"No no no!"','"Please stop!"'],dealing_damage:['"S-sorry!"','"I had to!"','"Please fall!"'],low_health:[`"I don't want to die!"`,'"Please, mercy!"','"Gods save me!"'],victory:['"I... I did it?"',`"I'm alive! I'm alive!"`,'"Thank the gods..."'],defeat:['"I knew it... I knew..."','"Mother..."'],rest:['"Safe... for now."','"Maybe I can run..."'],training:[`"I'll try..."`,`"Please don't hit too hard."`],shop:['"Something protective, please."','"Anything to help me survive."'],idle:['"Why am I here?"','"There has to be another way..."']},jovial:{battle_start:[`"Let's have some fun!"`,'"Nice day for a fight, eh?"','"May the best looking one win!"'],taking_damage:['"Ow! Good one!"','"Ha! That tickled!"',`"Oh, you're serious!"`],dealing_damage:['"Haha! How about that?"',`"Didn't see that coming!"`,`"Tag! You're it!"`],low_health:['"Getting interesting now!"','"Ha... ha... okay, serious time."',`"You're making this dramatic!"`],victory:['"Good game! Drinks are on me!"','"That was fun! Again sometime?"','"Haha! What a rush!"'],defeat:['"Heh... well played..."',`"Guess the joke's on me..."`],rest:['"Time for ale and stories!"','"Rest is good for the soul!"'],training:[`"Let's make it a game!"`,'"Winner buys the drinks!"'],shop:['"Got anything shiny?"',`"Ooh, what's this do?"`],idle:['"Anyone want to hear a joke?"','"Bored bored bored..."']}};function ae(o=1){var O;const n=p.pick(te.firstNames),e=p.pick(te.lastNames),i=p.pick(te.nicknames),a=p.int(18,45),t=p.pick(ye.birthplaces),s=p.pick(ye.snippets).replace("{birthplace}",t).replace("{age}",String(a)),r=p.pick(["stoic","aggressive","honorable","cunning","fearful","jovial"]),l=Math.floor(o/2),c=We(l),h=Re(),d=p.pick(De),g={id:d.id,name:d.name,backstory:d.backstory,effect:d.effect,statBonus:d.statBonus,upgraded:!1,upgradeEffect:d.upgradeEffect},y=p.pick(ie.signature),w={...y,evolutionStage:0,maxEvolution:((O=y.evolutionNames)==null?void 0:O.length)||3},S=p.int(1,2),v=p.pickMultiple(ie.positive,S).map(C=>({...C})),R=[{...p.pick(ie.negative)}];return{id:p.id(12),firstName:n,lastName:e,nickname:i,fullName:`${n} '${i}' ${e}`,age:a,birthplace:t,backstory:s,personality:r,baseStats:c,currentStats:{...c},equipment:{weapon:null,armor:null,accessory:null},keepsake:g,inventory:[],signatureTrait:w,traits:v,flaws:R,portrait:h,level:1,experience:0,wins:0,losses:0,kills:0,status:"healthy",injuries:[],scars:[],activeEffects:[],trust:20,trustLevel:"stranger",totalDamageDealt:0,totalDamageTaken:0,perfectParries:0,signatureMoveUses:0,closestCall:c.maxHP,bestWin:"",lettersWritten:[],weeksSurvived:0}}function We(o=0){return{maxHP:p.int(80,120)+o*5,currentHP:0,maxStamina:p.int(80,100)+o*3,currentStamina:0,maxFocus:p.int(50,80)+o*2,currentFocus:0,attack:p.int(8,15)+o,defense:p.int(5,12)+o,speed:p.int(5,12)+o,accuracy:p.int(70,90)+o,evasion:p.int(5,15)+o,critChance:p.int(5,15),critDamage:p.int(140,180)}}function Re(){const o=["#f5d0b9","#d4a574","#8b5a3c","#5c3d2e","#3b2417"],n=["#1a1a1a","#3d2314","#6b4423","#8b6914","#a08060","#c0c0c0","#8b0000"];return{baseIndex:p.int(0,5),eyeIndex:p.int(0,4),hairIndex:p.int(0,7),beardIndex:p.int(0,5),scarIndex:0,warpaintIndex:p.chance(.3)?p.int(1,4):0,hoodIndex:0,skinTone:p.pick(o),hairColor:p.pick(n),injuryOverlays:[]}}function Se(o){o.currentStats.currentHP=o.currentStats.maxHP,o.currentStats.currentStamina=o.currentStats.maxStamina,o.currentStats.currentFocus=0,o.activeEffects=[]}function Ne(o,n){o.injuries.push(n),o.status=n.severity==="severe"?"critical":"injured";for(const[e,i]of Object.entries(n.statPenalty)){const a=e;typeof o.currentStats[a]=="number"&&typeof i=="number"&&(o.currentStats[a]-=i)}if(o.portrait.injuryOverlays.push(`injury_${n.location}_${n.severity}`),p.chance(n.scarChance)){const e=`scar_${n.location}_${o.scars.length}`;o.scars.push(e),o.portrait.scarIndex=Math.min(o.portrait.scarIndex+1,5)}}function Ce(o,n=1){const e=[];o.injuries=o.injuries.filter(i=>{if(i.healTime-=n,i.healTime<=0){e.push(i.id);for(const[a,t]of Object.entries(i.statPenalty)){const s=a;typeof o.currentStats[s]=="number"&&typeof t=="number"&&(o.currentStats[s]+=t)}return!1}return!0}),o.portrait.injuryOverlays=o.portrait.injuryOverlays.filter(i=>!e.some(a=>i.includes(a.split("_")[1]))),o.injuries.length===0?o.status="healthy":o.injuries.some(i=>i.severity==="severe")?o.status="critical":o.status="injured"}function $e(o){o.trust>=90?o.trustLevel="legendary":o.trust>=70?o.trustLevel="bonded":o.trust>=50?o.trustLevel="ally":o.trust>=25?o.trustLevel="acquaintance":o.trustLevel="stranger"}function J(o,n){o.trust=Math.max(0,Math.min(100,o.trust+n)),$e(o)}function se(o,n){const e=Le[o.personality];return e&&e[n]?p.pick(e[n]):""}function Ye(o){const n={...o.baseStats};for(const e of Object.values(o.equipment))if(e!=null&&e.stats)for(const[i,a]of Object.entries(e.stats))typeof a=="number"&&(n[i]+=a);if(o.keepsake.statBonus)for(const[e,i]of Object.entries(o.keepsake.statBonus))typeof i=="number"&&(n[e]+=i);for(const e of[...o.traits,...o.flaws])if(e.statModifier)for(const[i,a]of Object.entries(e.statModifier))typeof a=="number"&&(n[i]+=a);return n.currentHP=n.maxHP,n.currentStamina=n.maxStamina,n.currentFocus=0,n}function je(o,n,e){const i=[`Fell to ${e} in round ${n}. ${o.location} strike proved fatal.`,`Collapsed from a ${o.weaponType} wound to the ${o.location} in round ${n}.`,`${o.location==="head"?"Skull cracked":o.location==="body"?"Heart pierced":"Leg shattered"} by ${e}'s ${o.weaponType}.`,`Bled out from wounds sustained in round ${n}. The crowd fell silent.`,`${e}'s final blow to the ${o.location} ended it all in round ${n}.`];return p.pick(i)}function qe(o){if(!p.chance(.3))return;const n=["Tell them... I tried.","Don't sell my keepsake...","Run... while you can...","It was... worth it...","Remember my name...","The crowd... they loved me...",`Tell ${o.birthplace}... I'm sorry...`,"One more fight... I could have...","My keepsake... keep it safe...","Honor... above all..."];return p.pick(n)}const $=[{id:"hardy_stock",name:"Hardy Stock",description:"Your bloodline is tough. Start with +10 max HP.",effect:"+10 Max HP",cost:5,tier:1,statBonus:{maxHP:10}},{id:"fighting_spirit",name:"Fighting Spirit",description:"Generations of warriors flow through you. +5 max Stamina.",effect:"+5 Max Stamina",cost:5,tier:1,statBonus:{maxStamina:5}},{id:"quick_learner",name:"Quick Learner",description:"Experience comes faster. +10% XP from all sources.",effect:"+10% XP",cost:5,tier:1},{id:"silver_tongue",name:"Silver Tongue",description:"Better deals at shops. -10% shop prices.",effect:"-10% Shop Prices",cost:5,tier:1},{id:"crowd_favorite",name:"Crowd Favorite",description:"The crowd remembers your lineage. Start with +10 Hype.",effect:"+10 Starting Hype",cost:5,tier:1},{id:"iron_will",name:"Iron Will",description:"Resist fear and panic. Immune to Fear status.",effect:"Fear Immunity",cost:10,tier:2,prerequisite:"hardy_stock"},{id:"second_wind",name:"Second Wind",description:"Recover faster between fights. +20% stamina regen.",effect:"+20% Stamina Regen",cost:10,tier:2,prerequisite:"fighting_spirit"},{id:"veterans_insight",name:"Veteran's Insight",description:"Start with one extra trait choice.",effect:"+1 Trait Choice",cost:10,tier:2,prerequisite:"quick_learner"},{id:"haggler",name:"Haggler",description:"Even better deals. Additional -15% shop prices.",effect:"-15% More Shop Prices",cost:10,tier:2,prerequisite:"silver_tongue"},{id:"showman",name:"Showman",description:"Hype gains increased by 25%.",effect:"+25% Hype Gain",cost:10,tier:2,prerequisite:"crowd_favorite"},{id:"unbreakable",name:"Unbreakable",description:"Survive one fatal blow per run at 1 HP.",effect:"Survive Fatal (1x)",cost:20,tier:3,prerequisite:"iron_will"},{id:"berserker_blood",name:"Berserker Blood",description:"Deal 20% more damage when below 30% HP.",effect:"+20% Low HP Damage",cost:20,tier:3,prerequisite:"second_wind"},{id:"legendary_lineage",name:"Legendary Lineage",description:"All stat bonuses from bloodline perks doubled.",effect:"2x Bloodline Stats",cost:20,tier:3,prerequisite:"veterans_insight"}];function Ue(o,n,e,i,a){const t={id:`legend_${o.id}`,fighter:{id:o.id,fullName:o.fullName,nickname:o.nickname,age:o.age,birthplace:o.birthplace,portrait:{...o.portrait},signatureTrait:o.signatureTrait.name},leagueReached:e,wins:o.wins,kills:o.kills,weeksSurvived:o.weeksSurvived,status:n,causeOfDeath:o.causeOfDeath,lastWords:o.lastWords,promiseType:i,promiseKept:a,bestWin:o.bestWin||"No notable victories",closestCall:o.closestCall,signatureMoveUses:o.signatureMoveUses,perfectParries:o.perfectParries,lettersWritten:[...o.lettersWritten],dateAdded:Date.now()};return m.addToHallOfLegends(t),Ve(o),Xe(o),t}function Ve(o,n){m.addGhostMoment({fighterId:o.id,fighterName:o.firstName,nickname:o.nickname,type:"crowd_chant",triggered:!1}),(o.equipment.weapon||o.equipment.armor)&&m.addGhostMoment({fighterId:o.id,fighterName:o.firstName,nickname:o.nickname,type:"item_drop",triggered:!1}),p.chance(.5)&&m.addGhostMoment({fighterId:o.id,fighterName:o.firstName,nickname:o.nickname,type:"story",triggered:!1})}function Xe(o){const e=.3+m.getMeta().promoterLevel*.05;if(p.chance(e)){const i={id:`heirloom_${o.id}`,name:o.keepsake.name,description:`${o.keepsake.backstory} Once belonged to ${o.fullName}.`,fromFighter:o.fullName,effect:o.keepsake.effect,recovered:!0};m.addHeirloom(i)}}function Qe(o){const n=m.getUntriggeredGhostMoments();if(n.length===0)return null;const e={arena:["crowd_chant","statue"],camp:["story"],shop:["item_drop"]},i=n.filter(t=>e[o].includes(t.type));if(i.length===0||!p.chance(.15))return null;const a=p.pick(i);return m.triggerGhostMoment(a.fighterId,a.type),a}function Ke(o){switch(o.type){case"crowd_chant":return`The crowd chants: "${o.nickname}! ${o.nickname}!" Someone remembers...`;case"item_drop":return`You find a worn item. A tag reads: "Property of ${o.fighterName} '${o.nickname}'"`;case"statue":return`A weathered statue stands in the corner. The plaque reads: "${o.fighterName} '${o.nickname}' - Never Forgotten"`;case"story":return`An old fighter tells tales of ${o.fighterName} '${o.nickname}'. The legend lives on.`;default:return""}}function Je(){const o=m.getMeta(),n={};let e=!1;for(const i of o.unlockedPerks){const a=$.find(t=>t.id===i);if(a!=null&&a.statBonus)for(const[t,s]of Object.entries(a.statBonus))n[t]=(n[t]||0)+s;i==="legendary_lineage"&&(e=!0)}if(e)for(const i of Object.keys(n))n[i]*=2;return n}function le(o){const n=m.getMeta(),e=$.find(i=>i.id===o);if(!e)return{canPurchase:!1,reason:"Perk not found"};if(n.unlockedPerks.includes(o))return{canPurchase:!1,reason:"Already owned"};if(e.prerequisite&&!n.unlockedPerks.includes(e.prerequisite)){const i=$.find(a=>a.id===e.prerequisite);return{canPurchase:!1,reason:`Requires: ${(i==null?void 0:i.name)||e.prerequisite}`}}return n.bloodlinePoints<e.cost?{canPurchase:!1,reason:`Need ${e.cost} points (have ${n.bloodlinePoints})`}:{canPurchase:!0,reason:""}}function Ze(o){const{canPurchase:n}=le(o);if(!n)return!1;const e=$.find(i=>i.id===o);return e&&m.spendBloodlinePoints(e.cost)?(m.unlockPerk(o),!0):!1}class Z{static renderPortrait(n,e,i,a,t){const s=n.add.container(i,a),r=t/80,l=n.add.graphics();l.fillStyle(1709072,1),l.fillCircle(0,0,(t/2+5)*1.1),l.fillStyle(657413,1),l.fillCircle(0,0,t/2),l.lineStyle(3,5917242,1),l.strokeCircle(0,0,(t/2+5)*1.1),s.add(l);const c=n.add.graphics(),h=k.Display.Color.HexStringToColor(e.skinTone).color,d=k.Display.Color.HexStringToColor(e.skinTone).darken(40).color;c.fillStyle(d,1),c.fillEllipse(0,t*.42,t*.7,t*.25),c.fillStyle(h,1),c.fillRect(-t*.12,t*.2,t*.24,t*.25),s.add(c);const g=n.add.graphics();g.fillStyle(d,.6),g.fillEllipse(0,t*.05,t*.44,t*.5),g.fillStyle(h,1),g.fillEllipse(0,0,t*.42,t*.48);const y=k.Display.Color.HexStringToColor(e.skinTone).lighten(15).color;g.fillStyle(y,.4),g.fillEllipse(-t*.12,-t*.02,t*.08,t*.1),g.fillEllipse(t*.12,-t*.02,t*.08,t*.1),g.fillStyle(y,.3),g.fillEllipse(0,-t*.05,t*.04,t*.12),s.add(g);const w=n.add.graphics(),S=-t*.06,v=t*.11;w.fillStyle(d,.4),w.fillEllipse(-v,S,t*.1,t*.06),w.fillEllipse(v,S,t*.1,t*.06),w.fillStyle(16119280,1),w.fillEllipse(-v,S,t*.08,t*.045),w.fillEllipse(v,S,t*.08,t*.045);const R=[4863264,2771520,3816016,5914656,2767402],B=R[e.eyeIndex%R.length],O=[{x:0,y:0},{x:1,y:0},{x:-1,y:0},{x:0,y:-.5},{x:.5,y:.5}],C=O[e.eyeIndex%O.length];w.fillStyle(B,1),w.fillCircle(-v+C.x,S+C.y,t*.03),w.fillCircle(v+C.x,S+C.y,t*.03),w.fillStyle(657930,1),w.fillCircle(-v+C.x,S+C.y,t*.015),w.fillCircle(v+C.x,S+C.y,t*.015),w.fillStyle(16777215,.6),w.fillCircle(-v-t*.01+C.x,S-t*.01,t*.008),w.fillCircle(v-t*.01+C.x,S-t*.01,t*.008);const N=k.Display.Color.HexStringToColor(e.hairColor).darken(20).color;w.lineStyle(2*r,N,.9);const fe=[()=>{w.moveTo(-v-t*.05,S-t*.06),w.lineTo(-v+t*.04,S-t*.055),w.moveTo(v-t*.04,S-t*.055),w.lineTo(v+t*.05,S-t*.06)},()=>{w.moveTo(-v-t*.05,S-t*.05),w.lineTo(-v+t*.04,S-t*.07),w.moveTo(v-t*.04,S-t*.07),w.lineTo(v+t*.05,S-t*.05)},()=>{w.moveTo(-v-t*.05,S-t*.07),w.lineTo(-v+t*.04,S-t*.06),w.moveTo(v-t*.04,S-t*.06),w.lineTo(v+t*.05,S-t*.07)}];fe[e.baseIndex%fe.length](),w.strokePath(),s.add(w);const F=n.add.graphics(),X=t*.02;F.fillStyle(d,.3),F.fillEllipse(t*.02,X+t*.05,t*.05,t*.08),F.lineStyle(1.5*r,d,.4),F.moveTo(0,S+t*.06),F.lineTo(0,X+t*.03),F.strokePath(),F.fillStyle(d,.5),F.fillCircle(-t*.025,X+t*.07,t*.015),F.fillCircle(t*.025,X+t*.07,t*.015),s.add(F);const T=n.add.graphics(),A=t*.14,q=k.Display.Color.HexStringToColor(e.skinTone).darken(25).color,ge=[()=>{T.lineStyle(2*r,q,.8),T.moveTo(-t*.06,A),T.lineTo(t*.06,A),T.strokePath(),T.fillStyle(d,.2),T.fillEllipse(0,A-t*.01,t*.06,t*.015)},()=>{T.lineStyle(2*r,q,.8),T.beginPath(),T.arc(0,A-t*.03,t*.06,.3,Math.PI-.3),T.strokePath()},()=>{T.lineStyle(2*r,q,.8),T.beginPath(),T.arc(0,A+t*.05,t*.06,Math.PI+.3,-.3),T.strokePath()},()=>{T.fillStyle(1708560,1),T.fillRect(-t*.05,A-t*.01,t*.1,t*.03),T.fillStyle(15789024,.8),T.fillRect(-t*.04,A-t*.008,t*.08,t*.015),T.lineStyle(1.5*r,q,.8),T.strokeRect(-t*.05,A-t*.01,t*.1,t*.03)},()=>{T.lineStyle(2*r,q,.8),T.moveTo(-t*.06,A+t*.01),T.lineTo(t*.02,A-t*.01),T.lineTo(t*.06,A-t*.02),T.strokePath()}];ge[e.baseIndex%ge.length](),s.add(T);const W=n.add.graphics();if(W.lineStyle(1*r,d,.3),W.moveTo(-t*.18,t*.08),W.lineTo(-t*.08,t*.22),W.lineTo(0,t*.24),W.lineTo(t*.08,t*.22),W.lineTo(t*.18,t*.08),W.strokePath(),s.add(W),e.hairIndex>0){const u=n.add.graphics(),x=k.Display.Color.HexStringToColor(e.hairColor).color,Y=k.Display.Color.HexStringToColor(e.hairColor).lighten(20).color,L=k.Display.Color.HexStringToColor(e.hairColor).darken(30).color,_=[()=>{},()=>{u.fillStyle(x,1),u.fillEllipse(0,-t*.22,t*.38,t*.18),u.lineStyle(1,L,.3);for(let E=-3;E<=3;E++)u.moveTo(E*t*.05,-t*.32),u.lineTo(E*t*.06,-t*.18);u.strokePath()},()=>{u.fillStyle(x,1),u.fillEllipse(0,-t*.2,t*.42,t*.22),u.fillRect(-t*.23,-t*.22,t*.08,t*.3),u.fillRect(t*.15,-t*.22,t*.08,t*.3),u.fillStyle(Y,.3),u.fillEllipse(-t*.08,-t*.28,t*.1,t*.06)},()=>{u.fillStyle(x,1),u.fillEllipse(0,-t*.18,t*.45,t*.25),u.fillRect(-t*.28,-t*.2,t*.12,t*.5),u.fillRect(t*.16,-t*.2,t*.12,t*.5),u.lineStyle(1,L,.4),u.moveTo(-t*.22,-t*.1),u.lineTo(-t*.24,t*.25),u.moveTo(t*.22,-t*.1),u.lineTo(t*.24,t*.25),u.strokePath()},()=>{u.fillStyle(x,1),u.beginPath(),u.moveTo(-t*.08,-t*.2),u.lineTo(0,-t*.42),u.lineTo(t*.08,-t*.2),u.closePath(),u.fillPath(),u.lineStyle(1,Y,.3),u.moveTo(0,-t*.4),u.lineTo(0,-t*.22),u.strokePath()},()=>{u.fillStyle(x,1),u.fillEllipse(0,-t*.22,t*.4,t*.16),u.lineStyle(1,L,.4);for(let E=-2;E<=2;E++)u.moveTo(E*t*.06,-t*.3),u.lineTo(E*t*.08+t*.05,-t*.15);u.strokePath()},()=>{u.fillStyle(x,1),u.fillRect(-t*.25,-t*.18,t*.1,t*.25),u.fillRect(t*.15,-t*.18,t*.1,t*.25),u.fillEllipse(0,-t*.2,t*.2,t*.08)},()=>{u.fillStyle(x,1),u.fillEllipse(0,-t*.22,t*.38,t*.15),u.fillStyle(4864554,1),u.fillRect(t*.15,-t*.22,t*.04,t*.08),u.fillStyle(x,1),u.fillRect(t*.18,-t*.2,t*.06,t*.15)}];_[e.hairIndex%_.length](),s.add(u)}if(e.beardIndex>0){const u=n.add.graphics(),x=k.Display.Color.HexStringToColor(e.hairColor).color,Y=k.Display.Color.HexStringToColor(e.hairColor).darken(20).color,L=[()=>{},()=>{u.fillStyle(x,.3);for(let _=0;_<30;_++){const E=(Math.random()-.5)*t*.3,Ae=t*.1+Math.random()*t*.15;u.fillRect(E,Ae,1,2)}},()=>{u.fillStyle(x,1),u.fillEllipse(0,t*.18,t*.25,t*.12),u.fillRect(-t*.16,A-t*.02,t*.32,t*.1),u.lineStyle(1,Y,.3);for(let _=-2;_<=2;_++)u.moveTo(_*t*.05,t*.12),u.lineTo(_*t*.05,t*.25);u.strokePath()},()=>{u.fillStyle(x,1),u.fillEllipse(0,t*.2,t*.28,t*.18),u.fillEllipse(-t*.04,A-t*.02,t*.06,t*.03),u.fillEllipse(t*.04,A-t*.02,t*.06,t*.03)},()=>{u.fillStyle(x,1),u.beginPath(),u.moveTo(-t*.2,t*.12),u.lineTo(-t*.15,t*.35),u.lineTo(0,t*.4),u.lineTo(t*.15,t*.35),u.lineTo(t*.2,t*.12),u.closePath(),u.fillPath()},()=>{u.fillStyle(x,1),u.fillEllipse(0,t*.2,t*.1,t*.12),u.fillRect(-t*.02,A+t*.02,t*.04,t*.04)}];L[e.beardIndex%L.length](),s.add(u)}if(e.scarIndex>0){const u=n.add.graphics(),x=9132634,Y=11567232;u.lineStyle(2.5*r,x,.7);const L=[()=>{},()=>{u.moveTo(-t*.2,-t*.15),u.lineTo(-t*.05,t*.05),u.strokePath(),u.lineStyle(1*r,Y,.4),u.moveTo(-t*.19,-t*.14),u.lineTo(-t*.04,t*.04),u.strokePath()},()=>{u.moveTo(t*.08,-t*.02),u.lineTo(t*.22,t*.08),u.strokePath()},()=>{u.moveTo(-t*.1,-t*.22),u.lineTo(t*.12,-t*.18),u.strokePath()},()=>{u.moveTo(-t*.1,0),u.lineTo(t*.02,t*.1),u.strokePath(),u.moveTo(t*.02,0),u.lineTo(-t*.1,t*.1),u.strokePath()},()=>{u.moveTo(-t*.18,-t*.1),u.lineTo(-t*.08,t*.02),u.strokePath(),u.moveTo(t*.12,-t*.05),u.lineTo(t*.2,t*.1),u.strokePath(),u.moveTo(0,t*.18),u.lineTo(t*.08,t*.22),u.strokePath()}];L[e.scarIndex%L.length](),s.add(u)}if(e.warpaintIndex>0){const u=n.add.graphics(),x=[()=>{},()=>{u.fillStyle(1710618,.7),u.fillRect(-t*.22,S-t*.02,t*.14,t*.04),u.fillRect(t*.08,S-t*.02,t*.14,t*.04)},()=>{u.fillStyle(9109504,.6),u.fillRect(-t*.02,-t*.3,t*.04,t*.5)},()=>{u.lineStyle(3*r,1710618,.7),u.moveTo(-t*.2,-t*.12),u.lineTo(-t*.12,-t*.08),u.lineTo(-t*.2,-t*.04),u.strokePath(),u.moveTo(t*.2,-t*.12),u.lineTo(t*.12,-t*.08),u.lineTo(t*.2,-t*.04),u.strokePath()},()=>{u.fillStyle(9109504,.6),u.fillRect(-v-t*.01,S+t*.04,t*.02,t*.12),u.fillRect(v-t*.01,S+t*.04,t*.02,t*.12)}];x[e.warpaintIndex%x.length](),s.add(u)}if(e.hoodIndex>0){const u=n.add.graphics(),x=[()=>{},()=>{u.fillStyle(2760474,.95),u.beginPath(),u.moveTo(-t*.35,t*.1),u.lineTo(-t*.32,-t*.25),u.lineTo(-t*.15,-t*.38),u.lineTo(0,-t*.42),u.lineTo(t*.15,-t*.38),u.lineTo(t*.32,-t*.25),u.lineTo(t*.35,t*.1),u.closePath(),u.fillPath(),u.fillStyle(657413,.5),u.fillEllipse(0,-t*.05,t*.28,t*.35)},()=>{u.fillStyle(5921370,1),u.fillEllipse(0,-t*.12,t*.4,t*.32),u.fillRect(-t*.02,-t*.25,t*.04,t*.2),u.fillStyle(1710618,1),u.fillRect(-t*.15,S-t*.01,t*.08,t*.03),u.fillRect(t*.07,S-t*.01,t*.08,t*.03),u.fillStyle(9079434,.4),u.fillEllipse(-t*.1,-t*.25,t*.08,t*.04)}];x[e.hoodIndex%x.length](),s.add(u)}for(const u of e.injuryOverlays){const x=n.add.graphics();u.includes("head")?(x.fillStyle(15261904,.9),x.fillRect(-t*.2,-t*.28,t*.4,t*.06),x.fillStyle(9109504,.4),x.fillCircle(-t*.05,-t*.25,t*.04)):u.includes("body")&&(x.fillStyle(4862032,.3),x.fillEllipse(t*.1,t*.15,t*.08,t*.06)),s.add(x)}const z=n.add.graphics();return z.lineStyle(2,13216089,.15),z.strokeCircle(0,0,(t/2+8)*1.1),s.add(z),n.tweens.add({targets:s,scaleX:1.01,scaleY:.99,duration:3e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),s}static renderMiniPortrait(n,e,i,a,t){const s=n.add.container(i,a),r=n.add.graphics();r.fillStyle(1709072,1),r.fillCircle(0,0,t/2+2),r.lineStyle(2,5917242,1),r.strokeCircle(0,0,t/2+2),s.add(r);const l=k.Display.Color.HexStringToColor(e.skinTone).color,c=n.add.graphics();c.fillStyle(l,1),c.fillCircle(0,0,t/2-2),s.add(c);const h=n.add.graphics();return h.fillStyle(16777215,1),h.fillCircle(-t*.15,-t*.08,t*.08),h.fillCircle(t*.15,-t*.08,t*.08),h.fillStyle(2759184,1),h.fillCircle(-t*.15,-t*.08,t*.04),h.fillCircle(t*.15,-t*.08,t*.04),s.add(h),s}}class ze extends k.Scene{constructor(){super({key:"RecruitScene"});f(this,"candidates",[]);f(this,"selectedIndex",-1);f(this,"candidateContainers",[]);f(this,"detailsContainer")}create(){const e=m.getRun();p.init(e.seed);const i=m.getMeta();this.candidates=[ae(i.promoterLevel),ae(i.promoterLevel),ae(i.promoterLevel)];const a=Je();for(const t of this.candidates){for(const[s,r]of Object.entries(a))typeof r=="number"&&s in t.baseStats&&(t.baseStats[s]+=r);t.currentStats=Ye(t)}this.createBackground(),this.createHeader(),this.createCandidateCards(),this.createDetailsPanel(),this.createConfirmButton(),this.cameras.main.fadeIn(300)}createBackground(){const{width:e,height:i}=this.cameras.main,a=this.add.graphics();if(a.fillGradientStyle(1709072,1709072,2760474,2760474),a.fillRect(0,0,e,i),this.textures.exists("parchment_overlay")){const t=this.add.image(e/2,i/2,"parchment_overlay");t.setAlpha(.08),t.setDisplaySize(e,i)}}createHeader(){const{width:e}=this.cameras.main;this.add.text(e/2,40,"CHOOSE YOUR FIGHTER",{fontFamily:"Georgia, serif",fontSize:"24px",color:"#c9a959",stroke:"#000000",strokeThickness:3}).setOrigin(.5),this.add.text(e/2,70,"Three souls await judgment. Only one will enter the arena.",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b7355",fontStyle:"italic"}).setOrigin(.5)}createCandidateCards(){const{width:e}=this.cameras.main,i=110,a=e/2-i*1.5,t=180;this.candidates.forEach((s,r)=>{const l=this.createCandidateCard(s,a+r*(i+10),t,r);this.candidateContainers.push(l)})}createCandidateCard(e,i,a,t){const s=this.add.container(i,a),r=110,l=200,c=this.add.graphics();c.fillStyle(2760474,1),c.fillRoundedRect(0,0,r,l,8),c.lineStyle(2,5917242,1),c.strokeRoundedRect(0,0,r,l,8),s.add(c);const h=Z.renderMiniPortrait(this,e.portrait,r/2,50,60);s.add(h);const d=this.add.text(r/2,95,e.firstName,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#c9a959"}).setOrigin(.5);s.add(d);const g=this.add.text(r/2,112,`"${e.nickname}"`,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355",fontStyle:"italic"}).setOrigin(.5);s.add(g);const y=this.add.text(r/2,130,`Age ${e.age}`,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#5a4a3a"}).setOrigin(.5);s.add(y);const w=this.add.text(r/2,155,e.signatureTrait.name,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#6b8e23"}).setOrigin(.5);if(s.add(w),e.flaws.length>0){const v=this.add.text(r/2,175,e.flaws[0].name,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b4513"}).setOrigin(.5);s.add(v)}const S=this.add.rectangle(r/2,l/2,r,l,16777215,0);return S.setInteractive({useHandCursor:!0}),s.add(S),S.on("pointerover",()=>{this.selectedIndex!==t&&(c.clear(),c.fillStyle(3813162,1),c.fillRoundedRect(0,0,r,l,8),c.lineStyle(2,9139029,1),c.strokeRoundedRect(0,0,r,l,8))}),S.on("pointerout",()=>{this.selectedIndex!==t&&(c.clear(),c.fillStyle(2760474,1),c.fillRoundedRect(0,0,r,l,8),c.lineStyle(2,5917242,1),c.strokeRoundedRect(0,0,r,l,8))}),S.on("pointerdown",()=>{this.selectCandidate(t)}),s}createDetailsPanel(){const{width:e,height:i}=this.cameras.main;this.detailsContainer=this.add.container(e/2,400);const a=this.add.text(0,0,"Select a fighter to view details",{fontFamily:"Georgia, serif",fontSize:"14px",color:"#5a4a3a",fontStyle:"italic"}).setOrigin(.5);this.detailsContainer.add(a)}updateDetailsPanel(e){this.detailsContainer.removeAll(!0);const i=-100,a=this.add.text(0,i,e.fullName,{fontFamily:"Georgia, serif",fontSize:"18px",color:"#c9a959"}).setOrigin(.5);this.detailsContainer.add(a);const t=this.add.text(0,i+30,e.backstory,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b7355",fontStyle:"italic",wordWrap:{width:320},align:"center"}).setOrigin(.5);this.detailsContainer.add(t);const s=e.currentStats,r=`HP: ${s.maxHP} | ATK: ${s.attack} | DEF: ${s.defense} | SPD: ${s.speed}`,l=this.add.text(0,i+80,r,{fontFamily:"Georgia, serif",fontSize:"12px",color:"#c9a959"}).setOrigin(.5);this.detailsContainer.add(l);const c=this.add.text(0,i+110,`Signature: ${e.signatureTrait.name}`,{fontFamily:"Georgia, serif",fontSize:"13px",color:"#6b8e23"}).setOrigin(.5);this.detailsContainer.add(c);const h=this.add.text(0,i+130,e.signatureTrait.description,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#5a4a3a",wordWrap:{width:280},align:"center"}).setOrigin(.5);if(this.detailsContainer.add(h),e.flaws.length>0){const y=this.add.text(0,i+165,`Flaw: ${e.flaws[0].name}`,{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b4513"}).setOrigin(.5);this.detailsContainer.add(y);const w=this.add.text(0,i+183,e.flaws[0].description,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#5a4a3a"}).setOrigin(.5);this.detailsContainer.add(w)}const d=this.add.text(0,i+215,`Keepsake: ${e.keepsake.name}`,{fontFamily:"Georgia, serif",fontSize:"12px",color:"#c9a959"}).setOrigin(.5);this.detailsContainer.add(d);const g=this.add.text(0,i+233,e.keepsake.effect,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355"}).setOrigin(.5);this.detailsContainer.add(g)}selectCandidate(e){if(this.selectedIndex>=0){const s=this.candidateContainers[this.selectedIndex].first;s.clear(),s.fillStyle(2760474,1),s.fillRoundedRect(0,0,110,200,8),s.lineStyle(2,5917242,1),s.strokeRoundedRect(0,0,110,200,8)}this.selectedIndex=e;const a=this.candidateContainers[e].first;a.clear(),a.fillStyle(3813162,1),a.fillRoundedRect(0,0,110,200,8),a.lineStyle(3,13216089,1),a.strokeRoundedRect(0,0,110,200,8),this.updateDetailsPanel(this.candidates[e])}createConfirmButton(){const{width:e,height:i}=this.cameras.main,a=b.createButton(this,e/2,i-60,"RECRUIT THIS FIGHTER",()=>this.confirmSelection(),{width:240,height:50,primary:!0});a.setAlpha(.5),this.events.on("update",()=>{this.selectedIndex>=0&&a.setAlpha(1)})}confirmSelection(){if(this.selectedIndex<0)return;const e=this.candidates[this.selectedIndex],i=m.getRun();i.fighter=e,m.updateRun(i),this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("PromiseScene")})}}const ne=[{id:"sleepless_night",title:"Sleepless Night",description:"Your fighter tosses and turns, haunted by memories. You hear muttering in the dark.",category:"camp",choices:[{id:"comfort",text:"Sit with them, offer comfort",effects:{trust:8,stamina:-10},resultText:"You stay up talking until dawn. The bond strengthens, but rest was lost."},{id:"leave",text:"Let them work through it alone",effects:{trust:-3},resultText:"Sometimes people need space. Whether this was the right call remains to be seen."},{id:"drink",text:"Share a drink to ease the mind",effects:{trust:5,hp:-5},resultText:"The drink helps, but the hangover tomorrow won't be pleasant."}]},{id:"old_friend",title:"An Old Friend",description:"Someone from your fighter's past appears at the camp. Their expression is unreadable.",category:"camp",choices:[{id:"welcome",text:"Welcome them warmly",effects:{trust:5,gold:-15},resultText:"You provide food and drink. The visitor leaves with a smile and a lighter purse for you."},{id:"suspicious",text:"Keep them at arm's length",effects:{trust:-2},resultText:"The visitor leaves, disappointed. Your fighter seems conflicted."},{id:"private",text:"Give them privacy to talk",effects:{trust:3},resultText:"Whatever was said stays between them. Your fighter seems... different after."}]},{id:"rival_encounter",title:"Rival's Shadow",description:"Your fighter's rival has been seen nearby, watching your training sessions.",category:"camp",choices:[{id:"confront",text:"Confront them directly",effects:{trust:3,fame:5},resultText:"A tense exchange of words. The crowd nearby takes notice. Good for reputation."},{id:"ignore",text:"Ignore them completely",effects:{trust:-2},resultText:"Your fighter seems disappointed you didn't stand up for them."},{id:"wave",text:"Wave mockingly",effects:{fame:3},resultText:"A small psychological victory. The rival stalks off, fuming."}]},{id:"injured_rest",title:"The Weight of Wounds",description:"Your fighter's injuries are clearly bothering them. They wince with every movement.",category:"camp",requirements:{hasInjury:!0},choices:[{id:"force_rest",text:"Insist on complete rest",effects:{trust:5,injuryHeal:1},resultText:"A day of nothing but rest and recovery. The wounds begin to close."},{id:"push_through",text:"Tell them to push through",effects:{trust:-5,stamina:10},resultText:"They train through the pain. Tougher, but at what cost?"},{id:"healer",text:"Pay for a healer visit",effects:{gold:-30,trust:3,injuryHeal:1},resultText:"Professional care makes a difference. Money well spent."}]},{id:"crowd_recognition",title:"Famous Face",description:"People in the market are pointing and whispering. Your fighter has been recognized.",category:"camp",requirements:{minWeek:3},choices:[{id:"acknowledge",text:"Wave to the crowd",effects:{fame:8,trust:2},resultText:"The crowd cheers! Your fighter beams with pride."},{id:"humble",text:"Stay humble, keep walking",effects:{trust:5},resultText:"A quiet moment of recognition. Character matters more than fame."},{id:"showoff",text:"Put on a show",effects:{fame:15,stamina:-15,trust:-3},resultText:"A dazzling display! But the exertion takes its toll, and your fighter seems annoyed."}]},{id:"nightmare",title:"Dark Dreams",description:"Your fighter wakes screaming from a nightmare about dying in the arena.",category:"camp",choices:[{id:"promise",text:`"I won't let that happen."`,effects:{trust:10},resultText:"Your words carry weight. The promise hangs in the air between you."},{id:"realistic",text:`"It's a real risk. We both know that."`,effects:{trust:2},resultText:"Honesty is respected, if not comforting."},{id:"dismiss",text:'"Just a dream. Go back to sleep."',effects:{trust:-5},resultText:"Your fighter rolls over, alone with their fears."}]},{id:"shady_surgeon",title:"The Surgeon's Offer",description:'A hooded figure approaches with a leather bag of tools. "I can fix those injuries... permanently. For a price."',category:"offer",requirements:{hasInjury:!0},choices:[{id:"accept",text:"Accept the surgery",effects:{gold:-50,injuryHeal:3,injury:"minor",trust:-5},resultText:"The surgery is painful and the methods questionable, but the wounds heal faster. Something feels... different."},{id:"refuse",text:"Refuse firmly",effects:{trust:5},resultText:'Your fighter relaxes visibly. "Thank you for not selling me to butchers."'},{id:"bargain",text:"Negotiate a better price",effects:{gold:-25,injuryHeal:2,trust:-3},resultText:"A lesser procedure at a lesser price. The results are... acceptable."}]},{id:"cursed_weapon",title:"The Black Blade",description:'A merchant offers a blade that seems to drink in the light. "Powerful. Deadly. But demanding."',category:"offer",choices:[{id:"accept",text:"Take the blade",effects:{gold:-40,hp:-10,buff:"cursed_weapon"},resultText:"The blade feels wrong in the hand, but the power is undeniable."},{id:"refuse",text:"Walk away",effects:{trust:3},resultText:`"Wise choice," your fighter murmurs. Some things aren't worth the cost.`},{id:"examine",text:"Examine it closely first",effects:{gold:-10},resultText:"You pay for an appraisal. The blade is powerful but cursed. Knowledge gained."}]},{id:"sponsor_deal",title:"The Sponsor",description:"A wealthy patron offers gold in exchange for... loyalty. Their smile doesn't reach their eyes.",category:"offer",requirements:{minWeek:2},choices:[{id:"accept",text:"Accept the sponsorship",effects:{gold:100,reputation:-5,trust:-10},resultText:"The gold flows freely, but strings are attached. Your fighter looks at you differently now."},{id:"refuse",text:"Decline politely",effects:{trust:8},resultText:`"We don't need their kind," your fighter says with relief.`},{id:"negotiate",text:"Counter-offer with terms",effects:{gold:50,reputation:-2,trust:-3},resultText:"A compromise is reached. Less gold, fewer strings."}]},{id:"poison_offer",title:"Unfair Advantage",description:`A quiet voice in the dark offers a vial. "Coat your blade. They'll never know."`,category:"offer",choices:[{id:"accept",text:"Take the poison",effects:{gold:-30,trust:-15,buff:"poison_blade"},resultText:"Your fighter's face hardens. Honor is a luxury, after all."},{id:"refuse_loudly",text:"Refuse and report them",effects:{trust:10,fame:5},resultText:"Word spreads of your honor. Your fighter stands taller."},{id:"refuse_quietly",text:"Just say no",effects:{trust:5},resultText:"The figure melts into shadows. Some offers are better forgotten."}]},{id:"letter_home",title:"A Letter Home",description:"Your fighter sits with quill and parchment, struggling to find words.",category:"letter",choices:[{id:"help",text:"Help them write",effects:{trust:8},resultText:"Together you craft a message of hope and determination. The letter is finished."},{id:"private",text:"Give them privacy",effects:{trust:3},resultText:"Some words are too personal to share. The letter is sealed in silence."},{id:"discourage",text:"Suggest they focus on training instead",effects:{trust:-8,stamina:10},resultText:"The parchment is put away. Your fighter trains harder, but something is lost."}]},{id:"letter_response",title:"News From Home",description:"A letter arrives for your fighter. Their hands tremble as they read.",category:"letter",choices:[{id:"ask",text:"Ask what it says",effects:{trust:5},resultText:"They share the news. Family is well. A weight lifts from their shoulders."},{id:"space",text:"Give them time alone",effects:{trust:3},resultText:"When they emerge, their eyes are red but their resolve is firm."},{id:"practical",text:"Remind them we have work to do",effects:{trust:-5},resultText:"The letter is folded away. Duty calls, but at what cost?"}]},{id:"write_legacy",title:"Words for the Future",description:"Your fighter wants to write something to be read if they don't survive.",category:"letter",choices:[{id:"support",text:"Help them prepare this",effects:{trust:12},resultText:"A sobering task, but important. The letter is sealed and stored safely."},{id:"optimistic",text:`"You'll deliver it yourself."`,effects:{trust:5},resultText:"Your confidence is infectious. They smile, but keep writing anyway."},{id:"avoid",text:"Change the subject",effects:{trust:-3},resultText:"The topic is dropped, but the unwritten words hang between you."}]},{id:"stray_dog",title:"The Stray",description:"A scrawny dog has been following your fighter around camp.",category:"event",choices:[{id:"adopt",text:"Keep the dog",effects:{trust:8,gold:-10},resultText:"Your fighter names it immediately. Loyalty comes in many forms."},{id:"feed",text:"Feed it and send it away",effects:{trust:2,gold:-5},resultText:"A small kindness. The dog looks back once before leaving."},{id:"ignore",text:"Ignore it",effects:{trust:-2},resultText:"The dog eventually leaves. Your fighter watches it go with sad eyes."}]},{id:"gambler",title:"Double or Nothing",description:"Your fighter found a dice game in the back alleys.",category:"event",requirements:{minTrust:30},choices:[{id:"allow",text:"Let them gamble",effects:{gold:30,trust:5},resultText:"Lady luck smiles! Your fighter returns with a grin and coin."},{id:"forbid",text:"Forbid it",effects:{trust:-8},resultText:"They obey, but resentment simmers. You're not their parent."},{id:"join",text:"Join the game",effects:{gold:-20,trust:10},resultText:"You lose some coin but gain a memory. Worth every copper."}]},{id:"arena_tour",title:"Sacred Ground",description:"An opportunity to visit the Grand Arena at night, when it's empty.",category:"event",choices:[{id:"go",text:"Go together",effects:{trust:10,fame:3},resultText:"Standing on the sand, imagining the crowds. A moment of shared dreams."},{id:"train",text:"Use the time to train instead",effects:{stamina:15,trust:-2},resultText:"Practical, but something magical is missed."},{id:"alone",text:"Send them alone",effects:{trust:5},resultText:"Some experiences are personal. They return with fire in their eyes."}]},{id:"bad_food",title:"Spoiled Supplies",description:"Your food stores have gone bad. Someone needs to deal with this.",category:"event",choices:[{id:"buy_new",text:"Buy fresh supplies",effects:{gold:-25,trust:3},resultText:"New supplies secured. Your fighter appreciates proper meals."},{id:"make_do",text:"Make do with what's edible",effects:{hp:-10,trust:-3},resultText:"A rough few days. Stomachs suffer, but coin is saved."},{id:"hunt",text:"Go hunting for fresh meat",effects:{stamina:-10,trust:5},resultText:"A successful hunt! Fresh meat and bonding time."}]},{id:"festival",title:"Festival Night",description:"The town is celebrating. Music and laughter fill the streets.",category:"event",choices:[{id:"celebrate",text:"Join the celebration",effects:{gold:-15,trust:8,stamina:-10},resultText:"A night of joy and revelry. Some things matter more than training."},{id:"observe",text:"Watch from the edge",effects:{trust:3},resultText:"You share quiet observations about the crowd. A different kind of bonding."},{id:"train",text:"Use the empty training grounds",effects:{stamina:15,trust:-5},resultText:"Productive, but your fighter keeps glancing toward the music."}]}],et=[{id:"survival",name:"I'll get you out alive",description:"Promise to prioritize survival. Earlier and cheaper retirement options.",effect:"-30% retirement cost, available after 3 wins",mechanicBonus:{retirementDiscount:.3,earlyRetirement:!0}},{id:"glory",name:"We'll win the belt",description:"Promise to fight for the championship. Greater rewards, harder path.",effect:"+20% gold/fame rewards, +10% enemy stats",mechanicBonus:{rewardBonus:.2,enemyStatBonus:.1}},{id:"honor",name:"We fight with honor",description:"Promise to fight fairly. Crowd loves you, fewer shady opportunities.",effect:"+30% crowd hype gain, no shady offers",mechanicBonus:{hypeBonus:.3,noShadyOffers:!0}},{id:"vengeance",name:"We'll make them pay",description:"Promise to defeat every rival. Bonus damage to rivals, they seek you out.",effect:"+25% damage to rivals, rivals appear more often",mechanicBonus:{rivalDamageBonus:.25,rivalFrequency:2}},{id:"legacy",name:"Your name will echo forever",description:"Promise to build a legend. Extra bloodline points, more fame.",effect:"+50% fame gain, +1 bloodline point per league advanced",mechanicBonus:{fameBonus:.5,bloodlineBonus:1}}];class tt extends k.Scene{constructor(){super({key:"PromiseScene"});f(this,"selectedPromise",null);f(this,"promiseContainers",new Map)}create(){var t;const{width:e,height:i}=this.cameras.main,a=m.getRun();this.createBackground(),this.createHeader(((t=a.fighter)==null?void 0:t.firstName)||"Fighter"),this.createPromiseCards(),this.createConfirmButton(),this.cameras.main.fadeIn(300)}createBackground(){const{width:e,height:i}=this.cameras.main,a=this.add.graphics();if(a.fillGradientStyle(1709072,1709072,2760474,2760474),a.fillRect(0,0,e,i),this.textures.exists("parchment_overlay")){const t=this.add.image(e/2,i/2,"parchment_overlay");t.setAlpha(.08),t.setDisplaySize(e,i)}}createHeader(e){const{width:i}=this.cameras.main;this.add.text(i/2,40,"MAKE A PROMISE",{fontFamily:"Georgia, serif",fontSize:"24px",color:"#c9a959",stroke:"#000000",strokeThickness:3}).setOrigin(.5),this.add.text(i/2,70,`What will you promise ${e}?`,{fontFamily:"Georgia, serif",fontSize:"13px",color:"#8b7355",fontStyle:"italic"}).setOrigin(.5),this.add.text(i/2,90,"This choice will define your journey together.",{fontFamily:"Georgia, serif",fontSize:"11px",color:"#5a4a3a"}).setOrigin(.5)}createPromiseCards(){const{width:e}=this.cameras.main,i=320,a=100,t=130,s=110;et.forEach((r,l)=>{const c=t+l*s,h=this.createPromiseCard(r,e/2-i/2,c,i,a);this.promiseContainers.set(r.id,h)})}createPromiseCard(e,i,a,t,s){const r=this.add.container(i,a),l=this.add.graphics();l.fillStyle(2760474,1),l.fillRoundedRect(0,0,t,s,8),l.lineStyle(2,5917242,1),l.strokeRoundedRect(0,0,t,s,8),r.add(l);const c=this.add.text(t/2,18,`"${e.name}"`,{fontFamily:"Georgia, serif",fontSize:"15px",color:"#c9a959"}).setOrigin(.5);r.add(c);const h=this.add.text(t/2,42,e.description,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b7355",wordWrap:{width:t-30},align:"center"}).setOrigin(.5);r.add(h);const d=this.add.text(t/2,75,e.effect,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#6b8e23"}).setOrigin(.5);r.add(d);const g=this.add.rectangle(t/2,s/2,t,s,16777215,0);return g.setInteractive({useHandCursor:!0}),r.add(g),g.on("pointerover",()=>{this.selectedPromise!==e.id&&(l.clear(),l.fillStyle(3813162,1),l.fillRoundedRect(0,0,t,s,8),l.lineStyle(2,9139029,1),l.strokeRoundedRect(0,0,t,s,8))}),g.on("pointerout",()=>{this.selectedPromise!==e.id&&(l.clear(),l.fillStyle(2760474,1),l.fillRoundedRect(0,0,t,s,8),l.lineStyle(2,5917242,1),l.strokeRoundedRect(0,0,t,s,8))}),g.on("pointerdown",()=>{this.selectPromise(e.id,t,s)}),r}selectPromise(e,i,a){if(this.selectedPromise){const s=this.promiseContainers.get(this.selectedPromise);if(s){const r=s.first;r.clear(),r.fillStyle(2760474,1),r.fillRoundedRect(0,0,i,a,8),r.lineStyle(2,5917242,1),r.strokeRoundedRect(0,0,i,a,8)}}this.selectedPromise=e;const t=this.promiseContainers.get(e);if(t){const s=t.first;s.clear(),s.fillStyle(3813162,1),s.fillRoundedRect(0,0,i,a,8),s.lineStyle(3,13216089,1),s.strokeRoundedRect(0,0,i,a,8)}}createConfirmButton(){const{width:e,height:i}=this.cameras.main,a=b.createButton(this,e/2,i-60,"SEAL THIS PROMISE",()=>this.confirmPromise(),{width:220,height:50,primary:!0});a.setAlpha(.5),this.events.on("update",()=>{a.setAlpha(this.selectedPromise?1:.5)})}confirmPromise(){if(!this.selectedPromise)return;m.updateRun({promise:this.selectedPromise}),this.cameras.main.fadeOut(500,0,0,0);const{width:e,height:i}=this.cameras.main,a=this.add.text(e/2,i/2,"PROMISE SEALED",{fontFamily:"Georgia, serif",fontSize:"28px",color:"#c9a959",stroke:"#000000",strokeThickness:4}).setOrigin(.5).setAlpha(0);this.tweens.add({targets:a,alpha:1,duration:300,yoyo:!0,hold:500,onComplete:()=>{this.scene.start("CampScene")}})}}const H=52,we=8;function G(){const o=/iPhone/.test(navigator.userAgent),n=window.innerHeight>800&&o;return{top:n?44:20,bottom:n?34:10,left:16,right:16}}function V(o){const{width:n,height:e}=o.cameras.main,i=G();return{x:i.left,y:i.top,width:n-i.left-i.right,height:e-i.top-i.bottom}}function ce(o,n=0){return o.cameras.main.height-G().bottom-n}class ri extends k.GameObjects.Container{constructor(e){super(e,0,0);f(this,"debugMode",!1);f(this,"debugGraphics");f(this,"contentArea");e.add.existing(this),this.contentArea=V(e),e.scale.on("resize",this.handleResize,this)}handleResize(){this.contentArea=V(this.scene),this.updateDebugOverlay()}toggleDebug(){this.debugMode=!this.debugMode,this.updateDebugOverlay()}updateDebugOverlay(){if(this.debugGraphics&&(this.debugGraphics.destroy(),this.debugGraphics=void 0),!this.debugMode)return;this.debugGraphics=this.scene.add.graphics(),this.debugGraphics.setDepth(9999);const{width:e,height:i}=this.scene.cameras.main,a=G();this.debugGraphics.lineStyle(2,65280,.5),this.debugGraphics.strokeRect(a.left,a.top,e-a.left-a.right,i-a.top-a.bottom),this.debugGraphics.lineStyle(1,16711680,.8),this.each(t=>{this.drawInteractiveBounds(t)})}drawInteractiveBounds(e){var i,a;if(this.debugGraphics&&(e instanceof k.GameObjects.Container&&e.each(t=>{this.drawInteractiveBounds(t)}),"input"in e&&((i=e.input)!=null&&i.enabled))){const t=(a=e.getBounds)==null?void 0:a.call(e);t&&this.debugGraphics.strokeRect(t.x,t.y,t.width,t.height)}}getContentArea(){return{...this.contentArea}}destroy(e){var i;this.scene.scale.off("resize",this.handleResize,this),(i=this.debugGraphics)==null||i.destroy(),super.destroy(e)}}class oi extends k.GameObjects.Container{constructor(e,i,a,t=10,s="center"){super(e,i,a);f(this,"spacing");f(this,"alignment");f(this,"items",[]);this.spacing=t,this.alignment=s,e.add.existing(this)}addItem(e){return this.items.push(e),this.add(e),this.layout(),this}removeItem(e){const i=this.items.indexOf(e);return i>-1&&(this.items.splice(i,1),this.remove(e),this.layout()),this}layout(){let e=0;this.items.forEach(i=>{const a=this.getItemHeight(i);if("setPosition"in i){let t=0;(this.alignment==="left"||this.alignment==="right")&&(t=0),i.setPosition(t,e)}e+=a+this.spacing})}getItemHeight(e){return"height"in e?e.height||H:"displayHeight"in e&&e.displayHeight||H}setSpacing(e){return this.spacing=e,this.layout(),this}}class li extends k.GameObjects.Container{constructor(e,i,a,t=10){super(e,i,a);f(this,"spacing");f(this,"items",[]);this.spacing=t,e.add.existing(this)}addItem(e){return this.items.push(e),this.add(e),this.layout(),this}layout(){let i=-this.getTotalWidth()/2;this.items.forEach(a=>{const t=this.getItemWidth(a);"setPosition"in a&&a.setPosition(i+t/2,0),i+=t+this.spacing})}getTotalWidth(){return this.items.reduce((e,i,a)=>e+this.getItemWidth(i)+(a>0?this.spacing:0),0)}getItemWidth(e){return"width"in e?e.width||H:"displayWidth"in e&&e.displayWidth||H}}class ci extends k.GameObjects.Container{constructor(e,i,a,t,s){super(e,i,a);f(this,"contentContainer");f(this,"maskGraphics");f(this,"panelWidth");f(this,"panelHeight");f(this,"contentHeight",0);f(this,"scrollY",0);f(this,"isDragging",!1);f(this,"dragStartY",0);f(this,"scrollStartY",0);this.panelWidth=t,this.panelHeight=s,e.add.existing(this),this.maskGraphics=e.add.graphics(),this.maskGraphics.fillStyle(16777215),this.maskGraphics.fillRect(i,a,t,s);const r=this.maskGraphics.createGeometryMask();this.contentContainer=e.add.container(0,0),this.contentContainer.setMask(r),this.add(this.contentContainer),this.setupScrollInput()}setupScrollInput(){const e=this.scene.add.rectangle(this.panelWidth/2,this.panelHeight/2,this.panelWidth,this.panelHeight,0,0);e.setInteractive(),this.add(e),e.on("pointerdown",i=>{this.isDragging=!0,this.dragStartY=i.y,this.scrollStartY=this.scrollY}),this.scene.input.on("pointermove",i=>{if(!this.isDragging)return;const a=i.y-this.dragStartY;this.scrollTo(this.scrollStartY-a)}),this.scene.input.on("pointerup",()=>{this.isDragging=!1})}addContent(e,i){return"setPosition"in e&&e.setPosition(this.panelWidth/2,this.contentHeight+i/2),this.contentContainer.add(e),this.contentHeight+=i+10,this}scrollTo(e){const i=Math.max(0,this.contentHeight-this.panelHeight);this.scrollY=k.Math.Clamp(e,0,i),this.contentContainer.y=-this.scrollY}getScrollPosition(){return this.scrollY}destroy(e){this.maskGraphics.destroy(),super.destroy(e)}}class Pe extends k.GameObjects.Container{constructor(e,i,a,t,s,r={}){super(e,i,a);f(this,"bg");f(this,"label");f(this,"visualWidth");f(this,"visualHeight");f(this,"touchWidth");f(this,"touchHeight");f(this,"callback");f(this,"isPrimary");e.add.existing(this);const{width:l=180,height:c=52,fontSize:h=14,primary:d=!1}=r;this.visualWidth=l,this.visualHeight=c,this.touchWidth=Math.max(l+we*2,H),this.touchHeight=Math.max(c+we*2,H),this.callback=s,this.isPrimary=d,this.bg=e.add.graphics(),this.drawBackground(!1),this.add(this.bg),this.label=e.add.text(0,0,t,{fontFamily:"Georgia, serif",fontSize:`${h}px`,color:d?"#c9a959":"#8b7355"}).setOrigin(.5),this.add(this.label),this.setSize(this.touchWidth,this.touchHeight),this.setInteractive(new k.Geom.Rectangle(-this.touchWidth/2,-this.touchHeight/2,this.touchWidth,this.touchHeight),k.Geom.Rectangle.Contains),this.setupInteraction()}drawBackground(e){this.bg.clear();const i=e?this.isPrimary?5917242:3813162:this.isPrimary?4864554:2760474,a=e||this.isPrimary?13216089:5917242;this.bg.fillStyle(i,1),this.bg.fillRoundedRect(-this.visualWidth/2,-this.visualHeight/2,this.visualWidth,this.visualHeight,8),this.bg.lineStyle(2,a,1),this.bg.strokeRoundedRect(-this.visualWidth/2,-this.visualHeight/2,this.visualWidth,this.visualHeight,8)}setupInteraction(){this.on("pointerover",()=>{this.drawBackground(!0),this.label.setColor("#c9a959")}),this.on("pointerout",()=>{this.drawBackground(!1),this.label.setColor(this.isPrimary?"#c9a959":"#8b7355")}),this.on("pointerdown",()=>{this.scene.tweens.add({targets:this,scaleX:.95,scaleY:.95,duration:50})}),this.on("pointerup",()=>{this.scene.tweens.add({targets:this,scaleX:1,scaleY:1,duration:50,onComplete:()=>this.callback()})})}setText(e){return this.label.setText(e),this}setDisabled(e){return this.setAlpha(e?.5:1),e?this.disableInteractive():this.setInteractive(),this}}class it extends k.Scene{constructor(){super({key:"CampScene"});f(this,"fighter");f(this,"gold");f(this,"week");f(this,"league");f(this,"fighterSprite");f(this,"campfireGlow")}create(){const e=m.getRun();if(!e.fighter){this.scene.start("MainMenuScene");return}this.fighter=e.fighter,this.gold=e.gold,this.week=e.week,this.league=e.league,this.createBackground(),this.createHeader(),this.createFighterDisplay(),this.createActionButtons(),this.createBottomBar(),this.checkGhostMoments(),this.checkRelicOpportunity(),this.cameras.main.fadeIn(300)}createBackground(){const{width:e,height:i}=this.cameras.main,a=this.add.graphics();a.fillGradientStyle(657426,657426,1710112,1710112),a.fillRect(0,0,e,i);for(let t=0;t<20;t++){const s=this.add.graphics();s.fillStyle(16777215,Math.random()*.4+.1),s.fillCircle(Math.random()*e,Math.random()*i*.35,1),this.tweens.add({targets:s,alpha:{from:.2,to:.6},duration:1500+Math.random()*2e3,yoyo:!0,repeat:-1})}a.fillStyle(2762016,1),a.fillRect(0,i*.6,e,i*.4),a.fillStyle(1709333,1),a.beginPath(),a.moveTo(0,i*.45),a.lineTo(e*.2,i*.32),a.lineTo(e*.4,i*.42),a.lineTo(e*.65,i*.28),a.lineTo(e*.85,i*.38),a.lineTo(e,i*.35),a.lineTo(e,i*.6),a.lineTo(0,i*.6),a.closePath(),a.fillPath(),this.createCampfire(e*.5,i*.55)}createCampfire(e,i){const a=this.add.graphics();a.fillStyle(3811866,1),a.fillEllipse(e,i+15,35,12),this.campfireGlow=this.add.graphics();const t=s=>{this.campfireGlow&&(this.campfireGlow.clear(),this.campfireGlow.fillStyle(16737792,.08*s),this.campfireGlow.fillCircle(e,i-5,50*s),this.campfireGlow.fillStyle(16750848,.12*s),this.campfireGlow.fillCircle(e,i-5,30*s),this.campfireGlow.fillStyle(16763904,.25),this.campfireGlow.fillCircle(e,i-8,12))};this.tweens.add({targets:{i:1},i:1.15,duration:180,yoyo:!0,repeat:-1,ease:"Sine.easeInOut",onUpdate:s=>{const r=s.getValue();typeof r=="number"&&t(r)}}),t(1)}createHeader(){const{width:e}=this.cameras.main,i=G(),a=i.top+15;this.add.text(i.left,a,`Week ${this.week+1}`,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#c9a959"});const t={bronze:"#cd7f32",silver:"#c0c0c0",gold:"#ffd700",champion:"#ff4500"};this.add.text(i.left,a+18,this.league.toUpperCase(),{fontFamily:"Georgia, serif",fontSize:"11px",color:t[this.league]||"#8b7355"});const s=m.getRun();this.add.text(e-i.right,a,`💰 ${this.gold}`,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#c9a959"}).setOrigin(1,0),this.add.text(e-i.right,a+18,`⭐ ${s.fame}`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b7355"}).setOrigin(1,0);const r=m.getFatigue();if(r>0){const l=r>70?"#8b0000":r>40?"#daa520":"#8b7355";this.add.text(e-i.right,a+35,`⚡ ${r}%`,{fontFamily:"Georgia, serif",fontSize:"10px",color:l}).setOrigin(1,0)}s.relics.length>0&&this.add.text(e/2,a,`🔮 ${s.relics.length}`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#9932cc"}).setOrigin(.5,0)}createFighterDisplay(){const{width:e,height:i}=this.cameras.main;G();const a=i*.35;this.fighterSprite=this.add.container(e*.5,a);const t=Math.min(80,e*.2),s=Z.renderPortrait(this,this.fighter.portrait,0,0,t);if(this.fighterSprite.add(s),this.fighter.injuries.length>0){const c=this.add.text(t/2+5,-t/2,"🩹",{fontSize:"14px"});this.fighterSprite.add(c)}this.tweens.add({targets:this.fighterSprite,y:a-3,duration:2e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.add.text(e*.5,a+t/2+15,this.fighter.firstName,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#c9a959"}).setOrigin(.5);const r={healthy:"#6b8e23",injured:"#daa520",critical:"#8b0000"};this.add.text(e*.5,a+t/2+32,this.fighter.status.toUpperCase(),{fontFamily:"Georgia, serif",fontSize:"10px",color:r[this.fighter.status]||"#8b7355"}).setOrigin(.5);const l=this.getContextualVoiceLine();l&&this.createSpeechBubble(e*.5,a-t/2-30,l),this.fighterSprite.setSize(t+20,t+20),this.fighterSprite.setInteractive(),this.fighterSprite.on("pointerdown",()=>this.showCharacterInfo())}createSpeechBubble(e,i,a){const t=Math.min(180,this.cameras.main.width-40),s=this.add.container(e,i),r=this.add.graphics();r.fillStyle(2760474,.9),r.fillRoundedRect(-t/2,-20,t,35,6),r.lineStyle(1,13216089,.4),r.strokeRoundedRect(-t/2,-20,t,35,6),r.fillStyle(2760474,.9),r.fillTriangle(-5,15,5,15,0,25);const l=this.add.text(0,-3,`"${a}"`,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355",fontStyle:"italic",wordWrap:{width:t-20},align:"center"}).setOrigin(.5);s.add([r,l]),s.setAlpha(0),this.tweens.add({targets:s,alpha:1,duration:400,delay:300})}createActionButtons(){const{width:e,height:i}=this.cameras.main,a=V(this),t=Math.min(160,(a.width-20)/2),s=Math.max(H,58),r=10,l=i*.55,c=a.x+t/2+5,h=a.x+a.width-t/2-5;m.getRun();const d=m.getFatigue(),g=d<100;this.createActionButton(c,l,t,s,"⚔️","TRAIN","Build your skills",()=>this.goToTraining(),g),this.createActionButton(h,l,t,s,"🛒","SHOP",`${this.gold} gold`,()=>this.goToShop(),!0),this.createActionButton(c,l+s+r,t,s,"🛏️","REST","-40 fatigue, +HP",()=>this.doRest(),d>0||this.fighter.injuries.length>0||this.fighter.currentStats.currentHP<this.fighter.currentStats.maxHP);const y=m.getSeals();this.createActionButton(h,l+s+r,t,s,"✉️","WRITE",y>0?`${y} seals`:"Gain seals",()=>this.writeLetter(),!0,!0)}createActionButton(e,i,a,t,s,r,l,c,h=!0,d=!1){const g=this.add.container(e,i),y=this.add.graphics(),w=d?3811882:2760474,S=h?d?13216089:5917242:3811866;y.fillStyle(w,.95),y.fillRoundedRect(-a/2,-t/2,a,t,8),y.lineStyle(2,S,1),y.strokeRoundedRect(-a/2,-t/2,a,t,8),g.add(y);const v=this.add.text(-a/2+12,-5,s,{fontSize:"22px"}).setOrigin(0,.5);g.add(v);const R=this.add.text(-a/2+42,-10,r,{fontFamily:"Georgia, serif",fontSize:"13px",color:h?"#c9a959":"#5a4a3a"});g.add(R);const B=this.add.text(-a/2+42,6,l,{fontFamily:"Georgia, serif",fontSize:"10px",color:h?"#8b7355":"#4a3a2a"});return g.add(B),h?(g.setSize(a,t),g.setInteractive(new k.Geom.Rectangle(-a/2,-t/2,a,t),k.Geom.Rectangle.Contains),g.on("pointerover",()=>{y.clear(),y.fillStyle(3813162,.95),y.fillRoundedRect(-a/2,-t/2,a,t,8),y.lineStyle(2,13216089,1),y.strokeRoundedRect(-a/2,-t/2,a,t,8)}),g.on("pointerout",()=>{y.clear(),y.fillStyle(w,.95),y.fillRoundedRect(-a/2,-t/2,a,t,8),y.lineStyle(2,S,1),y.strokeRoundedRect(-a/2,-t/2,a,t,8)}),g.on("pointerdown",()=>{this.tweens.add({targets:g,scaleX:.95,scaleY:.95,duration:50,yoyo:!0,onComplete:c})})):g.setAlpha(.6),g}createBottomBar(){const{width:e}=this.cameras.main,i=G(),a=m.getRun(),t=ce(this,85),s=e-i.left-i.right;this.add.text(i.left,t-15,`${a.fightsInLeague}/${a.fightsToNextLeague} to next league`,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#5a4a3a"});const r=this.add.graphics();r.fillStyle(2760474,1),r.fillRoundedRect(i.left,t,s,8,3);const l=this.add.graphics();l.fillStyle(13216089,1),l.fillRoundedRect(i.left,t,s*(a.fightsInLeague/a.fightsToNextLeague),8,3),new Pe(this,e/2,ce(this,35),"🗡️ ENTER ARENA",()=>this.enterArena(),{width:Math.min(220,e-80),height:52,fontSize:15,primary:!0})}getContextualVoiceLine(){return this.fighter.injuries.length>0?se(this.fighter,"taking_damage"):this.fighter.trust<30?se(this.fighter,"idle"):se(this.fighter,"rest")}showCharacterInfo(){b.showNotification(this,`${this.fighter.fullName}
Trust: ${this.fighter.trust}% | Wins: ${this.fighter.wins}`,3e3)}goToTraining(){m.updateRun({lastCampAction:"train"}),this.cameras.main.fadeOut(200),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("TrainingScene")})}goToShop(){m.updateRun({lastCampAction:"shop"}),this.cameras.main.fadeOut(200),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("ShopScene")})}doRest(){Se(this.fighter),Ce(this.fighter,1),J(this.fighter,5),m.reduceFatigue(40),m.clearSparringInjuries(),m.updateRun({fighter:this.fighter,week:this.week+1,lastCampAction:"rest"}),b.showNotification(this,"💤 Rested! HP restored, -40 fatigue, +5 Trust"),this.refreshScene()}writeLetter(){m.updateRun({lastCampAction:"letter"}),this.cameras.main.fadeOut(200),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("LetterScene")})}enterArena(){Se(this.fighter),m.updateRun({fighter:this.fighter,lastCampAction:"fight"}),this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("FightScene")})}checkGhostMoments(){const e=Qe("camp");if(e){const i=Ke(e);this.time.delayedCall(1e3,()=>{b.showNotification(this,i,4e3)})}}checkRelicOpportunity(){const e=m.getRun();e.fightsSinceRelic>=3&&e.consecutiveWins>=2&&this.time.delayedCall(1500,()=>{b.showConfirmDialog(this,"Relic Opportunity!","A mysterious merchant offers you a choice of relics...",()=>{this.scene.start("RelicChoiceScene")},()=>{m.updateRun({fightsSinceRelic:0})},"VIEW RELICS")})}refreshScene(){this.cameras.main.fadeOut(150),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.restart()})}}const at=[{name:"Bruised Ribs",location:"body",severity:"minor",effect:"Hurts to breathe deeply",statPenalty:{maxStamina:-5},healTime:1,scarChance:0},{name:"Split Lip",location:"head",severity:"minor",effect:"Looks worse than it is",statPenalty:{},healTime:1,scarChance:.1},{name:"Twisted Ankle",location:"legs",severity:"minor",effect:"Movement slightly impaired",statPenalty:{speed:-1,evasion:-3},healTime:1,scarChance:0},{name:"Black Eye",location:"head",severity:"minor",effect:"Vision slightly impaired",statPenalty:{accuracy:-5},healTime:1,scarChance:0},{name:"Strained Shoulder",location:"body",severity:"minor",effect:"Arm feels weak",statPenalty:{attack:-2},healTime:2,scarChance:0},{name:"Deep Cut",location:"body",severity:"moderate",effect:"Bleeding wound",statPenalty:{maxHP:-10,defense:-2},healTime:2,scarChance:.3},{name:"Fractured Jaw",location:"head",severity:"moderate",effect:"Speaking and eating is painful",statPenalty:{maxStamina:-8},healTime:3,scarChance:.2},{name:"Torn Muscle",location:"legs",severity:"moderate",effect:"Mobility severely limited",statPenalty:{speed:-3,evasion:-8},healTime:3,scarChance:0},{name:"Cracked Ribs",location:"body",severity:"moderate",effect:"Every breath hurts",statPenalty:{maxStamina:-12,defense:-3},healTime:3,scarChance:0},{name:"Gashed Thigh",location:"legs",severity:"moderate",effect:"Deep wound, heavy bleeding",statPenalty:{maxHP:-8,speed:-2},healTime:2,scarChance:.4},{name:"Concussion",location:"head",severity:"moderate",effect:"Head trauma, dizziness",statPenalty:{accuracy:-10,maxFocus:-10},healTime:2,scarChance:0},{name:"Broken Arm",location:"body",severity:"severe",effect:"Cannot use dominant arm properly",statPenalty:{attack:-8,accuracy:-15},healTime:4,scarChance:.1},{name:"Shattered Knee",location:"legs",severity:"severe",effect:"May never fight the same",statPenalty:{speed:-5,evasion:-15},healTime:5,scarChance:.2},{name:"Skull Fracture",location:"head",severity:"severe",effect:"Life-threatening head trauma",statPenalty:{maxHP:-20,maxFocus:-15},healTime:5,scarChance:.5},{name:"Punctured Lung",location:"body",severity:"severe",effect:"Breathing is agony",statPenalty:{maxStamina:-25,maxHP:-15},healTime:5,scarChance:.3},{name:"Severed Tendon",location:"legs",severity:"severe",effect:"Leg barely functional",statPenalty:{speed:-8,evasion:-20,attack:-3},healTime:5,scarChance:.4},{name:"Facial Disfigurement",location:"head",severity:"severe",effect:"Scarred for life",statPenalty:{},healTime:4,scarChance:1}],st=[{id:"bandages",name:"Crude Bandages",description:"Dirty cloth strips. Better than nothing.",type:"healing",effect:"Restore 20 HP",value:20,uses:1,price:15},{id:"healing_salve",name:"Healing Salve",description:"A pungent green paste that numbs pain.",type:"healing",effect:"Restore 35 HP",value:35,uses:1,price:30},{id:"surgeons_kit",name:"Surgeon's Kit",description:"Professional medical supplies.",type:"healing",effect:"Restore 50 HP, cure Bleed",value:50,uses:1,price:60},{id:"grit_salts",name:"Grit Salts",description:"Inhale for instant alertness. Burns like hell.",type:"buff",effect:"Restore 30 Stamina",value:30,uses:1,price:25},{id:"focus_tonic",name:"Focus Tonic",description:"A bitter brew that sharpens the mind.",type:"buff",effect:"Gain 20 Focus",value:20,uses:1,price:35},{id:"berserker_draught",name:"Berserker Draught",description:"Red liquid that tastes of iron. +5 Attack for 3 turns.",type:"buff",effect:"+5 Attack (3 turns)",value:5,uses:1,price:45},{id:"iron_skin_oil",name:"Iron-Skin Oil",description:"Protective coating. +5 Defense for 3 turns.",type:"buff",effect:"+5 Defense (3 turns)",value:5,uses:1,price:45},{id:"smoke_bomb",name:"Smoke Bomb",description:"Creates a concealing cloud. Guarantees dodge next attack.",type:"utility",effect:"Guaranteed dodge (1 attack)",value:1,uses:1,price:50},{id:"flash_powder",name:"Flash Powder",description:"Blinds the opponent. -20 Accuracy for 2 turns.",type:"utility",effect:"Enemy -20 Accuracy (2 turns)",value:20,uses:1,price:40},{id:"antivenom",name:"Antivenom",description:"Neutralizes poisons and clears the blood.",type:"healing",effect:"Cure Bleed and Poison",value:0,uses:1,price:35}],nt=[{id:"rusty_sword",name:"Rusty Sword",description:"A worn blade, but still sharp enough.",rarity:"common",attackBonus:2,accuracyBonus:0,critBonus:0,price:30},{id:"wooden_club",name:"Wooden Club",description:"Simple but effective.",rarity:"common",attackBonus:3,accuracyBonus:-5,critBonus:0,price:20},{id:"fighting_knife",name:"Fighting Knife",description:"Quick and precise.",rarity:"common",attackBonus:1,accuracyBonus:8,critBonus:3,price:35},{id:"iron_mace",name:"Iron Mace",description:"Heavy and crushing.",rarity:"common",attackBonus:4,accuracyBonus:-3,critBonus:0,price:40},{id:"soldiers_blade",name:"Soldier's Blade",description:"A proper military weapon.",rarity:"uncommon",attackBonus:5,accuracyBonus:3,critBonus:2,price:80},{id:"spiked_flail",name:"Spiked Flail",description:"Unpredictable and dangerous.",rarity:"uncommon",attackBonus:6,accuracyBonus:-5,critBonus:5,price:90},{id:"gladius",name:"Gladius",description:"Classic arena weapon.",rarity:"uncommon",attackBonus:4,accuracyBonus:5,critBonus:3,price:85},{id:"war_axe",name:"War Axe",description:"Brutal chopping power.",rarity:"uncommon",attackBonus:7,accuracyBonus:-3,critBonus:4,price:95},{id:"champion_sword",name:"Champion's Sword",description:"Wielded by a former champion.",rarity:"rare",attackBonus:8,accuracyBonus:5,critBonus:5,effect:"+10% Hype gain",price:180},{id:"blood_drinker",name:"Blood Drinker",description:"Heals on critical hits.",rarity:"rare",attackBonus:6,accuracyBonus:3,critBonus:8,effect:"Crit heals 10 HP",price:200},{id:"executioner",name:"The Executioner",description:"Heavy two-handed blade.",rarity:"rare",attackBonus:12,accuracyBonus:-8,critBonus:10,effect:"+30% damage to low HP enemies",price:220},{id:"viper_fang",name:"Viper Fang",description:"Poisoned edge.",rarity:"rare",attackBonus:5,accuracyBonus:8,critBonus:5,effect:"Attacks apply Bleed",price:190},{id:"crown_slayer",name:"Crown Slayer",description:"The weapon of legends.",rarity:"legendary",attackBonus:12,accuracyBonus:8,critBonus:10,effect:"+50% damage to champions",price:500},{id:"soulreaper",name:"Soulreaper",description:"Said to steal the dying breath.",rarity:"legendary",attackBonus:10,accuracyBonus:5,critBonus:15,effect:"Killing blows restore 25 HP",price:450}],rt=[{id:"leather_vest",name:"Leather Vest",description:"Basic protection.",rarity:"common",defenseBonus:3,hpBonus:0,speedPenalty:0,price:25},{id:"padded_gambeson",name:"Padded Gambeson",description:"Quilted cloth armor.",rarity:"common",defenseBonus:4,hpBonus:5,speedPenalty:1,price:35},{id:"studded_leather",name:"Studded Leather",description:"Leather reinforced with metal studs.",rarity:"common",defenseBonus:5,hpBonus:0,speedPenalty:1,price:45},{id:"chainmail_shirt",name:"Chainmail Shirt",description:"Interlocked metal rings.",rarity:"uncommon",defenseBonus:8,hpBonus:5,speedPenalty:2,price:100},{id:"gladiator_harness",name:"Gladiator Harness",description:"Arena-style protective gear.",rarity:"uncommon",defenseBonus:6,hpBonus:10,speedPenalty:0,price:110},{id:"scale_mail",name:"Scale Mail",description:"Overlapping metal scales.",rarity:"uncommon",defenseBonus:9,hpBonus:0,speedPenalty:3,price:120},{id:"champion_plate",name:"Champion's Plate",description:"Worn by arena legends.",rarity:"rare",defenseBonus:12,hpBonus:15,speedPenalty:2,effect:"+10 Trust with crowd",price:250},{id:"shadow_leather",name:"Shadow Leather",description:"Dark, supple armor.",rarity:"rare",defenseBonus:8,hpBonus:5,speedPenalty:-1,effect:"+10 Evasion",price:230},{id:"berserker_hide",name:"Berserker Hide",description:"Blessed by battle priests.",rarity:"rare",defenseBonus:6,hpBonus:20,speedPenalty:0,effect:"+15% damage when injured",price:240},{id:"immortal_aegis",name:"Immortal Aegis",description:"Said to have saved a hundred lives.",rarity:"legendary",defenseBonus:15,hpBonus:25,speedPenalty:2,effect:"Survive fatal blow once per fight",price:500},{id:"bloodline_armor",name:"Bloodline Armor",description:"Passed through generations of champions.",rarity:"legendary",defenseBonus:12,hpBonus:30,speedPenalty:1,effect:"+2 Bloodline Points on victory",price:480}];class ot extends k.Scene{constructor(){super({key:"ShopScene"});f(this,"gold");f(this,"fighter");f(this,"selectedCategory","items");f(this,"shopInventory",new Map);f(this,"goldText");f(this,"itemsContainer")}create(){const e=m.getRun();if(!e.fighter){this.scene.start("MainMenuScene");return}this.fighter=e.fighter,this.gold=e.gold,this.generateShopInventory(),this.createBackground(),this.createHeader(),this.createCategoryTabs(),this.createItemList(),this.createBackButton(),this.cameras.main.fadeIn(300)}generateShopInventory(){const e=m.getMeta(),i=3+Math.floor(e.promoterLevel/2),a=3+Math.floor(e.promoterLevel/2),t=p.shuffle([...nt]).slice(0,i);this.shopInventory.set("weapons",t);const s=p.shuffle([...rt]).slice(0,a);this.shopInventory.set("armor",s),this.shopInventory.set("items",[...st])}createBackground(){const{width:e,height:i}=this.cameras.main,a=this.add.graphics();if(a.fillGradientStyle(1709072,1709072,2760474,2760474),a.fillRect(0,0,e,i),this.textures.exists("parchment_overlay")){const t=this.add.image(e/2,i/2,"parchment_overlay");t.setAlpha(.08),t.setDisplaySize(e,i)}}createHeader(){const{width:e}=this.cameras.main;this.add.text(e/2,35,"🛒 MERCHANT",{fontFamily:"Georgia, serif",fontSize:"24px",color:"#c9a959",stroke:"#000000",strokeThickness:3}).setOrigin(.5),this.add.text(e/2,65,'"Best wares this side of the arena..."',{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b7355",fontStyle:"italic"}).setOrigin(.5),this.goldText=this.add.text(e-20,20,`💰 ${this.gold}`,{fontFamily:"Georgia, serif",fontSize:"18px",color:"#ffd700"}).setOrigin(1,0)}createCategoryTabs(){const{width:e}=this.cameras.main,i=100,a=100,t=110,s=e/2-t;[{id:"items",label:"🧪 Items"},{id:"weapons",label:"⚔️ Weapons"},{id:"armor",label:"🛡️ Armor"}].forEach((l,c)=>{const h=s+c*t;b.createButton(this,h,i,l.label,()=>this.selectCategory(l.id),{width:a,height:35,fontSize:"11px"}).setData("category",l.id)})}selectCategory(e){this.selectedCategory=e,this.createItemList()}createItemList(){const{width:e,height:i}=this.cameras.main;this.itemsContainer&&this.itemsContainer.destroy(),this.itemsContainer=this.add.container(0,0);const a=this.shopInventory.get(this.selectedCategory)||[],t=150,s=80;a.forEach((r,l)=>{const c=t+l*s;this.createItemCard(r,30,c,e-60,70)}),a.length===0&&this.add.text(e/2,250,"No items available",{fontFamily:"Georgia, serif",fontSize:"14px",color:"#5a4a3a"}).setOrigin(.5)}createItemCard(e,i,a,t,s){const r=this.add.container(i,a);this.itemsContainer.add(r);const l=this.add.graphics();l.fillStyle(2760474,1),l.fillRoundedRect(0,0,t,s,8),l.lineStyle(1,5917242,1),l.strokeRoundedRect(0,0,t,s,8),r.add(l);const h={common:"#8b8b8b",uncommon:"#2e8b57",rare:"#4169e1",legendary:"#ffd700"}[e.rarity]||"#8b8b8b",d=this.add.text(15,12,e.name,{fontFamily:"Georgia, serif",fontSize:"14px",color:h});r.add(d);const g=this.add.text(15,32,e.description||e.effect,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355",wordWrap:{width:t-100}});r.add(g);const y=this.add.text(t-15,12,`💰 ${e.price}`,{fontFamily:"Georgia, serif",fontSize:"14px",color:this.gold>=e.price?"#ffd700":"#8b0000"}).setOrigin(1,0);r.add(y);const w=this.gold>=e.price,S=b.createButton(this,t-45,s-20,"BUY",()=>this.buyItem(e),{width:60,height:25,fontSize:"10px",primary:w});r.add(S),w||S.setAlpha(.5)}buyItem(e){if(this.gold<e.price){b.showNotification(this,"Not enough gold!");return}this.gold-=e.price,this.goldText.setText(`💰 ${this.gold}`),this.selectedCategory==="items"?this.fighter.inventory.push({id:e.id,name:e.name,type:"accessory",rarity:"common",stats:{},description:e.description}):this.selectedCategory==="weapons"?this.fighter.equipment.weapon={id:e.id,name:e.name,type:"weapon",rarity:e.rarity,stats:{attack:e.attackBonus,accuracy:e.accuracyBonus,critChance:e.critBonus},effect:e.effect,description:e.description}:this.selectedCategory==="armor"&&(this.fighter.equipment.armor={id:e.id,name:e.name,type:"armor",rarity:e.rarity,stats:{defense:e.defenseBonus,maxHP:e.hpBonus,speed:-e.speedPenalty},effect:e.effect,description:e.description}),m.updateRun({fighter:this.fighter,gold:this.gold}),b.showNotification(this,`Purchased ${e.name}!`),this.createItemList()}createBackButton(){const{width:e,height:i}=this.cameras.main;b.createButton(this,e/2,i-50,"← BACK TO CAMP",()=>this.returnToCamp(),{width:180,height:45})}returnToCamp(){this.cameras.main.fadeOut(200),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("CampScene")})}}const D={light_attack:{staminaCost:10,baseDamage:1,accuracy:.9,focusGain:5,hypeGain:5},heavy_attack:{staminaCost:25,baseDamage:1.8,accuracy:.75,focusGain:10,hypeGain:15},guard:{staminaCost:5,blockMultiplier:.6,focusGain:3,hypeGain:0},dodge:{staminaCost:15,evasionBonus:.3,focusGain:5,hypeGain:10},special:{staminaCost:20,focusCost:30,baseDamage:2,accuracy:.85,hypeGain:25},item:{staminaCost:0,focusGain:0,hypeGain:-5}},lt={head:{damage:1.2,critBonus:.1,effect:"concuss"},body:{damage:1,critBonus:0,effect:null},legs:{damage:.9,critBonus:-.05,effect:"cripple"}};function ct(o,n){return{player:ke(o),enemy:ke(n),round:1,turn:o.currentStats.speed>=n.currentStats.speed?"player":"enemy",phase:"select_action",crowdHype:30,log:[],isParryWindow:!1,parryWindowStart:0,winner:null,lastAction:null}}function ke(o){return{fighter:o,currentHP:o.currentStats.currentHP,currentStamina:o.currentStats.currentStamina,currentFocus:0,injuryMeter:0,activeEffects:new Map,guardStance:null,lastAction:null,consecutiveGuards:0}}function ve(o,n,e,i,a){const t=o[n],s=o[n==="player"?"enemy":"player"],r=D[e];let l={success:!1,damage:0,damageBlocked:0,targetZone:i,critical:!1,perfectParry:!1,counterDamage:0,statusApplied:null,staminaCost:r.staminaCost,focusGained:0,focusSpent:0,hypeGained:0,message:""};if(t.currentStamina<r.staminaCost)return l.message=`${t.fighter.firstName} is too exhausted!`,l;switch(t.currentStamina-=r.staminaCost,e){case"light_attack":case"heavy_attack":l=dt(o,t,s,e,i);break;case"guard":l=ht(t,i);break;case"dodge":l=ut(t);break;case"special":l=ft(o,t,s,i);break;case"item":l=gt(t);break}return t.lastAction=e,o.log.push({round:o.round,actor:n,action:e,result:l,timestamp:Date.now()}),o.crowdHype=Math.max(0,Math.min(100,o.crowdHype+l.hypeGained)),s.currentHP<=0?(o.winner=n,o.phase="end"):t.currentHP<=0&&(o.winner=n==="player"?"enemy":"player",o.phase="end"),o.lastAction=l,l}function dt(o,n,e,i,a){const t=D[i],s=lt[a],r={success:!1,damage:0,damageBlocked:0,targetZone:a,critical:!1,perfectParry:!1,counterDamage:0,statusApplied:null,staminaCost:t.staminaCost,focusGained:0,focusSpent:0,hypeGained:0,message:""};let l=t.accuracy*(n.fighter.currentStats.accuracy/100);if(e.lastAction==="dodge"&&(l-=D.dodge.evasionBonus),n.activeEffects.has("concuss")&&(l-=.15),e.activeEffects.has("cripple")&&a==="legs"&&(l+=.1),p.chance(l)){r.success=!0;let c=n.fighter.currentStats.attack*t.baseDamage;c*=s.damage;const h=n.fighter.currentStats.critChance/100+s.critBonus;p.chance(h)&&(r.critical=!0,c*=n.fighter.currentStats.critDamage/100,r.hypeGained+=10),e.lastAction==="guard"&&e.guardStance===a&&(r.damageBlocked=c*D.guard.blockMultiplier,c-=r.damageBlocked,r.message=`${e.fighter.firstName} blocked! `);const d=e.fighter.currentStats.defense,g=Math.max(1,Math.round(c-d*.3));r.damage=g,e.currentHP-=g,e.currentHP<e.fighter.closestCall&&(e.fighter.closestCall=e.currentHP),e.injuryMeter+=g*.5,r.critical&&(e.injuryMeter+=10),s.effect&&p.chance(.2+(r.critical?.1:0))&&(r.statusApplied=s.effect,e.activeEffects.set(s.effect,3)),r.focusGained=t.focusGain,n.currentFocus=Math.min(n.fighter.currentStats.maxFocus,n.currentFocus+r.focusGained),r.hypeGained+=t.hypeGain;const y=i==="light_attack"?"quick strike":"heavy blow";r.message+=`${n.fighter.firstName}'s ${y} hits the ${a} for ${g} damage!`,r.critical&&(r.message+=" CRITICAL HIT!"),r.statusApplied&&(r.message+=` ${e.fighter.firstName} is ${r.statusApplied}ed!`)}else r.message=`${n.fighter.firstName}'s attack misses!`,e.lastAction==="dodge"&&(r.message=`${e.fighter.firstName} dodges the attack!`,r.hypeGained=5);return r}function ht(o,n){o.guardStance=n,o.consecutiveGuards++;const e=D.guard.focusGain*Math.min(o.consecutiveGuards,3);return o.currentFocus=Math.min(o.fighter.currentStats.maxFocus,o.currentFocus+e),{success:!0,damage:0,damageBlocked:0,targetZone:n,critical:!1,perfectParry:!1,counterDamage:0,statusApplied:null,staminaCost:D.guard.staminaCost,focusGained:e,focusSpent:0,hypeGained:0,message:`${o.fighter.firstName} raises guard to protect ${n}!`}}function ut(o){return o.guardStance=null,o.consecutiveGuards=0,{success:!0,damage:0,damageBlocked:0,targetZone:"body",critical:!1,perfectParry:!1,counterDamage:0,statusApplied:null,staminaCost:D.dodge.staminaCost,focusGained:D.dodge.focusGain,focusSpent:0,hypeGained:D.dodge.hypeGain,message:`${o.fighter.firstName} prepares to dodge!`}}function ft(o,n,e,i){const a=D.special;if(n.currentFocus<a.focusCost)return{success:!1,damage:0,damageBlocked:0,targetZone:i,critical:!1,perfectParry:!1,counterDamage:0,statusApplied:null,staminaCost:0,focusGained:0,focusSpent:0,hypeGained:-5,message:`${n.fighter.firstName} lacks focus for a special move!`};n.currentFocus-=a.focusCost,n.fighter.signatureMoveUses++;const t=n.fighter.currentStats.attack*a.baseDamage,s=Math.round(t*p.float(.9,1.2));return e.currentHP-=s,e.injuryMeter+=s*.7,{success:!0,damage:s,damageBlocked:0,targetZone:i,critical:!1,perfectParry:!1,counterDamage:0,statusApplied:null,staminaCost:a.staminaCost,focusGained:0,focusSpent:a.focusCost,hypeGained:a.hypeGain,message:`${n.fighter.firstName} unleashes "${n.fighter.signatureTrait.name}"! ${s} damage!`}}function gt(o,n){return o.currentHP=Math.min(o.fighter.currentStats.maxHP,o.currentHP+30),{success:!0,damage:0,damageBlocked:0,targetZone:"body",critical:!1,perfectParry:!1,counterDamage:0,statusApplied:null,staminaCost:0,focusGained:0,focusSpent:0,hypeGained:-5,message:`${o.fighter.firstName} uses a healing item! Restored 30 HP.`}}function mt(o){for(const n of["player","enemy"]){const e=o[n];e.currentStamina=Math.min(e.fighter.currentStats.maxStamina,e.currentStamina+10);for(const[i,a]of e.activeEffects)i==="bleed"&&(e.currentHP-=5,o.log.push({round:o.round,actor:n,action:"light_attack",result:{success:!0,damage:5,damageBlocked:0,targetZone:"body",critical:!1,perfectParry:!1,counterDamage:0,statusApplied:null,staminaCost:0,focusGained:0,focusSpent:0,hypeGained:0,message:`${e.fighter.firstName} bleeds for 5 damage!`},timestamp:Date.now()})),a<=1?e.activeEffects.delete(i):e.activeEffects.set(i,a-1);e.lastAction!=="guard"&&(e.guardStance=null,e.consecutiveGuards=0)}}function be(o){mt(o),o.turn=o.turn==="player"?"enemy":"player",o.turn==="player"&&o.round++,o.phase="select_action",o.isParryWindow=!1}function pt(o,n){const e=o.injuryMeter/200;if(p.chance(e)){const i=o.injuryMeter>80?"severe":o.injuryMeter>40?"moderate":"minor";return yt(i)}return null}function yt(o){const n=at.filter(i=>i.severity===o);return{...p.pick(n),id:`injury_${p.id(8)}`}}function St(o,n,e){const i=e==="bronze"?1:e==="silver"?1.5:2,a=1+o.crowdHype/100*.5,t=20+o.round*5,s=10+o.round*2,r=25+o.round*5;return{gold:Math.round(t*i*a),fame:Math.round(s*i*a),xp:Math.round(r*i)}}const wt=[{first:"Brutus",last:"Ironjaw"},{first:"Gaius",last:"Bloodhand"},{first:"Marcus",last:"the Cruel"},{first:"Varro",last:"Steelarm"},{first:"Crixus",last:"the Shadow"},{first:"Spartus",last:"Bonecrusher"},{first:"Drago",last:"the Silent"},{first:"Thorin",last:"Skullsplitter"},{first:"Ragnar",last:"the Red"},{first:"Ulric",last:"Deathbringer"},{first:"Kira",last:"Swiftblade"},{first:"Valeria",last:"the Viper"},{first:"Helena",last:"Ironmaiden"},{first:"Freya",last:"Frostbite"},{first:"Sigrid",last:"the Storm"},{first:"Malik",last:"the Merciless"},{first:"Cyrus",last:"Sandstorm"},{first:"Ajax",last:"the Giant"},{first:"Nero",last:"Blackheart"},{first:"Lucius",last:"Goldmask"},{first:"Gorm",last:"the Grim"},{first:"Fenris",last:"Wolfjaw"},{first:"Balthus",last:"the Beast"},{first:"Corvus",last:"Ravenwing"}],Be=[{id:"brute",name:"Brute Force",title:"The Brute",aiType:"brutal",statMultipliers:{maxHP:1.2,attack:1.3,defense:.9,speed:.8},specialAbility:"Heavy blows deal +20% damage",flavorText:"Raw strength and aggression. No finesse, just power.",taunts:["I'll crush your skull!","Weakling! Face a real warrior!","Your bones will crack like twigs!","This ends now!"]},{id:"duelist",name:"Precise Strikes",title:"The Duelist",aiType:"tactical",statMultipliers:{attack:1,defense:1,speed:1.2,accuracy:1.15},specialAbility:"+15% critical chance",flavorText:"Elegant and deadly. Every move calculated.",taunts:["You fight like a farmer.","Too slow. Much too slow.","I've faced better.","Shall we dance?"]},{id:"tank",name:"Iron Wall",title:"The Wall",aiType:"defensive",statMultipliers:{maxHP:1.4,defense:1.4,attack:.8,speed:.7},specialAbility:"+30% block effectiveness",flavorText:"Immovable and patient. Waits for you to tire.",taunts:["Your attacks mean nothing.","I could do this all day.","Tired yet?","I am the wall."]},{id:"assassin",name:"Shadow Strike",title:"The Assassin",aiType:"trickster",statMultipliers:{maxHP:.8,attack:1.1,speed:1.4,evasion:1.3},specialAbility:"+25% dodge chance",flavorText:"Fast and elusive. Strikes from unexpected angles.",taunts:["You can't hit what you can't see.","Too predictable.","Catch me if you can.","Already behind you."]},{id:"berserker",name:"Blood Rage",title:"The Berserker",aiType:"berserker",statMultipliers:{maxHP:1.1,attack:1.2,defense:.7,maxStamina:1.2},specialAbility:"+30% damage when below 50% HP",flavorText:"Grows more dangerous as the fight progresses.",taunts:["BLOOD! MORE BLOOD!","PAIN MAKES ME STRONGER!","RAAAAAAGH!","I CANNOT BE STOPPED!"]},{id:"veteran",name:"Battle Wisdom",title:"The Veteran",aiType:"balanced",statMultipliers:{maxHP:1.1,attack:1.1,defense:1.1,accuracy:1.1},specialAbility:"No weaknesses",flavorText:"Years of experience. Knows every trick in the book.",taunts:["I've seen it all before.","Youth and enthusiasm, meet old age and treachery.","Still learning, I see.","Not bad. But not good enough."]},{id:"showman",name:"Crowd Favorite",title:"The Showman",aiType:"aggressive",statMultipliers:{maxHP:1,attack:1.15,speed:1.1},specialAbility:"+50% crowd hype gain",flavorText:"Fights for glory and applause.",taunts:["Watch closely, crowd!","Let me show you how it's done!","Are you not entertained?!","Remember this moment!"]},{id:"executioner",name:"Final Blow",title:"The Executioner",aiType:"brutal",statMultipliers:{maxHP:1.15,attack:1.25,accuracy:1.1,speed:.9},specialAbility:"+50% damage to enemies below 25% HP",flavorText:"Specializes in finishing wounded opponents.",taunts:["Your end approaches.","I smell your fear.","Time to finish this.","Accept your fate."]}];function kt(o,n){const e=p.pick(Be),i=p.pick(wt),a={bronze:1,silver:1.3,gold:1.6,champion:2}[o],t=Math.min(n*2,20),s={maxHP:Math.round((80+t)*a*(e.statMultipliers.maxHP||1)),currentHP:0,maxStamina:Math.round((80+t*.5)*(e.statMultipliers.maxStamina||1)),currentStamina:0,maxFocus:Math.round(60*(e.statMultipliers.maxFocus||1)),currentFocus:0,attack:Math.round((10+t*.3)*a*(e.statMultipliers.attack||1)),defense:Math.round((8+t*.2)*a*(e.statMultipliers.defense||1)),speed:Math.round((8+t*.2)*(e.statMultipliers.speed||1)),accuracy:Math.round(75+t*.5),evasion:Math.round(10+t*.3),critChance:10,critDamage:150};return s.currentHP=s.maxHP,s.currentStamina=s.maxStamina,{id:`enemy_${p.id(8)}`,firstName:i.first,lastName:i.last,nickname:e.title,fullName:`${i.first} '${e.title}' ${i.last}`,age:p.int(20,50),birthplace:"Unknown",backstory:e.flavorText,personality:vt(e.aiType),baseStats:s,currentStats:{...s},equipment:{weapon:null,armor:null,accessory:null},keepsake:{id:"enemy_keepsake",name:"Fighter's Token",backstory:"A simple token.",effect:"None",statBonus:{},upgraded:!1},inventory:[],signatureTrait:{id:e.id,name:e.name,description:e.specialAbility||"No special ability",type:"neutral",effect:e.specialAbility||""},traits:[],flaws:[],portrait:Re(),level:Math.ceil(n/2),experience:0,wins:p.int(0,n*2),losses:p.int(0,n),kills:p.int(0,n),status:"healthy",injuries:[],scars:[],activeEffects:[],trust:0,trustLevel:"stranger",totalDamageDealt:0,totalDamageTaken:0,perfectParries:0,signatureMoveUses:0,closestCall:s.maxHP,bestWin:"",lettersWritten:[],weeksSurvived:n}}function vt(o){return{aggressive:"aggressive",defensive:"stoic",trickster:"cunning",brutal:"aggressive",balanced:"stoic",cautious:"fearful",berserker:"aggressive",tactical:"cunning"}[o]}function bt(o,n){const e=o.enemy,i=o.player,a=e.currentStamina>=25,t=e.currentFocus>=30&&e.currentStamina>=20,s=e.currentStamina>=15,r=e.currentHP/e.fighter.currentStats.maxHP,l=i.currentHP/i.fighter.currentStats.maxHP;let c,h;switch(n){case"aggressive":c=xt(a,t),h=p.chance(.4)?"head":p.chance(.5)?"body":"legs";break;case"defensive":c=Tt(s,r,i.lastAction),h=i.guardStance?ue(i.guardStance):"body";break;case"trickster":c=Rt(s,t,o),h=Ct(i);break;case"brutal":c=Pt(a,t),h="head";break;case"balanced":c=Bt(a,t,s),h=p.pick(["head","body","legs"]);break;case"cautious":c=At(s,r,l),h="body";break;case"berserker":c=It(a,t,r),h=p.chance(.6)?"head":"body";break;case"tactical":c=Ot(o,a,t,s),h=Mt(i);break;default:c="light_attack",h="body"}return{action:c,targetZone:h}}function xt(o,n,e){return n&&p.chance(.3)?"special":o&&p.chance(.5)?"heavy_attack":"light_attack"}function Tt(o,n,e){return n<.3&&p.chance(.6)?"guard":e==="heavy_attack"&&o?p.chance(.5)?"dodge":"guard":p.chance(.3)?"guard":o&&p.chance(.2)?"dodge":"light_attack"}function Rt(o,n,e){return o&&e.player.lastAction==="heavy_attack"?"dodge":n&&p.chance(.4)?"special":p.chance(.3)?"dodge":"light_attack"}function Ct(o){return o.guardStance?ue(o.guardStance):p.pick(["head","body","legs"])}function Pt(o,n){return n&&p.chance(.4)?"special":o?"heavy_attack":"light_attack"}function Bt(o,n,e,i){const a=p.random();return n&&a<.15?"special":o&&a<.35?"heavy_attack":a<.45?"guard":e&&a<.55?"dodge":"light_attack"}function At(o,n,e){if(n<.4)return p.chance(.5)?"guard":o?"dodge":"guard";if(e<.3)return p.chance(.6)?"light_attack":"heavy_attack";const i=p.random();return i<.3?"guard":o&&i<.4?"dodge":"light_attack"}function It(o,n,e){const i=(1-e)*.3;return n&&p.chance(.3+i)?"special":o&&p.chance(.6+i)?"heavy_attack":"light_attack"}function Ot(o,n,e,i){const a=o.player,t=o.enemy;return a.consecutiveGuards>=2&&e?"special":a.lastAction==="heavy_attack"&&i?"dodge":t.currentFocus>=50&&e?"special":(a.currentStamina<20,n?"heavy_attack":"light_attack")}function Mt(o){return o.activeEffects.has("cripple")?"legs":o.activeEffects.has("concuss")?"head":o.guardStance?ue(o.guardStance):p.pick(["head","body","legs"])}function ue(o){const e=["head","body","legs"].filter(i=>i!==o);return p.pick(e)}function Et(o){const n=Be.find(e=>e.id===o.signatureTrait.id);return n!=null&&n.taunts?p.pick(n.taunts):"You'll fall like the rest."}class xe extends k.GameObjects.Container{constructor(e,i){super(e,i.x,i.y);f(this,"config");f(this,"currentPose","idle");f(this,"torso");f(this,"head");f(this,"armFront");f(this,"armBack");f(this,"legFront");f(this,"legBack");f(this,"weapon");f(this,"shield");f(this,"idleTween");f(this,"baseY");f(this,"skinColor");f(this,"armorColor");f(this,"weaponColor",8421504);this.config=i,this.baseY=i.y;const a=i.fighter.portrait.skinTone;this.skinColor=k.Display.Color.HexStringToColor(a).color;const t=[4864554,5917242,3816010,9127187,3100495];this.armorColor=t[Math.floor(Math.random()*t.length)],this.createBodyParts(),this.setScale(i.scale),i.flipX&&this.setScale(-i.scale,i.scale),e.add.existing(this),this.startIdleAnimation()}createBodyParts(){this.legBack=this.scene.add.graphics(),this.legBack.fillStyle(this.armorColor,1),this.legBack.fillRoundedRect(-8*1,0,16*1,45*1,4),this.legBack.setPosition(-10*1,30*1),this.add(this.legBack),this.armBack=this.scene.add.graphics(),this.armBack.fillStyle(this.skinColor,1),this.armBack.fillRoundedRect(-6*1,0,12*1,35*1,3),this.armBack.setPosition(-18*1,-20*1),this.add(this.armBack),this.torso=this.scene.add.graphics(),this.torso.fillStyle(this.armorColor,1),this.torso.fillRoundedRect(-20*1,-30*1,40*1,60*1,6),this.torso.lineStyle(2,3811866,.5),this.torso.strokeRoundedRect(-18*1,-28*1,36*1,30*1,4),this.torso.fillStyle(3811866,1),this.torso.fillRect(-22*1,20*1,44*1,8*1),this.add(this.torso),this.legFront=this.scene.add.graphics(),this.legFront.fillStyle(this.armorColor,1),this.legFront.fillRoundedRect(-8*1,0,16*1,45*1,4),this.legFront.fillStyle(5917242,1),this.legFront.fillEllipse(0,15*1,10*1,8*1),this.legFront.setPosition(10*1,30*1),this.add(this.legFront),this.head=this.scene.add.graphics(),this.head.fillStyle(this.skinColor,1),this.head.fillRect(-8*1,15*1,16*1,15*1),this.head.fillStyle(this.skinColor,1),this.head.fillEllipse(0,0,28*1,32*1),this.head.fillStyle(16777215,1),this.head.fillEllipse(-7*1,-3*1,6*1,4*1),this.head.fillEllipse(7*1,-3*1,6*1,4*1),this.head.fillStyle(2759184,1),this.head.fillCircle(-6*1,-3*1,2*1),this.head.fillCircle(8*1,-3*1,2*1),this.head.lineStyle(1,9132604,.5),this.head.lineBetween(0,-2*1,0,5*1),this.head.lineStyle(2,5913130,.8),this.head.lineBetween(-5*1,10*1,5*1,10*1),this.head.setPosition(0,-55*1),this.add(this.head),this.weapon=this.scene.add.graphics(),this.weapon.fillStyle(3811866,1),this.weapon.fillRect(-3,0,6,15),this.weapon.fillStyle(this.weaponColor,1),this.weapon.fillRect(-10,-3,20,6),this.weapon.fillStyle(12632256,1),this.weapon.beginPath(),this.weapon.moveTo(-4,-3),this.weapon.lineTo(4,-3),this.weapon.lineTo(2,-55),this.weapon.lineTo(0,-60),this.weapon.lineTo(-2,-55),this.weapon.closePath(),this.weapon.fillPath(),this.weapon.lineStyle(1,16777215,.5),this.weapon.lineBetween(0,-5,0,-55),this.weapon.setPosition(25*1,-15*1),this.weapon.setRotation(-.3),this.add(this.weapon),this.armFront=this.scene.add.graphics(),this.armFront.fillStyle(this.skinColor,1),this.armFront.fillRoundedRect(-6*1,0,12*1,35*1,3),this.armFront.fillStyle(4864554,1),this.armFront.fillRect(-7*1,20*1,14*1,12*1),this.armFront.setPosition(18*1,-20*1),this.add(this.armFront);const i=this.scene.add.graphics();i.fillStyle(0,.3),i.fillEllipse(0,80*1,50*1,15*1),this.add(i),this.sendToBack(i)}startIdleAnimation(){this.stopCurrentAnimation(),this.currentPose="idle",this.idleTween=this.scene.tweens.add({targets:this,y:this.baseY-3,duration:1500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.scene.tweens.add({targets:this.armFront,rotation:-.05,duration:2e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.scene.tweens.add({targets:this.weapon,rotation:-.35,duration:2e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}stopCurrentAnimation(){var e;(e=this.idleTween)==null||e.stop(),this.scene.tweens.killTweensOf(this.armFront),this.scene.tweens.killTweensOf(this.weapon),this.scene.tweens.killTweensOf(this.head),this.scene.tweens.killTweensOf(this)}async playLightAttack(e){this.stopCurrentAnimation(),this.currentPose="attack_light";const i=this.config.flipX?-1:1,a=this.x;return new Promise(t=>{this.scene.tweens.add({targets:this,x:a+40*i,duration:150,ease:"Quad.out",onComplete:()=>{this.scene.tweens.add({targets:this.weapon,rotation:1.5*i,duration:100,ease:"Quad.out",onComplete:()=>{e(),this.scene.tweens.add({targets:this.weapon,rotation:-.3,duration:200,ease:"Quad.out"}),this.scene.tweens.add({targets:this,x:a,duration:200,ease:"Quad.in",onComplete:()=>{this.startIdleAnimation(),t()}})}})}}),this.scene.tweens.add({targets:this.armFront,rotation:.8,duration:250,yoyo:!0,ease:"Quad.inOut"})})}async playHeavyAttack(e){this.stopCurrentAnimation(),this.currentPose="attack_heavy";const i=this.config.flipX?-1:1,a=this.x;return new Promise(t=>{this.scene.tweens.add({targets:this.weapon,rotation:-2,duration:300,ease:"Quad.out",onComplete:()=>{this.scene.tweens.add({targets:this,x:a+60*i,duration:150,ease:"Quad.out"}),this.scene.tweens.add({targets:this.weapon,rotation:2.5*i,duration:150,ease:"Quad.in",onComplete:()=>{m.getSettings().screenShake&&this.scene.cameras.main.shake(100,.01),e(),this.scene.tweens.add({targets:this.weapon,rotation:-.3,duration:400,ease:"Quad.out"}),this.scene.tweens.add({targets:this,x:a,duration:350,ease:"Quad.in",onComplete:()=>{this.startIdleAnimation(),t()}})}})}}),this.scene.tweens.add({targets:this.torso,rotation:.2*i,duration:500,yoyo:!0,ease:"Quad.inOut"})})}async playBlock(){return this.stopCurrentAnimation(),this.currentPose="block",new Promise(e=>{this.scene.tweens.add({targets:this.weapon,rotation:-1.5,y:this.weapon.y-20,duration:150,ease:"Quad.out"}),this.scene.tweens.add({targets:this,y:this.baseY+10,duration:150,ease:"Quad.out",onComplete:()=>{this.scene.time.delayedCall(500,()=>{this.scene.tweens.add({targets:this.weapon,rotation:-.3,y:this.weapon.y+20,duration:200,ease:"Quad.out"}),this.scene.tweens.add({targets:this,y:this.baseY,duration:200,ease:"Quad.out",onComplete:()=>{this.startIdleAnimation(),e()}})})}})})}async playDodge(){this.stopCurrentAnimation(),this.currentPose="dodge";const e=this.config.flipX?1:-1,i=this.x;return new Promise(a=>{this.scene.tweens.add({targets:this,x:i+50*e,y:this.baseY-15,duration:150,ease:"Quad.out",onComplete:()=>{this.scene.tweens.add({targets:this,x:i,y:this.baseY,duration:200,ease:"Quad.in",onComplete:()=>{this.startIdleAnimation(),a()}})}}),this.scene.tweens.add({targets:this.torso,rotation:.3*e,duration:200,yoyo:!0,ease:"Quad.out"})})}async playHit(e){this.stopCurrentAnimation(),this.currentPose="hit";const i=this.config.flipX?1:-1,a=this.x,t=Math.min(e/30,1);return new Promise(s=>{this.scene.tweens.add({targets:this,x:a+25*i*t,duration:100,ease:"Quad.out",onComplete:()=>{this.scene.tweens.add({targets:this,x:a,duration:300,ease:"Quad.out",onComplete:()=>{this.startIdleAnimation(),s()}})}}),this.scene.tweens.add({targets:this.head,rotation:.2*i,duration:100,yoyo:!0,ease:"Quad.out"}),this.scene.tweens.add({targets:this.torso,alpha:.5,duration:50,yoyo:!0,repeat:2})})}async playStagger(){this.stopCurrentAnimation(),this.currentPose="stagger";const e=this.config.flipX?1:-1,i=this.x;return new Promise(a=>{this.scene.tweens.add({targets:this,x:i+50*e,y:this.baseY+20,duration:200,ease:"Quad.out"}),this.scene.tweens.add({targets:this.torso,rotation:.4*e,duration:200,ease:"Quad.out",onComplete:()=>{this.scene.tweens.add({targets:this,x:i,y:this.baseY,duration:500,ease:"Quad.out"}),this.scene.tweens.add({targets:this.torso,rotation:0,duration:500,ease:"Quad.out",onComplete:()=>{this.startIdleAnimation(),a()}})}}),this.scene.tweens.add({targets:this.weapon,rotation:1,duration:300,yoyo:!0,ease:"Quad.out"})})}async playVictory(){return this.stopCurrentAnimation(),this.currentPose="victory",new Promise(e=>{this.scene.tweens.add({targets:this.weapon,rotation:-2,y:this.weapon.y-30,duration:500,ease:"Back.out"}),this.scene.tweens.add({targets:this,y:this.baseY-15,duration:500,ease:"Back.out",onComplete:()=>e()}),this.scene.tweens.add({targets:this.armFront,rotation:-1.2,duration:500,ease:"Back.out"})})}async playDefeat(){return this.stopCurrentAnimation(),this.currentPose="defeat",new Promise(e=>{this.scene.tweens.add({targets:this,y:this.baseY+60,duration:800,ease:"Bounce.out"}),this.scene.tweens.add({targets:this.torso,rotation:1.2,duration:600,ease:"Quad.out"}),this.scene.tweens.add({targets:this.head,rotation:.8,y:this.head.y+30,duration:700,ease:"Quad.out"}),this.scene.tweens.add({targets:this.weapon,rotation:2,x:this.weapon.x+40,y:this.weapon.y+80,duration:500,ease:"Quad.out",onComplete:()=>e()})})}setGuardStance(e){e?this.scene.tweens.add({targets:this.weapon,rotation:-1.2,duration:200,ease:"Quad.out"}):this.scene.tweens.add({targets:this.weapon,rotation:-.3,duration:200,ease:"Quad.out"})}getPose(){return this.currentPose}}class Gt{constructor(n){f(this,"scene");this.scene=n}showDamageNumber(n,e,i,a=!1){if(!m.getSettings().showDamageNumbers)return;const s=a?"#ff4444":"#ffffff",r=a?"28px":"22px",l=this.scene.add.text(n,e,`-${i}`,{fontFamily:"Georgia, serif",fontSize:r,color:s,stroke:"#000000",strokeThickness:3}).setOrigin(.5).setDepth(100);a&&this.createSparkle(n,e,16776960),this.scene.tweens.add({targets:l,y:e-60,alpha:0,duration:1e3,ease:"Quad.out",onComplete:()=>l.destroy()})}showHealNumber(n,e,i){if(!m.getSettings().showDamageNumbers)return;const t=this.scene.add.text(n,e,`+${i}`,{fontFamily:"Georgia, serif",fontSize:"20px",color:"#44ff44",stroke:"#000000",strokeThickness:2}).setOrigin(.5).setDepth(100);this.scene.tweens.add({targets:t,y:e-50,alpha:0,duration:800,ease:"Quad.out",onComplete:()=>t.destroy()})}createSparks(n,e){for(let i=0;i<8;i++){const a=this.scene.add.graphics();a.fillStyle(16763904,1),a.fillCircle(0,0,3),a.setPosition(n,e),a.setDepth(90);const t=Math.PI*2/8*i+Math.random()*.5,s=30+Math.random()*30;this.scene.tweens.add({targets:a,x:n+Math.cos(t)*s,y:e+Math.sin(t)*s,alpha:0,duration:300,ease:"Quad.out",onComplete:()=>a.destroy()})}}createBlood(n,e){if(m.getSettings().bloodFX)for(let a=0;a<5;a++){const t=this.scene.add.graphics();t.fillStyle(9109504,1),t.fillCircle(0,0,2+Math.random()*3),t.setPosition(n,e),t.setDepth(85);const s=Math.random()*Math.PI-Math.PI/2,r=20+Math.random()*40;this.scene.tweens.add({targets:t,x:n+Math.cos(s)*r,y:e+Math.sin(s)*r+30,alpha:.3,duration:500,ease:"Quad.out",onComplete:()=>t.destroy()})}}createSparkle(n,e,i=16777215){for(let a=0;a<6;a++){const t=this.scene.add.graphics();t.fillStyle(i,1),t.beginPath(),t.moveTo(0,-6),t.lineTo(2,-2),t.lineTo(6,0),t.lineTo(2,2),t.lineTo(0,6),t.lineTo(-2,2),t.lineTo(-6,0),t.lineTo(-2,-2),t.closePath(),t.fillPath(),t.setPosition(n,e),t.setDepth(95);const s=Math.PI*2/6*a,r=25+Math.random()*15;this.scene.tweens.add({targets:t,x:n+Math.cos(s)*r,y:e+Math.sin(s)*r,rotation:Math.PI,alpha:0,scale:.3,duration:400,ease:"Quad.out",onComplete:()=>t.destroy()})}}showStatusEffect(n,e,i){const t={bleed:"🩸",stun:"💫",block:"🛡️",dodge:"💨",crit:"⚡",miss:"❌"}[i]||"❓",s=this.scene.add.text(n,e-30,t,{fontSize:"24px"}).setOrigin(.5).setDepth(100);this.scene.tweens.add({targets:s,y:e-70,alpha:0,duration:1e3,ease:"Quad.out",onComplete:()=>s.destroy()})}screenFlash(n=16777215,e=.3){const{width:i,height:a}=this.scene.cameras.main,t=this.scene.add.rectangle(i/2,a/2,i,a,n,e).setDepth(200);this.scene.tweens.add({targets:t,alpha:0,duration:200,onComplete:()=>t.destroy()})}createWeaponTrail(n,e,i,a){const t=this.scene.add.graphics();t.lineStyle(4,16777215,.6),t.beginPath(),t.moveTo(n,e);const s=(n+i)/2+(Math.random()-.5)*30,r=(e+a)/2-20,l=10;for(let c=1;c<=l;c++){const h=c/l,d=h*h,g=1-h,y=g*g,w=y*n+2*g*h*s+d*i,S=y*e+2*g*h*r+d*a;t.lineTo(w,S)}t.strokePath(),t.setDepth(80),this.scene.tweens.add({targets:t,alpha:0,duration:200,onComplete:()=>t.destroy()})}}class Ft extends k.Scene{constructor(){super({key:"FightScene"});f(this,"combatState");f(this,"player");f(this,"enemy");f(this,"selectedAction",null);f(this,"selectedZone","body");f(this,"playerSprite");f(this,"enemySprite");f(this,"vfx");f(this,"playerHealthBar");f(this,"enemyHealthBar");f(this,"playerStaminaBar");f(this,"playerFocusBar");f(this,"combatLog");f(this,"roundText");f(this,"hypeBar");f(this,"actionButtonsContainer");f(this,"zoneButtons",[]);f(this,"isInputEnabled",!0)}create(){const e=m.getRun();if(!e.fighter){this.scene.start("MainMenuScene");return}this.player=e.fighter,this.enemy=kt(e.league,e.week),this.combatState=ct(this.player,this.enemy),this.vfx=new Gt(this),this.createBackground(),this.createFighters(),this.createCombatUI(),this.createActionPanel();const i=Et(this.enemy);this.showCombatMessage(i),this.cameras.main.fadeIn(300)}createBackground(){const{width:e,height:i}=this.cameras.main,a=this.add.graphics();a.fillGradientStyle(3811866,3811866,2760469,2760469),a.fillRect(0,0,e,i),a.fillStyle(4864544,1),a.fillRect(0,i*.55,e,i*.45),a.lineStyle(1,3811861,.3);for(let s=0;s<8;s++){const r=i*.55+s*25;a.moveTo(0,r+Math.random()*10),a.lineTo(e,r+Math.random()*10)}a.strokePath(),a.fillStyle(2759184,.6),a.fillRect(0,i*.2,e,i*.15);for(let s=0;s<15;s++){const r=s/14*e,l=i*.25+Math.random()*20;a.fillStyle(1708560,.8),a.fillCircle(r,l,8+Math.random()*5),a.fillRect(r-5,l,10,15)}const t=this.add.graphics();t.fillStyle(0,.4),t.fillRect(0,0,e,i*.08),t.fillRect(0,i*.92,e,i*.08)}createFighters(){const{width:e,height:i}=this.cameras.main;this.playerSprite=new xe(this,{fighter:this.player,x:e*.25,y:i*.48,scale:.9,flipX:!1}),this.enemySprite=new xe(this,{fighter:this.enemy,x:e*.75,y:i*.48,scale:.9,flipX:!0})}createCombatUI(){const{width:e,height:i}=this.cameras.main,a=G();this.roundText=this.add.text(e/2,a.top+15,`ROUND ${this.combatState.round}`,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#c9a959"}).setOrigin(.5);const t=a.left,s=a.top+40,r=Math.min(140,e*.35),l=18;this.playerHealthBar=this.createHealthBar(t,s,r,l,!0),this.add.text(t,s-15,this.player.firstName,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#c9a959"}),this.playerStaminaBar=this.createResourceBar(t,s+22,r*.8,10,4620980),this.add.text(t,s+20,"STA",{fontFamily:"Georgia, serif",fontSize:"8px",color:"#8b7355"}),this.playerFocusBar=this.createResourceBar(t,s+36,r*.6,8,10040012),this.add.text(t,s+35,"FOC",{fontFamily:"Georgia, serif",fontSize:"8px",color:"#8b7355"});const c=Math.min(140,e*.35),h=e-a.right-c,d=a.top+40;this.enemyHealthBar=this.createHealthBar(h,d,c,l,!1),this.add.text(h+c,d-15,this.enemy.firstName,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b4513"}).setOrigin(1,0),this.add.text(h+c,d+5,`"${this.enemy.nickname}"`,{fontFamily:"Georgia, serif",fontSize:"9px",color:"#5a4a3a",fontStyle:"italic"}).setOrigin(1,0);const g=120;this.hypeBar=this.createResourceBar(e/2-g/2,a.top+35,g,10,16766720),this.add.text(e/2,a.top+33,"CROWD",{fontFamily:"Georgia, serif",fontSize:"8px",color:"#8b7355"}).setOrigin(.5,0),this.combatLog=this.add.text(e/2,i*.38,"",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#c9a959",wordWrap:{width:e-40},align:"center",stroke:"#000000",strokeThickness:2}).setOrigin(.5).setDepth(50),this.updateAllBars()}createHealthBar(e,i,a,t,s){const r=this.add.graphics();r.fillStyle(2760474,1),r.fillRoundedRect(e,i,a,t,4),r.lineStyle(1,5917242,1),r.strokeRoundedRect(e,i,a,t,4);const l=this.add.graphics();return{bg:r,fill:l,x:e,y:i,w:a,h:t}}createResourceBar(e,i,a,t,s){const r=this.add.graphics();r.fillStyle(2760474,1),r.fillRoundedRect(e,i,a,t,3);const l=this.add.graphics();return l.fillStyle(s,1),l.fillRoundedRect(e+1,i+1,a-2,t-2,2),{fill:l,x:e,y:i,w:a,h:t}}updateHealthBar(e,i,a){const t=Math.max(0,i/a),s=t>.5?2263842:t>.25?14329120:9109504;e.fill.clear(),e.fill.fillStyle(s,1),e.fill.fillRoundedRect(e.x+2,e.y+2,(e.w-4)*t,e.h-4,3)}updateResourceBar(e,i,a){e.fill.clear(),e.fill.fillStyle(a,1),e.fill.fillRoundedRect(e.x+1,e.y+1,(e.w-2)*Math.max(0,i),e.h-2,2)}updateAllBars(){this.updateHealthBar(this.playerHealthBar,this.combatState.player.currentHP,this.player.currentStats.maxHP),this.updateHealthBar(this.enemyHealthBar,this.combatState.enemy.currentHP,this.enemy.currentStats.maxHP),this.updateResourceBar(this.playerStaminaBar,this.combatState.player.currentStamina/this.player.currentStats.maxStamina,4620980),this.updateResourceBar(this.playerFocusBar,this.combatState.player.currentFocus/this.player.currentStats.maxFocus,10040012),this.updateResourceBar(this.hypeBar,this.combatState.crowdHype/100,16766720)}createActionPanel(){const{width:e,height:i}=this.cameras.main,a=V(this);G();const t=i*.62,s=["head","body","legs"],r={head:"🎯 HEAD",body:"🎯 BODY",legs:"🎯 LEGS"},l=Math.min(85,(a.width-20)/3);s.forEach((v,R)=>{const B=e/2+(R-1)*(l+8),O=this.createZoneButton(B,t,l,36,r[v],v);this.zoneButtons.push(O)}),this.highlightZone("body"),this.actionButtonsContainer=this.add.container(0,0);const c=[{action:"light_attack",label:"LIGHT",stamina:10,icon:"⚔️"},{action:"heavy_attack",label:"HEAVY",stamina:25,icon:"💥"},{action:"guard",label:"GUARD",stamina:5,icon:"🛡️"},{action:"dodge",label:"DODGE",stamina:15,icon:"💨"},{action:"special",label:"SPECIAL",stamina:20,icon:"✨"},{action:"item",label:"ITEM",stamina:0,icon:"🧪"}],h=3,d=Math.min(100,(a.width-20)/h),g=Math.max(H,48),y=d+8,w=g+8,S=i*.72;c.forEach((v,R)=>{const B=R%h,O=Math.floor(R/h),C=e/2+(B-1)*y,N=S+O*w;this.createActionButton(C,N,d,g,v.icon,v.label,v.action,v.stamina)})}createZoneButton(e,i,a,t,s,r){const l=this.add.container(e,i),c=this.add.graphics();c.fillStyle(2760474,.9),c.fillRoundedRect(-a/2,-t/2,a,t,5),c.lineStyle(2,5917242,1),c.strokeRoundedRect(-a/2,-t/2,a,t,5),l.add(c);const h=this.add.text(0,0,s,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355"}).setOrigin(.5);return l.add(h),l.setData("zone",r),l.setData("bg",c),l.setData("text",h),l.setSize(a,t),l.setInteractive(new k.Geom.Rectangle(-a/2,-t/2,a,t),k.Geom.Rectangle.Contains),l.on("pointerdown",()=>{this.isInputEnabled&&(this.selectedZone=r,this.highlightZone(r))}),l}highlightZone(e){this.zoneButtons.forEach(i=>{const a=i.getData("zone"),t=i.getData("bg"),s=i.getData("text"),r=a===e,l=i.width,c=i.height;t.clear(),t.fillStyle(r?3811882:2760474,.9),t.fillRoundedRect(-l/2,-c/2,l,c,5),t.lineStyle(2,r?13216089:5917242,1),t.strokeRoundedRect(-l/2,-c/2,l,c,5),s.setColor(r?"#c9a959":"#8b7355")})}createActionButton(e,i,a,t,s,r,l,c){const h=this.add.container(e,i);this.actionButtonsContainer.add(h);const d=this.add.graphics();d.fillStyle(2760474,.95),d.fillRoundedRect(-a/2,-t/2,a,t,6),d.lineStyle(2,5917242,1),d.strokeRoundedRect(-a/2,-t/2,a,t,6),h.add(d);const g=this.add.text(-a/2+10,0,s,{fontSize:"16px"}).setOrigin(0,.5);h.add(g);const y=this.add.text(-a/2+32,-5,r,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#c9a959"});h.add(y);const w=this.add.text(-a/2+32,8,`${c} sta`,{fontFamily:"Georgia, serif",fontSize:"9px",color:"#8b7355"});h.add(w),h.setSize(a,t),h.setInteractive(new k.Geom.Rectangle(-a/2,-t/2,a,t),k.Geom.Rectangle.Contains),h.on("pointerover",()=>{this.isInputEnabled&&(d.clear(),d.fillStyle(3813162,.95),d.fillRoundedRect(-a/2,-t/2,a,t,6),d.lineStyle(2,13216089,1),d.strokeRoundedRect(-a/2,-t/2,a,t,6))}),h.on("pointerout",()=>{d.clear(),d.fillStyle(2760474,.95),d.fillRoundedRect(-a/2,-t/2,a,t,6),d.lineStyle(2,5917242,1),d.strokeRoundedRect(-a/2,-t/2,a,t,6)}),h.on("pointerdown",()=>{this.isInputEnabled&&this.performAction(l)})}async performAction(e){if(!this.isInputEnabled||this.combatState.turn!=="player"||this.combatState.phase==="end")return;const i={light_attack:10,heavy_attack:25,guard:5,dodge:15,special:20,item:0};if(this.combatState.player.currentStamina<i[e]){this.showCombatMessage("Not enough stamina!");return}if(e==="special"&&this.combatState.player.currentFocus<30){this.showCombatMessage("Not enough focus!");return}this.disableInput(),await this.animatePlayerAction(e);const a=ve(this.combatState,"player",e,this.selectedZone);if(this.showCombatMessage(a.message),a.damage>0){const{width:t,height:s}=this.cameras.main;this.vfx.showDamageNumber(t*.75,s*.4,a.damage,a.critical||!1),this.vfx.createSparks(t*.75,s*.45),a.damage>20?await this.enemySprite.playStagger():await this.enemySprite.playHit(a.damage)}else if(e==="guard"||e==="dodge"){const{width:t,height:s}=this.cameras.main;this.vfx.showStatusEffect(t*.25,s*.35,e==="guard"?"block":"dodge")}if(this.updateAllBars(),this.combatState.winner){await this.endCombat();return}await this.delay(800),await this.performEnemyTurn()}async animatePlayerAction(e){switch(e){case"light_attack":await this.playerSprite.playLightAttack(()=>{const{width:i,height:a}=this.cameras.main;this.vfx.createWeaponTrail(i*.35,a*.4,i*.65,a*.45)});break;case"heavy_attack":await this.playerSprite.playHeavyAttack(()=>{const{width:i,height:a}=this.cameras.main;this.vfx.createWeaponTrail(i*.3,a*.3,i*.7,a*.5),this.vfx.screenFlash(16777215,.2)});break;case"guard":this.playerSprite.setGuardStance(!0),await this.playerSprite.playBlock();break;case"dodge":await this.playerSprite.playDodge();break;case"special":this.vfx.screenFlash(16766720,.3),await this.playerSprite.playHeavyAttack(()=>{const{width:i,height:a}=this.cameras.main;this.vfx.createSparkle(i*.75,a*.4,16766720)});break;default:await this.delay(300)}}async performEnemyTurn(){if(this.combatState.winner)return;be(this.combatState),this.roundText.setText(`ROUND ${this.combatState.round}`);const e=this.enemy.signatureTrait.id||"balanced",{action:i,targetZone:a}=bt(this.combatState,e),t={light_attack:"⚔️",heavy_attack:"💥",guard:"🛡️",dodge:"💨",special:"✨",item:"🧪"};this.showCombatMessage(`Enemy prepares: ${t[i]}`),await this.delay(500),await this.animateEnemyAction(i);const s=ve(this.combatState,"enemy",i,a);if(this.showCombatMessage(s.message),s.damage>0){const{width:r,height:l}=this.cameras.main;this.vfx.showDamageNumber(r*.25,l*.4,s.damage,s.critical||!1),this.vfx.createSparks(r*.25,l*.45),m.getSettings().bloodFX&&s.damage>15&&this.vfx.createBlood(r*.25,l*.45),s.damage>20?(this.shakeScreen(),await this.playerSprite.playStagger()):await this.playerSprite.playHit(s.damage)}if(this.updateAllBars(),this.combatState.winner){await this.endCombat();return}await this.delay(500),be(this.combatState),this.enableInput()}async animateEnemyAction(e){switch(e){case"light_attack":await this.enemySprite.playLightAttack(()=>{const{width:i,height:a}=this.cameras.main;this.vfx.createWeaponTrail(i*.65,a*.4,i*.35,a*.45)});break;case"heavy_attack":await this.enemySprite.playHeavyAttack(()=>{const{width:i,height:a}=this.cameras.main;this.vfx.createWeaponTrail(i*.7,a*.3,i*.3,a*.5)});break;case"guard":this.enemySprite.setGuardStance(!0),await this.enemySprite.playBlock();break;case"dodge":await this.enemySprite.playDodge();break;default:await this.delay(300)}}showCombatMessage(e){this.combatLog.setText(e),this.tweens.add({targets:this.combatLog,alpha:{from:1,to:.8},duration:80,yoyo:!0})}shakeScreen(){m.getSettings().screenShake&&this.cameras.main.shake(150,.012)}disableInput(){this.isInputEnabled=!1,this.actionButtonsContainer.setAlpha(.5),this.zoneButtons.forEach(e=>e.setAlpha(.5))}enableInput(){this.isInputEnabled=!0,this.actionButtonsContainer.setAlpha(1),this.zoneButtons.forEach(e=>e.setAlpha(1))}delay(e){return new Promise(i=>this.time.delayedCall(e,i))}async endCombat(){var a;this.disableInput();const e=this.combatState.winner==="player",i=m.getRun();if(e){await this.playerSprite.playVictory(),await this.enemySprite.playDefeat(),this.vfx.screenFlash(16766720,.2),this.player.wins++,this.player.totalDamageDealt+=this.combatState.log.filter(r=>r.actor==="player").reduce((r,l)=>r+l.result.damage,0),this.player.weeksSurvived=i.week+1;const t=pt(this.combatState.player);t&&Ne(this.player,t);const s=St(this.combatState,!0,i.league);m.updateRun({fighter:this.player,gold:i.gold+s.gold,fame:i.fame+s.fame,fightsInLeague:i.fightsInLeague+1,consecutiveWins:i.consecutiveWins+1,fightsSinceRelic:i.fightsSinceRelic+1}),await this.delay(1500),this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("ResultsScene",{won:!0,rewards:s,injury:t,enemy:this.enemy})})}else await this.playerSprite.playDefeat(),await this.enemySprite.playVictory(),this.vfx.screenFlash(9109504,.3),this.player.status="dead",this.player.causeOfDeath=je({damage:((a=this.combatState.lastAction)==null?void 0:a.damage)||0,location:this.selectedZone,weaponType:"blade"},this.combatState.round,this.enemy.fullName),this.player.lastWords=qe(this.player),this.player.killedBy=this.enemy.fullName,m.updateRun({fighter:this.player,consecutiveWins:0}),m.endRun(!1),this.player.lastWords&&(this.showCombatMessage(`"${this.player.lastWords}"`),await this.delay(2500)),this.cameras.main.fadeOut(500),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("DeathScene")})}}class _t extends k.Scene{constructor(){super({key:"ResultsScene"});f(this,"resultsData")}init(e){this.resultsData=e}create(){const{width:e,height:i}=this.cameras.main;if(this.createBackground(),this.createResultsDisplay(),this.createRewardsDisplay(),this.createContinueButton(),this.resultsData.won){const a=m.getRun();a.fighter&&(J(a.fighter,5),m.updateRun({fighter:a.fighter}))}this.checkLeagueAdvancement(),this.cameras.main.fadeIn(300)}createBackground(){const{width:e,height:i}=this.cameras.main,a=this.add.graphics();a.fillGradientStyle(1709072,1709072,2760474,2760474),a.fillRect(0,0,e,i)}createResultsDisplay(){const{width:e}=this.cameras.main,i=this.resultsData.won?"VICTORY!":"DEFEAT",a=this.resultsData.won?"#c9a959":"#8b0000";this.add.text(e/2,80,i,{fontFamily:"Georgia, serif",fontSize:"36px",color:a,stroke:"#000000",strokeThickness:4}).setOrigin(.5),this.resultsData.won&&this.add.text(e/2,130,`${this.resultsData.enemy.fullName} has fallen!`,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#8b7355",fontStyle:"italic"}).setOrigin(.5),this.resultsData.injury&&(this.add.text(e/2,160,`⚠️ INJURY: ${this.resultsData.injury.name}`,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#8b4513"}).setOrigin(.5),this.add.text(e/2,180,this.resultsData.injury.effect,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#5a4a3a"}).setOrigin(.5))}createRewardsDisplay(){const{width:e}=this.cameras.main,i=230;this.add.text(e/2,i,"═══ REWARDS ═══",{fontFamily:"Georgia, serif",fontSize:"16px",color:"#c9a959"}).setOrigin(.5);const a=this.add.text(e/2,i+40,`💰 ${this.resultsData.rewards.gold} Gold`,{fontFamily:"Georgia, serif",fontSize:"18px",color:"#ffd700"}).setOrigin(.5),t=this.add.text(e/2,i+70,`⭐ ${this.resultsData.rewards.fame} Fame`,{fontFamily:"Georgia, serif",fontSize:"16px",color:"#c0c0c0"}).setOrigin(.5),s=this.add.text(e/2,i+100,`📈 ${this.resultsData.rewards.xp} XP`,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#8b7355"}).setOrigin(.5);[a,t,s].forEach((r,l)=>{r.setAlpha(0),this.tweens.add({targets:r,alpha:1,y:r.y-10,duration:300,delay:200+l*200,ease:"Back.out"})})}checkLeagueAdvancement(){const e=m.getRun(),{width:i}=this.cameras.main;if(e.fightsInLeague>=e.fightsToNextLeague){const t={bronze:"silver",silver:"gold",gold:"champion"}[e.league];t&&(this.time.delayedCall(1e3,()=>{const s=this.add.text(i/2,400,`🏆 ADVANCED TO ${t.toUpperCase()} LEAGUE!`,{fontFamily:"Georgia, serif",fontSize:"18px",color:"#ffd700",stroke:"#000000",strokeThickness:2}).setOrigin(.5).setAlpha(0);this.tweens.add({targets:s,alpha:1,scale:{from:.5,to:1},duration:500,ease:"Back.out"})}),m.updateRun({league:t,fightsInLeague:0,fightsToNextLeague:t==="champion"?1:3}),m.addBloodlinePoints(5),m.addPromoterXP(25))}}createContinueButton(){const{width:e,height:i}=this.cameras.main;b.createButton(this,e/2,i-80,"CONTINUE",()=>this.continue(),{width:200,height:50,primary:!0})}continue(){this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("CampScene")})}}class Ht extends k.Scene{constructor(){super({key:"DeathScene"});f(this,"fighter");f(this,"legendEntry");f(this,"playerNote","")}create(){const e=m.getRun();if(!e.fighter){this.scene.start("MainMenuScene");return}this.fighter=e.fighter,this.legendEntry=Ue(this.fighter,"dead",e.league,e.promise||"none",!1),this.createBackground(),this.createMemorial(),this.createNoteInput(),this.createButtons(),this.cameras.main.fadeIn(1e3,0,0,0)}createBackground(){const{width:e,height:i}=this.cameras.main,a=this.add.graphics();if(a.fillGradientStyle(657414,657414,1709072,1709072),a.fillRect(0,0,e,i),this.textures.exists("vignette")){const t=this.add.image(e/2,i/2,"vignette");t.setDisplaySize(e,i),t.setAlpha(.8)}}createMemorial(){const{width:e,height:i}=this.cameras.main,a=e/2,t=320,s=500,r=a-t/2,l=40,c=this.add.graphics();c.fillStyle(1709072,.9),c.fillRoundedRect(r,l,t,s,12),c.lineStyle(3,5917242,1),c.strokeRoundedRect(r,l,t,s,12),c.lineStyle(1,3811866,.5),c.strokeRoundedRect(r+8,l+8,t-16,s-16,8),this.add.text(a,l+30,"IN MEMORIAM",{fontFamily:"Georgia, serif",fontSize:"18px",color:"#c9a959",letterSpacing:4}).setOrigin(.5);const h=l+100;Z.renderPortrait(this,this.fighter.portrait,a,h,80),this.add.text(a,h+60,this.fighter.fullName,{fontFamily:"Georgia, serif",fontSize:"16px",color:"#c9a959"}).setOrigin(.5),this.add.text(a,h+82,`${this.fighter.age} winters • ${this.fighter.birthplace}`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b7355"}).setOrigin(.5),this.fighter.causeOfDeath&&this.add.text(a,h+115,this.fighter.causeOfDeath,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b4513",fontStyle:"italic",wordWrap:{width:280},align:"center"}).setOrigin(.5),this.fighter.lastWords&&this.add.text(a,h+160,`"${this.fighter.lastWords}"`,{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b7355",fontStyle:"italic"}).setOrigin(.5);const d=h+200;this.add.text(a,d,"─── LEGACY ───",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#5a4a3a"}).setOrigin(.5),[`Victories: ${this.fighter.wins}`,`Weeks Survived: ${this.fighter.weeksSurvived}`,`Signature Moves: ${this.fighter.signatureMoveUses}`,`Perfect Parries: ${this.fighter.perfectParries}`,`Closest Call: ${this.fighter.closestCall} HP`].forEach((S,v)=>{this.add.text(a,d+25+v*18,S,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b7355"}).setOrigin(.5)}),m.getRun();const y=d+120;this.add.text(a,y,"⚔️ Promise Broken",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b4513"}).setOrigin(.5),this.add.text(a,y+25,`📿 ${this.fighter.keepsake.name} - Recovered`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#6b8e23"}).setOrigin(.5)}createNoteInput(){const{width:e,height:i}=this.cameras.main;this.add.text(e/2,570,"Leave a note for the fallen:",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b7355"}).setOrigin(.5);const a=this.add.graphics();a.fillStyle(2760474,1),a.fillRoundedRect(e/2-140,585,280,60,6),a.lineStyle(1,5917242,1),a.strokeRoundedRect(e/2-140,585,280,60,6);const t=this.add.text(e/2,615,"Tap to add note...",{fontFamily:"Georgia, serif",fontSize:"11px",color:"#5a4a3a",fontStyle:"italic"}).setOrigin(.5);a.setInteractive(new k.Geom.Rectangle(e/2-140,585,280,60),k.Geom.Rectangle.Contains),a.on("pointerdown",()=>{const s=prompt("Write a note for the fallen:");if(s){this.playerNote=s,this.legendEntry.playerNote=s,t.setText(s.substring(0,40)+(s.length>40?"...":"")),t.setColor("#c9a959"),t.setFontStyle("normal");const r=m.getHallOfLegends(),l=r.find(c=>c.id===this.legendEntry.id);l&&(l.playerNote=s,m.updateMeta({hallOfLegends:r}))}})}createButtons(){const{width:e,height:i}=this.cameras.main;b.createButton(this,e/2,i-60,"RETURN TO MENU",()=>this.returnToMenu(),{width:200,height:50,primary:!0})}returnToMenu(){this.cameras.main.fadeOut(500,0,0,0),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("MainMenuScene")})}}class Dt extends k.Scene{constructor(){super({key:"HallOfLegendsScene"});f(this,"legends",[]);f(this,"scrollOffset",0);f(this,"selectedLegend",null);f(this,"detailsContainer")}create(){this.legends=m.getHallOfLegends(),this.createBackground(),this.createHeader(),this.createLegendList(),this.createDetailsPanel(),this.createBackButton(),this.cameras.main.fadeIn(300)}createBackground(){const{width:e,height:i}=this.cameras.main,a=this.add.graphics();if(a.fillGradientStyle(657414,657414,1709072,1709072),a.fillRect(0,0,e,i),this.textures.exists("parchment_overlay")){const t=this.add.image(e/2,i/2,"parchment_overlay");t.setAlpha(.05),t.setDisplaySize(e,i)}}createHeader(){const{width:e}=this.cameras.main;this.add.text(e/2,35,"HALL OF LEGENDS",{fontFamily:"Georgia, serif",fontSize:"24px",color:"#c9a959",stroke:"#000000",strokeThickness:3}).setOrigin(.5),this.add.text(e/2,65,"Those who fought and fell...",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b7355",fontStyle:"italic"}).setOrigin(.5);const i=this.legends.filter(s=>s.status==="dead").length,a=this.legends.filter(s=>s.status==="retired").length,t=this.legends.filter(s=>s.status==="champion").length;this.add.text(e/2,85,`☠️ ${i}  |  🏛️ ${a}  |  🏆 ${t}`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#5a4a3a"}).setOrigin(.5)}createLegendList(){const{width:e,height:i}=this.cameras.main;if(this.legends.length===0){this.add.text(e/2,200,`No legends yet...

Your fighters will be remembered here.`,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#5a4a3a",align:"center"}).setOrigin(.5);return}const a=110,t=70,s=e-40,r=[...this.legends].sort((l,c)=>c.dateAdded-l.dateAdded);r.slice(0,5).forEach((l,c)=>{this.createLegendCard(l,20,a+c*(t+10),s,t)}),r.length>5&&this.add.text(e/2,a+5*(t+10)+10,`...and ${r.length-5} more`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#5a4a3a"}).setOrigin(.5)}createLegendCard(e,i,a,t,s){var B;const r=this.add.container(i,a),l=this.add.graphics(),c=e.status==="champion"?2763280:e.status==="retired"?1714714:2759194;l.fillStyle(c,1),l.fillRoundedRect(0,0,t,s,8),l.lineStyle(1,5917242,1),l.strokeRoundedRect(0,0,t,s,8),r.add(l);const h=Z.renderMiniPortrait(this,e.fighter.portrait,35,s/2,40);r.add(h);const d=this.add.text(70,12,e.fighter.fullName,{fontFamily:"Georgia, serif",fontSize:"13px",color:"#c9a959"});r.add(d);const g=e.status==="champion"?"🏆":e.status==="retired"?"🏛️":"☠️",y=this.add.text(t-15,12,g,{fontSize:"16px"}).setOrigin(1,0);r.add(y);const w=`${e.leagueReached.toUpperCase()} | ${e.wins} wins | ${e.weeksSurvived} weeks`,S=this.add.text(70,32,w,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355"});r.add(S);const v=e.status==="dead"?((B=e.causeOfDeath)==null?void 0:B.substring(0,40))+"...":e.status==="retired"?"Retired with honor":"Became Champion!",R=this.add.text(70,48,v||"",{fontFamily:"Georgia, serif",fontSize:"9px",color:"#5a4a3a",fontStyle:"italic"});r.add(R),l.setInteractive(new k.Geom.Rectangle(0,0,t,s),k.Geom.Rectangle.Contains),l.on("pointerdown",()=>this.showDetails(e)),l.on("pointerover",()=>{l.clear(),l.fillStyle(c+1118481,1),l.fillRoundedRect(0,0,t,s,8),l.lineStyle(2,13216089,1),l.strokeRoundedRect(0,0,t,s,8)}),l.on("pointerout",()=>{l.clear(),l.fillStyle(c,1),l.fillRoundedRect(0,0,t,s,8),l.lineStyle(1,5917242,1),l.strokeRoundedRect(0,0,t,s,8)})}createDetailsPanel(){const{width:e,height:i}=this.cameras.main;this.detailsContainer=this.add.container(e/2,550),this.detailsContainer.setVisible(!1);const a=this.add.graphics();a.fillStyle(1709072,.95),a.fillRoundedRect(-160,-100,320,200,10),a.lineStyle(2,13216089,1),a.strokeRoundedRect(-160,-100,320,200,10),this.detailsContainer.add(a)}showDetails(e){this.selectedLegend=e,this.detailsContainer.removeAll(!0);const i=this.add.graphics();i.fillStyle(1709072,.95),i.fillRoundedRect(-160,-100,320,200,10),i.lineStyle(2,13216089,1),i.strokeRoundedRect(-160,-100,320,200,10),this.detailsContainer.add(i);const a=this.add.text(0,-85,e.fighter.fullName,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#c9a959"}).setOrigin(.5);this.detailsContainer.add(a);const t=this.add.text(0,-65,`✨ ${e.fighter.signatureTrait}`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#6b8e23"}).setOrigin(.5);if(this.detailsContainer.add(t),e.bestWin){const r=this.add.text(0,-45,`Best Victory: ${e.bestWin}`,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355"}).setOrigin(.5);this.detailsContainer.add(r)}if(e.lettersWritten.length>0){const r=this.add.text(0,-25,`📜 ${e.lettersWritten.length} letters written`,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355"}).setOrigin(.5);this.detailsContainer.add(r)}if(e.playerNote){const r=this.add.text(0,10,`"${e.playerNote}"`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#c9a959",fontStyle:"italic",wordWrap:{width:280},align:"center"}).setOrigin(.5);this.detailsContainer.add(r)}const s=b.createButton(this,0,70,"CLOSE",()=>this.detailsContainer.setVisible(!1),{width:80,height:30,fontSize:"11px"});this.detailsContainer.add(s),this.detailsContainer.setVisible(!0)}createBackButton(){const{width:e,height:i}=this.cameras.main;b.createButton(this,e/2,i-50,"← BACK TO MENU",()=>this.returnToMenu(),{width:180,height:45})}returnToMenu(){this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("MainMenuScene")})}}class Lt extends k.Scene{constructor(){super({key:"BloodlinePerksScene"});f(this,"pointsText");f(this,"selectedPerk",null);f(this,"detailsContainer");f(this,"perkContainers",new Map)}create(){this.createBackground(),this.createHeader(),this.createPerkTree(),this.createDetailsPanel(),this.createBackButton(),this.cameras.main.fadeIn(300)}createBackground(){const{width:e,height:i}=this.cameras.main,a=this.add.graphics();a.fillGradientStyle(1709072,1709072,2760474,2760474),a.fillRect(0,0,e,i)}createHeader(){const{width:e}=this.cameras.main,i=m.getMeta();this.add.text(e/2,35,"BLOODLINE PERKS",{fontFamily:"Georgia, serif",fontSize:"24px",color:"#c9a959",stroke:"#000000",strokeThickness:3}).setOrigin(.5),this.add.text(e/2,65,"Permanent upgrades for future fighters",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b7355",fontStyle:"italic"}).setOrigin(.5),this.pointsText=this.add.text(e/2,90,`⚡ ${i.bloodlinePoints} Points Available`,{fontFamily:"Georgia, serif",fontSize:"16px",color:"#ffd700"}).setOrigin(.5),this.add.text(e/2,110,`Promoter Level: ${i.promoterLevel}`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b7355"}).setOrigin(.5)}createPerkTree(){const{width:e}=this.cameras.main,i=150,a=160,t=$.filter(l=>l.tier===1),s=$.filter(l=>l.tier===2),r=$.filter(l=>l.tier===3);this.add.text(e/2,i-15,"─── TIER 1 ───",{fontFamily:"Georgia, serif",fontSize:"11px",color:"#5a4a3a"}).setOrigin(.5),this.createPerkRow(t,i,e),this.add.text(e/2,i+a-15,"─── TIER 2 ───",{fontFamily:"Georgia, serif",fontSize:"11px",color:"#5a4a3a"}).setOrigin(.5),this.createPerkRow(s,i+a,e),this.add.text(e/2,i+a*2-15,"─── TIER 3 ───",{fontFamily:"Georgia, serif",fontSize:"11px",color:"#5a4a3a"}).setOrigin(.5),this.createPerkRow(r,i+a*2,e)}createPerkRow(e,i,a){const r=a/2-(e.length-1)*75/2;e.forEach((l,c)=>{const h=r+c*75;this.createPerkNode(l,h,i,60)})}createPerkNode(e,i,a,t){const s=this.add.container(i,a);this.perkContainers.set(e.id,s);const l=m.getMeta().unlockedPerks.includes(e.id),{canPurchase:c,reason:h}=le(e.id),d=this.add.graphics(),g=l?2771498:c?2763322:2760474;d.fillStyle(g,1),d.fillRoundedRect(-t/2,-t/2,t,t,8);const y=l?7048739:c?13216089:5917242;d.lineStyle(2,y,1),d.strokeRoundedRect(-t/2,-t/2,t,t,8),s.add(d);const w=e.tier===1?"●":e.tier===2?"◆":"★",S=this.add.text(0,-t/2-10,w,{fontSize:"12px",color:l?"#6b8e23":"#5a4a3a"}).setOrigin(.5);if(s.add(S),l){const R=this.add.text(0,0,"✓",{fontSize:"24px",color:"#6b8e23"}).setOrigin(.5);s.add(R)}else{const R=this.add.text(0,8,`${e.cost}`,{fontFamily:"Georgia, serif",fontSize:"16px",color:c?"#ffd700":"#5a4a3a"}).setOrigin(.5);s.add(R)}const v=this.add.text(0,t/2+10,e.name,{fontFamily:"Georgia, serif",fontSize:"9px",color:l?"#6b8e23":"#8b7355",wordWrap:{width:70},align:"center"}).setOrigin(.5,0);s.add(v),d.setInteractive(new k.Geom.Rectangle(-t/2,-t/2,t,t),k.Geom.Rectangle.Contains),d.on("pointerdown",()=>this.selectPerk(e)),d.on("pointerover",()=>{l||(d.clear(),d.fillStyle(g+1118481,1),d.fillRoundedRect(-t/2,-t/2,t,t,8),d.lineStyle(2,13216089,1),d.strokeRoundedRect(-t/2,-t/2,t,t,8))}),d.on("pointerout",()=>{d.clear(),d.fillStyle(g,1),d.fillRoundedRect(-t/2,-t/2,t,t,8),d.lineStyle(2,y,1),d.strokeRoundedRect(-t/2,-t/2,t,t,8)})}createDetailsPanel(){const{width:e,height:i}=this.cameras.main;this.detailsContainer=this.add.container(e/2,650),this.add.text(e/2,630,"Select a perk to view details",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#5a4a3a"}).setOrigin(.5)}selectPerk(e){this.selectedPerk=e,this.updateDetailsPanel()}updateDetailsPanel(){if(!this.selectedPerk)return;const e=this.selectedPerk;this.detailsContainer.removeAll(!0);const a=m.getMeta().unlockedPerks.includes(e.id),{canPurchase:t,reason:s}=le(e.id),r=this.add.graphics();r.fillStyle(2760474,.95),r.fillRoundedRect(-160,-70,320,140,10),r.lineStyle(2,5917242,1),r.strokeRoundedRect(-160,-70,320,140,10),this.detailsContainer.add(r);const l=this.add.text(0,-55,e.name,{fontFamily:"Georgia, serif",fontSize:"16px",color:"#c9a959"}).setOrigin(.5);this.detailsContainer.add(l);const c=this.add.text(0,-30,e.description,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b7355",wordWrap:{width:280},align:"center"}).setOrigin(.5);this.detailsContainer.add(c);const h=this.add.text(0,0,`Effect: ${e.effect}`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#6b8e23"}).setOrigin(.5);if(this.detailsContainer.add(h),a){const d=this.add.text(0,25,"✓ OWNED",{fontFamily:"Georgia, serif",fontSize:"14px",color:"#6b8e23"}).setOrigin(.5);this.detailsContainer.add(d)}else if(t){const d=b.createButton(this,0,40,`BUY (${e.cost} pts)`,()=>this.purchasePerk(e),{width:120,height:35,fontSize:"12px",primary:!0});this.detailsContainer.add(d)}else{const d=this.add.text(0,25,`🔒 ${s}`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b4513"}).setOrigin(.5);this.detailsContainer.add(d)}}purchasePerk(e){if(Ze(e.id)){b.showNotification(this,`Unlocked: ${e.name}!`);const i=m.getMeta();this.pointsText.setText(`⚡ ${i.bloodlinePoints} Points Available`),this.scene.restart()}}createBackButton(){const{width:e,height:i}=this.cameras.main;b.createButton(this,e/2,i-50,"← BACK TO MENU",()=>this.returnToMenu(),{width:180,height:45})}returnToMenu(){this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("MainMenuScene")})}}class Wt extends k.Scene{constructor(){super({key:"SettingsScene"});f(this,"settings");f(this,"toggleButtons",new Map)}create(){this.settings=m.getSettings(),this.createBackground(),this.createHeader(),this.createSettingsList(),this.createResetButton(),this.createBackButton(),this.cameras.main.fadeIn(300)}createBackground(){const{width:e,height:i}=this.cameras.main,a=this.add.graphics();a.fillGradientStyle(1709072,1709072,2760474,2760474),a.fillRect(0,0,e,i)}createHeader(){const{width:e}=this.cameras.main;this.add.text(e/2,40,"SETTINGS",{fontFamily:"Georgia, serif",fontSize:"28px",color:"#c9a959",stroke:"#000000",strokeThickness:3}).setOrigin(.5)}createSettingsList(){const{width:e}=this.cameras.main,i=100;this.add.text(e/2,i,"─── VISUAL ───",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#5a4a3a"}).setOrigin(.5),this.createToggle("reduceMotion","Reduce Motion","Minimize animations and particles",i+40),this.createToggle("screenShake","Screen Shake","Enable impact screen shake",i+100),this.createToggle("bloodFX","Blood Effects","Show blood during combat",i+160),this.createToggle("grainFX","Grain/Ink FX","Atmospheric visual overlay",i+220),this.add.text(e/2,i+290,"─── AUDIO ───",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#5a4a3a"}).setOrigin(.5),this.createToggle("soundEnabled","Sound Enabled","Enable all game audio",i+330),this.add.text(e/2,i+390,"(Audio features coming soon)",{fontFamily:"Georgia, serif",fontSize:"10px",color:"#5a4a3a",fontStyle:"italic"}).setOrigin(.5)}createToggle(e,i,a,t){const{width:s}=this.cameras.main;this.add.text(30,t,i,{fontFamily:"Georgia, serif",fontSize:"15px",color:"#c9a959"}),this.add.text(30,t+20,a,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355"});const r=!!this.settings[e],l=this.createToggleButton(s-80,t+10,r,c=>{this.settings[e]=c,m.updateSettings({[e]:c})});this.toggleButtons.set(e,l)}createToggleButton(e,i,a,t){const s=this.add.container(e,i);let r=a;const l=60,c=28,h=this.add.graphics(),d=()=>{h.clear(),h.fillStyle(r?3050327:3811866,1),h.fillRoundedRect(0,0,l,c,c/2),h.lineStyle(1,r?7048739:5917242,1),h.strokeRoundedRect(0,0,l,c,c/2)};d(),s.add(h);const g=c-6,y=this.add.graphics(),w=()=>{const S=r?l-g-3:3;y.clear(),y.fillStyle(r?16777215:9139029,1),y.fillCircle(S+g/2,c/2,g/2)};return w(),s.add(y),h.setInteractive(new k.Geom.Rectangle(0,0,l,c),k.Geom.Rectangle.Contains),h.on("pointerdown",()=>{r=!r,d(),w(),t(r)}),s}createResetButton(){const{width:e,height:i}=this.cameras.main;this.add.text(e/2,i-150,"─── DANGER ZONE ───",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b0000"}).setOrigin(.5);const t=b.createButton(this,e/2,i-110,"🗑️ RESET ALL DATA",()=>this.showResetConfirmation(),{width:200,height:45}).first;t.clear(),t.fillStyle(3807770,1),t.fillRoundedRect(-100,-22.5,200,45,8),t.lineStyle(2,9109504,1),t.strokeRoundedRect(-100,-22.5,200,45,8)}showResetConfirmation(){b.showConfirmDialog(this,"Reset All Data?",`This will DELETE all save data including:
• All fighters
• Hall of Legends
• Bloodline Perks
• Settings

This CANNOT be undone!`,()=>this.performReset(),()=>{},"HOLD TO CONFIRM")}performReset(){m.resetAllData(),b.showNotification(this,"All data has been reset"),this.time.delayedCall(1500,()=>{this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("MainMenuScene")})})}createBackButton(){const{width:e,height:i}=this.cameras.main;b.createButton(this,e/2,i-50,"← BACK TO MENU",()=>this.returnToMenu(),{width:180,height:45})}returnToMenu(){this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("MainMenuScene")})}}class Nt extends k.Scene{constructor(){super({key:"VignetteScene"});f(this,"vignette");f(this,"fighter");f(this,"resultText")}init(e){const i=m.getRun();if(!i.fighter){this.scene.start("MainMenuScene");return}this.fighter=i.fighter,e.specificVignette?this.vignette=ne.find(a=>a.id===e.specificVignette):this.vignette=this.selectRandomVignette(e.type||"camp")}selectRandomVignette(e){const i=m.getRun(),a=i.completedVignettes,t=ne.filter(s=>!(s.category!==e||a.includes(s.id)||s.requirements&&(s.requirements.minWeek&&i.week<s.requirements.minWeek||s.requirements.minTrust&&this.fighter.trust<s.requirements.minTrust||s.requirements.maxTrust&&this.fighter.trust>s.requirements.maxTrust||s.requirements.hasInjury&&this.fighter.injuries.length===0)));if(t.length===0){const s=ne.filter(r=>r.category===e);return p.pick(s)}return p.pick(t)}create(){this.createBackground(),this.createVignetteContent(),this.cameras.main.fadeIn(300)}createBackground(){const{width:e,height:i}=this.cameras.main,a=this.add.graphics();if(a.fillGradientStyle(1709072,1709072,2760474,2760474),a.fillRect(0,0,e,i),this.textures.exists("parchment_overlay")){const t=this.add.image(e/2,i/2,"parchment_overlay");t.setAlpha(.1),t.setDisplaySize(e,i)}}createVignetteContent(){const{width:e,height:i}=this.cameras.main;this.add.text(e/2,50,this.vignette.title,{fontFamily:"Georgia, serif",fontSize:"22px",color:"#c9a959",stroke:"#000000",strokeThickness:2}).setOrigin(.5);const a={camp:"🏕️",offer:"💀",letter:"✉️",event:"❓"};this.add.text(e/2,80,a[this.vignette.category]||"📜",{fontSize:"20px"}).setOrigin(.5),this.add.text(e/2,150,this.vignette.description,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#c9a959",wordWrap:{width:320},align:"center",lineSpacing:6}).setOrigin(.5);const t=280,s=90;this.vignette.choices.forEach((r,l)=>{this.createChoiceButton(r,e/2,t+l*s)}),this.resultText=this.add.text(e/2,i-150,"",{fontFamily:"Georgia, serif",fontSize:"13px",color:"#8b7355",fontStyle:"italic",wordWrap:{width:320},align:"center"}).setOrigin(.5)}createChoiceButton(e,i,a){const t=this.add.container(i,a),s=320,r=70,l=this.add.graphics();l.fillStyle(2760474,1),l.fillRoundedRect(-s/2,-r/2,s,r,8),l.lineStyle(2,5917242,1),l.strokeRoundedRect(-s/2,-r/2,s,r,8),t.add(l);const c=this.add.text(0,-10,e.text,{fontFamily:"Georgia, serif",fontSize:"13px",color:"#c9a959",wordWrap:{width:s-30},align:"center"}).setOrigin(.5);t.add(c);const h=[];if(e.effects.trust){const d=e.effects.trust>0?"+":"";h.push(`${d}${e.effects.trust} Trust`)}if(e.effects.gold){const d=e.effects.gold>0?"+":"";h.push(`${d}${e.effects.gold} Gold`)}if(e.effects.hp){const d=e.effects.hp>0?"+":"";h.push(`${d}${e.effects.hp} HP`)}if(e.effects.injury&&h.push(`Risk: ${e.effects.injury} injury`),e.effects.injuryHeal&&h.push(`Heal ${e.effects.injuryHeal} week(s)`),h.length>0){const d=this.add.text(0,18,h.join(" | "),{fontFamily:"Georgia, serif",fontSize:"10px",color:"#6b8e23"}).setOrigin(.5);t.add(d)}l.setInteractive(new k.Geom.Rectangle(-s/2,-r/2,s,r),k.Geom.Rectangle.Contains),l.on("pointerover",()=>{l.clear(),l.fillStyle(3813162,1),l.fillRoundedRect(-s/2,-r/2,s,r,8),l.lineStyle(2,13216089,1),l.strokeRoundedRect(-s/2,-r/2,s,r,8)}),l.on("pointerout",()=>{l.clear(),l.fillStyle(2760474,1),l.fillRoundedRect(-s/2,-r/2,s,r,8),l.lineStyle(2,5917242,1),l.strokeRoundedRect(-s/2,-r/2,s,r,8)}),l.on("pointerdown",()=>{this.selectChoice(e),t.setVisible(!1)})}selectChoice(e){const i=m.getRun();e.effects.trust&&J(this.fighter,e.effects.trust),e.effects.gold&&(i.gold+=e.effects.gold),e.effects.hp&&(this.fighter.currentStats.currentHP=Math.max(1,Math.min(this.fighter.currentStats.maxHP,this.fighter.currentStats.currentHP+e.effects.hp))),e.effects.stamina&&(this.fighter.currentStats.currentStamina=Math.max(0,Math.min(this.fighter.currentStats.maxStamina,this.fighter.currentStats.currentStamina+e.effects.stamina))),e.effects.injuryHeal&&Ce(this.fighter,e.effects.injuryHeal),i.completedVignettes.includes(this.vignette.id)||i.completedVignettes.push(this.vignette.id),m.updateRun({fighter:this.fighter,gold:i.gold,completedVignettes:i.completedVignettes,lettersWritten:i.lettersWritten}),this.showResult(e.resultText)}showResult(e){const{width:i,height:a}=this.cameras.main;this.tweens.add({targets:this.children.getAll().filter(t=>t.y>200&&t.y<600),alpha:0,duration:300}),this.resultText.setText(e),this.resultText.setAlpha(0),this.tweens.add({targets:this.resultText,alpha:1,duration:500,delay:300}),this.time.delayedCall(800,()=>{b.createButton(this,i/2,a-70,"CONTINUE",()=>this.returnToCamp(),{width:180,height:45,primary:!0})})}returnToCamp(){this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("CampScene")})}}const $t=[{id:"letter_home",type:"home",name:"Letter Home",icon:"🏠",description:"Write to family or loved ones. Brings comfort and strengthens resolve.",recipient:"your family",guaranteedEffects:[{type:"trust",value:10,description:"+10 Trust"},{type:"resolve",value:15,description:"+15 Resolve (reduces fear effects)"},{type:"letter_stamp",value:1,description:"+1 Letter Stamp"}],positiveChance:.4,positiveEffect:{type:"hp",value:15,description:"The act of writing brings peace. +15 HP"},negativeChance:.1,negativeEffect:{type:"trust",value:-5,description:"Memories bring sadness. -5 Trust"},letterSnippets:["I hope this letter finds you well. The arena is harsh, but I think of you often.","The crowd cheers, but it's your faces I see when I fight.","They call me {nickname} now. I wonder if you'd recognize me.","I've made friends here. And enemies. But I survive.","The gold I've sent should help with the farm. There will be more.","I dream of home. Of the smell of bread. Of peace.","Tell the children I'm fighting for their future.","I've seen death here. It makes me appreciate life more."],closingLines:["With love, {name}","Until we meet again, {name}","Your devoted {name}","Forever yours, {name}"],milestoneRewards:[{count:3,reward:{type:"ability",id:"rally_cry",name:"Rally Cry",description:"Once per fight, read your letter to gain +20 Focus instantly"}},{count:7,reward:{type:"keepsake_upgrade",id:"family_blessing",name:"Family Blessing",description:"Your keepsake now also grants +5% HP regeneration between fights"}},{count:12,reward:{type:"cosmetic",id:"home_banner",name:"Home Banner",description:"A banner with your family crest flies in the arena"}}]},{id:"letter_patron",type:"patron",name:"Letter to a Patron",icon:"💰",description:"Request support from a wealthy sponsor. Risky but lucrative.",recipient:"a wealthy patron",guaranteedEffects:[{type:"gold",value:30,description:"+30 Gold immediately"},{type:"letter_stamp",value:1,description:"+1 Letter Stamp"}],positiveChance:.5,positiveEffect:{type:"gold",value:50,description:"Your patron sends extra! +50 Gold"},negativeChance:.25,negativeEffect:{type:"debt",value:40,description:"You now owe them. Debt: 40 gold from next 2 victories"},letterSnippets:["Honorable Patron, your investment in me has not been misplaced.","I write seeking your continued support in the arena.","My victories bring glory to your name as well as mine.","The crowds chant {nickname}. Soon they'll know who backs me.","With better equipment, I could win you greater fame.","I've proven my worth. Now I ask for your faith.","My enemies grow stronger. I need stronger steel to match.","Every coin you invest returns tenfold in glory."],closingLines:["Your humble servant, {name}","In your debt, {name}","Gratefully, {name}","Your champion, {name}"],milestoneRewards:[{count:3,reward:{type:"perk_point",id:"patron_connection",name:"Patron Connection",description:"+1 Bloodline Point and permanent 5% shop discount"}},{count:7,reward:{type:"ability",id:"emergency_funds",name:"Emergency Funds",description:"Once per run, receive 100 gold in desperate times"}},{count:12,reward:{type:"cosmetic",id:"patron_sigil",name:"Patron's Sigil",description:"A golden sigil marks your equipment"}}]},{id:"letter_rival",type:"rival",name:"Letter to a Rival",icon:"⚔️",description:"Taunt your rival or attempt diplomacy. High risk, high reward.",recipient:"your rival",guaranteedEffects:[{type:"hype",value:10,description:"+10 Crowd Hype (carries to next fight)"},{type:"letter_stamp",value:1,description:"+1 Letter Stamp"}],positiveChance:.45,positiveEffect:{type:"enemy_debuff",value:15,description:"Your rival is rattled! -15% accuracy next encounter"},negativeChance:.3,negativeEffect:{type:"buff",value:-1,description:"They use your words against you. Rival gains +10% damage next fight"},letterSnippets:["I know you're watching. Good. Watch me win.","We both know how this ends. In blood. Probably yours.","Perhaps we are not so different, you and I.","Your technique is good. But mine is better.","I've studied your fights. I see your weaknesses.","The crowd will cheer when we finally meet.","May the better fighter win. That would be me.","You think you're special? I've beaten better."],closingLines:["See you in the sand, {name}","Until we dance, {name}","Your future conqueror, {name}","With grudging respect, {name}"],milestoneRewards:[{count:3,reward:{type:"ability",id:"psychological_warfare",name:"Psychological Warfare",description:"Start fights against rivals with +15 Focus"}},{count:7,reward:{type:"perk_point",id:"rival_hunter",name:"Rival Hunter",description:"+25% gold and fame from defeating rivals"}},{count:12,reward:{type:"archetype_hint",id:"duelist_unlock",name:"Duelist's Path",description:"Progress toward unlocking the Street Duelist archetype"}}]},{id:"letter_chaplain",type:"chaplain",name:"Letter to the Chaplain",icon:"✝️",description:"Seek spiritual guidance and healing. Pure benefits but costly.",recipient:"the arena chaplain",guaranteedEffects:[{type:"hp",value:20,description:"+20 HP healing"},{type:"status_cure",value:1,description:"Cure Fear and Concussion"},{type:"letter_stamp",value:1,description:"+1 Letter Stamp"}],positiveChance:.35,positiveEffect:{type:"injury_heal",value:1,description:"Blessed recovery! Heal 1 injury week"},negativeChance:.2,negativeEffect:{type:"gold",value:-25,description:"The chaplain requests a donation. -25 Gold"},letterSnippets:["Father, I seek your blessing before my next trial.","I confess my sins and ask for absolution.","The arena tests my faith. Help me stay true.","I've done terrible things. Can I still be forgiven?","Pray for me, Father. The enemy is strong.","I fight not for glory, but for those I love.","Grant me your blessing, that I might survive.","In this world of blood, I seek something pure."],closingLines:["In faith, {name}","Your humble penitent, {name}","Seeking grace, {name}","Bless me, {name}"],milestoneRewards:[{count:3,reward:{type:"ability",id:"divine_protection",name:"Divine Protection",description:"Once per fight, survive a killing blow with 1 HP"}},{count:7,reward:{type:"keepsake_upgrade",id:"blessed_keepsake",name:"Blessed Keepsake",description:"Your keepsake now reduces injury severity by one tier"}},{count:12,reward:{type:"cosmetic",id:"holy_symbol",name:"Holy Symbol",description:"A blessed symbol adorns your equipment"}}]},{id:"letter_future",type:"future_self",name:"Letter to Your Future Self",icon:"📜",description:"Write wisdom for the next generation. Boosts legacy rewards.",recipient:"your future self",guaranteedEffects:[{type:"trust",value:5,description:"+5 Trust (self-reflection)"},{type:"letter_stamp",value:2,description:"+2 Letter Stamps"}],positiveChance:.6,positiveEffect:{type:"buff",value:1,description:"Clarity of purpose! +10% all rewards next fight"},negativeChance:.05,negativeEffect:{type:"focus",value:-10,description:"Dark thoughts intrude. -10 starting Focus next fight"},letterSnippets:["If you're reading this, I'm gone. Learn from my mistakes.","Remember: defense wins fights, offense wins crowds.","Trust your instincts. They've kept you alive this long.","The rival to fear is the one you underestimate.","Your keepsake is more than metal. It's who you are.","Win or lose, fight with honor. That's what matters.","I've learned that trust is earned in blood, not words.","The arena takes everything. Give it nothing but your best."],closingLines:["From the past, {name}","Learn and survive, {name}","Your former self, {name}","Remember me, {name}"],milestoneRewards:[{count:3,reward:{type:"perk_point",id:"legacy_wisdom",name:"Legacy Wisdom",description:"+1 Bloodline Point and new recruits start with +5 in a random stat"}},{count:7,reward:{type:"ability",id:"ghost_guidance",name:"Ghost Guidance",description:"Fallen fighters may appear as ghosts to give combat hints"}},{count:12,reward:{type:"cosmetic",id:"memorial_wings",name:"Memorial Wings",description:"Spectral wings appear on your memorial portrait"}}]}];function Yt(o,n,e){const i=o.letterSnippets[Math.floor(Math.random()*o.letterSnippets.length)],a=o.closingLines[Math.floor(Math.random()*o.closingLines.length)];return i.replace("{name}",n).replace("{nickname}",e)+`

`+a.replace("{name}",n)}function jt(o){const n=[...o.guaranteedEffects];return Math.random()<o.positiveChance&&n.push(o.positiveEffect),Math.random()<o.negativeChance&&n.push(o.negativeEffect),n}const M=class M extends k.GameObjects.Container{constructor(e,i,a,t,s){super(e,i,a);f(this,"bg");f(this,"textObj");f(this,"effectsContainer");f(this,"riskIndicator");f(this,"config");f(this,"callback");f(this,"isHovered",!1);this.config=t,this.callback=s,this.createCard(),this.setupInteraction(),this.setScale(.8),this.setAlpha(0),e.tweens.add({targets:this,scale:1,alpha:1,duration:300,ease:"Back.out"}),e.add.existing(this)}createCard(){const e=M.WIDTH;this.bg=this.scene.add.graphics(),this.drawBackground(!1),this.add(this.bg);let i=-e/2+15;if(this.config.icon){const a=this.scene.add.text(-e/2+25,0,this.config.icon,{fontSize:"24px"}).setOrigin(.5);this.add(a),i+=35}this.textObj=this.scene.add.text(i,-15,this.config.text,{fontFamily:"Georgia, serif",fontSize:"13px",color:"#c9a959",wordWrap:{width:e-80}}).setOrigin(0,.5),this.add(this.textObj),this.effectsContainer=this.scene.add.container(-e/2+15,20),this.createEffectsPreviews(),this.add(this.effectsContainer),this.config.riskLevel&&this.config.riskLevel!=="safe"&&this.createRiskIndicator()}drawBackground(e){const i=M.WIDTH,a=M.HEIGHT;this.bg.clear(),this.bg.fillStyle(0,.2),this.bg.fillRoundedRect(-i/2+2,-a/2+2,i,a,8);const s={safe:2767402,risky:3815978,dangerous:3811882}[this.config.riskLevel||"safe"],r=e?s+1118481:s;this.bg.fillStyle(r,.95),this.bg.fillRoundedRect(-i/2,-a/2,i,a,8);const c=e?13216089:{safe:7048739,risky:14329120,dangerous:13458524}[this.config.riskLevel||"safe"];this.bg.lineStyle(e?2:1,c,1),this.bg.strokeRoundedRect(-i/2,-a/2,i,a,8),this.bg.fillStyle(c,.5),this.bg.fillRect(-i/2,-a/2+5,4,a-10)}createEffectsPreviews(){let e=0;this.config.effects.slice(0,3).forEach(i=>{const a=i.isPositive?"▲":"▼",t=i.isPositive?"#6b8e23":"#cd5c5c",s=this.scene.add.text(e,0,`${a} ${i.description}`,{fontFamily:"Georgia, serif",fontSize:"10px",color:t});this.effectsContainer.add(s),e+=s.width+15})}createRiskIndicator(){const e={risky:"⚠️ RISKY",dangerous:"☠️ DANGEROUS"},i={risky:"#daa520",dangerous:"#cd5c5c"};this.riskIndicator=this.scene.add.text(M.WIDTH/2-10,-100/2+10,e[this.config.riskLevel],{fontFamily:"Georgia, serif",fontSize:"9px",color:i[this.config.riskLevel]}).setOrigin(1,0),this.add(this.riskIndicator)}setupInteraction(){const e=new k.Geom.Rectangle(-140,-50,M.WIDTH,M.HEIGHT);this.setSize(M.WIDTH,M.HEIGHT),this.setInteractive(e,k.Geom.Rectangle.Contains),this.on("pointerover",()=>{this.isHovered=!0,this.drawBackground(!0),this.scene.tweens.add({targets:this,x:this.x+5,scaleX:1.02,scaleY:1.02,duration:100})}),this.on("pointerout",()=>{this.isHovered=!1,this.drawBackground(!1),this.scene.tweens.add({targets:this,x:this.x-5,scaleX:1,scaleY:1,duration:100})}),this.on("pointerdown",()=>{this.scene.tweens.add({targets:this,scaleX:.98,scaleY:.98,duration:50})}),this.on("pointerup",()=>{this.scene.tweens.add({targets:this,scaleX:1.1,scaleY:1.1,alpha:0,duration:200,ease:"Quad.in",onComplete:()=>{this.callback()}})})}select(){this.emit("pointerup")}fadeOut(){this.scene.tweens.add({targets:this,alpha:0,y:this.y+20,duration:200,onComplete:()=>this.destroy()})}};f(M,"WIDTH",280),f(M,"HEIGHT",100);let de=M;class qt extends k.Scene{constructor(){super({key:"LetterScene"});f(this,"fighter");f(this,"selectedTemplate");f(this,"letterContent");f(this,"effects",[]);f(this,"phase","select");f(this,"quillSprite");f(this,"parchmentGroup");f(this,"letterTextObj");f(this,"waxSeal")}create(){const e=m.getRun();if(!e.fighter){this.scene.start("MainMenuScene");return}this.fighter=e.fighter,this.phase="select",this.createBackground(),this.showLetterTypeSelection(),this.cameras.main.fadeIn(300)}createBackground(){const{width:e,height:i}=this.cameras.main,a=this.add.graphics();a.fillGradientStyle(1709072,1709072,985605,985605),a.fillRect(0,0,e,i);const t=this.add.graphics();t.fillStyle(16753920,.1),t.fillCircle(e*.8,i*.2,100),this.tweens.add({targets:t,alpha:{from:.1,to:.15},duration:200,yoyo:!0,repeat:-1}),this.add.text(e/2,40,"WRITE A LETTER",{fontFamily:"Georgia, serif",fontSize:"20px",color:"#c9a959"}).setOrigin(.5),this.add.text(e/2,65,"Choose your words carefully...",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b7355",fontStyle:"italic"}).setOrigin(.5),b.createButton(this,50,35,"← BACK",()=>this.goBack(),{width:80,height:35,fontSize:"11px"})}showLetterTypeSelection(){const{width:e,height:i}=this.cameras.main,a=this.add.container(0,0);a.setData("phase","select");const t=120,s=100;$t.forEach((c,h)=>{const d=t+h*s,g=c.guaranteedEffects.map(S=>({type:S.type,value:S.value,isPositive:S.value>0||["letter_stamp","status_cure","injury_heal"].includes(S.type),description:S.description}));c.positiveChance>0&&g.push({type:"chance",value:Math.round(c.positiveChance*100),isPositive:!0,description:`${Math.round(c.positiveChance*100)}%: ${c.positiveEffect.description}`});const y=new de(this,e/2,d,{id:c.id,text:`${c.icon} ${c.name}`,effects:g.slice(0,3),riskLevel:c.negativeChance>.2?"risky":"safe",icon:c.icon},()=>this.selectLetterType(c)),w=this.add.text(e/2,d+55,c.description,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#6a5a4a",align:"center"}).setOrigin(.5);a.add(y),a.add(w)});const r=m.getSeals(),l=m.getLetterStamps();this.add.text(e-20,i-50,`🔵 Seals: ${r}`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#4682b4"}).setOrigin(1,.5),this.add.text(e-20,i-30,`📜 Stamps: ${l}`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b7355"}).setOrigin(1,.5)}selectLetterType(e){this.selectedTemplate=e,this.phase="write",this.letterContent=Yt(e,this.fighter.firstName,this.fighter.nickname),this.effects=jt(e),this.children.each(i=>{i.getData("phase")==="select"&&i.destroy()}),this.showWritingPhase()}showWritingPhase(){var s;const{width:e,height:i}=this.cameras.main;this.parchmentGroup=this.add.container(e/2,i/2-50);const a=this.add.graphics();a.fillStyle(13943968,1),a.fillRoundedRect(-160,-180,320,360,5),a.lineStyle(2,9139029,1),a.strokeRoundedRect(-160,-180,320,360,5),a.fillStyle(13219990,.5),a.fillCircle(-100,-100,30),a.fillCircle(80,50,25),this.parchmentGroup.add(a);const t=this.add.text(0,-150,`To ${(s=this.selectedTemplate)==null?void 0:s.recipient}`,{fontFamily:"Georgia, serif",fontSize:"12px",color:"#3a2a1a",fontStyle:"italic"}).setOrigin(.5);this.parchmentGroup.add(t),this.letterTextObj=this.add.text(0,-50,"",{fontFamily:"Georgia, serif",fontSize:"11px",color:"#2a1a0a",wordWrap:{width:280},align:"center",lineSpacing:6}).setOrigin(.5),this.parchmentGroup.add(this.letterTextObj),this.typewriterEffect(this.letterContent||"",()=>{this.showSealButton()}),this.createQuill()}createQuill(){this.quillSprite=this.add.graphics(),this.quillSprite.fillStyle(4864554,1),this.quillSprite.fillTriangle(0,0,-5,30,5,30),this.quillSprite.fillStyle(16119260,1),this.quillSprite.fillTriangle(-2,30,2,30,0,80);const{width:e,height:i}=this.cameras.main;this.quillSprite.setPosition(e/2+100,i/2-100),this.tweens.add({targets:this.quillSprite,x:{from:e/2+80,to:e/2+120},y:{from:i/2-120,to:i/2},duration:2e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}typewriterEffect(e,i){let a=0;const t=e;this.time.addEvent({delay:30,callback:()=>{var s;a++,(s=this.letterTextObj)==null||s.setText(t.substring(0,a)),a>=t.length&&i()},repeat:t.length-1})}showSealButton(){var t,s;const{width:e,height:i}=this.cameras.main;(t=this.quillSprite)==null||t.destroy();const a=this.add.text(e/2,i/2+80,`— ${this.fighter.firstName}`,{fontFamily:"Georgia, serif",fontSize:"12px",color:"#2a1a0a",fontStyle:"italic"}).setOrigin(.5);(s=this.parchmentGroup)==null||s.add(a),b.createButton(this,e/2,i-80,"🔴 SEAL WITH WAX",()=>this.sealLetter(),{width:180,height:50,primary:!0})}sealLetter(){this.phase="seal";const{width:e,height:i}=this.cameras.main;this.waxSeal=this.add.container(e/2,i/2+130);const a=this.add.graphics();a.fillStyle(9109504,1),a.fillCircle(0,0,0),this.waxSeal.add(a),this.tweens.add({targets:{radius:0},radius:25,duration:500,ease:"Quad.out",onUpdate:t=>{const s=t.getValue();typeof s=="number"&&(a.clear(),a.fillStyle(9109504,1),a.fillCircle(0,0,s))},onComplete:()=>{this.stampSeal()}})}stampSeal(){var i;this.cameras.main.flash(100,255,200,200);const e=this.add.text(0,0,"⚔️",{fontSize:"20px"}).setOrigin(.5);(i=this.waxSeal)==null||i.add(e),e.setScale(2),e.setAlpha(0),this.tweens.add({targets:e,scale:1,alpha:1,duration:200,ease:"Back.out",onComplete:()=>{this.time.delayedCall(500,()=>this.showResults())}})}showResults(){this.phase="result";const{width:e,height:i}=this.cameras.main;this.tweens.add({targets:[this.parchmentGroup,this.waxSeal],alpha:0,y:"+=50",duration:500}),this.time.delayedCall(600,()=>{this.displayEffects(),this.applyEffects()})}displayEffects(){const{width:e,height:i}=this.cameras.main;this.add.text(e/2,100,"LETTER SENT",{fontFamily:"Georgia, serif",fontSize:"24px",color:"#c9a959"}).setOrigin(.5);let a=160;this.effects.forEach((t,s)=>{this.time.delayedCall(s*200,()=>{const r=t.value>0||["letter_stamp","status_cure","injury_heal","resolve","buff"].includes(t.type),l=r?"✓":"✗",c=r?"#6b8e23":"#cd5c5c",h=this.add.text(e/2,a,`${l} ${t.description}`,{fontFamily:"Georgia, serif",fontSize:"14px",color:c}).setOrigin(.5);h.setAlpha(0),this.tweens.add({targets:h,alpha:1,x:e/2,duration:300,ease:"Back.out"}),a+=35})}),this.time.delayedCall(this.effects.length*200+500,()=>{b.createButton(this,e/2,i-80,"CONTINUE",()=>{this.goBack()},{width:160,height:50,primary:!0})})}applyEffects(){const e=m.getRun();let i=0,a=0;this.effects.forEach(r=>{switch(r.type){case"trust":a+=r.value;break;case"gold":i+=r.value;break;case"hp":this.fighter.currentStats&&(this.fighter.currentStats.currentHP=Math.min(this.fighter.currentStats.maxHP,this.fighter.currentStats.currentHP+r.value));break;case"letter_stamp":m.addLetterStamps(r.value),m.addSeals(r.value);break;case"debt":m.addDebt(Math.abs(r.value),2);break;case"resolve":m.reduceFatigue(15);break}}),m.reduceFatigue(15),a!==0&&(this.fighter.trust=Math.max(0,Math.min(100,this.fighter.trust+a)));const t={id:`letter_${Date.now()}`,type:this.selectedTemplate.type,templateId:this.selectedTemplate.id,content:this.letterContent||"",fighterName:this.fighter.fullName,fighterId:this.fighter.id,weekWritten:e.week,wasRead:!1,effects:this.effects,timestamp:Date.now()},s=[...e.lettersWritten,t];m.updateRun({fighter:this.fighter,gold:e.gold+i,lettersWritten:s,lastCampAction:"letter"}),m.incrementLetterCount(this.selectedTemplate.type),this.checkMilestones()}checkMilestones(){if(!this.selectedTemplate)return;const e=m.getLetterCount(this.selectedTemplate.type);for(const i of this.selectedTemplate.milestoneRewards)e>=i.count&&!m.hasLetterReward(i.reward.id)&&(m.unlockLetterReward(i.reward.id),this.time.delayedCall(1e3,()=>{b.showNotification(this,`🎉 UNLOCKED: ${i.reward.name}!`,3e3)}))}goBack(){this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("CampScene")})}}const U=[{id:"iron_ring",name:"Iron Ring",description:"+5 Defense",rarity:"common",icon:"💍",auraColor:"#808080",particleType:"none",statModifiers:{defense:5},lore:"Simple iron, but reassuring."},{id:"fighters_tooth",name:"Fighter's Tooth",description:"+3 Attack",rarity:"common",icon:"🦷",auraColor:"#f5f5dc",particleType:"none",statModifiers:{attack:3},lore:"A trophy from your first kill."},{id:"worn_boots",name:"Worn Boots",description:"+2 Speed, +5 Evasion",rarity:"common",icon:"👢",auraColor:"#8b4513",particleType:"none",statModifiers:{speed:2,evasion:5},lore:"Comfortable and broken in."},{id:"lucky_coin",name:"Lucky Coin",description:"+10% Gold rewards",rarity:"common",icon:"🪙",auraColor:"#ffd700",particleType:"sparkle",passiveEffect:"gold_bonus_10",lore:"Tails you win."},{id:"bandolier",name:"Bandolier",description:"+1 Item slot, items 10% more effective",rarity:"common",icon:"🎒",auraColor:"#654321",particleType:"none",passiveEffect:"extra_item_slot",lore:"Room for more tricks."},{id:"crowd_favor",name:"Crowd's Favor",description:"+15% Hype gain",rarity:"common",icon:"📣",auraColor:"#ffa500",particleType:"sparkle",passiveEffect:"hype_bonus_15",lore:"They love you. For now."},{id:"blood_amulet",name:"Blood Amulet",description:"Heal 5 HP on kill",rarity:"uncommon",icon:"📿",auraColor:"#8b0000",particleType:"blood",triggerEffect:{condition:"on_kill",effect:"heal",value:5},lore:"Drinks deep from the dying."},{id:"berserker_band",name:"Berserker Band",description:"+20% damage when below 50% HP",rarity:"uncommon",icon:"🔴",auraColor:"#ff4500",particleType:"flame",triggerEffect:{condition:"on_low_hp",effect:"damage_boost",value:20},lore:"Pain is just weakness leaving."},{id:"focused_lens",name:"Focused Lens",description:"+10 Accuracy, +5% Crit Chance",rarity:"uncommon",icon:"🔍",auraColor:"#87ceeb",particleType:"sparkle",statModifiers:{accuracy:10,critChance:5},lore:"See the gaps in their defense."},{id:"shadow_cloak",name:"Shadow Cloak",description:"+15 Evasion, 20% chance to dodge on turn start",rarity:"uncommon",icon:"🧥",auraColor:"#2f2f4f",particleType:"shadow",statModifiers:{evasion:15},triggerEffect:{condition:"on_turn_start",effect:"auto_dodge",value:1,chance:.2},lore:"Become one with darkness."},{id:"wrath_stone",name:"Wrath Stone",description:"Gain +2 Focus per hit taken",rarity:"uncommon",icon:"💎",auraColor:"#9932cc",particleType:"sparkle",passiveEffect:"focus_on_hit",lore:"Channel your rage."},{id:"healers_charm",name:"Healer's Charm",description:"All healing +30%",rarity:"uncommon",icon:"💚",auraColor:"#32cd32",particleType:"holy",passiveEffect:"healing_boost_30",lore:"Blessed by temple healers."},{id:"warriors_belt",name:"Warrior's Belt",description:"+20 Max Stamina, Stamina regen +20%",rarity:"uncommon",icon:"🥋",auraColor:"#8b4513",particleType:"none",statModifiers:{maxStamina:20},passiveEffect:"stamina_regen_20",lore:"Hold everything together."},{id:"champions_medal",name:"Champion's Medal",description:"+5 to all stats",rarity:"rare",icon:"🏅",auraColor:"#ffd700",particleType:"sparkle",statModifiers:{attack:5,defense:5,speed:5,accuracy:5,evasion:5,maxHP:10,maxStamina:10},lore:"Earned by a true champion."},{id:"phoenix_feather",name:"Phoenix Feather",description:"Survive fatal blow once per fight with 20% HP",rarity:"rare",icon:"🪶",auraColor:"#ff6347",particleType:"flame",triggerEffect:{condition:"on_low_hp",effect:"death_save",value:20},lore:"Rise from the ashes."},{id:"vampiric_blade",name:"Vampiric Essence",description:"Heal 10% of damage dealt",rarity:"rare",icon:"🩸",auraColor:"#8b0000",particleType:"blood",triggerEffect:{condition:"on_hit",effect:"lifesteal",value:10},lore:"Your wounds feed on theirs."},{id:"executioners_eye",name:"Executioner's Eye",description:"+50% damage to enemies below 30% HP",rarity:"rare",icon:"👁️",auraColor:"#4b0082",particleType:"shadow",triggerEffect:{condition:"on_hit",effect:"execute_bonus",value:50},lore:"See the moment of death."},{id:"mirror_shield",name:"Mirror Shield",description:"Perfect parries deal 150% counter damage",rarity:"rare",icon:"🪞",auraColor:"#c0c0c0",particleType:"sparkle",triggerEffect:{condition:"on_parry",effect:"counter_boost",value:150},lore:"Return their violence twofold."},{id:"crowd_roar",name:"Crowd's Roar",description:"At 80+ Hype, +30% damage and heal 5 HP per turn",rarity:"rare",icon:"🎭",auraColor:"#ffd700",particleType:"sparkle",passiveEffect:"crowd_power",lore:"Their cheers fuel your strength."},{id:"storm_caller",name:"Storm Caller",description:"Critical hits chain to deal 30% damage to all",rarity:"rare",icon:"⚡",auraColor:"#1e90ff",particleType:"sparkle",triggerEffect:{condition:"on_crit",effect:"chain_lightning",value:30},lore:"Call down the thunder."},{id:"crown_of_blood",name:"Crown of Blood",description:"Killing an enemy fully heals you and grants +5 permanent HP",rarity:"legendary",icon:"👑",auraColor:"#8b0000",particleType:"blood",triggerEffect:{condition:"on_kill",effect:"full_heal_plus",value:5},lore:"The arena throne, paid in blood."},{id:"gods_hand",name:"God's Hand",description:"Start every fight with full Focus. Special costs no Focus.",rarity:"legendary",icon:"✋",auraColor:"#ffd700",particleType:"holy",passiveEffect:"unlimited_special",lore:"Touched by the divine."},{id:"shadow_twin",name:"Shadow Twin",description:"25% chance for attacks to hit twice",rarity:"legendary",icon:"👥",auraColor:"#2f2f4f",particleType:"shadow",triggerEffect:{condition:"on_hit",effect:"double_strike",value:25,chance:.25},lore:"Your shadow fights beside you."},{id:"immortal_will",name:"Immortal Will",description:"Cannot die while you have Stamina. Damage drains Stamina instead.",rarity:"legendary",icon:"💀",auraColor:"#4b0082",particleType:"shadow",passiveEffect:"stamina_as_hp",lore:"Death cannot claim the determined."},{id:"arena_heart",name:"Heart of the Arena",description:"Crowd Hype starts at 100 and never decreases. +50% all rewards.",rarity:"legendary",icon:"❤️‍🔥",auraColor:"#ff4500",particleType:"flame",passiveEffect:"permanent_hype",lore:"The arena itself fights for you."}];U.filter(o=>o.rarity==="common").map(o=>o.id),U.filter(o=>o.rarity==="uncommon").map(o=>o.id),U.filter(o=>o.rarity==="rare").map(o=>o.id),U.filter(o=>o.rarity==="legendary").map(o=>o.id);const Ut={common:50,uncommon:35,rare:12,legendary:3};function Vt(o=0){const n={...Ut};n.legendary+=Math.floor(o/3),n.rare+=Math.floor(o/2);const e=Object.values(n).reduce((a,t)=>a+t,0);let i=Math.random()*e;for(const[a,t]of Object.entries(n))if(i-=t,i<=0)return a;return"common"}function Xt(o=3,n=[]){const e=U.filter(a=>!n.includes(a.id)),i=[];for(let a=0;a<o&&e.length>0;a++){const t=Vt(),s=e.filter(r=>r.rarity===t);if(s.length>0){const r=Math.floor(Math.random()*s.length);i.push(s[r]);const l=e.findIndex(c=>c.id===s[r].id);e.splice(l,1)}else{const r=Math.floor(Math.random()*e.length);i.push(e[r]),e.splice(r,1)}}return i}const P=class P extends k.GameObjects.Container{constructor(e,i,a,t,s){super(e,i,a);f(this,"bg");f(this,"glowLayer");f(this,"particleEmitter");f(this,"relic");f(this,"callback");f(this,"revealed",!1);this.relic=t,this.callback=s,this.createCard(),e.add.existing(this)}createCard(){const e=P.WIDTH,i=P.HEIGHT,a=P.RARITY_COLORS[this.relic.rarity];this.glowLayer=this.scene.add.graphics(),this.add(this.glowLayer),this.animateGlow(a),this.bg=this.scene.add.graphics(),this.drawBackground(!1),this.add(this.bg);const t=this.scene.add.graphics();t.fillStyle(a,.8),t.fillRect(-e/2,-i/2,e,30),this.add(t);const s=this.scene.add.text(0,-i/2+15,this.relic.rarity.toUpperCase(),{fontFamily:"Georgia, serif",fontSize:"12px",color:"#ffffff",fontStyle:"bold"}).setOrigin(.5);this.add(s);const r=this.scene.add.text(0,-35,this.relic.icon,{fontSize:"48px"}).setOrigin(.5);this.add(r),this.createAuraEffect(a);const l=this.scene.add.text(0,15,this.relic.name,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#c9a959",fontStyle:"bold",wordWrap:{width:e-20},align:"center"}).setOrigin(.5);this.add(l);const c=this.scene.add.text(0,50,this.relic.description,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#ffffff",wordWrap:{width:e-30},align:"center"}).setOrigin(.5,0);this.add(c);const h=this.scene.add.text(0,i/2-30,`"${this.relic.lore}"`,{fontFamily:"Georgia, serif",fontSize:"9px",color:"#8b7355",fontStyle:"italic",wordWrap:{width:e-20},align:"center"}).setOrigin(.5);this.add(h),this.setupInteraction()}drawBackground(e){const i=P.WIDTH,a=P.HEIGHT,t=P.RARITY_COLORS[this.relic.rarity];this.bg.clear(),this.bg.fillStyle(0,.4),this.bg.fillRoundedRect(-i/2+4,-a/2+4,i,a,12);const s=e?3815994:2763306;this.bg.fillStyle(s,.95),this.bg.fillRoundedRect(-i/2,-a/2,i,a,12),this.bg.lineStyle(e?4:3,t,1),this.bg.strokeRoundedRect(-i/2,-a/2,i,a,12),this.bg.lineStyle(1,t,.3),this.bg.strokeRoundedRect(-i/2+8,-a/2+8,i-16,a-16,8)}animateGlow(e){const i=P.WIDTH,a=P.HEIGHT,t=s=>{this.glowLayer.clear(),this.glowLayer.fillStyle(e,s*.3),this.glowLayer.fillRoundedRect(-i/2-10,-a/2-10,i+20,a+20,15)};this.scene.tweens.add({targets:{alpha:.5},alpha:1,duration:1e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut",onUpdate:s=>{const r=s.getValue();typeof r=="number"&&t(r)}}),t(.5)}createAuraEffect(e){const i=this.scene.add.graphics();this.add(i);let a=0;this.scene.time.addEvent({delay:50,callback:()=>{i.clear();for(let t=0;t<6;t++){const s=a+t*Math.PI/3,r=Math.cos(s)*40,l=Math.sin(s)*40-35;i.fillStyle(e,.5-t*.08),i.fillCircle(r,l,3-t*.3)}a+=.05},loop:!0})}setupInteraction(){const e=P.WIDTH,i=P.HEIGHT,a=new k.Geom.Rectangle(-e/2,-i/2,e,i);this.setSize(e,i),this.setInteractive(a,k.Geom.Rectangle.Contains),this.on("pointerover",()=>{this.drawBackground(!0),this.scene.tweens.add({targets:this,scaleX:1.05,scaleY:1.05,y:this.y-10,duration:150,ease:"Back.out"})}),this.on("pointerout",()=>{this.drawBackground(!1),this.scene.tweens.add({targets:this,scaleX:1,scaleY:1,y:this.y+10,duration:150})}),this.on("pointerdown",()=>{this.scene.tweens.add({targets:this,scaleX:.95,scaleY:.95,duration:50})}),this.on("pointerup",()=>{this.selectAnimation()})}selectAnimation(){const e=P.RARITY_COLORS[this.relic.rarity];for(let i=0;i<20;i++){const a=Math.random()*Math.PI*2,t=100+Math.random()*150,s=this.scene.add.graphics();s.fillStyle(e,1),s.fillCircle(0,0,4),this.add(s),this.scene.tweens.add({targets:s,x:Math.cos(a)*t,y:Math.sin(a)*t,alpha:0,scale:0,duration:500,ease:"Quad.out",onComplete:()=>s.destroy()})}this.scene.tweens.add({targets:this,scaleX:1.5,scaleY:1.5,alpha:0,duration:400,ease:"Quad.in",onComplete:()=>{this.callback()}})}reveal(){return new Promise(e=>{if(this.revealed){e();return}this.setScale(1,0),this.scene.tweens.add({targets:this,scaleY:1,duration:400,ease:"Back.out",delay:Math.random()*200,onComplete:()=>{this.revealed=!0,this.playRevealEffect(),e()}})})}playRevealEffect(){const e=P.RARITY_COLORS[this.relic.rarity],i=this.scene.add.graphics();i.fillStyle(e,.5),i.fillRoundedRect(-180/2,-240/2,P.WIDTH,P.HEIGHT,12),this.add(i),this.scene.tweens.add({targets:i,alpha:0,duration:300,onComplete:()=>i.destroy()}),this.relic.rarity==="legendary"&&this.scene.cameras.main.shake(200,.01)}};f(P,"WIDTH",180),f(P,"HEIGHT",240),f(P,"RARITY_COLORS",{common:8421504,uncommon:2031360,rare:28893,legendary:16744448});let he=P;class Qt extends k.Scene{constructor(){super({key:"RelicChoiceScene"});f(this,"relicChoices",[]);f(this,"relicCards",[]);f(this,"selectedRelic")}create(){const e=m.getRun();this.relicChoices=Xt(3,e.relics),this.createBackground(),this.createHeader(),this.revealRelics(),this.cameras.main.fadeIn(300)}createBackground(){const{width:e,height:i}=this.cameras.main,a=this.add.graphics();a.fillGradientStyle(657429,657429,1708069,1708069),a.fillRect(0,0,e,i);for(let s=0;s<50;s++){const r=this.add.graphics();r.fillStyle(10040012,Math.random()*.3),r.fillCircle(0,0,2),r.setPosition(Math.random()*e,Math.random()*i),this.tweens.add({targets:r,y:r.y-100,alpha:0,duration:3e3+Math.random()*2e3,repeat:-1,delay:Math.random()*2e3})}const t=this.add.graphics();t.fillStyle(0,.5),t.fillRect(0,0,e,60),t.fillRect(0,i-60,e,60)}createHeader(){const{width:e}=this.cameras.main,i=this.add.text(e/2,50,"CHOOSE A RELIC",{fontFamily:"Georgia, serif",fontSize:"28px",color:"#c9a959",stroke:"#000000",strokeThickness:4}).setOrigin(.5);this.tweens.add({targets:i,alpha:{from:1,to:.8},duration:1e3,yoyo:!0,repeat:-1}),this.add.text(e/2,85,"A mysterious power calls to you...",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b7355",fontStyle:"italic"}).setOrigin(.5)}async revealRelics(){const{width:e,height:i}=this.cameras.main,a=200,t=e/2-a;for(let s=0;s<this.relicChoices.length;s++){const r=this.relicChoices[s],l=t+s*a,c=new he(this,l,i/2,r,()=>{this.selectRelic(r,s)});c.setScale(1,0),this.relicCards.push(c)}await this.playRevealSequence()}async playRevealSequence(){this.cameras.main.flash(200,150,100,200);for(let e=0;e<this.relicCards.length;e++)await this.delay(300),await this.relicCards[e].reveal();this.time.delayedCall(500,()=>{this.createSkipButton()})}delay(e){return new Promise(i=>{this.time.delayedCall(e,i)})}createSkipButton(){const{width:e,height:i}=this.cameras.main;b.createButton(this,e/2,i-50,"SKIP (No Relic)",()=>this.skipRelic(),{width:150,height:40,fontSize:"11px"})}selectRelic(e,i){this.selectedRelic||(this.selectedRelic=e,this.relicCards.forEach((a,t)=>{t!==i&&this.tweens.add({targets:a,alpha:0,y:a.y+50,duration:300})}),m.addRelic(e.id),this.time.delayedCall(500,()=>{this.showAcquisitionEffect(e)}))}showAcquisitionEffect(e){const{width:i,height:a}=this.cameras.main,t=this.add.text(i/2,a/2,e.icon,{fontSize:"64px"}).setOrigin(.5);t.setScale(0),this.tweens.add({targets:t,scale:2,duration:500,ease:"Back.out"});const s=this.add.text(i/2,a/2+80,e.name,{fontFamily:"Georgia, serif",fontSize:"24px",color:"#c9a959"}).setOrigin(.5);s.setAlpha(0),this.tweens.add({targets:s,alpha:1,duration:300,delay:300}),this.time.delayedCall(1500,()=>{this.returnToCamp()})}skipRelic(){b.showConfirmDialog(this,"Skip Relic?","Are you sure you want to pass on this opportunity?",()=>this.returnToCamp(),()=>{},"YES, SKIP")}returnToCamp(){m.updateRun({fightsSinceRelic:0}),this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("CampScene")})}}const Kt=[{id:"footwork",name:"Footwork Drills",icon:"👣",description:"Practice agility and positioning. Improves dodge and unlocks counter techniques.",statChanges:{dodge:3,speed:2,accuracy:1},fatigueCost:15,injuryRisk:.05,techniqueId:"sidestep_counter",previewText:"+3 Dodge, +2 Speed, +1 Acc | Unlocks Sidestep Counter",trainingText:"You spend hours dancing between training posts, learning to move without thinking."},{id:"guard_parry",name:"Guard & Parry",icon:"🛡️",description:"Master defensive timing. Wider parry window and bonus focus on perfect parries.",statChanges:{defense:3,accuracy:-1},fatigueCost:20,injuryRisk:.1,techniqueId:"riposte_mastery",previewText:"+3 Defense, -1 Acc | Unlocks Riposte Mastery",trainingText:"Wooden swords crack against your shield as you perfect your timing."},{id:"power_strikes",name:"Power Strikes",icon:"💪",description:"Train raw strength. Heavy attacks gain armor break but cost more stamina.",statChanges:{attack:4,maxStamina:-5},fatigueCost:25,injuryRisk:.15,techniqueId:"crushing_blow",previewText:"+4 Attack, -5 Max Stamina | Unlocks Crushing Blow",trainingText:"You lift stones and swing weighted weapons until your arms scream."},{id:"bleed_craft",name:"Bleed Craft",icon:"🩸",description:"Learn to cut deep. Light attacks have a chance to cause bleeding.",statChanges:{attack:1,accuracy:2},fatigueCost:15,injuryRisk:.08,techniqueId:"arterial_strike",previewText:"+1 Attack, +2 Acc | Unlocks Arterial Strike",trainingText:"The trainer shows you exactly where to cut for maximum effect."},{id:"endurance",name:"Endurance Training",icon:"🏃",description:"Build stamina and resilience. More stamina, faster recovery.",statChanges:{maxStamina:15,maxHP:10,attack:-1},fatigueCost:30,injuryRisk:.03,techniqueId:"second_wind",previewText:"+15 Stamina, +10 HP, -1 Attack | Unlocks Second Wind",trainingText:"Run. Lift. Carry. Repeat. Your body adapts to the punishment."},{id:"crowd_play",name:"Crowd Play",icon:"🎭",description:"Learn to work the audience. Hype builds faster, special moves cost less.",statChanges:{maxFocus:10,accuracy:1},fatigueCost:10,injuryRisk:.02,techniqueId:"showmanship",previewText:"+10 Focus, +1 Acc | Unlocks Showmanship",trainingText:"An old performer teaches you how to make the crowd love you."}],Jt=[{id:"sidestep_counter",name:"Sidestep Counter",icon:"↪️",description:"After a successful dodge, your next attack deals bonus damage.",maxLevel:3,effects:[{level:1,description:"+15% damage after dodge",modifier:{type:"counter_damage",value:15}},{level:2,description:"+25% damage after dodge",modifier:{type:"counter_damage",value:25}},{level:3,description:"+35% damage after dodge, costs no stamina",modifier:{type:"counter_damage",value:35}}],combatModifier:{trigger:"on_dodge"}},{id:"riposte_mastery",name:"Riposte Mastery",icon:"⚔️",description:"Perfect parries grant focus and allow an instant counter-attack.",maxLevel:3,effects:[{level:1,description:"+10 Focus on perfect parry",modifier:{type:"focus_gain",value:10}},{level:2,description:"+15 Focus, 20% stun chance",modifier:{type:"focus_gain",value:15}},{level:3,description:"+20 Focus, 35% stun, free counter",modifier:{type:"focus_gain",value:20}}],combatModifier:{trigger:"on_parry"}},{id:"crushing_blow",name:"Crushing Blow",icon:"💥",description:"Heavy attacks break through armor and can stagger enemies.",maxLevel:3,effects:[{level:1,description:"Heavy ignores 20% armor",modifier:{type:"armor_break",value:20}},{level:2,description:"Heavy ignores 35% armor",modifier:{type:"armor_break",value:35}},{level:3,description:"Heavy ignores 50% armor, 25% stun",modifier:{type:"armor_break",value:50}}],combatModifier:{action:"heavy_attack"}},{id:"arterial_strike",name:"Arterial Strike",icon:"🩸",description:"Light attacks have a chance to cause bleeding damage over time.",maxLevel:3,effects:[{level:1,description:"15% bleed chance on light",modifier:{type:"bleed_chance",value:15}},{level:2,description:"25% bleed, stronger effect",modifier:{type:"bleed_chance",value:25}},{level:3,description:"35% bleed, can stack 3x",modifier:{type:"bleed_chance",value:35}}],combatModifier:{action:"light_attack"}},{id:"second_wind",name:"Second Wind",icon:"💨",description:"Recover stamina when low, gaining a burst of energy.",maxLevel:3,effects:[{level:1,description:"Recover 15 stamina when below 20%",modifier:{type:"stamina_cost",value:-15}},{level:2,description:"Recover 25 stamina, +10 HP",modifier:{type:"stamina_cost",value:-25}},{level:3,description:"Recover 35 stamina, +15 HP, once per fight",modifier:{type:"stamina_cost",value:-35}}],combatModifier:{passive:!0}},{id:"showmanship",name:"Showmanship",icon:"✨",description:"Special moves cost less focus and generate more crowd hype.",maxLevel:3,effects:[{level:1,description:"-5 focus cost, +10% hype",modifier:{type:"hype_bonus",value:10}},{level:2,description:"-10 focus cost, +20% hype",modifier:{type:"hype_bonus",value:20}},{level:3,description:"-15 focus cost, +30% hype, gold bonus",modifier:{type:"hype_bonus",value:30}}],combatModifier:{action:"special"}}],Te=[{id:"bruised_ribs",name:"Bruised Ribs",effect:"-5 Max Stamina for 1 fight",duration:1},{id:"sprained_wrist",name:"Sprained Wrist",effect:"-2 Attack for 1 fight",duration:1},{id:"twisted_ankle",name:"Twisted Ankle",effect:"-3 Dodge for 1 fight",duration:1},{id:"sore_muscles",name:"Sore Muscles",effect:"-1 to all stats for 1 fight",duration:1},{id:"black_eye",name:"Black Eye",effect:"-3 Accuracy for 1 fight",duration:1}];function K(o){return Jt.find(n=>n.id===o)}function Zt(o,n){const e=K(o);if(e)return e.effects.find(i=>i.level===n)}function zt(o){return Math.random()<o?Te[Math.floor(Math.random()*Te.length)]:null}class ei extends k.Scene{constructor(){super({key:"TrainingScene"});f(this,"fighter");f(this,"selectedProgram",null);f(this,"trainingDummy");f(this,"detailPanel")}create(){const e=m.getRun();if(!e.fighter){this.scene.start("CampScene");return}this.fighter=e.fighter,this.createBackground(),this.createHeader(),this.createTrainingDummy(),this.createProgramCards(),this.createFatigueDisplay(),this.createBackButton(),this.cameras.main.fadeIn(300)}createBackground(){const{width:e,height:i}=this.cameras.main,a=this.add.graphics();a.fillGradientStyle(2762016,2762016,1709328,1709328),a.fillRect(0,0,e,i),a.fillStyle(3811866,1),a.fillRect(0,i*.5,e,i*.5),a.lineStyle(1,2759178,.5);for(let t=0;t<10;t++){const s=i*.5+t*30;a.moveTo(0,s),a.lineTo(e,s)}a.strokePath(),this.drawWeaponRack(50,i*.35),this.createTorch(40,i*.2),this.createTorch(e-40,i*.2)}drawWeaponRack(e,i){const a=this.add.graphics();a.fillStyle(3811866,1),a.fillRect(e-25,i,50,120),a.lineStyle(2,2759178,1),a.strokeRect(e-25,i,50,120),a.lineStyle(4,8421504,1),a.moveTo(e-15,i+20),a.lineTo(e-15,i+100),a.strokePath(),a.moveTo(e,i+15),a.lineTo(e,i+105),a.strokePath(),a.moveTo(e+15,i+25),a.lineTo(e+15,i+95),a.strokePath()}createTorch(e,i){const a=this.add.container(e,i),t=this.add.graphics();t.fillStyle(4864554,1),t.fillRect(-8,0,16,25),a.add(t);const s=this.add.graphics(),r=l=>{s.clear(),s.fillStyle(16737792,.2*l),s.fillCircle(0,-10,30*l),s.fillStyle(16755200,.3*l),s.fillCircle(0,-10,15)};this.tweens.add({targets:{i:1},i:1.3,duration:200,yoyo:!0,repeat:-1,onUpdate:l=>{const c=l.getValue();typeof c=="number"&&r(c)}}),r(1),a.add(s)}createHeader(){const{width:e}=this.cameras.main,i=G();this.add.text(e/2,i.top+20,"TRAINING YARD",{fontFamily:"Georgia, serif",fontSize:"22px",color:"#c9a959",stroke:"#000000",strokeThickness:2}).setOrigin(.5),this.add.text(e/2,i.top+48,"Choose a training program",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b7355"}).setOrigin(.5)}createTrainingDummy(){const{width:e,height:i}=this.cameras.main;this.trainingDummy=this.add.container(e*.75,i*.38);const a=this.add.graphics();a.fillStyle(3811866,1),a.fillRect(-8,0,16,100),this.trainingDummy.add(a);const t=this.add.graphics();t.fillStyle(6969930,1),t.fillEllipse(0,-20,50,70),t.fillRect(-40,-30,20,10),t.fillRect(20,-30,20,10),t.fillCircle(0,-65,20),t.lineStyle(2,9109504,.5),t.strokeCircle(0,-30,15),t.strokeCircle(0,10,12),this.trainingDummy.add(t),this.tweens.add({targets:this.trainingDummy,rotation:.03,duration:2e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}createProgramCards(){const{width:e,height:i}=this.cameras.main,a=V(this),t=Math.min(160,(a.width-30)/2),s=90,r=2,l=a.x+t/2+10,c=i*.52,h=t+10,d=s+10,g=m.getFatigue();Kt.forEach((y,w)=>{const S=w%r,v=Math.floor(w/r),R=l+S*h,B=c+v*d,O=g+y.fatigueCost<=100,C=m.getTechniqueLevel(y.techniqueId),N=K(y.techniqueId);this.createProgramCard(R,B,t,s,y,O,C,(N==null?void 0:N.maxLevel)||3)})}createProgramCard(e,i,a,t,s,r,l,c){const h=this.add.container(e,i),d=this.add.graphics(),g=r?2760474:1709328;d.fillStyle(g,.95),d.fillRoundedRect(-a/2,-t/2,a,t,8),d.lineStyle(2,r?5917242:3811866,1),d.strokeRoundedRect(-a/2,-t/2,a,t,8),h.add(d);const y=this.add.text(-a/2+15,-t/2+12,s.icon,{fontSize:"20px"});h.add(y);const w=this.add.text(-a/2+40,-t/2+10,s.name,{fontFamily:"Georgia, serif",fontSize:"11px",color:r?"#c9a959":"#5a4a3a"});h.add(w);const S=this.add.text(a/2-15,-t/2+10,"",{fontFamily:"Georgia, serif",fontSize:"10px",color:"#c9a959"}).setOrigin(1,0);let v="";for(let C=0;C<c;C++)v+=C<l?"●":"○";S.setText(v),h.add(S);const R=this.formatStatChanges(s.statChanges),B=this.add.text(0,-5,R,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355",align:"center"}).setOrigin(.5);h.add(B);const O=this.add.text(-a/2+10,t/2-22,`⚡${s.fatigueCost}`,{fontFamily:"Georgia, serif",fontSize:"9px",color:r?"#daa520":"#5a3a1a"});if(h.add(O),s.injuryRisk>.1){const C=this.add.text(a/2-10,t/2-22,"⚠️",{fontSize:"10px"}).setOrigin(1,0);h.add(C)}return r?(h.setSize(a,t),h.setInteractive(new k.Geom.Rectangle(-a/2,-t/2,a,t),k.Geom.Rectangle.Contains),h.on("pointerover",()=>{d.clear(),d.fillStyle(3813162,.95),d.fillRoundedRect(-a/2,-t/2,a,t,8),d.lineStyle(2,13216089,1),d.strokeRoundedRect(-a/2,-t/2,a,t,8),this.showProgramDetail(s,l)}),h.on("pointerout",()=>{d.clear(),d.fillStyle(g,.95),d.fillRoundedRect(-a/2,-t/2,a,t,8),d.lineStyle(2,5917242,1),d.strokeRoundedRect(-a/2,-t/2,a,t,8),this.hideProgramDetail()}),h.on("pointerdown",()=>{this.selectProgram(s)})):h.setAlpha(.6),h}formatStatChanges(e){const i=[];return e.attack&&i.push(`${e.attack>0?"+":""}${e.attack} ATK`),e.defense&&i.push(`${e.defense>0?"+":""}${e.defense} DEF`),e.accuracy&&i.push(`${e.accuracy>0?"+":""}${e.accuracy} ACC`),e.dodge&&i.push(`${e.dodge>0?"+":""}${e.dodge} DOD`),e.speed&&i.push(`${e.speed>0?"+":""}${e.speed} SPD`),e.maxStamina&&i.push(`${e.maxStamina>0?"+":""}${e.maxStamina} STA`),e.maxHP&&i.push(`${e.maxHP>0?"+":""}${e.maxHP} HP`),e.maxFocus&&i.push(`${e.maxFocus>0?"+":""}${e.maxFocus} FOC`),i.join(", ")}showProgramDetail(e,i){this.hideProgramDetail();const{width:a,height:t}=this.cameras.main,s=Math.min(280,a-40),r=120;this.detailPanel=this.add.container(a/2,t*.35);const l=this.add.graphics();l.fillStyle(1709072,.95),l.fillRoundedRect(-s/2,-r/2,s,r,10),l.lineStyle(2,13216089,1),l.strokeRoundedRect(-s/2,-r/2,s,r,10),this.detailPanel.add(l);const c=this.add.text(0,-r/2+15,e.name,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#c9a959"}).setOrigin(.5);this.detailPanel.add(c);const h=this.add.text(0,-15,e.description,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355",wordWrap:{width:s-30},align:"center"}).setOrigin(.5);this.detailPanel.add(h);const d=K(e.techniqueId);if(d){const g=i+1,y=Zt(e.techniqueId,g);let w=`${d.icon} ${d.name}`;y?w+=` (Lv.${g}): ${y.description}`:i>=d.maxLevel&&(w+=" (MAXED)");const S=this.add.text(0,r/2-25,w,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#6495ed",wordWrap:{width:s-20},align:"center"}).setOrigin(.5);this.detailPanel.add(S)}}hideProgramDetail(){var e;(e=this.detailPanel)==null||e.destroy(),this.detailPanel=void 0}createFatigueDisplay(){const{width:e}=this.cameras.main,i=G(),a=m.getFatigue();this.add.text(e/2,i.top+72,"FATIGUE",{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355"}).setOrigin(.5);const t=150,s=12,r=e/2-t/2,l=i.top+85,c=this.add.graphics();c.fillStyle(2760474,1),c.fillRoundedRect(r,l,t,s,4);const h=this.add.graphics(),d=a>70?9109504:a>40?14329120:2263842;h.fillStyle(d,1),h.fillRoundedRect(r+2,l+2,(t-4)*(a/100),s-4,3),this.add.text(e/2+t/2+10,l+s/2,`${a}%`,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355"}).setOrigin(0,.5),a>=80&&this.add.text(e/2,l+20,"⚠️ High fatigue reduces stamina regen!",{fontFamily:"Georgia, serif",fontSize:"9px",color:"#daa520"}).setOrigin(.5)}selectProgram(e){this.selectedProgram=e,this.trainingDummy&&this.tweens.add({targets:this.trainingDummy,rotation:.3,duration:100,yoyo:!0,repeat:2,ease:"Quad.out"}),this.showTrainingConfirmation(e)}showTrainingConfirmation(e){const{width:i,height:a}=this.cameras.main;b.showConfirmDialog(this,`Train: ${e.name}?`,`${e.previewText}

Fatigue +${e.fatigueCost}%`+(e.injuryRisk>.1?`
Injury Risk: ${Math.round(e.injuryRisk*100)}%`:""),()=>this.completeTraining(e),()=>{this.selectedProgram=null},"TRAIN")}completeTraining(e){const i=m.getRun();if(!i.fighter)return;for(const[r,l]of Object.entries(e.statChanges))if(typeof l=="number"){const c=r;typeof i.fighter.currentStats[c]=="number"&&(i.fighter.currentStats[c]+=l)}const a=m.getTechniqueLevel(e.techniqueId),t=K(e.techniqueId);t&&a<t.maxLevel&&m.setTechniqueLevel(e.techniqueId,a+1),m.addFatigue(e.fatigueCost);const s=zt(e.injuryRisk);s&&(m.addSparringInjury(s.id),b.showNotification(this,`⚠️ ${s.name}: ${s.effect}`,3e3)),J(i.fighter,3),m.updateRun({fighter:i.fighter,week:i.week+1,lastCampAction:"train"}),b.showNotification(this,e.trainingText,2500),this.time.delayedCall(2500,()=>{this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("CampScene")})})}createBackButton(){const e=G();new Pe(this,e.left+50,ce(this,30),"← BACK",()=>{this.cameras.main.fadeOut(200),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("CampScene")})},{width:90,height:44,fontSize:12})}}const ti=()=>{const o=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),n=window.innerHeight>window.innerWidth;let e=390,i=844;return!o&&!n&&(e=600,i=900),{type:k.AUTO,parent:"game-container",width:e,height:i,backgroundColor:"#1a1410",scale:{mode:k.Scale.FIT,autoCenter:k.Scale.CENTER_BOTH,min:{width:320,height:480},max:{width:600,height:1200}},render:{pixelArt:!1,antialias:!0,roundPixels:!0},input:{activePointers:3,touch:{capture:!0}},scene:[Me,_e,He,ze,tt,it,ot,Ft,_t,Ht,Dt,Lt,Wt,Nt,qt,Qt,ei],physics:{default:"arcade",arcade:{debug:!1}}}},ii=ti(),ai=new k.Game(ii);window.addEventListener("resize",()=>{ai.scale.refresh()});document.addEventListener("touchstart",o=>{o.target instanceof HTMLCanvasElement&&o.preventDefault()},{passive:!1});document.addEventListener("touchmove",o=>{o.target instanceof HTMLCanvasElement&&o.preventDefault()},{passive:!1});document.addEventListener("contextmenu",o=>{o.preventDefault()});
