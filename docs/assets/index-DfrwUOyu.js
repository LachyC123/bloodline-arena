var Yt=Object.defineProperty;var zt=(c,n,e)=>n in c?Yt(c,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):c[n]=e;var m=(c,n,e)=>zt(c,typeof n!="symbol"?n+"":n,e);import{P as w}from"./phaser-0RJB29YE.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const t of i)if(t.type==="childList")for(const s of t.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&a(s)}).observe(document,{childList:!0,subtree:!0});function e(i){const t={};return i.integrity&&(t.integrity=i.integrity),i.referrerPolicy&&(t.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?t.credentials="include":i.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function a(i){if(i.ep)return;i.ep=!0;const t=e(i);fetch(i.href,t)}})();class Ut extends w.Scene{constructor(){super({key:"BootScene"})}init(){console.log("[BootScene] Initializing...")}preload(){}create(){console.log("[BootScene] Created - transitioning to PreloadScene"),this.registry.set("initialized",!0),this.registry.set("gameVersion","1.0.0"),this.scene.start("PreloadScene")}}const Xe=[{id:"rusty_sword",name:"Rusty Sword",type:"sword",rarity:"common",icon:"âš”ï¸",damageMin:5,damageMax:8,lightStaminaCost:10,heavyStaminaCost:22,accuracyMod:0,critChanceMod:0,speedMod:0,effects:[],damageDescription:"Light: Quick slash. Heavy: Overhead chop.",lore:"A worn blade, but it still cuts.",price:30,sellPrice:10,leagueMin:"bronze"},{id:"iron_gladius",name:"Iron Gladius",type:"sword",rarity:"common",icon:"âš”ï¸",damageMin:7,damageMax:10,lightStaminaCost:10,heavyStaminaCost:22,accuracyMod:5,critChanceMod:0,speedMod:1,effects:[],damageDescription:"Light: Precise thrust. Heavy: Wide slash with good accuracy.",lore:"Standard arena issue. Reliable.",price:60,sellPrice:20,leagueMin:"bronze"},{id:"pit_fighter_blade",name:"Pit Fighter's Blade",type:"sword",rarity:"uncommon",icon:"âš”ï¸",damageMin:9,damageMax:13,lightStaminaCost:10,heavyStaminaCost:24,accuracyMod:5,critChanceMod:5,speedMod:0,effects:[{type:"bleed",chance:.15,value:3,description:"15% bleed on hit"}],damageDescription:"Light: Fast cut with bleed chance. Heavy: Deep slash.",lore:"Notched from countless fights.",price:120,sellPrice:40,leagueMin:"bronze"},{id:"arena_champion_sword",name:"Arena Champion's Sword",type:"sword",rarity:"rare",icon:"âš”ï¸",damageMin:12,damageMax:17,lightStaminaCost:10,heavyStaminaCost:24,accuracyMod:8,critChanceMod:8,speedMod:2,effects:[{type:"momentum_gain",chance:.25,value:1,description:"Builds momentum on hit"}],damageDescription:"Light: Swift strike that builds momentum. Heavy: Crowd-pleasing cleave.",lore:"Won by a champion who never lost.",price:250,sellPrice:85,leagueMin:"silver"},{id:"bloodletter",name:"Bloodletter",type:"sword",rarity:"epic",icon:"âš”ï¸",damageMin:14,damageMax:20,lightStaminaCost:12,heavyStaminaCost:26,accuracyMod:5,critChanceMod:10,speedMod:1,effects:[{type:"bleed",chance:.35,value:5,description:"35% bleed on any hit"},{type:"lifesteal",chance:.2,value:15,description:"20% chance to heal 15% of damage"}],damageDescription:"Light: Bleeding cut. Heavy: Deep wound that may heal you.",lore:"The blade drinks deep.",price:450,sellPrice:150,leagueMin:"silver"},{id:"executioners_edge",name:"Executioner's Edge",type:"sword",rarity:"legendary",icon:"âš”ï¸",damageMin:18,damageMax:26,lightStaminaCost:12,heavyStaminaCost:28,accuracyMod:10,critChanceMod:15,speedMod:2,effects:[{type:"crit_bonus",chance:1,value:25,description:"+25% crit damage"},{type:"bleed",chance:.4,value:6,description:"Severe bleeding on crit"}],damageDescription:"Light: Precise cut. Heavy: Devastating execution strike with massive crit potential.",lore:"The last blade many have seen.",price:800,sellPrice:270,leagueMin:"gold"},{id:"wood_axe",name:"Woodcutter's Axe",type:"axe",rarity:"common",icon:"ðŸª“",damageMin:6,damageMax:10,lightStaminaCost:12,heavyStaminaCost:28,accuracyMod:-5,critChanceMod:0,speedMod:-1,effects:[{type:"armor_break",chance:.2,value:1,description:"Can chip armor"}],damageDescription:"Light: Wide chop. Heavy: Overhead slam with armor break.",lore:"Made for trees, works on men too.",price:35,sellPrice:12,leagueMin:"bronze"},{id:"iron_battleaxe",name:"Iron Battleaxe",type:"axe",rarity:"uncommon",icon:"ðŸª“",damageMin:10,damageMax:15,lightStaminaCost:14,heavyStaminaCost:30,accuracyMod:-3,critChanceMod:5,speedMod:-1,effects:[{type:"armor_break",chance:.35,value:2,description:"35% to apply 2 armor break"}],damageDescription:"Light: Hooking cut. Heavy: Brutal chop that breaks armor.",lore:"A soldier's trusted companion.",price:100,sellPrice:35,leagueMin:"bronze"},{id:"berserker_cleaver",name:"Berserker's Cleaver",type:"axe",rarity:"rare",icon:"ðŸª“",damageMin:14,damageMax:21,lightStaminaCost:14,heavyStaminaCost:32,accuracyMod:-5,critChanceMod:10,speedMod:-2,effects:[{type:"armor_break",chance:.5,value:3,description:"Shatters armor on heavy hits"},{type:"momentum_gain",chance:.3,value:2,description:"Rage builds momentum"}],damageDescription:"Light: Wild swing. Heavy: Devastating cleave that destroys armor.",lore:"Forged in fury.",price:220,sellPrice:75,leagueMin:"silver"},{id:"skull_splitter",name:"Skull Splitter",type:"axe",rarity:"epic",icon:"ðŸª“",damageMin:18,damageMax:28,lightStaminaCost:16,heavyStaminaCost:35,accuracyMod:-8,critChanceMod:15,speedMod:-2,effects:[{type:"armor_break",chance:.6,value:4,description:"Massive armor destruction"},{type:"stun",chance:.2,value:1,description:"20% stun on head hits"}],damageDescription:"Light: Powerful chop. Heavy: Skull-crushing blow that stuns and breaks all armor.",lore:"Its name is well earned.",price:420,sellPrice:140,leagueMin:"silver"},{id:"wooden_club",name:"Wooden Club",type:"mace",rarity:"common",icon:"ðŸ”¨",damageMin:5,damageMax:9,lightStaminaCost:11,heavyStaminaCost:25,accuracyMod:5,critChanceMod:-5,speedMod:0,effects:[{type:"stun",chance:.1,value:1,description:"Chance to daze"}],damageDescription:"Light: Quick bonk. Heavy: Overhead smash.",lore:"Simple but effective.",price:25,sellPrice:8,leagueMin:"bronze"},{id:"iron_mace",name:"Iron Mace",type:"mace",rarity:"common",icon:"ðŸ”¨",damageMin:7,damageMax:11,lightStaminaCost:12,heavyStaminaCost:26,accuracyMod:3,critChanceMod:0,speedMod:0,effects:[{type:"stun",chance:.15,value:1,description:"15% stun chance"},{type:"guard_crush",chance:.2,value:50,description:"Bypasses 50% guard on crit"}],damageDescription:"Light: Swift strike. Heavy: Guard-crushing smash.",lore:"Dents helmets nicely.",price:65,sellPrice:22,leagueMin:"bronze"},{id:"flanged_mace",name:"Flanged Mace",type:"mace",rarity:"uncommon",icon:"ðŸ”¨",damageMin:10,damageMax:15,lightStaminaCost:13,heavyStaminaCost:28,accuracyMod:5,critChanceMod:5,speedMod:0,effects:[{type:"stun",chance:.25,value:1,description:"High stun chance"},{type:"armor_break",chance:.2,value:1,description:"Dents armor"}],damageDescription:"Light: Flanged strike. Heavy: Devastating crush that stuns and dents.",lore:"Designed to defeat armor.",price:130,sellPrice:45,leagueMin:"bronze"},{id:"morningstar",name:"Morningstar",type:"mace",rarity:"rare",icon:"ðŸ”¨",damageMin:12,damageMax:18,lightStaminaCost:14,heavyStaminaCost:30,accuracyMod:0,critChanceMod:10,speedMod:-1,effects:[{type:"stun",chance:.35,value:1,description:"Spiked head stuns often"},{type:"bleed",chance:.2,value:3,description:"Spikes cause bleeding"}],damageDescription:"Light: Spiked swing. Heavy: Crushing blow that stuns and tears.",lore:"Spikes add conviction.",price:200,sellPrice:68,leagueMin:"silver"},{id:"wooden_spear",name:"Wooden Spear",type:"spear",rarity:"common",icon:"ðŸ”±",damageMin:4,damageMax:8,lightStaminaCost:9,heavyStaminaCost:20,accuracyMod:10,critChanceMod:0,speedMod:2,effects:[{type:"first_strike",chance:1,value:1,description:"Always strikes first"}],damageDescription:"Light: Quick jab with reach advantage. Heavy: Powerful thrust.",lore:"Reach is everything.",price:30,sellPrice:10,leagueMin:"bronze"},{id:"iron_pike",name:"Iron Pike",type:"spear",rarity:"uncommon",icon:"ðŸ”±",damageMin:7,damageMax:12,lightStaminaCost:10,heavyStaminaCost:22,accuracyMod:12,critChanceMod:5,speedMod:3,effects:[{type:"first_strike",chance:1,value:1,description:"Strike before they reach you"},{type:"bleed",chance:.15,value:2,description:"Piercing causes bleeding"}],damageDescription:"Light: Precise thrust. Heavy: Deep penetrating stab with bleed.",lore:"Keep them at distance.",price:110,sellPrice:38,leagueMin:"bronze"},{id:"gladiator_trident",name:"Gladiator's Trident",type:"spear",rarity:"rare",icon:"ðŸ”±",damageMin:10,damageMax:16,lightStaminaCost:11,heavyStaminaCost:24,accuracyMod:15,critChanceMod:8,speedMod:3,effects:[{type:"first_strike",chance:1,value:1,description:"Always first"},{type:"bleed",chance:.3,value:4,description:"Three prongs cause severe bleeding"}],damageDescription:"Light: Triple-pronged jab. Heavy: Hooking thrust that tears and bleeds.",lore:"A crowd favorite.",price:240,sellPrice:80,leagueMin:"silver"},{id:"rusty_shiv",name:"Rusty Shiv",type:"dagger",rarity:"common",icon:"ðŸ—¡ï¸",damageMin:3,damageMax:6,lightStaminaCost:6,heavyStaminaCost:14,accuracyMod:10,critChanceMod:15,speedMod:3,effects:[{type:"bleed",chance:.2,value:2,description:"Causes infection-prone cuts"}],damageDescription:"Light: Quick stab. Heavy: Targeted vital strike.",lore:"Prison-made but deadly.",price:20,sellPrice:7,leagueMin:"bronze"},{id:"assassins_blade",name:"Assassin's Blade",type:"dagger",rarity:"uncommon",icon:"ðŸ—¡ï¸",damageMin:5,damageMax:9,lightStaminaCost:7,heavyStaminaCost:15,accuracyMod:15,critChanceMod:25,speedMod:4,effects:[{type:"crit_bonus",chance:1,value:20,description:"+20% crit damage"},{type:"bleed",chance:.3,value:3,description:"Precise cuts bleed heavily"}],damageDescription:"Light: Surgical cut. Heavy: Vital strike with massive crit chance.",lore:"Silent and deadly.",price:140,sellPrice:48,leagueMin:"bronze"},{id:"venom_fang",name:"Venom Fang",type:"dagger",rarity:"rare",icon:"ðŸ—¡ï¸",damageMin:6,damageMax:11,lightStaminaCost:8,heavyStaminaCost:16,accuracyMod:12,critChanceMod:20,speedMod:4,effects:[{type:"poison",chance:.4,value:4,description:"40% poison that deals 4/turn"},{type:"crit_bonus",chance:1,value:15,description:"Extra crit damage"}],damageDescription:"Light: Poisoned nick. Heavy: Deep venomous stab.",lore:"The poison does the work.",price:280,sellPrice:95,leagueMin:"silver"},{id:"shadowstrike",name:"Shadowstrike",type:"dagger",rarity:"epic",icon:"ðŸ—¡ï¸",damageMin:8,damageMax:14,lightStaminaCost:8,heavyStaminaCost:18,accuracyMod:18,critChanceMod:35,speedMod:5,effects:[{type:"crit_bonus",chance:1,value:40,description:"+40% crit damage"},{type:"bleed",chance:.5,value:5,description:"Devastating bleeds on crit"},{type:"momentum_gain",chance:.4,value:1,description:"Builds momentum quickly"}],damageDescription:"Light: Lightning-fast slash. Heavy: Devastating backstab with massive crit.",lore:"They never see it coming.",price:500,sellPrice:170,leagueMin:"gold"},{id:"crude_zweihander",name:"Crude Zweihander",type:"greatsword",rarity:"uncommon",icon:"âš”ï¸",damageMin:12,damageMax:20,lightStaminaCost:18,heavyStaminaCost:38,accuracyMod:-10,critChanceMod:5,speedMod:-3,effects:[{type:"armor_break",chance:.3,value:2,description:"Weight breaks armor"}],damageDescription:"Light: Wide sweep. Heavy: Devastating overhead cleave.",lore:"More steel than skill.",price:150,sellPrice:50,leagueMin:"bronze"},{id:"champions_greatsword",name:"Champion's Greatsword",type:"greatsword",rarity:"rare",icon:"âš”ï¸",damageMin:16,damageMax:26,lightStaminaCost:20,heavyStaminaCost:40,accuracyMod:-5,critChanceMod:10,speedMod:-2,effects:[{type:"armor_break",chance:.45,value:3,description:"Shatters defenses"},{type:"momentum_gain",chance:.35,value:2,description:"Crowd loves big swings"}],damageDescription:"Light: Powerful sweep. Heavy: Arena-shaking cleave that destroys armor.",lore:"Only the strong can wield it.",price:300,sellPrice:100,leagueMin:"silver"},{id:"doom_bringer",name:"Doom Bringer",type:"greatsword",rarity:"legendary",icon:"âš”ï¸",damageMin:22,damageMax:35,lightStaminaCost:22,heavyStaminaCost:45,accuracyMod:-5,critChanceMod:15,speedMod:-3,effects:[{type:"armor_break",chance:.6,value:5,description:"Absolute armor destruction"},{type:"stun",chance:.25,value:1,description:"Impact stuns"},{type:"momentum_gain",chance:.5,value:3,description:"Massive momentum on hit"}],damageDescription:"Light: Earth-shaking sweep. Heavy: Apocalyptic strike that ends fights.",lore:"Forged from a fallen star.",price:900,sellPrice:300,leagueMin:"gold"},{id:"chain_flail",name:"Chain Flail",type:"flail",rarity:"uncommon",icon:"â›“ï¸",damageMin:8,damageMax:14,lightStaminaCost:14,heavyStaminaCost:28,accuracyMod:-8,critChanceMod:5,speedMod:0,effects:[{type:"guard_crush",chance:.4,value:60,description:"Bypasses 60% of guard"}],damageDescription:"Light: Unpredictable swing. Heavy: Guard-ignoring smash.",lore:"The chain finds a way.",price:120,sellPrice:40,leagueMin:"bronze"},{id:"spiked_flail",name:"Spiked Flail",type:"flail",rarity:"rare",icon:"â›“ï¸",damageMin:11,damageMax:18,lightStaminaCost:15,heavyStaminaCost:30,accuracyMod:-10,critChanceMod:8,speedMod:-1,effects:[{type:"guard_crush",chance:.5,value:70,description:"Almost ignores guard"},{type:"bleed",chance:.25,value:3,description:"Spikes tear flesh"}],damageDescription:"Light: Whirling strike. Heavy: Devastating guard-bypassing blow.",lore:"Impossible to block properly.",price:220,sellPrice:75,leagueMin:"silver"},{id:"sledgehammer",name:"Sledgehammer",type:"hammer",rarity:"uncommon",icon:"ðŸ”¨",damageMin:14,damageMax:22,lightStaminaCost:20,heavyStaminaCost:42,accuracyMod:-15,critChanceMod:0,speedMod:-4,effects:[{type:"armor_break",chance:.6,value:4,description:"Massive armor break"},{type:"stun",chance:.3,value:1,description:"Concussive force"}],damageDescription:"Light: Heavy swing. Heavy: Armor-obliterating smash.",lore:"Built for demolition.",price:180,sellPrice:60,leagueMin:"bronze"},{id:"war_hammer",name:"War Hammer",type:"hammer",rarity:"rare",icon:"ðŸ”¨",damageMin:18,damageMax:28,lightStaminaCost:22,heavyStaminaCost:45,accuracyMod:-12,critChanceMod:5,speedMod:-3,effects:[{type:"armor_break",chance:.7,value:5,description:"Destroys all armor"},{type:"stun",chance:.4,value:1,description:"High stun chance"},{type:"guard_crush",chance:.5,value:80,description:"Nearly ignores guard"}],damageDescription:"Light: Crushing swing. Heavy: Earth-shattering blow that ignores defenses.",lore:"The ultimate answer to armor.",price:350,sellPrice:120,leagueMin:"silver"},{id:"titans_maul",name:"Titan's Maul",type:"hammer",rarity:"legendary",icon:"ðŸ”¨",damageMin:25,damageMax:40,lightStaminaCost:25,heavyStaminaCost:50,accuracyMod:-15,critChanceMod:10,speedMod:-5,effects:[{type:"armor_break",chance:1,value:6,description:"Guaranteed total armor break"},{type:"stun",chance:.5,value:2,description:"50% chance of 2-turn stun"},{type:"guard_crush",chance:1,value:100,description:"Completely ignores guard"}],damageDescription:"Light: Massive swing. Heavy: Unstoppable force that breaks everything.",lore:"Said to be wielded by giants.",price:1e3,sellPrice:335,leagueMin:"gold"}];function Qe(c){return Xe.find(n=>n.id===c)}const Ke=[{id:"tattered_tunic",name:"Tattered Tunic",slot:"body",rarity:"common",icon:"ðŸ‘•",defense:2,staminaRegenMod:2,dodgeMod:5,speedMod:1,perks:[],description:"Light and unrestricting but offers little protection.",lore:"Better than nothing.",price:20,sellPrice:7,leagueMin:"bronze"},{id:"padded_vest",name:"Padded Vest",slot:"body",rarity:"common",icon:"ðŸ‘•",defense:4,staminaRegenMod:1,dodgeMod:3,speedMod:0,perks:[{type:"bleed_resist",value:15,description:"15% bleed resistance"}],description:"Layered cloth provides some cushioning.",lore:"Absorbs some impact.",price:40,sellPrice:14,leagueMin:"bronze"},{id:"leather_armor",name:"Leather Armor",slot:"body",rarity:"common",icon:"ðŸ¦º",defense:6,staminaRegenMod:0,dodgeMod:2,speedMod:0,perks:[{type:"bleed_resist",value:20,description:"20% bleed resistance"}],description:"Standard gladiator protection. Balanced.",lore:"Arena standard issue.",price:60,sellPrice:20,leagueMin:"bronze"},{id:"hardened_leather",name:"Hardened Leather",slot:"body",rarity:"uncommon",icon:"ðŸ¦º",defense:9,staminaRegenMod:0,dodgeMod:0,speedMod:0,perks:[{type:"bleed_resist",value:30,description:"30% bleed resistance"},{type:"crit_resist",value:10,description:"10% crit damage reduction"}],description:"Boiled and treated leather provides solid protection.",lore:"Proven in countless fights.",price:100,sellPrice:35,leagueMin:"bronze"},{id:"gladiator_harness",name:"Gladiator's Harness",slot:"body",rarity:"uncommon",icon:"ðŸ¦º",defense:8,staminaRegenMod:2,dodgeMod:5,speedMod:1,perks:[{type:"momentum_boost",value:20,description:"+20% momentum gain"},{type:"dodge_boost",value:5,description:"+5% dodge chance"}],description:"Flashy straps that please the crowd.",lore:"Style over substance.",price:130,sellPrice:45,leagueMin:"bronze"},{id:"chainmail",name:"Chainmail",slot:"body",rarity:"uncommon",icon:"â›“ï¸",defense:12,staminaRegenMod:-2,dodgeMod:-5,speedMod:-1,perks:[{type:"bleed_resist",value:50,description:"50% bleed resistance"}],description:"Interlocked rings stop slashing attacks.",lore:"The rattling of metal.",price:150,sellPrice:50,leagueMin:"bronze"},{id:"reinforced_chain",name:"Reinforced Chainmail",slot:"body",rarity:"rare",icon:"â›“ï¸",defense:15,staminaRegenMod:-1,dodgeMod:-3,speedMod:-1,perks:[{type:"bleed_resist",value:65,description:"65% bleed resistance"},{type:"crit_resist",value:15,description:"15% crit damage reduction"}],description:"Double-woven rings with leather backing.",lore:"Heavy but reliable.",price:220,sellPrice:75,leagueMin:"silver"},{id:"scale_mail",name:"Scale Mail",slot:"body",rarity:"rare",icon:"ðŸ‰",defense:14,staminaRegenMod:-2,dodgeMod:-4,speedMod:0,perks:[{type:"bleed_resist",value:40,description:"40% bleed resistance"},{type:"poison_resist",value:30,description:"30% poison resistance"}],description:"Overlapping metal scales like a serpent.",lore:"Flexible yet strong.",price:200,sellPrice:68,leagueMin:"silver"},{id:"brigandine",name:"Brigandine",slot:"body",rarity:"rare",icon:"ðŸ›¡ï¸",defense:18,staminaRegenMod:-3,dodgeMod:-8,speedMod:-2,perks:[{type:"bleed_resist",value:60,description:"60% bleed resistance"},{type:"stun_resist",value:20,description:"20% stun resistance"}],description:"Metal plates riveted inside heavy cloth.",lore:"A soldier's choice.",price:280,sellPrice:95,leagueMin:"silver"},{id:"half_plate",name:"Half Plate",slot:"body",rarity:"epic",icon:"ðŸ›¡ï¸",defense:22,staminaRegenMod:-4,dodgeMod:-10,speedMod:-2,perks:[{type:"bleed_resist",value:70,description:"70% bleed resistance"},{type:"crit_resist",value:25,description:"25% crit damage reduction"},{type:"stun_resist",value:25,description:"25% stun resistance"}],description:"Solid plates protecting vital areas.",lore:"Knight's armor, arena-modified.",price:400,sellPrice:135,leagueMin:"silver"},{id:"full_plate",name:"Full Plate Armor",slot:"body",rarity:"epic",icon:"ðŸ›¡ï¸",defense:28,staminaRegenMod:-6,dodgeMod:-15,speedMod:-3,perks:[{type:"bleed_resist",value:80,description:"80% bleed resistance"},{type:"crit_resist",value:35,description:"35% crit damage reduction"},{type:"stun_resist",value:35,description:"35% stun resistance"},{type:"first_strike_resist",value:50,description:"50% first strike resistance"}],description:"Complete metal encasement. Maximum protection.",lore:"A walking fortress.",price:600,sellPrice:200,leagueMin:"gold"},{id:"champions_plate",name:"Champion's Plate",slot:"body",rarity:"legendary",icon:"ðŸ›¡ï¸",defense:32,staminaRegenMod:-4,dodgeMod:-10,speedMod:-2,perks:[{type:"bleed_resist",value:85,description:"85% bleed resistance"},{type:"crit_resist",value:40,description:"40% crit damage reduction"},{type:"stun_resist",value:40,description:"40% stun resistance"},{type:"hp_regen",value:2,description:"Regenerate 2 HP per turn"}],description:"Masterwork plate worn by arena legends.",lore:"Forged by the greatest smith.",price:950,sellPrice:320,leagueMin:"gold"},{id:"berserker_furs",name:"Berserker's Furs",slot:"body",rarity:"rare",icon:"ðŸ»",defense:10,staminaRegenMod:3,dodgeMod:0,speedMod:1,perks:[{type:"momentum_boost",value:40,description:"+40% momentum gain"},{type:"thorns",value:3,description:"Deal 3 damage when hit"}],description:"Savage furs that fuel rage.",lore:"From the northern wastes.",price:250,sellPrice:85,leagueMin:"silver"},{id:"assassin_cloak",name:"Assassin's Cloak",slot:"body",rarity:"epic",icon:"ðŸ§¥",defense:6,staminaRegenMod:4,dodgeMod:15,speedMod:3,perks:[{type:"dodge_boost",value:15,description:"+15% dodge chance"},{type:"crit_resist",value:20,description:"20% crit damage reduction"},{type:"counter_damage",value:25,description:"+25% counter damage"}],description:"Light as shadow, fast as death.",lore:"Worn by the unseen.",price:450,sellPrice:150,leagueMin:"silver"},{id:"leather_cap",name:"Leather Cap",slot:"helmet",rarity:"common",icon:"ðŸŽ©",defense:2,staminaRegenMod:0,dodgeMod:0,speedMod:0,perks:[{type:"stun_resist",value:10,description:"10% stun resistance"}],description:"Basic head protection.",lore:"Better than bare.",price:25,sellPrice:8,leagueMin:"bronze"},{id:"iron_helm",name:"Iron Helm",slot:"helmet",rarity:"uncommon",icon:"â›‘ï¸",defense:4,staminaRegenMod:-1,dodgeMod:-2,speedMod:0,perks:[{type:"stun_resist",value:25,description:"25% stun resistance"},{type:"crit_resist",value:10,description:"10% crit damage reduction"}],description:"Solid iron protection for the skull.",lore:"Standard military issue.",price:80,sellPrice:28,leagueMin:"bronze"},{id:"gladiator_helm",name:"Gladiator's Helm",slot:"helmet",rarity:"rare",icon:"â›‘ï¸",defense:6,staminaRegenMod:0,dodgeMod:-3,speedMod:0,perks:[{type:"stun_resist",value:35,description:"35% stun resistance"},{type:"crit_resist",value:20,description:"20% crit damage reduction"},{type:"momentum_boost",value:15,description:"Crowd loves the look"}],description:"Iconic arena headgear with face guard.",lore:"Intimidating and protective.",price:180,sellPrice:60,leagueMin:"silver"},{id:"greathelm",name:"Greathelm",slot:"helmet",rarity:"epic",icon:"â›‘ï¸",defense:10,staminaRegenMod:-2,dodgeMod:-5,speedMod:-1,perks:[{type:"stun_resist",value:50,description:"50% stun resistance"},{type:"crit_resist",value:35,description:"35% crit damage reduction"},{type:"bleed_resist",value:25,description:"25% bleed resistance"}],description:"Full head enclosure. Maximum protection.",lore:"The bucket helm.",price:320,sellPrice:108,leagueMin:"gold"},{id:"wooden_buckler",name:"Wooden Buckler",slot:"shield",rarity:"common",icon:"ðŸ›¡ï¸",defense:3,staminaRegenMod:-1,dodgeMod:0,speedMod:0,perks:[],description:"Small shield for deflecting blows.",lore:"Light and maneuverable.",price:30,sellPrice:10,leagueMin:"bronze"},{id:"iron_shield",name:"Iron Round Shield",slot:"shield",rarity:"uncommon",icon:"ðŸ›¡ï¸",defense:6,staminaRegenMod:-2,dodgeMod:-3,speedMod:-1,perks:[{type:"stun_resist",value:15,description:"15% stun resistance"}],description:"Standard combat shield.",lore:"Dented from use.",price:90,sellPrice:30,leagueMin:"bronze"},{id:"kite_shield",name:"Kite Shield",slot:"shield",rarity:"rare",icon:"ðŸ›¡ï¸",defense:10,staminaRegenMod:-3,dodgeMod:-5,speedMod:-1,perks:[{type:"bleed_resist",value:25,description:"25% bleed resistance"},{type:"first_strike_resist",value:30,description:"30% first strike resistance"}],description:"Large teardrop shield covering the body.",lore:"A knight's companion.",price:200,sellPrice:68,leagueMin:"silver"},{id:"tower_shield",name:"Tower Shield",slot:"shield",rarity:"epic",icon:"ðŸ›¡ï¸",defense:15,staminaRegenMod:-5,dodgeMod:-10,speedMod:-2,perks:[{type:"bleed_resist",value:40,description:"40% bleed resistance"},{type:"stun_resist",value:30,description:"30% stun resistance"},{type:"first_strike_resist",value:50,description:"50% first strike resistance"}],description:"Massive shield that covers the entire body.",lore:"A mobile wall.",price:380,sellPrice:128,leagueMin:"gold"},{id:"spiked_shield",name:"Spiked Shield",slot:"shield",rarity:"rare",icon:"ðŸ›¡ï¸",defense:7,staminaRegenMod:-2,dodgeMod:-2,speedMod:0,perks:[{type:"thorns",value:5,description:"Deal 5 damage when blocking"},{type:"counter_damage",value:20,description:"+20% counter damage"}],description:"Shield with offensive capability.",lore:"Defense is also attack.",price:220,sellPrice:75,leagueMin:"silver"}];function _t(c){return Ke.find(n=>n.id===c)}class Ge{constructor(n){m(this,"seed");m(this,"initialSeed");this.initialSeed=n??Math.floor(Math.random()*2147483647),this.seed=this.initialSeed}reset(){this.seed=this.initialSeed}setSeed(n){this.initialSeed=n,this.seed=n}getSeed(){return this.initialSeed}mulberry32(){let n=this.seed+=1831565813;return n=Math.imul(n^n>>>15,n|1),n^=n+Math.imul(n^n>>>7,n|61),((n^n>>>14)>>>0)/4294967296}random(){return this.mulberry32()}randomInt(n,e){return Math.floor(this.random()*(e-n+1))+n}randomFloat(n,e){return this.random()*(e-n)+n}chance(n){return this.random()<n}pick(n){if(n.length===0)throw new Error("Cannot pick from empty array");return n[this.randomInt(0,n.length-1)]}pickMultiple(n,e){if(e>n.length)throw new Error("Cannot pick more elements than array length");const a=[...n],i=[];for(let t=0;t<e;t++){const s=this.randomInt(0,a.length-1);i.push(a[s]),a.splice(s,1)}return i}shuffle(n){const e=[...n];for(let a=e.length-1;a>0;a--){const i=this.randomInt(0,a);[e[a],e[i]]=[e[i],e[a]]}return e}weightedPick(n){const e=n.reduce((i,[,t])=>i+t,0);let a=this.random()*e;for(const[i,t]of n)if(a-=t,a<=0)return i;return n[n.length-1][0]}randomId(n=8){const e="abcdefghijklmnopqrstuvwxyz0123456789";let a="";for(let i=0;i<n;i++)a+=e[this.randomInt(0,e.length-1)];return a}roll(n){const e=n.match(/^(\d+)d(\d+)([+-]\d+)?$/);if(!e)throw new Error(`Invalid dice notation: ${n}`);const a=parseInt(e[1],10),i=parseInt(e[2],10);let s=e[3]?parseInt(e[3],10):0;for(let r=0;r<a;r++)s+=this.randomInt(1,i);return s}bellCurve(n,e,a=3){let i=0;for(let t=0;t<a;t++)i+=this.randomFloat(n,e);return i/a}}let $=new Ge;const k={init(c){$=new Ge(c)},getSeed(){return $.getSeed()},reset(){$.reset()},random(){return $.random()},int(c,n){return $.randomInt(c,n)},float(c,n){return $.randomFloat(c,n)},chance(c){return $.chance(c)},pick(c){return $.pick(c)},pickMultiple(c,n){return $.pickMultiple(c,n)},shuffle(c){return $.shuffle(c)},weightedPick(c){return $.weightedPick(c)},id(c){return $.randomId(c)},roll(c){return $.roll(c)},bellCurve(c,n,e){return $.bellCurve(c,n,e)},create(c){return new Ge(c)}},jt=[{id:"sharp",name:"Sharp",description:"+2-3 base damage",weight:100,tier:"common",allowedItemTypes:["weapon"],statMods:[{stat:"damageMin",value:2},{stat:"damageMax",value:3}],tags:["damage"]},{id:"heavy",name:"Heavy",description:"+5 max damage, +3 stamina cost",weight:80,tier:"common",allowedItemTypes:["weapon"],statMods:[{stat:"damageMax",value:5},{stat:"staminaCost",value:3}],tags:["damage","stamina"]},{id:"light",name:"Light",description:"-5 stamina cost, -1 damage",weight:80,tier:"common",allowedItemTypes:["weapon"],statMods:[{stat:"staminaCost",value:-5},{stat:"damageMin",value:-1}],tags:["stamina"]},{id:"balanced",name:"Balanced",description:"+5% accuracy",weight:90,tier:"common",allowedItemTypes:["weapon"],statMods:[{stat:"accuracy",value:5,isPercent:!0}],tags:["accuracy"]},{id:"rusted",name:"Rusted",description:"-2 damage, +8% bleed chance",weight:70,tier:"common",allowedItemTypes:["weapon"],statMods:[{stat:"damageMin",value:-2},{stat:"bleedChance",value:8,isPercent:!0}],tags:["bleed","damage"]},{id:"vicious",name:"Vicious",description:"+8% crit chance",weight:60,tier:"uncommon",allowedItemTypes:["weapon"],statMods:[{stat:"critChance",value:8,isPercent:!0}],tags:["crit"]},{id:"precise",name:"Precise",description:"+10% accuracy, +5% crit",weight:55,tier:"uncommon",allowedItemTypes:["weapon"],statMods:[{stat:"accuracy",value:10,isPercent:!0},{stat:"critChance",value:5,isPercent:!0}],tags:["accuracy","crit"]},{id:"serrated",name:"Serrated",description:"+15% bleed chance, +1 bleed damage",weight:50,tier:"uncommon",allowedItemTypes:["weapon"],statMods:[{stat:"bleedChance",value:15,isPercent:!0},{stat:"bleedDamage",value:1}],tags:["bleed"]},{id:"brutal",name:"Brutal",description:"+4-6 damage, +1 armor break",weight:50,tier:"uncommon",allowedItemTypes:["weapon"],statMods:[{stat:"damageMin",value:4},{stat:"damageMax",value:6},{stat:"armorBreak",value:1}],tags:["damage","armorBreak"]},{id:"quick",name:"Quick",description:"-8 stamina cost, +5% dodge",weight:55,tier:"uncommon",allowedItemTypes:["weapon"],statMods:[{stat:"staminaCost",value:-8},{stat:"dodge",value:5,isPercent:!0}],tags:["stamina","dodge"]},{id:"bloodthirsty",name:"Bloodthirsty",description:"+20% bleed, heals 2 HP on kill",weight:30,tier:"rare",allowedItemTypes:["weapon"],statMods:[{stat:"bleedChance",value:20,isPercent:!0}],tags:["bleed","lifesteal"],proc:{trigger:"on_kill",chance:100,effect:"heal",value:2}},{id:"thundering",name:"Thundering",description:"+15% stun chance on heavy attacks",weight:35,tier:"rare",allowedItemTypes:["weapon"],statMods:[{stat:"stunChance",value:15,isPercent:!0}],tags:["stun"],proc:{trigger:"on_hit",chance:15,effect:"stun_visual"}},{id:"sundering",name:"Sundering",description:"+2 armor break, +10% vs armored",weight:35,tier:"rare",allowedItemTypes:["weapon"],statMods:[{stat:"armorBreak",value:2},{stat:"bonusVsArmored",value:10,isPercent:!0}],tags:["armorBreak"]},{id:"vampiric",name:"Vampiric",description:"Heals 3% of damage dealt",weight:25,tier:"rare",allowedItemTypes:["weapon"],statMods:[{stat:"lifesteal",value:3,isPercent:!0}],tags:["lifesteal"]},{id:"relentless",name:"Relentless",description:"+2 momentum per hit",weight:30,tier:"rare",allowedItemTypes:["weapon"],statMods:[{stat:"momentumGain",value:2}],tags:["momentum"]},{id:"devastating",name:"Devastating",description:"+8-12 damage, +50% crit damage",weight:15,tier:"epic",allowedItemTypes:["weapon"],statMods:[{stat:"damageMin",value:8},{stat:"damageMax",value:12},{stat:"critDamage",value:50,isPercent:!0}],tags:["damage","crit"]},{id:"executioner",name:"Executioner's",description:"+100% damage vs wounded enemies",weight:12,tier:"epic",allowedItemTypes:["weapon"],statMods:[{stat:"bonusVsWounded",value:100,isPercent:!0}],tags:["damage","wound"]},{id:"flawless",name:"Flawless",description:"+15% accuracy, +15% crit, +5 damage",weight:10,tier:"epic",allowedItemTypes:["weapon"],statMods:[{stat:"accuracy",value:15,isPercent:!0},{stat:"critChance",value:15,isPercent:!0},{stat:"damageMin",value:5}],tags:["accuracy","crit","damage"]},{id:"annihilating",name:"Annihilating",description:"+15 damage, crits cause wound",weight:5,tier:"legendary",allowedItemTypes:["weapon"],statMods:[{stat:"damageMin",value:10},{stat:"damageMax",value:15}],tags:["damage","wound"],proc:{trigger:"on_crit",chance:100,effect:"inflict_wound"}},{id:"legendary_champion",name:"Champion's",description:"All stats +10%, momentum starts at 20",weight:3,tier:"legendary",allowedItemTypes:["weapon"],statMods:[{stat:"allStats",value:10,isPercent:!0},{stat:"startingMomentum",value:20}],tags:["momentum","damage","crit"]}],Vt=[{id:"sturdy",name:"Sturdy",description:"+3 defense",weight:100,tier:"common",allowedItemTypes:["armor"],statMods:[{stat:"defense",value:3}],tags:["defense"]},{id:"padded",name:"Padded",description:"+10 max HP",weight:90,tier:"common",allowedItemTypes:["armor"],statMods:[{stat:"maxHP",value:10}],tags:["hp"]},{id:"flexible",name:"Flexible",description:"+5% dodge, -1 defense",weight:80,tier:"common",allowedItemTypes:["armor"],statMods:[{stat:"dodge",value:5,isPercent:!0},{stat:"defense",value:-1}],tags:["dodge"]},{id:"reinforced",name:"Reinforced",description:"+5 defense, -3% dodge",weight:80,tier:"common",allowedItemTypes:["armor"],statMods:[{stat:"defense",value:5},{stat:"dodge",value:-3,isPercent:!0}],tags:["defense"]},{id:"resilient",name:"Resilient",description:"+15 max HP, +2 defense",weight:50,tier:"uncommon",allowedItemTypes:["armor"],statMods:[{stat:"maxHP",value:15},{stat:"defense",value:2}],tags:["hp","defense"]},{id:"agile",name:"Agile",description:"+10% dodge, +5% parry",weight:50,tier:"uncommon",allowedItemTypes:["armor"],statMods:[{stat:"dodge",value:10,isPercent:!0},{stat:"parryWindow",value:5,isPercent:!0}],tags:["dodge","parry"]},{id:"spiked",name:"Spiked",description:"Reflects 3 damage when hit",weight:45,tier:"uncommon",allowedItemTypes:["armor"],statMods:[{stat:"thornsDamage",value:3}],tags:["thorns"]},{id:"warded",name:"Warded",description:"+25% bleed resist, +25% stun resist",weight:45,tier:"uncommon",allowedItemTypes:["armor"],statMods:[{stat:"bleedResist",value:25,isPercent:!0},{stat:"stunResist",value:25,isPercent:!0}],tags:["resist"]},{id:"impervious",name:"Impervious",description:"+8 defense, +50% armor break resist",weight:30,tier:"rare",allowedItemTypes:["armor"],statMods:[{stat:"defense",value:8},{stat:"armorBreakResist",value:50,isPercent:!0}],tags:["defense","resist"]},{id:"regenerating",name:"Regenerating",description:"Heal 2 HP per turn",weight:25,tier:"rare",allowedItemTypes:["armor"],statMods:[{stat:"hpRegen",value:2}],tags:["heal"]},{id:"enduring",name:"Enduring",description:"+25 max HP, +15 stamina",weight:30,tier:"rare",allowedItemTypes:["armor"],statMods:[{stat:"maxHP",value:25},{stat:"maxStamina",value:15}],tags:["hp","stamina"]},{id:"invincible",name:"Invincible",description:"+12 defense, 10% damage reduction",weight:15,tier:"epic",allowedItemTypes:["armor"],statMods:[{stat:"defense",value:12},{stat:"damageReduction",value:10,isPercent:!0}],tags:["defense"]},{id:"vampiric_armor",name:"Vampiric",description:"Heal 5% of damage blocked",weight:12,tier:"epic",allowedItemTypes:["armor"],statMods:[{stat:"blockHeal",value:5,isPercent:!0}],tags:["lifesteal","defense"]},{id:"legendary_fortress",name:"Fortress",description:"+20 defense, +40 HP, immune to armor break",weight:5,tier:"legendary",allowedItemTypes:["armor"],statMods:[{stat:"defense",value:20},{stat:"maxHP",value:40},{stat:"armorBreakImmune",value:1}],tags:["defense","hp"]}],Je=[...jt,...Vt];function Xt(c){return Je.find(n=>n.id===c)}function Qt(c){return Je.filter(n=>n.allowedItemTypes.includes(c))}const Kt=[{id:"of_the_fox",name:"of the Fox",description:"+5% dodge while attacking",weight:80,tier:"common",allowedItemTypes:["weapon"],statMods:[{stat:"attackDodge",value:5,isPercent:!0}],tags:["dodge"]},{id:"of_fury",name:"of Fury",description:"+1 momentum on hit",weight:80,tier:"common",allowedItemTypes:["weapon"],statMods:[{stat:"momentumGain",value:1}],tags:["momentum"]},{id:"of_the_bear",name:"of the Bear",description:"+3 damage, -2% speed",weight:70,tier:"common",allowedItemTypes:["weapon"],statMods:[{stat:"damageMin",value:2},{stat:"damageMax",value:3},{stat:"speed",value:-2,isPercent:!0}],tags:["damage"]},{id:"of_reach",name:"of Reach",description:"First attack each fight: +20% accuracy",weight:70,tier:"common",allowedItemTypes:["weapon"],statMods:[{stat:"firstStrikeAccuracy",value:20,isPercent:!0}],tags:["accuracy"]},{id:"of_bloodletting",name:"of Bloodletting",description:"+12% bleed, bleeds stack",weight:50,tier:"uncommon",allowedItemTypes:["weapon"],statMods:[{stat:"bleedChance",value:12,isPercent:!0},{stat:"bleedStack",value:1}],tags:["bleed"]},{id:"of_the_hawk",name:"of the Hawk",description:"+12% crit, +5% accuracy",weight:50,tier:"uncommon",allowedItemTypes:["weapon"],statMods:[{stat:"critChance",value:12,isPercent:!0},{stat:"accuracy",value:5,isPercent:!0}],tags:["crit","accuracy"]},{id:"of_breaking",name:"of Breaking",description:"+2 armor break per hit",weight:45,tier:"uncommon",allowedItemTypes:["weapon"],statMods:[{stat:"armorBreak",value:2}],tags:["armorBreak"]},{id:"of_the_wolf",name:"of the Wolf",description:"+15% damage vs bleeding enemies",weight:45,tier:"uncommon",allowedItemTypes:["weapon"],statMods:[{stat:"bonusVsBleeding",value:15,isPercent:!0}],tags:["bleed","damage"]},{id:"of_endurance",name:"of Endurance",description:"-10 stamina cost, +5 stamina regen",weight:50,tier:"uncommon",allowedItemTypes:["weapon"],statMods:[{stat:"staminaCost",value:-10},{stat:"staminaRegen",value:5}],tags:["stamina"]},{id:"of_the_viper",name:"of the Viper",description:"Crits apply 2 poison stacks",weight:30,tier:"rare",allowedItemTypes:["weapon"],statMods:[{stat:"poisonOnCrit",value:2}],tags:["poison","crit"],proc:{trigger:"on_crit",chance:100,effect:"apply_poison",value:2}},{id:"of_thunder",name:"of Thunder",description:"Heavy attacks: 20% stun chance",weight:30,tier:"rare",allowedItemTypes:["weapon"],statMods:[{stat:"heavyStunChance",value:20,isPercent:!0}],tags:["stun"],proc:{trigger:"on_hit",chance:20,effect:"stun"}},{id:"of_the_arena",name:"of the Arena",description:"+10% damage per momentum tier",weight:25,tier:"rare",allowedItemTypes:["weapon"],statMods:[{stat:"momentumDamageBonus",value:10,isPercent:!0}],tags:["momentum","damage"]},{id:"of_execution",name:"of Execution",description:"+50% damage vs enemies below 25% HP",weight:25,tier:"rare",allowedItemTypes:["weapon"],statMods:[{stat:"executeDamage",value:50,isPercent:!0}],tags:["damage"]},{id:"of_the_crowd",name:"of the Crowd",description:"Kills restore 10 stamina, +5 gold",weight:25,tier:"rare",allowedItemTypes:["weapon"],statMods:[{stat:"killStamina",value:10},{stat:"killGold",value:5}],tags:["stamina","gold"],proc:{trigger:"on_kill",chance:100,effect:"restore_stamina",value:10}},{id:"of_annihilation",name:"of Annihilation",description:"Crits deal +75% damage and ignore defense",weight:15,tier:"epic",allowedItemTypes:["weapon"],statMods:[{stat:"critDamage",value:75,isPercent:!0},{stat:"critIgnoreDefense",value:1}],tags:["crit","damage"]},{id:"of_the_legend",name:"of the Legend",description:"+5 to all stats, +10% fame",weight:12,tier:"epic",allowedItemTypes:["weapon"],statMods:[{stat:"allStats",value:5},{stat:"fameBonus",value:10,isPercent:!0}],tags:["damage","fame"]},{id:"of_the_bloodline",name:"of the Bloodline",description:"Inherits 10% of previous fighter power",weight:10,tier:"epic",allowedItemTypes:["weapon"],statMods:[{stat:"bloodlineInherit",value:10,isPercent:!0}],tags:["bloodline"]},{id:"of_the_champion",name:"of the Champion",description:"Start combat with full momentum, cannot be stunned",weight:5,tier:"legendary",allowedItemTypes:["weapon"],statMods:[{stat:"startingMomentum",value:100},{stat:"stunImmune",value:1}],tags:["momentum","resist"]},{id:"of_endless_battle",name:"of Endless Battle",description:"Each hit: +1 damage permanently (resets each fight)",weight:3,tier:"legendary",allowedItemTypes:["weapon"],statMods:[{stat:"rampingDamage",value:1}],tags:["damage"],proc:{trigger:"on_hit",chance:100,effect:"stack_damage",value:1}}],Jt=[{id:"of_protection",name:"of Protection",description:"+10% block effectiveness",weight:80,tier:"common",allowedItemTypes:["armor"],statMods:[{stat:"blockEffectiveness",value:10,isPercent:!0}],tags:["block"]},{id:"of_the_turtle",name:"of the Turtle",description:"+15% parry window",weight:75,tier:"common",allowedItemTypes:["armor"],statMods:[{stat:"parryWindow",value:15,isPercent:!0}],tags:["parry"]},{id:"of_stamina",name:"of Stamina",description:"+15 max stamina",weight:80,tier:"common",allowedItemTypes:["armor"],statMods:[{stat:"maxStamina",value:15}],tags:["stamina"]},{id:"of_recovery",name:"of Recovery",description:"+3 stamina regen per turn",weight:70,tier:"common",allowedItemTypes:["armor"],statMods:[{stat:"staminaRegen",value:3}],tags:["stamina"]},{id:"of_the_guardian",name:"of the Guardian",description:"Blocking restores 5 stamina",weight:50,tier:"uncommon",allowedItemTypes:["armor"],statMods:[{stat:"blockStamina",value:5}],tags:["block","stamina"],proc:{trigger:"on_block",chance:100,effect:"restore_stamina",value:5}},{id:"of_the_wind",name:"of the Wind",description:"+15% dodge, +5% speed",weight:45,tier:"uncommon",allowedItemTypes:["armor"],statMods:[{stat:"dodge",value:15,isPercent:!0},{stat:"speed",value:5,isPercent:!0}],tags:["dodge","speed"]},{id:"of_the_iron_will",name:"of Iron Will",description:"+35% wound resist",weight:45,tier:"uncommon",allowedItemTypes:["armor"],statMods:[{stat:"woundResist",value:35,isPercent:!0}],tags:["resist","wound"]},{id:"of_thorns",name:"of Thorns",description:"Reflect 5 damage when hit",weight:45,tier:"uncommon",allowedItemTypes:["armor"],statMods:[{stat:"thornsDamage",value:5}],tags:["thorns"]},{id:"of_the_phoenix",name:"of the Phoenix",description:"Once per fight: survive lethal with 1 HP",weight:25,tier:"rare",allowedItemTypes:["armor"],statMods:[{stat:"surviveLethal",value:1}],tags:["hp"],proc:{trigger:"on_low_hp",chance:100,effect:"survive_lethal"}},{id:"of_vitality",name:"of Vitality",description:"+35 max HP, heal 5 on block",weight:30,tier:"rare",allowedItemTypes:["armor"],statMods:[{stat:"maxHP",value:35},{stat:"blockHeal",value:5}],tags:["hp","heal"],proc:{trigger:"on_block",chance:100,effect:"heal",value:5}},{id:"of_the_counter",name:"of the Counter",description:"Perfect parry: counter-attack for 10 damage",weight:25,tier:"rare",allowedItemTypes:["armor"],statMods:[{stat:"counterDamage",value:10}],tags:["parry","damage"]},{id:"of_the_crowd_favorite",name:"of the Crowd Favorite",description:"+20% fame, +5 gold per fight",weight:25,tier:"rare",allowedItemTypes:["armor"],statMods:[{stat:"fameBonus",value:20,isPercent:!0},{stat:"fightGold",value:5}],tags:["fame","gold"]},{id:"of_undying",name:"of the Undying",description:"Heal 10% max HP per turn below 25% HP",weight:15,tier:"epic",allowedItemTypes:["armor"],statMods:[{stat:"lowHPRegen",value:10,isPercent:!0}],tags:["hp","heal"]},{id:"of_the_mountain",name:"of the Mountain",description:"Cannot be knocked back or moved, +50% stagger resist",weight:12,tier:"epic",allowedItemTypes:["armor"],statMods:[{stat:"immovable",value:1},{stat:"staggerResist",value:50,isPercent:!0}],tags:["resist","defense"]},{id:"of_immortality",name:"of Immortality",description:"Take no damage first 2 turns, -20% damage after",weight:5,tier:"legendary",allowedItemTypes:["armor"],statMods:[{stat:"invulnTurns",value:2},{stat:"damageTaken",value:-20,isPercent:!0}],tags:["defense"]},{id:"of_the_arena_master",name:"of the Arena Master",description:"+50% all resist, attacks grant momentum",weight:3,tier:"legendary",allowedItemTypes:["armor"],statMods:[{stat:"allResist",value:50,isPercent:!0},{stat:"momentumOnBlock",value:5}],tags:["resist","momentum"]}],Ze=[...Kt,...Jt];function Zt(c){return Ze.find(n=>n.id===c)}function ea(c){return Ze.filter(n=>n.allowedItemTypes.includes(c))}const et=[{id:"debt",name:"Debt",description:"+30% damage, lose 10% gold after each fight",upside:"+30% damage",downside:"-10% gold per fight",weight:30,tier:"rare",allowedItemTypes:["weapon"],statMods:[{stat:"damagePercent",value:30,isPercent:!0},{stat:"goldLossPerFight",value:10,isPercent:!0}],tags:["damage","gold"]},{id:"bloodprice",name:"Blood Price",description:"+50% crit damage, take 3 damage on crit",upside:"+50% crit damage",downside:"Take 3 damage when you crit",weight:25,tier:"rare",allowedItemTypes:["weapon"],statMods:[{stat:"critDamage",value:50,isPercent:!0},{stat:"selfDamageOnCrit",value:3}],tags:["crit","damage"],proc:{trigger:"on_crit",chance:100,effect:"self_damage",value:3}},{id:"berserker",name:"Berserker",description:"+8 damage, cannot block or parry",upside:"+8 flat damage",downside:"Cannot use block or parry",weight:25,tier:"rare",allowedItemTypes:["weapon"],statMods:[{stat:"damageMin",value:8},{stat:"damageMax",value:8},{stat:"canBlock",value:0},{stat:"canParry",value:0}],tags:["damage"]},{id:"gluttony",name:"Gluttony",description:"Heal 8 on kill, take +25% damage",upside:"Heal 8 HP on kill",downside:"Take 25% more damage",weight:25,tier:"rare",allowedItemTypes:["weapon"],statMods:[{stat:"killHeal",value:8},{stat:"damageTaken",value:25,isPercent:!0}],tags:["lifesteal","damage"],proc:{trigger:"on_kill",chance:100,effect:"heal",value:8}},{id:"hungry",name:"Hunger",description:"+3 damage per turn, lose 2 HP per turn",upside:"+3 damage each turn (stacks)",downside:"Lose 2 HP each turn",weight:20,tier:"epic",allowedItemTypes:["weapon"],statMods:[{stat:"rampingDamage",value:3},{stat:"selfDamagePerTurn",value:2}],tags:["damage","hp"]},{id:"executioner_curse",name:"Executioner",description:"Kills grant +10% damage permanently, start at -20% HP",upside:"Permanent +10% damage per kill",downside:"Start fights at 80% HP",weight:15,tier:"epic",allowedItemTypes:["weapon"],statMods:[{stat:"killDamageStack",value:10,isPercent:!0},{stat:"startingHPPercent",value:-20,isPercent:!0}],tags:["damage"]},{id:"heavy_burden",name:"Heavy Burden",description:"+15 defense, -20% dodge, -10 stamina",upside:"+15 defense",downside:"-20% dodge, -10 max stamina",weight:30,tier:"rare",allowedItemTypes:["armor"],statMods:[{stat:"defense",value:15},{stat:"dodge",value:-20,isPercent:!0},{stat:"maxStamina",value:-10}],tags:["defense","dodge","stamina"]},{id:"glass_cannon",name:"Glass Cannon",description:"+40% damage, -30% max HP",upside:"+40% damage dealt",downside:"-30% max HP",weight:25,tier:"rare",allowedItemTypes:["armor"],statMods:[{stat:"damagePercent",value:40,isPercent:!0},{stat:"maxHPPercent",value:-30,isPercent:!0}],tags:["damage","hp"]},{id:"marked",name:"Marked",description:"+35 HP, enemies deal +15% damage to you",upside:"+35 max HP",downside:"Enemies deal +15% damage to you",weight:25,tier:"rare",allowedItemTypes:["armor"],statMods:[{stat:"maxHP",value:35},{stat:"enemyDamageBonus",value:15,isPercent:!0}],tags:["hp","defense"]},{id:"blood_oath",name:"Blood Oath",description:"Heal 5% damage dealt, bleed for 2/turn",upside:"Lifesteal 5% of damage dealt",downside:"Constantly bleeding (2 damage/turn)",weight:25,tier:"rare",allowedItemTypes:["armor"],statMods:[{stat:"lifesteal",value:5,isPercent:!0},{stat:"selfDamagePerTurn",value:2}],tags:["lifesteal","bleed"]},{id:"cursed_vigor",name:"Cursed Vigor",description:"+50 HP, cannot be healed above 50%",upside:"+50 max HP",downside:"Cannot heal above 50% max HP",weight:20,tier:"epic",allowedItemTypes:["armor"],statMods:[{stat:"maxHP",value:50},{stat:"maxHealPercent",value:50,isPercent:!0}],tags:["hp","heal"]},{id:"doomed",name:"Doomed",description:"Immune to wounds, die instantly at 0 HP (no second chance)",upside:"Completely immune to wounds",downside:"No last-stand chances, instant death at 0 HP",weight:15,tier:"epic",allowedItemTypes:["armor"],statMods:[{stat:"woundImmune",value:1},{stat:"noLastStand",value:1}],tags:["wound","hp"]}];function ta(c){return et.find(n=>n.id===c)}function aa(c){return et.filter(n=>n.allowedItemTypes.includes(c))}function ia(c){switch(c){case"epic":return 20;case"legendary":return 35;default:return 0}}const Ce=Xt,Me=Zt,ge=ta,sa={damageMin:0,damageMax:0,defense:0,maxHP:0,maxStamina:0,staminaCost:0,staminaRegen:0,accuracy:0,critChance:0,critDamage:0,dodge:0,parryWindow:0,speed:0,bleedChance:0,bleedDamage:0,stunChance:0,armorBreak:0,lifesteal:0,thornsDamage:0,momentumGain:0,bleedResist:0,stunResist:0,woundResist:0,armorBreakResist:0,canBlock:!0,canParry:!0,stunImmune:!1,woundImmune:!1,armorBreakImmune:!1,procs:[]};function na(c){switch(c){case"common":return{prefixChance:25,suffixChance:0};case"uncommon":return{prefixChance:60,suffixChance:30};case"rare":return{prefixChance:80,suffixChance:60};case"epic":return{prefixChance:100,suffixChance:80};case"legendary":return{prefixChance:100,suffixChance:100};default:return{prefixChance:0,suffixChance:0}}}function rt(c,n,e){const a=["common","uncommon","rare","epic","legendary"],i=a.indexOf(n),s=Math.min(i+({bronze:0,silver:1,gold:2,champion:3}[e]||0),4),r=c.filter(l=>a.indexOf(l.tier)<=s);if(r.length===0)return null;const o=r.reduce((l,h)=>l+h.weight,0);let d=k.random()*o;for(const l of r)if(d-=l.weight,d<=0)return l;return r[0]}function He(c,n,e){const a={},i=na(n),s={common:"common",uncommon:"uncommon",rare:"rare",epic:"epic",legendary:"legendary"}[n];if(k.random()*100<i.prefixChance){const o=Qt(c),d=rt(o,s,e);d&&(a.prefixId=d.id)}if(k.random()*100<i.suffixChance){const o=ea(c),d=rt(o,s,e);d&&(a.suffixId=d.id)}const r=ia(n);if(r>0&&k.random()*100<r){const o=aa(c);if(o.length>0){const d=k.pick(o);a.curseId=d.id}}return a}function Pe(c,n){for(const e of n)switch(e.stat){case"damageMin":c.damageMin+=e.value;break;case"damageMax":c.damageMax+=e.value;break;case"defense":c.defense+=e.value;break;case"maxHP":c.maxHP+=e.value;break;case"maxStamina":c.maxStamina+=e.value;break;case"staminaCost":c.staminaCost+=e.value;break;case"staminaRegen":c.staminaRegen+=e.value;break;case"accuracy":c.accuracy+=e.value;break;case"critChance":c.critChance+=e.value;break;case"critDamage":c.critDamage+=e.value;break;case"dodge":c.dodge+=e.value;break;case"parryWindow":c.parryWindow+=e.value;break;case"speed":c.speed+=e.value;break;case"bleedChance":c.bleedChance+=e.value;break;case"bleedDamage":c.bleedDamage+=e.value;break;case"stunChance":c.stunChance+=e.value;break;case"armorBreak":c.armorBreak+=e.value;break;case"lifesteal":c.lifesteal+=e.value;break;case"thornsDamage":c.thornsDamage+=e.value;break;case"momentumGain":c.momentumGain+=e.value;break;case"bleedResist":c.bleedResist+=e.value;break;case"stunResist":c.stunResist+=e.value;break;case"woundResist":c.woundResist+=e.value;break;case"armorBreakResist":c.armorBreakResist+=e.value;break;case"canBlock":c.canBlock=e.value!==0;break;case"canParry":c.canParry=e.value!==0;break;case"stunImmune":c.stunImmune=e.value!==0;break;case"woundImmune":c.woundImmune=e.value!==0;break;case"armorBreakImmune":c.armorBreakImmune=e.value!==0;break}}function At(c){const n={...sa,procs:[]};if(c.prefixId){const e=Ce(c.prefixId);e&&(Pe(n,e.statMods),e.proc&&n.procs.push(e.proc))}if(c.suffixId){const e=Me(c.suffixId);e&&(Pe(n,e.statMods),e.proc&&n.procs.push(e.proc))}if(c.curseId){const e=ge(c.curseId);e&&(Pe(n,e.statMods),e.proc&&n.procs.push(e.proc))}return n}function ra(c,n){let e=n;if(c.prefixId){const a=Ce(c.prefixId);a&&(e=`${a.name} ${e}`)}if(c.suffixId){const a=Me(c.suffixId);a&&(e=`${e} ${a.name}`)}if(c.curseId){const a=ge(c.curseId);a&&(e=`${e} (Cursed: ${a.name})`)}return e}function oa(c){const n=[];if(c.prefixId){const e=Ce(c.prefixId);e&&n.push(e.description)}if(c.suffixId){const e=Me(c.suffixId);e&&n.push(e.description)}if(c.curseId){const e=ge(c.curseId);e&&(n.push(`âš ï¸ ${e.upside}`),n.push(`â˜ ï¸ ${e.downside}`))}return n}function he(c){const n=c;return!!(n.prefixId||n.suffixId||n.curseId)}const xe={weaponId:null,armorId:null,helmetId:null,shieldId:null,trinket1Id:null,trinket2Id:null,consumable1Id:null,consumable2Id:null},ca=[{id:"lucky_coin",name:"Lucky Coin",rarity:"common",icon:"ðŸª™",description:"A coin from your first win.",effects:[{type:"stat_bonus",stat:"critChance",value:3,description:"+3% crit chance"}],price:50,sellPrice:17,leagueMin:"bronze"},{id:"fighters_ring",name:"Fighter's Ring",rarity:"common",icon:"ðŸ’",description:"A simple iron ring.",effects:[{type:"stat_bonus",stat:"attack",value:2,description:"+2 Attack"}],price:60,sellPrice:20,leagueMin:"bronze"},{id:"leather_armband",name:"Leather Armband",rarity:"common",icon:"ðŸŽ—ï¸",description:"Reinforced wrist protection.",effects:[{type:"stat_bonus",stat:"defense",value:2,description:"+2 Defense"}],price:55,sellPrice:18,leagueMin:"bronze"},{id:"endurance_pendant",name:"Endurance Pendant",rarity:"uncommon",icon:"ðŸ“¿",description:"Grants stamina when you need it.",effects:[{type:"stat_bonus",stat:"maxStamina",value:15,description:"+15 Max Stamina"},{type:"combat_bonus",stat:"staminaRegen",value:3,description:"+3 Stamina/turn"}],price:120,sellPrice:40,leagueMin:"bronze"},{id:"bloodstone_amulet",name:"Bloodstone Amulet",rarity:"uncommon",icon:"ðŸ”´",description:"Absorbs blood to heal.",effects:[{type:"passive",value:10,description:"Heal 10% of bleed damage dealt"}],price:140,sellPrice:48,leagueMin:"bronze"},{id:"crowd_favor_token",name:"Crowd Favor Token",rarity:"uncommon",icon:"ðŸŽ­",description:"The crowd loves you.",effects:[{type:"combat_bonus",stat:"momentumGain",value:25,description:"+25% Momentum gain"}],price:130,sellPrice:45,leagueMin:"bronze"},{id:"champions_signet",name:"Champion's Signet",rarity:"rare",icon:"ðŸ’Ž",description:"Ring of a former champion.",effects:[{type:"stat_bonus",stat:"attack",value:4,description:"+4 Attack"},{type:"stat_bonus",stat:"critChance",value:5,description:"+5% Crit"}],price:250,sellPrice:85,leagueMin:"silver"},{id:"iron_will_charm",name:"Iron Will Charm",rarity:"rare",icon:"ðŸ§¿",description:"Protects against fear and control.",effects:[{type:"passive",value:50,description:"50% stun resistance"},{type:"stat_bonus",stat:"maxFocus",value:10,description:"+10 Max Focus"}],price:220,sellPrice:75,leagueMin:"silver"},{id:"berserker_fang",name:"Berserker's Fang",rarity:"rare",icon:"ðŸ¦·",description:"Power through pain.",effects:[{type:"passive",value:1,description:"+1% damage per 5% HP missing"}],price:280,sellPrice:95,leagueMin:"silver"},{id:"executioners_eye",name:"Executioner's Eye",rarity:"epic",icon:"ðŸ‘ï¸",description:"Sees the killing blow.",effects:[{type:"stat_bonus",stat:"critChance",value:10,description:"+10% Crit"},{type:"stat_bonus",stat:"critDamage",value:25,description:"+25% Crit Damage"}],price:450,sellPrice:150,leagueMin:"gold"},{id:"phoenix_feather",name:"Phoenix Feather",rarity:"legendary",icon:"ðŸª¶",description:"Rise from death once.",effects:[{type:"passive",value:30,description:"Once per fight: Revive at 30% HP when killed"}],price:800,sellPrice:270,leagueMin:"gold"}],da=[{id:"bandage",name:"Bandage",rarity:"common",icon:"ðŸ©¹",description:"Basic wound care.",usesPerFight:2,effect:{type:"heal",value:20,description:"Heal 20 HP"},price:15,sellPrice:5,leagueMin:"bronze"},{id:"healing_salve",name:"Healing Salve",rarity:"uncommon",icon:"ðŸ§´",description:"Potent healing mixture.",usesPerFight:1,effect:{type:"heal",value:50,description:"Heal 50 HP"},price:40,sellPrice:14,leagueMin:"bronze"},{id:"stamina_tonic",name:"Stamina Tonic",rarity:"common",icon:"âš—ï¸",description:"Restores energy.",usesPerFight:2,effect:{type:"stamina",value:40,description:"Restore 40 Stamina"},price:20,sellPrice:7,leagueMin:"bronze"},{id:"focus_elixir",name:"Focus Elixir",rarity:"uncommon",icon:"ðŸ§ª",description:"Sharpens the mind.",usesPerFight:1,effect:{type:"focus",value:30,description:"Gain 30 Focus"},price:35,sellPrice:12,leagueMin:"bronze"},{id:"antidote",name:"Antidote",rarity:"common",icon:"ðŸ’Š",description:"Cures poison.",usesPerFight:2,effect:{type:"cure",value:1,description:"Remove poison effect"},price:25,sellPrice:8,leagueMin:"bronze"},{id:"rage_potion",name:"Rage Potion",rarity:"rare",icon:"ðŸ”´",description:"Temporary power surge.",usesPerFight:1,effect:{type:"buff",value:25,duration:3,description:"+25% Damage for 3 turns"},price:80,sellPrice:28,leagueMin:"silver"},{id:"iron_skin_draft",name:"Iron Skin Draft",rarity:"rare",icon:"ðŸ›¡ï¸",description:"Temporary defense boost.",usesPerFight:1,effect:{type:"buff",value:30,duration:3,description:"+30% Defense for 3 turns"},price:75,sellPrice:25,leagueMin:"silver"},{id:"throwing_knife",name:"Throwing Knife",rarity:"uncommon",icon:"ðŸ—¡ï¸",description:"Ranged surprise attack.",usesPerFight:3,effect:{type:"damage",value:15,description:"Deal 15 damage instantly"},price:30,sellPrice:10,leagueMin:"bronze"},{id:"flash_powder",name:"Flash Powder",rarity:"rare",icon:"âœ¨",description:"Blind and stun briefly.",usesPerFight:1,effect:{type:"buff",value:1,duration:1,description:"Enemy skips next turn"},price:100,sellPrice:35,leagueMin:"silver"},{id:"champions_brew",name:"Champion's Brew",rarity:"epic",icon:"ðŸº",description:"The drink of legends.",usesPerFight:1,effect:{type:"buff",value:15,duration:5,description:"+15% to all stats for 5 turns"},price:200,sellPrice:68,leagueMin:"gold"}];function Bt(c){return ca.find(n=>n.id===c)}function la(c){return da.find(n=>n.id===c)}function ha(){return`item_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}function ue(c,n,e,a=1,i){const t={instanceId:ha(),itemId:c,itemType:n,slot:e,quantity:a,acquired:Date.now()};return i&&(i.prefixId&&(t.prefixId=i.prefixId),i.suffixId&&(t.suffixId=i.suffixId),i.curseId&&(t.curseId=i.curseId)),t}function ot(c,n,e,a,i){const t=He(n,e,a);return ue(c,n,i,1,t)}function z(c){switch(c.itemType){case"weapon":return Qe(c.itemId);case"armor":return _t(c.itemId);case"trinket":return Bt(c.itemId);case"consumable":return la(c.itemId);default:return}}function j(c){const n=z(c),e=(n==null?void 0:n.name)||"Unknown Item";return c.prefixId||c.suffixId||c.curseId?ra(c,e):e}function fe(c){const n=z(c);return(n==null?void 0:n.icon)||"â“"}function ee(c){const n=z(c);return(n==null?void 0:n.rarity)||"common"}const ct={damageMin:5,damageMax:8,accuracyMod:0,critChanceMod:0,speedMod:0,totalDefense:2,staminaRegenMod:0,dodgeMod:0,weaponEffects:[],armorPerks:[],bleedResist:0,stunResist:0,poisonResist:0,critResist:0};function tt(c,n){const e={damageMin:5,damageMax:8,lightStaminaCost:10,heavyStaminaCost:22,accuracyMod:0,critChanceMod:0,speedMod:0,totalDefense:0,staminaRegenMod:0,dodgeMod:0,weaponEffects:[],armorPerks:[],trinketEffects:[],bleedResist:0,stunResist:0,poisonResist:0,critResist:0};if(n.weaponId){const s=c.find(r=>r.instanceId===n.weaponId);if(s){const r=Qe(s.itemId);r&&(e.damageMin=r.damageMin,e.damageMax=r.damageMax,e.lightStaminaCost=r.lightStaminaCost,e.heavyStaminaCost=r.heavyStaminaCost,e.accuracyMod+=r.accuracyMod,e.critChanceMod+=r.critChanceMod,e.speedMod+=r.speedMod,e.weaponEffects=r.effects.map(o=>o.description))}}const a=[n.armorId,n.helmetId,n.shieldId];for(const s of a)if(s){const r=c.find(o=>o.instanceId===s);if(r){const o=_t(r.itemId);if(o){e.totalDefense+=o.defense,e.staminaRegenMod+=o.staminaRegenMod,e.dodgeMod+=o.dodgeMod,e.speedMod+=o.speedMod;for(const d of o.perks)switch(e.armorPerks.push(d.description),d.type){case"bleed_resist":e.bleedResist+=d.value;break;case"stun_resist":e.stunResist+=d.value;break;case"poison_resist":e.poisonResist+=d.value;break;case"crit_resist":e.critResist+=d.value;break;case"dodge_boost":e.dodgeMod+=d.value;break}}}}const i=[n.trinket1Id,n.trinket2Id];for(const s of i)if(s){const r=c.find(o=>o.instanceId===s);if(r){const o=Bt(r.itemId);if(o){for(const d of o.effects)if(e.trinketEffects.push(d.description),d.type==="stat_bonus"&&d.stat)switch(d.stat){case"attack":e.damageMin+=d.value,e.damageMax+=d.value;break;case"defense":e.totalDefense+=d.value;break;case"critChance":e.critChanceMod+=d.value;break}}}}const t=[n.weaponId,n.armorId,n.helmetId,n.shieldId].filter(Boolean);for(const s of t){const r=c.find(o=>o.instanceId===s);if(r&&(r.prefixId||r.suffixId||r.curseId)){const o=At(r);e.damageMin+=o.damageMin,e.damageMax+=o.damageMax,e.totalDefense+=o.defense,e.critChanceMod+=o.critChance,e.accuracyMod+=o.accuracy,e.dodgeMod+=o.dodge,e.speedMod+=o.speed,e.staminaRegenMod+=o.staminaRegen,e.lightStaminaCost+=o.staminaCost,e.heavyStaminaCost+=o.staminaCost,e.bleedResist+=o.bleedResist,e.stunResist+=o.stunResist}}return e}function _e(){return[ue("rusty_sword","weapon"),ue("tattered_tunic","armor","body"),ue("bandage","consumable",void 0,3)]}function Ae(c){const n={...xe},e=c.find(i=>i.itemType==="weapon");e&&(n.weaponId=e.instanceId);const a=c.find(i=>i.itemType==="armor"&&i.slot==="body");return a&&(n.armorId=a.instanceId),n}const Z={common:8947848,uncommon:2280482,rare:3377407,epic:11158783,legendary:16755200},dt={common:"Common",uncommon:"Uncommon",rare:"Rare",epic:"Epic",legendary:"Legendary"},se=7,lt="bloodline_arena_save",ht={reduceMotion:!1,screenShake:!0,bloodFX:!0,grainFX:!0,soundEnabled:!0,musicVolume:.7,sfxVolume:.8,showDamageNumbers:!0,showTimingRing:!0,autoSave:!0,debugMode:!1},Le={totalDamageDealt:0,totalDamageTaken:0,totalPerfectParries:0,totalItemsUsed:0,totalGoldEarned:0,totalFameEarned:0,highestStreak:0,championsDefeated:0,rivalsDefeated:0,fightsWithNoDamage:0,bleedDeaths:0,maxSingleDamage:0},we={seed:0,week:0,league:"bronze",fightsInLeague:0,fightsToNextLeague:3,gold:50,fame:0,fighter:null,archetypeId:"gladiator",promise:null,rivalId:null,friendId:null,completedVignettes:[],lettersWritten:[],lastCampAction:null,inProgress:!1,relics:[],relicPityCounter:0,activeModifiers:[],activeDecreeIds:[],decreeDraftCompleted:!1,seenDecreeIds:[],seenAffixIds:[],seenMutatorIds:[],fightsSinceRelic:0,consecutiveWins:0,debt:0,debtFightsRemaining:0,fatigue:0,techniques:{},sparringInjuries:[],seals:0,savedLetters:[],embers:0,masteryPoints:0,weaponMastery:{},signatureId:null,signatureLevel:1,signatureXP:0,runMap:null,activeContracts:[],completedContracts:[],inventory:[],loadout:{...xe},currentMomentum:0,currentStance:"balanced",activeWounds:[],armorBreakStacks:0,adrenalineUsed:!1,seenEnemyClasses:[],trainingHistory:[],lastFightResult:null,customization:{philosophyId:null,backgroundId:null,startingTechniqueId:null,cosmetics:{firstName:"",lastName:"",nickname:"",faceIndex:0,eyeIndex:0,hairIndex:0,beardIndex:0,scarIndex:0,warpaintIndex:0,hoodIndex:0,skinTone:"#d4a574",hairColor:"#3d2314",eyeColor:"#5a4a3a",accentColor:"#8b0000"}}},Be={promoterXP:0,promoterLevel:1,bloodlinePoints:0,letterStamps:0,unlockedPerks:[],unlockedArchetypes:["gladiator"],hallOfLegends:[],heirlooms:[],totalRuns:0,totalWins:0,totalDeaths:0,ghostMoments:[],lifetimeStats:{...Le},letterCounts:{},unlockedLetterRewards:[],purchasedStampRewards:[]};class ua{constructor(){m(this,"data");m(this,"autoSaveInterval",null);this.data=this.getDefaultData()}getDefaultData(){return{version:se,settings:{...ht},run:{...we},meta:{...Be},lastSaved:Date.now()}}load(){try{const n=localStorage.getItem(lt);if(n){const e=JSON.parse(n);return e.version!==se?(console.log(`Migrating save from v${e.version} to v${se}`),this.migrate(e)):this.data=this.mergeWithDefaults(e),console.log("Save data loaded successfully"),!0}}catch(n){console.error("Failed to load save data:",n)}return this.data=this.getDefaultData(),!1}mergeWithDefaults(n){var e,a,i,t,s,r,o,d,l,h,u,f,g,y,S,b,M,C,x,R,B;return{version:se,settings:{...ht,...n.settings},run:{...we,...n.run,relics:((e=n.run)==null?void 0:e.relics)||[],lettersWritten:((a=n.run)==null?void 0:a.lettersWritten)||[],activeModifiers:((i=n.run)==null?void 0:i.activeModifiers)||[],sparringInjuries:((t=n.run)==null?void 0:t.sparringInjuries)||[],savedLetters:((s=n.run)==null?void 0:s.savedLetters)||[],inventory:((r=n.run)==null?void 0:r.inventory)||[],activeWounds:((o=n.run)==null?void 0:o.activeWounds)||[],seenEnemyClasses:((d=n.run)==null?void 0:d.seenEnemyClasses)||[],trainingHistory:((l=n.run)==null?void 0:l.trainingHistory)||[],techniques:((h=n.run)==null?void 0:h.techniques)||{},loadout:((u=n.run)==null?void 0:u.loadout)||{...xe},fatigue:((f=n.run)==null?void 0:f.fatigue)||0,seals:((g=n.run)==null?void 0:g.seals)||0,currentMomentum:((y=n.run)==null?void 0:y.currentMomentum)||0,armorBreakStacks:((S=n.run)==null?void 0:S.armorBreakStacks)||0,currentStance:((b=n.run)==null?void 0:b.currentStance)||"balanced",adrenalineUsed:((M=n.run)==null?void 0:M.adrenalineUsed)||!1,lastFightResult:((C=n.run)==null?void 0:C.lastFightResult)||null},meta:{...Be,...n.meta,lifetimeStats:{...Le,...(x=n.meta)==null?void 0:x.lifetimeStats},letterCounts:((R=n.meta)==null?void 0:R.letterCounts)||{},unlockedArchetypes:((B=n.meta)==null?void 0:B.unlockedArchetypes)||["gladiator"]},lastSaved:n.lastSaved||Date.now()}}migrate(n){var a,i,t,s,r,o,d,l,h,u,f,g,y,S,b,M,C;let e=n;if(e.version===1){if(console.log("Migrating v1 -> v2: Adding relics, archetypes, letters"),e.run={...we,...e.run,relics:[],relicPityCounter:0,activeModifiers:[],fightsSinceRelic:0,consecutiveWins:0,debt:0,debtFightsRemaining:0,archetypeId:"gladiator",lettersWritten:[]},e.meta={...Be,...e.meta,letterStamps:0,unlockedArchetypes:["gladiator"],lifetimeStats:{...Le},letterCounts:{},unlockedLetterRewards:[],purchasedStampRewards:[]},Array.isArray(e.run.lettersWritten)){const x=e.run.lettersWritten;x.length>0&&typeof x[0]=="string"&&(e.run.lettersWritten=[])}e.version=2}if(e.version===2&&(console.log("Migrating v2 -> v3: Adding training system and seals"),e.run={...e.run,fatigue:0,techniques:{},sparringInjuries:[],seals:0,savedLetters:[]},e.version=3),e.version===3){console.log("Migrating v3 -> v4: Adding inventory, loadout, intensity mechanics");const x=e.run.inProgress?_e():[],R=x.length>0?Ae(x):{...xe};e.run={...e.run,inventory:x,loadout:R,currentMomentum:0,currentStance:"balanced",activeWounds:[],armorBreakStacks:0,adrenalineUsed:!1,seenEnemyClasses:[],trainingHistory:[],lastFightResult:null},e.version=4}e.version===4&&(console.log("Migrating v4 -> v5: Adding customization system"),e.run={...e.run,customization:{philosophyId:null,backgroundId:null,startingTechniqueId:null,cosmetics:{firstName:((a=e.run.fighter)==null?void 0:a.firstName)||"",lastName:((i=e.run.fighter)==null?void 0:i.lastName)||"",nickname:((t=e.run.fighter)==null?void 0:t.nickname)||"",faceIndex:((r=(s=e.run.fighter)==null?void 0:s.portrait)==null?void 0:r.baseIndex)||0,eyeIndex:((d=(o=e.run.fighter)==null?void 0:o.portrait)==null?void 0:d.eyeIndex)||0,hairIndex:((h=(l=e.run.fighter)==null?void 0:l.portrait)==null?void 0:h.hairIndex)||0,beardIndex:((f=(u=e.run.fighter)==null?void 0:u.portrait)==null?void 0:f.beardIndex)||0,scarIndex:((y=(g=e.run.fighter)==null?void 0:g.portrait)==null?void 0:y.scarIndex)||0,warpaintIndex:0,hoodIndex:0,skinTone:((b=(S=e.run.fighter)==null?void 0:S.portrait)==null?void 0:b.skinTone)||"#d4a574",hairColor:((C=(M=e.run.fighter)==null?void 0:M.portrait)==null?void 0:C.hairColor)||"#3d2314",eyeColor:"#5a4a3a",accentColor:"#8b0000"}}},e.version=5),e.version===5&&(console.log("Migrating v5 -> v6: Adding affixes, decrees, mutators tracking"),e.run={...e.run,activeDecreeIds:[],decreeDraftCompleted:!1,seenDecreeIds:[],seenAffixIds:[],seenMutatorIds:[]},e.version=6),e.version===6&&(console.log("Migrating v6 -> v7: Adding forge, mastery, signatures, run map, contracts"),e.run={...e.run,embers:0,masteryPoints:0,weaponMastery:{},signatureId:null,signatureLevel:1,signatureXP:0,runMap:null,activeContracts:[],completedContracts:[]},e.version=7),this.data=this.mergeWithDefaults(e),this.data.version=se,this.save()}save(){try{return this.data.lastSaved=Date.now(),localStorage.setItem(lt,JSON.stringify(this.data)),!0}catch(n){return console.error("Failed to save game:",n),!1}}startAutoSave(n=3e4){this.stopAutoSave(),this.data.settings.autoSave&&(this.autoSaveInterval=window.setInterval(()=>{this.save()},n))}stopAutoSave(){this.autoSaveInterval!==null&&(clearInterval(this.autoSaveInterval),this.autoSaveInterval=null)}getSettings(){return{...this.data.settings}}updateSettings(n){this.data.settings={...this.data.settings,...n},this.save()}getRun(){return{...this.data.run}}updateRun(n){this.data.run={...this.data.run,...n},this.save()}hasActiveRun(){return this.data.run.inProgress&&this.data.run.fighter!==null}startNewRun(n,e="gladiator"){const a=_e();this.data.run={...we,seed:n??Math.floor(Math.random()*2147483647),archetypeId:e,inProgress:!0,inventory:a,loadout:Ae(a)},this.data.meta.totalRuns++,this.save()}endRun(n){n?this.data.meta.totalWins++:this.data.meta.totalDeaths++,this.data.run.consecutiveWins>this.data.meta.lifetimeStats.highestStreak&&(this.data.meta.lifetimeStats.highestStreak=this.data.run.consecutiveWins),this.data.run.inProgress=!1,this.save()}getMeta(){return{...this.data.meta}}updateMeta(n){this.data.meta={...this.data.meta,...n},this.save()}updateLifetimeStat(n,e){this.data.meta.lifetimeStats[n]+=e,this.save()}getLifetimeStats(){return{...this.data.meta.lifetimeStats}}addPromoterXP(n){this.data.meta.promoterXP+=n;const e=Math.floor(this.data.meta.promoterXP/100)+1;e>this.data.meta.promoterLevel&&(this.data.meta.promoterLevel=e,this.data.meta.bloodlinePoints+=e),this.save()}addBloodlinePoints(n){this.data.meta.bloodlinePoints+=n,this.save()}spendBloodlinePoints(n){return this.data.meta.bloodlinePoints>=n?(this.data.meta.bloodlinePoints-=n,this.save(),!0):!1}addLetterStamps(n){this.data.meta.letterStamps+=n,this.save()}spendLetterStamps(n){return this.data.meta.letterStamps>=n?(this.data.meta.letterStamps-=n,this.save(),!0):!1}getLetterStamps(){return this.data.meta.letterStamps}incrementLetterCount(n){this.data.meta.letterCounts[n]=(this.data.meta.letterCounts[n]||0)+1,this.save()}getLetterCount(n){return this.data.meta.letterCounts[n]||0}unlockLetterReward(n){this.data.meta.unlockedLetterRewards.includes(n)||(this.data.meta.unlockedLetterRewards.push(n),this.save())}hasLetterReward(n){return this.data.meta.unlockedLetterRewards.includes(n)}addRelic(n){this.data.run.relics.includes(n)||(this.data.run.relics.push(n),this.data.run.fightsSinceRelic=0,this.data.run.relicPityCounter=0,this.save())}getRelics(){return[...this.data.run.relics]}incrementRelicPity(){this.data.run.relicPityCounter++,this.data.run.fightsSinceRelic++,this.save()}unlockArchetype(n){this.data.meta.unlockedArchetypes.includes(n)||(this.data.meta.unlockedArchetypes.push(n),this.save())}isArchetypeUnlocked(n){return this.data.meta.unlockedArchetypes.includes(n)}getUnlockedArchetypes(){return[...this.data.meta.unlockedArchetypes]}unlockPerk(n){this.data.meta.unlockedPerks.includes(n)||(this.data.meta.unlockedPerks.push(n),this.save())}hasPerk(n){return this.data.meta.unlockedPerks.includes(n)}addToHallOfLegends(n){this.data.meta.hallOfLegends.push(n),this.save()}getHallOfLegends(){return[...this.data.meta.hallOfLegends]}addHeirloom(n){this.data.meta.heirlooms.push(n),this.save()}getHeirlooms(){return[...this.data.meta.heirlooms]}addGhostMoment(n){this.data.meta.ghostMoments.push(n),this.save()}getUntriggeredGhostMoments(){return this.data.meta.ghostMoments.filter(n=>!n.triggered)}triggerGhostMoment(n,e){const a=this.data.meta.ghostMoments.find(i=>i.fighterId===n&&i.type===e&&!i.triggered);a&&(a.triggered=!0,this.save())}addDebt(n,e){this.data.run.debt+=n,this.data.run.debtFightsRemaining=Math.max(this.data.run.debtFightsRemaining,e),this.save()}collectDebt(){if(this.data.run.debt>0&&this.data.run.debtFightsRemaining>0){const n=Math.ceil(this.data.run.debt/this.data.run.debtFightsRemaining);return this.data.run.debt-=n,this.data.run.debtFightsRemaining--,this.save(),n}return 0}resetAllData(){this.data=this.getDefaultData(),this.save(),console.log("All save data has been reset")}exportSave(){return JSON.stringify(this.data,null,2)}importSave(n){try{const e=JSON.parse(n);return e.version!==se?this.migrate(e):this.data=this.mergeWithDefaults(e),this.save(),!0}catch(e){return console.error("Failed to import save:",e),!1}}getSaveVersion(){return this.data.version}addFatigue(n){this.data.run.fatigue=Math.min(100,Math.max(0,this.data.run.fatigue+n)),this.save()}reduceFatigue(n){this.data.run.fatigue=Math.max(0,this.data.run.fatigue-n),this.save()}getFatigue(){return this.data.run.fatigue}setTechniqueLevel(n,e){this.data.run.techniques[n]=e,this.save()}getTechniqueLevel(n){return this.data.run.techniques[n]||0}getTechniques(){return{...this.data.run.techniques}}addSparringInjury(n){this.data.run.sparringInjuries.includes(n)||(this.data.run.sparringInjuries.push(n),this.save())}clearSparringInjuries(){this.data.run.sparringInjuries=[],this.save()}getSparringInjuries(){return[...this.data.run.sparringInjuries]}addSeals(n){this.data.run.seals+=n,this.save()}spendSeals(n){return this.data.run.seals>=n?(this.data.run.seals-=n,this.save(),!0):!1}getSeals(){return this.data.run.seals}saveLetter(n){this.data.run.savedLetters.includes(n)||(this.data.run.savedLetters.push(n),this.save())}useSavedLetter(n){const e=this.data.run.savedLetters.indexOf(n);return e>-1?(this.data.run.savedLetters.splice(e,1),this.save(),!0):!1}getSavedLetters(){return[...this.data.run.savedLetters]}getInventory(){return[...this.data.run.inventory]}addItem(n){if(n.itemType==="consumable"){const e=this.data.run.inventory.find(a=>a.itemId===n.itemId&&a.itemType==="consumable");if(e){e.quantity+=n.quantity,this.save();return}}this.data.run.inventory.push(n),this.save()}removeItem(n){const e=this.data.run.inventory.findIndex(a=>a.instanceId===n);return e>-1?(this.data.run.inventory.splice(e,1),this.unequipItem(n),this.save(),!0):!1}updateItemQuantity(n,e){const a=this.data.run.inventory.find(i=>i.instanceId===n);a&&(a.quantity=e,a.quantity<=0?this.removeItem(n):this.save())}updateItem(n){const e=this.data.run.inventory.findIndex(a=>a.instanceId===n.instanceId);e>=0&&(this.data.run.inventory[e]={...n},this.save(),console.log("[SaveSystem] Updated item:",n.instanceId))}getLoadout(){return{...this.data.run.loadout}}equipItem(n,e){this.data.run.loadout[e]=n,this.save()}unequipItem(n){const e=this.data.run.loadout;for(const a of Object.keys(e))e[a]===n&&(e[a]=null);this.save()}setLoadout(n){this.data.run.loadout={...n},this.save()}getMomentum(){return this.data.run.currentMomentum}setMomentum(n){this.data.run.currentMomentum=Math.max(0,Math.min(100,n)),this.save()}addMomentum(n){this.setMomentum(this.data.run.currentMomentum+n)}getStance(){return this.data.run.currentStance}setStance(n){this.data.run.currentStance=n,this.save()}getWounds(){return[...this.data.run.activeWounds]}addWound(n){this.data.run.activeWounds.push(n),this.save()}clearWounds(){this.data.run.activeWounds=[],this.save()}getArmorBreakStacks(){return this.data.run.armorBreakStacks}setArmorBreakStacks(n){this.data.run.armorBreakStacks=Math.max(0,Math.min(10,n)),this.save()}isAdrenalineUsed(){return this.data.run.adrenalineUsed}useAdrenaline(){this.data.run.adrenalineUsed=!0,this.save()}resetAdrenaline(){this.data.run.adrenalineUsed=!1,this.save()}markEnemyClassSeen(n){this.data.run.seenEnemyClasses.includes(n)||(this.data.run.seenEnemyClasses.push(n),this.save())}hasSeenEnemyClass(n){return this.data.run.seenEnemyClasses.includes(n)}getSeenEnemyClasses(){return[...this.data.run.seenEnemyClasses]}addTrainingHistory(n){this.data.run.trainingHistory.push(n),this.data.run.trainingHistory.length>10&&this.data.run.trainingHistory.shift(),this.save()}getTrainingHistory(){return[...this.data.run.trainingHistory]}getLastTraining(){const n=this.data.run.trainingHistory;return n.length>0?n[n.length-1]:null}setLastFightResult(n){this.data.run.lastFightResult=n,this.save()}getLastFightResult(){return this.data.run.lastFightResult}resetCombatState(){this.data.run.currentMomentum=0,this.data.run.armorBreakStacks=0,this.data.run.activeWounds=[],this.data.run.adrenalineUsed=!1,this.save()}initializeStarterInventory(){const n=_e();this.data.run.inventory=n,this.data.run.loadout=Ae(n),this.save()}getCustomization(){return{...this.data.run.customization}}setCustomization(n){this.data.run.customization={...this.data.run.customization,...n,cosmetics:{...this.data.run.customization.cosmetics,...n.cosmetics||{}}},this.save()}setPhilosophy(n){this.data.run.customization.philosophyId=n,this.save()}setBackground(n){this.data.run.customization.backgroundId=n,this.save()}setStartingTechnique(n){this.data.run.customization.startingTechniqueId=n,this.save()}setCosmetics(n){this.data.run.customization.cosmetics={...this.data.run.customization.cosmetics,...n},this.save()}getCosmetics(){return{...this.data.run.customization.cosmetics}}applyCustomizationToFighter(){const n=this.data.run.fighter;if(!n)return;const a=this.data.run.customization.cosmetics;a.firstName&&(n.firstName=a.firstName),a.lastName&&(n.lastName=a.lastName),a.nickname&&(n.nickname=a.nickname),n.fullName=`${n.firstName} ${n.lastName}`,n.portrait={...n.portrait,baseIndex:a.faceIndex,eyeIndex:a.eyeIndex,hairIndex:a.hairIndex,beardIndex:a.beardIndex,scarIndex:a.scarIndex,skinTone:a.skinTone,hairColor:a.hairColor},this.save()}getActiveDecrees(){return[...this.data.run.activeDecreeIds||[]]}addDecree(n){this.data.run.activeDecreeIds||(this.data.run.activeDecreeIds=[]),this.data.run.activeDecreeIds.includes(n)||this.data.run.activeDecreeIds.push(n),this.markDecreeSeen(n),this.save()}removeDecree(n){this.data.run.activeDecreeIds&&(this.data.run.activeDecreeIds=this.data.run.activeDecreeIds.filter(e=>e!==n),this.save())}isDecreeDraftCompleted(){return this.data.run.decreeDraftCompleted||!1}completeDecreeDraft(){this.data.run.decreeDraftCompleted=!0,this.save()}markDecreeSeen(n){this.data.run.seenDecreeIds||(this.data.run.seenDecreeIds=[]),this.data.run.seenDecreeIds.includes(n)||this.data.run.seenDecreeIds.push(n)}isDecreeNew(n){return!(this.data.run.seenDecreeIds||[]).includes(n)}markAffixSeen(n){this.data.run.seenAffixIds||(this.data.run.seenAffixIds=[]),this.data.run.seenAffixIds.includes(n)||this.data.run.seenAffixIds.push(n)}isAffixNew(n){return!(this.data.run.seenAffixIds||[]).includes(n)}markMutatorSeen(n){this.data.run.seenMutatorIds||(this.data.run.seenMutatorIds=[]),this.data.run.seenMutatorIds.includes(n)||this.data.run.seenMutatorIds.push(n)}isMutatorNew(n){return!(this.data.run.seenMutatorIds||[]).includes(n)}}const p=new ua;class fa{constructor(n){m(this,"scene");this.scene=n}generateUIAssets(){this.generateParchmentOverlay(),this.generateVignette(),this.generateParticle()}generatePortraitAssets(){}generateArenaAssets(){this.generateArenaOverlay(),this.generateCrowdSilhouette()}generateEffectAssets(){this.generateSpark(),this.generateBloodDrop(),this.generateDustPuff()}generateIconAssets(){}generateParchmentOverlay(){const e=this.scene.make.graphics({x:0,y:0});for(let a=0;a<512;a+=4)for(let i=0;i<512;i+=4){const t=Math.random()*.1,s=w.Display.Color.GetColor(Math.floor(180+t*30),Math.floor(160+t*30),Math.floor(120+t*30));e.fillStyle(s,.02+Math.random()*.03),e.fillRect(i,a,4,4)}for(let a=0;a<20;a++){const i=Math.random()*512,t=Math.random()*512,s=20+Math.random()*40;e.fillStyle(9139029,.02),e.fillCircle(i,t,s)}e.generateTexture("parchment_overlay",512,512),e.destroy()}generateVignette(){const e=this.scene.make.graphics({x:0,y:0}),a=512/2,i=512/2,t=512*.7;for(let s=t;s>0;s-=2){const r=Math.pow(1-s/t,2)*.8;e.fillStyle(0,r*.1),e.fillCircle(a,i,s)}e.fillStyle(0,.3),e.fillRect(0,0,512,30),e.fillRect(0,482,512,30),e.fillRect(0,0,30,512),e.fillRect(482,0,30,512),e.generateTexture("vignette",512,512),e.destroy()}generateParticle(){const e=this.scene.make.graphics({x:0,y:0});for(let a=16/2;a>0;a--){const i=a/8;e.fillStyle(16777215,i),e.fillCircle(16/2,16/2,a)}e.generateTexture("particle",16,16),e.destroy()}generateArenaOverlay(){const a=this.scene.make.graphics({x:0,y:0});a.fillGradientStyle(0,0,1709072,1709072,.3),a.fillRect(0,0,512,512);for(let i=0;i<5;i++){const t=102.4*i;a.fillStyle(0,.05+i*.02),a.fillRect(0,t,512,512/10)}a.fillStyle(16753920,.03),a.fillCircle(50,100,80),a.fillCircle(462,100,80),a.generateTexture("arena_overlay",512,512),a.destroy()}generateCrowdSilhouette(){const a=this.scene.make.graphics({x:0,y:0});a.fillStyle(1709072,1);for(let i=0;i<256;i+=20){const t=8+Math.random()*6,s=44+Math.random()*10;a.fillCircle(i+10,s,t),a.fillRect(i+2,s+t-2,16,20)}a.generateTexture("crowd_silhouette",256,64),a.destroy()}generateSpark(){const e=this.scene.make.graphics({x:0,y:0});e.fillStyle(16776960,1),e.fillCircle(8/2,8/2,8/4),e.fillStyle(16753920,.5),e.fillCircle(8/2,8/2,8/2),e.generateTexture("spark",8,8),e.destroy()}generateBloodDrop(){const e=this.scene.make.graphics({x:0,y:0});e.fillStyle(9109504,1),e.fillCircle(12/2,12/2+2,12/3),e.fillTriangle(12/2,0,12/2-12/4,12/2,12/2+12/4,12/2),e.generateTexture("blood_drop",12,12),e.destroy()}generateDustPuff(){const e=this.scene.make.graphics({x:0,y:0});for(let a=0;a<5;a++){const i=16+(Math.random()-.5)*32*.4,t=32/2+(Math.random()-.5)*32*.4,s=4+Math.random()*6;e.fillStyle(9139029,.2),e.fillCircle(i,t,s)}e.generateTexture("dust_puff",32,32),e.destroy()}static generateIcon(n,e,a,i=32){const t=n.make.graphics({x:0,y:0});a(t,i),t.generateTexture(e,i,i),t.destroy()}}function ma(c){return`./${c.replace(/^\/+/,"")}`}class ga extends w.Scene{constructor(){super({key:"PreloadScene"});m(this,"diag",{totalToLoad:0,totalComplete:0,totalFailed:0,lastFileKey:"",lastFileUrl:"",failedFiles:[],startTime:0});m(this,"progressBar");m(this,"diagText");m(this,"statusText");m(this,"failedText");m(this,"retryBtn");m(this,"continueBtn");m(this,"loadComplete",!1);m(this,"timedOut",!1);m(this,"transitionStarted",!1);m(this,"timeoutTimer");m(this,"TIMEOUT_MS",8e3);m(this,"BAR_WIDTH",260);m(this,"BAR_HEIGHT",18)}init(){this.diag={totalToLoad:0,totalComplete:0,totalFailed:0,lastFileKey:"",lastFileUrl:"",failedFiles:[],startTime:Date.now()},this.loadComplete=!1,this.timedOut=!1,this.transitionStarted=!1,console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),console.log("[PRELOAD] Scene initialized"),console.log('[PRELOAD] BASE_URL = "./"'),console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")}preload(){this.createDiagnosticUI(),this.setupLoaderEvents(),this.startTimeout(),this.queueAssets(),this.generateProceduralAssets(),this.diag.totalToLoad=this.load.totalToLoad,this.updateDiagnostics(),console.log(`[PRELOAD] Queued ${this.diag.totalToLoad} files`)}createDiagnosticUI(){const{width:e,height:a}=this.cameras.main,i=e/2,t=a/2;this.add.rectangle(i,t,e,a,1709072),this.add.text(i,t-120,"BLOODLINE ARENA",{fontFamily:"Georgia, serif",fontSize:"24px",color:"#c9a959",stroke:"#000000",strokeThickness:3}).setOrigin(.5),this.add.text(i,t-90,"Loading...",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b7355",fontStyle:"italic"}).setOrigin(.5);const s=i-this.BAR_WIDTH/2,r=t-30,o=this.add.graphics();o.fillStyle(3811866,1),o.fillRoundedRect(s-2,r-2,this.BAR_WIDTH+4,this.BAR_HEIGHT+4,4),o.fillStyle(1709072,1),o.fillRoundedRect(s,r,this.BAR_WIDTH,this.BAR_HEIGHT,3),this.progressBar=this.add.graphics(),this.statusText=this.add.text(i,t+10,"Initializing...",{fontFamily:"monospace",fontSize:"11px",color:"#8b7355"}).setOrigin(.5),this.diagText=this.add.text(i,t+45,"",{fontFamily:"monospace",fontSize:"10px",color:"#6a6a5a",align:"center"}).setOrigin(.5),this.failedText=this.add.text(i,t+90,"",{fontFamily:"monospace",fontSize:"9px",color:"#aa6666",align:"center",wordWrap:{width:e-40}}).setOrigin(.5,0)}setupLoaderEvents(){this.load.on("progress",e=>{this.updateProgressBar(e)}),this.load.on("filestart",e=>{this.diag.lastFileKey=e.key;const a=typeof e.src=="string"?e.src:String(e.src??e.url??"(unknown)");this.diag.lastFileUrl=a,this.statusText.setText(`Loading: ${e.key}`),console.log(`[PRELOAD] Loading: ${e.key} -> ${a}`)}),this.load.on("filecomplete",e=>{this.diag.totalComplete++,console.log(`[PRELOAD] âœ“ Complete: ${e}`),this.updateDiagnostics()}),this.load.on("loaderror",e=>{this.diag.totalFailed++;const a=typeof e.src=="string"?e.src:String(e.src??e.url??"(unknown)");this.diag.failedFiles.push({key:e.key,url:a}),console.error(`[PRELOAD] âœ— FAILED: ${e.key} -> ${a}`),this.updateDiagnostics(),this.updateFailedList(),this.createFallbackTexture(e.key)}),this.load.once("complete",()=>{this.loadComplete=!0,console.log("[PRELOAD] â•â•â• LOADER COMPLETE â•â•â•"),console.log(`[PRELOAD] Success: ${this.diag.totalComplete}, Failed: ${this.diag.totalFailed}`),this.clearTimeout(),this.diag.totalFailed>0?this.showErrorUI():this.startTransition()})}startTimeout(){console.log(`[PRELOAD] Starting ${this.TIMEOUT_MS}ms timeout`),this.timeoutTimer=this.time.delayedCall(this.TIMEOUT_MS,()=>{!this.loadComplete&&!this.transitionStarted&&(this.timedOut=!0,console.error("[PRELOAD] âš  TIMEOUT - Loading took too long!"),console.error("[PRELOAD] Pending files may have 404ed or stalled"),this.showErrorUI())})}clearTimeout(){this.timeoutTimer&&(this.timeoutTimer.destroy(),this.timeoutTimer=void 0)}queueAssets(){[{key:"ui_panel",path:"assets/ui/panel.svg"},{key:"ui_button",path:"assets/ui/button.svg"},{key:"ui_frame",path:"assets/ui/frame.svg"},{key:"overlay_vignette",path:"assets/overlays/vignette.svg"},{key:"overlay_grain",path:"assets/overlays/grain.svg"},{key:"arena_bg",path:"assets/arena/background.svg"},{key:"icon_main",path:"assets/icons/icon.svg"}].forEach(({key:a,path:i})=>{const t=ma(i);console.log(`[PRELOAD] Queue: ${a} -> ${t}`),this.load.svg(a,t)})}generateProceduralAssets(){try{const e=new fa(this);e.generateUIAssets(),e.generatePortraitAssets(),e.generateArenaAssets(),e.generateEffectAssets(),e.generateIconAssets(),console.log("[PRELOAD] Procedural assets generated")}catch(e){console.error("[PRELOAD] Procedural asset error:",e)}}updateProgressBar(e){if(!this.progressBar)return;const{width:a,height:i}=this.cameras.main,t=a/2-this.BAR_WIDTH/2,s=i/2-30,r=Math.max(0,(this.BAR_WIDTH-4)*e);this.progressBar.clear(),r>0&&(this.progressBar.fillStyle(13216089,1),this.progressBar.fillRoundedRect(t+2,s+2,r,this.BAR_HEIGHT-4,2))}updateDiagnostics(){const e=((Date.now()-this.diag.startTime)/1e3).toFixed(1),a=[`Files: ${this.diag.totalComplete}/${this.diag.totalToLoad} loaded, ${this.diag.totalFailed} failed`,`Time: ${e}s`,`Last: ${this.diag.lastFileKey||"(none)"}`];this.diagText.setText(a.join(`
`))}updateFailedList(){if(this.diag.failedFiles.length===0){this.failedText.setText("");return}const e=`âš  FAILED FILES (${this.diag.failedFiles.length}):
`,a=this.diag.failedFiles.slice(-5).map(i=>`${i.key}: ${i.url}`).join(`
`);this.failedText.setText(e+a)}createFallbackTexture(e){if(this.textures.exists(e))return;const a=this.make.graphics({x:0,y:0});a.fillStyle(3811866,1),a.fillRect(0,0,64,64),a.lineStyle(2,5917242,1),a.strokeRect(2,2,60,60),a.lineStyle(1,9127187,.5),a.moveTo(8,8),a.lineTo(56,56),a.moveTo(56,8),a.lineTo(8,56),a.strokePath(),a.generateTexture(e,64,64),a.destroy(),console.log(`[PRELOAD] Created fallback texture: ${e}`)}createAllFallbacks(){["ui_panel","ui_button","ui_frame","overlay_vignette","overlay_grain","arena_bg","icon_main","parchment_overlay","vignette","particle"].forEach(a=>{this.textures.exists(a)||this.createFallbackTexture(a)})}showErrorUI(){const{width:e,height:a}=this.cameras.main,i=e/2;this.clearTimeout();const t=this.timedOut?"TIMEOUT":`${this.diag.totalFailed} file(s) failed`;this.statusText.setText(`Loading issue: ${t}`),this.statusText.setColor("#cc8866"),this.createAllFallbacks(),this.retryBtn=this.createButton(i,a/2+150,"Retry Loading",()=>{console.log("[PRELOAD] User clicked Retry"),this.scene.restart()}),this.continueBtn=this.createButton(i,a/2+195,"Continue (Safe Mode)",()=>{console.log("[PRELOAD] User clicked Continue (Safe Mode)"),this.startTransition(!0)})}createButton(e,a,i,t){const s=this.add.container(e,a),r=this.add.graphics();r.fillStyle(3811866,1),r.fillRoundedRect(-90,-16,180,32,6),r.lineStyle(2,9139029,1),r.strokeRoundedRect(-90,-16,180,32,6);const o=this.add.text(0,0,i,{fontFamily:"Georgia, serif",fontSize:"12px",color:"#c9a959"}).setOrigin(.5);return s.add([r,o]),r.setInteractive(new w.Geom.Rectangle(-90,-16,180,32),w.Geom.Rectangle.Contains),r.on("pointerdown",t),r.on("pointerover",()=>{r.clear(),r.fillStyle(4864554,1),r.fillRoundedRect(-90,-16,180,32,6),r.lineStyle(2,13216089,1),r.strokeRoundedRect(-90,-16,180,32,6)}),r.on("pointerout",()=>{r.clear(),r.fillStyle(3811866,1),r.fillRoundedRect(-90,-16,180,32,6),r.lineStyle(2,9139029,1),r.strokeRoundedRect(-90,-16,180,32,6)}),s}startTransition(e=!1){if(this.transitionStarted)return;this.transitionStarted=!0,this.clearTimeout(),this.retryBtn&&this.retryBtn.setVisible(!1),this.continueBtn&&this.continueBtn.setVisible(!1),e&&this.createAllFallbacks();try{p.load(),p.startAutoSave(3e4)}catch(i){console.warn("[PRELOAD] SaveSystem error:",i)}const a=document.getElementById("loading-screen");a&&(a.style.opacity="0",a.style.pointerEvents="none"),this.statusText.setText("Loading complete, entering MainMenu..."),this.statusText.setColor("#8b7355"),this.updateProgressBar(1),console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),console.log("[PRELOAD] Starting transition to MainMenuScene"),console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),this.time.delayedCall(400,()=>{console.log('[PRELOAD] >>> this.scene.start("MainMenuScene")'),this.scene.start("MainMenuScene")})}create(){console.log("[PRELOAD] create() called"),!this.transitionStarted&&this.loadComplete&&(this.diag.totalFailed>0?this.showErrorUI():this.startTransition())}update(){this.transitionStarted||this.updateDiagnostics()}}class T{static createButton(n,e,a,i,t,s={}){const{width:r=180,height:o=45,fontSize:d="14px",primary:l=!1}=s,h=n.add.container(e,a),u=n.add.graphics(),f=l?4864554:2760474,g=l?13216089:5917242;u.fillStyle(f,1),u.fillRoundedRect(-r/2,-o/2,r,o,8),u.lineStyle(2,g,1),u.strokeRoundedRect(-r/2,-o/2,r,o,8),h.add(u);const y=n.add.text(0,0,i,{fontFamily:"Georgia, serif",fontSize:d,color:l?"#c9a959":"#8b7355"}).setOrigin(.5);return h.add(y),u.setInteractive(new w.Geom.Rectangle(-r/2,-o/2,r,o),w.Geom.Rectangle.Contains),u.on("pointerover",()=>{u.clear(),u.fillStyle(f+1118481,1),u.fillRoundedRect(-r/2,-o/2,r,o,8),u.lineStyle(2,13216089,1),u.strokeRoundedRect(-r/2,-o/2,r,o,8),y.setColor("#c9a959")}),u.on("pointerout",()=>{u.clear(),u.fillStyle(f,1),u.fillRoundedRect(-r/2,-o/2,r,o,8),u.lineStyle(2,g,1),u.strokeRoundedRect(-r/2,-o/2,r,o,8),y.setColor(l?"#c9a959":"#8b7355")}),u.on("pointerdown",()=>{n.tweens.add({targets:h,scaleX:.95,scaleY:.95,duration:50,yoyo:!0,onComplete:t})}),h}static showNotification(n,e,a=2e3){const{width:i,height:t}=n.cameras.main,s=n.add.container(i/2,100);s.setDepth(1e3);const r=20,o=n.add.text(0,0,e,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#c9a959"}).setOrigin(.5),d=o.width+r*2,l=o.height+r,h=n.add.graphics();return h.fillStyle(2760474,.95),h.fillRoundedRect(-d/2,-l/2,d,l,8),h.lineStyle(2,13216089,.5),h.strokeRoundedRect(-d/2,-l/2,d,l,8),s.add(h),s.add(o),s.setAlpha(0),s.y=80,n.tweens.add({targets:s,alpha:1,y:100,duration:200,ease:"Back.out"}),n.time.delayedCall(a,()=>{n.tweens.add({targets:s,alpha:0,y:80,duration:200,onComplete:()=>s.destroy()})}),s}static showConfirmDialog(n,e,a,i,t,s="CONFIRM"){const{width:r,height:o}=n.cameras.main,d=n.add.container(r/2,o/2);d.setDepth(1e3);const l=n.add.rectangle(0,0,r,o,0,.7);l.setInteractive(),d.add(l);const h=320,u=280,f=n.add.graphics();f.fillStyle(1709072,1),f.fillRoundedRect(-h/2,-u/2,h,u,12),f.lineStyle(3,13216089,1),f.strokeRoundedRect(-h/2,-u/2,h,u,12),d.add(f);const g=n.add.text(0,-u/2+30,e,{fontFamily:"Georgia, serif",fontSize:"18px",color:"#c9a959"}).setOrigin(.5);d.add(g);const y=n.add.text(0,-20,a,{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b7355",wordWrap:{width:h-40},align:"center"}).setOrigin(.5);d.add(y);const S=this.createButton(n,-70,u/2-50,"CANCEL",()=>{d.destroy(),t()},{width:100,height:40,fontSize:"12px"});d.add(S);const b=this.createButton(n,70,u/2-50,s,()=>{d.destroy(),i()},{width:100,height:40,fontSize:"12px",primary:!0});return d.add(b),d.setScale(.8),d.setAlpha(0),n.tweens.add({targets:d,scale:1,alpha:1,duration:200,ease:"Back.out"}),d}static createProgressBar(n,e,a,i,t,s,r,o=13216089){const d=n.add.container(e,a),l=n.add.graphics();l.fillStyle(2760474,1),l.fillRoundedRect(0,0,i,t,t/4),d.add(l);const h=n.add.graphics(),u=s/r*(i-4);return h.fillStyle(o,1),h.fillRoundedRect(2,2,Math.max(0,u),t-4,(t-4)/4),d.add(h),d}static createPanel(n,e,a,i,t){const s=n.add.graphics();return s.fillStyle(2760474,.95),s.fillRoundedRect(e,a,i,t,10),s.lineStyle(2,5917242,1),s.strokeRoundedRect(e,a,i,t,10),s.lineStyle(1,3811866,.5),s.strokeRoundedRect(e+5,a+5,i-10,t-10,8),s}static createDivider(n,e,a,i){const t=n.add.graphics();return t.lineStyle(1,5917242,.5),t.moveTo(e-i/2,a),t.lineTo(e+i/2,a),t.strokePath(),t.fillStyle(13216089,.5),t.fillCircle(e,a,3),t}}class pa extends w.Scene{constructor(){super({key:"MainMenuScene"});m(this,"menuContainer")}create(){const{width:e,height:a}=this.cameras.main;this.createBackground(),this.createTitle(),this.createMenu(),this.createAmbientEffects(),this.cameras.main.fadeIn(500,0,0,0),this.playAmbience()}createBackground(){const{width:e,height:a}=this.cameras.main,i=this.add.graphics();if(i.fillGradientStyle(1709072,1709072,2760474,2760474),i.fillRect(0,0,e,a),this.textures.exists("parchment_overlay")){const t=this.add.image(e/2,a/2,"parchment_overlay");t.setAlpha(.1),t.setDisplaySize(e,a)}if(this.textures.exists("vignette")){const t=this.add.image(e/2,a/2,"vignette");t.setDisplaySize(e,a),t.setAlpha(.5)}}createTitle(){const{width:e}=this.cameras.main,a=e/2;this.add.text(a,120,"BLOODLINE",{fontFamily:"Georgia, serif",fontSize:"48px",color:"#c9a959",stroke:"#000000",strokeThickness:6}).setOrigin(.5),this.add.text(a,175,"ARENA",{fontFamily:"Georgia, serif",fontSize:"36px",color:"#8b7355",stroke:"#000000",strokeThickness:4,letterSpacing:8}).setOrigin(.5);const i=this.add.graphics();i.lineStyle(2,13216089,.5),i.moveTo(a-100,210),i.lineTo(a+100,210),i.strokePath(),this.add.text(a,235,"Blood. Honor. Legacy.",{fontFamily:"Georgia, serif",fontSize:"14px",color:"#5a4a3a",fontStyle:"italic"}).setOrigin(.5)}createMenu(){const{width:e,height:a}=this.cameras.main,i=e/2,t=320,s=70;this.menuContainer=this.add.container(0,0);const r=p.hasActiveRun();if(r){const y=T.createButton(this,i,t,"CONTINUE RUN",()=>this.continueRun(),{width:260,height:55,primary:!0});this.menuContainer.add(y)}const o=r?t+s:t,d=T.createButton(this,i,o,r?"NEW RUN":"BEGIN YOUR LEGEND",()=>this.startNewRun(),{width:260,height:55,primary:!r});this.menuContainer.add(d);const l=T.createButton(this,i,o+s,"HALL OF LEGENDS",()=>this.openHallOfLegends(),{width:260,height:55});this.menuContainer.add(l);const h=T.createButton(this,i,o+s*2,"BLOODLINE PERKS",()=>this.openBloodlinePerks(),{width:260,height:55});this.menuContainer.add(h);const u=T.createButton(this,i,o+s*3,"SETTINGS",()=>this.openSettings(),{width:260,height:55});this.menuContainer.add(u);const f=p.getMeta(),g=`Runs: ${f.totalRuns} | Wins: ${f.totalWins} | Deaths: ${f.totalDeaths}`;this.add.text(i,a-60,g,{fontFamily:"Georgia, serif",fontSize:"12px",color:"#5a4a3a"}).setOrigin(.5),this.add.text(i,a-35,"v1.0.0",{fontFamily:"Georgia, serif",fontSize:"10px",color:"#3a3025"}).setOrigin(.5)}createAmbientEffects(){const{width:e,height:a}=this.cameras.main;if(!p.getSettings().reduceMotion){if(this.textures.exists("particle"))try{this.add.particles(0,0,"particle",{x:{min:0,max:e},y:{min:0,max:a},scale:{start:.5,end:0},alpha:{start:.3,end:0},speed:{min:10,max:30},angle:{min:-90,max:-90},lifespan:4e3,frequency:200,blendMode:"ADD"})}catch(t){console.warn("[MainMenu] Particle effect failed:",t)}this.tweens.add({targets:this.cameras.main,alpha:{from:1,to:.95},duration:100,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}}playAmbience(){p.getSettings().soundEnabled}continueRun(){this.cameras.main.fadeOut(300,0,0,0),this.cameras.main.once("camerafadeoutcomplete",()=>{const e=p.getRun();e.fighter&&e.lastCampAction==="fight"?this.scene.start("FightScene"):this.scene.start("CampScene")})}startNewRun(){p.hasActiveRun()?T.showConfirmDialog(this,"Abandon Current Run?","Starting a new run will end your current fighter's journey. This cannot be undone.",()=>{p.endRun(!1),this.beginNewRun()},()=>{}):this.beginNewRun()}beginNewRun(){p.startNewRun(),this.cameras.main.fadeOut(300,0,0,0),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("RecruitScene")})}openHallOfLegends(){this.cameras.main.fadeOut(300,0,0,0),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("HallOfLegendsScene")})}openBloodlinePerks(){this.cameras.main.fadeOut(300,0,0,0),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("BloodlinePerksScene")})}openSettings(){this.cameras.main.fadeOut(300,0,0,0),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("SettingsScene")})}}const Ee={firstNames:["Aldric","Bjorn","Cassius","Doran","Edric","Falco","Gareth","Harald","Ivan","Jorik","Kael","Lothar","Milo","Nils","Osric","Pavel","Quinn","Ragnar","Soren","Theron","Ulric","Viktor","Werner","Xander","Yoren","Zephyr","Edda","Freya","Greta","Helga","Ingrid","Jutta","Katla","Liv","Mira","Nessa","Olga","Petra","Runa","Sigrid","Thora","Una","Vera","Wren","Ylva","Zara","Brynn","Astrid"],lastNames:["Ashford","Blackwood","Coldstream","Dunmore","Elderstone","Fairweather","Grimshaw","Hartwell","Ironside","Jarvik","Korvin","Lockwood","Moorland","Northcott","Oakhart","Pembrook","Queensbury","Ravencroft","Stonebridge","Thornwood","Underhill","Varr","Windermere","Yarwood","Brann","Voss","Krenn","Dahl","Falk","Griff"],nicknames:["Tin Smile","Left Hook","The Silent","Red Fist","Iron Jaw","The Gentle","Blood Eye","One Shot","The Grim","Lucky","The Bear","Swift Blade","The Butcher","Old Bones","The Crow","Steel Shin","Thunder","The Wall","Widow Maker","The Ghost","Bone Breaker","The Hound","Scarface","The Ox","Quickdraw","The Jackal","Stone Cold","Fury","The Serpent","Nightshade","Pale Death","The Anvil","Copperhead","The Reaper","Mercy","Grudge"]},ut={birthplaces:["Nordheim","the Dustlands","Port Veras","the Iron Hills","Greymarsh","Ashenvale","the Frozen Coast","Thornwick","the Capital","Saltmere","the Border Wastes","Kingsridge","the Outer Reaches","Mirefall","Stonehaven"],snippets:["Born in {birthplace}, {age} winters have hardened this fighter. Sold into the arena to pay family debts.","A former soldier from {birthplace}, discharged after {age} years. The arena is all that remains.","Once a farmer's child in {birthplace}. At {age}, the crops failed, and fighting became the only trade.","Raised in the slums of {birthplace}. At {age}, the arena offers a chance at something more than survival.","A disgraced noble from {birthplace}, now {age} and fighting to reclaim lost honor.","Born to arena champions in {birthplace}. At {age}, the bloodline demands its due.","An orphan of {birthplace}'s plague years. Now {age}, with nothing left to lose.","A freed slave from {birthplace}, {age} years old. The arena is freedom, strange as it seems.","A wanderer from {birthplace} who found purpose at {age}. The roar of crowds calls.","Convicted of a crime in {birthplace} at a young age. Now {age}, fighting for redemption.","A blacksmith's apprentice from {birthplace}, {age} years old. Strong arms, stronger will.","Born during the siege of {birthplace}. {age} years of war made a natural fighter."]},ya=[{id:"mothers_coin",name:"Mother's Coin",backstory:'A worn copper coin, pressed into small hands on the day of departure. "For luck," she said.',effect:"+5 starting Focus",statBonus:{maxFocus:5},upgradeEffect:"+10 starting Focus, +5% gold gain"},{id:"broken_whistle",name:"Broken Whistle",backstory:"Once called the family dog. Now only a memory of simpler times rattles inside.",effect:"+5 max Stamina",statBonus:{maxStamina:5},upgradeEffect:"+10 max Stamina"},{id:"old_ribbon",name:"Old Ribbon",backstory:"Faded blue, from someone who promised to wait. They probably moved on.",effect:"+1 Trust per camp rest",statBonus:{},upgradeEffect:"+2 Trust per rest, reduced injury severity"},{id:"clay_figurine",name:"Clay Figurine",backstory:"A child's crude sculpture of a warrior. Made with love, if not skill.",effect:"+5% crowd hype gain",statBonus:{},upgradeEffect:"+15% crowd hype gain"},{id:"tooth_necklace",name:"Tooth Necklace",backstory:"A beast's fang from a hunt that almost ended everything. A reminder of survival.",effect:"+3 Attack",statBonus:{attack:3},upgradeEffect:"+5 Attack, +5% crit chance"},{id:"prayer_beads",name:"Prayer Beads",backstory:"Worn smooth by generations of whispered hopes. The gods may be listening.",effect:"+8 max HP",statBonus:{maxHP:8},upgradeEffect:"+15 max HP"},{id:"lucky_dice",name:"Lucky Dice",backstory:"Won these from a dying man. He said they always rolled true. Hasn't failed yet.",effect:"+5% critical chance",statBonus:{critChance:5},upgradeEffect:"+10% critical chance"},{id:"faded_letter",name:"Faded Letter",backstory:"The ink has run, the words nearly lost. But the feeling remains.",effect:"Start with 10 extra Trust",statBonus:{},upgradeEffect:"Start with 25 extra Trust"},{id:"iron_ring",name:"Iron Ring",backstory:"A wedding band? A slave's mark? Both have the same weight now.",effect:"+3 Defense",statBonus:{defense:3},upgradeEffect:"+5 Defense, reduced bleed duration"},{id:"dried_flower",name:"Dried Flower",backstory:"Picked the morning of recruitment. Already dead, but still beautiful.",effect:"Injuries heal 1 week faster",statBonus:{},upgradeEffect:"Injuries heal 2 weeks faster, +10 HP when resting"}],Fe={signature:[{id:"tin_smile",name:"Tin Smile",description:"Cannot be intimidated. Fear effects have no power here.",type:"positive",effect:"Immune to Fear",evolutionNames:["Tin Smile","Iron Grin","Steel Sneer"]},{id:"gentle_giant",name:"Gentle Giant",description:"The crowd loves a merciful warrior. Showing mercy grants bonus hype.",type:"positive",effect:"+20 Hype on merciful actions",evolutionNames:["Gentle Giant","Noble Warrior","The Beloved"]},{id:"vengeful",name:"Vengeful",description:"Pain fuels rage. Damage taken increases attack power temporarily.",type:"positive",effect:"+2 Attack per 10% HP lost",evolutionNames:["Vengeful","Wrathful","Avatar of Vengeance"]},{id:"crowd_pleaser",name:"Crowd Pleaser",description:"Fighting is an art. Style matters as much as substance.",type:"positive",effect:"+50% Hype gain",evolutionNames:["Crowd Pleaser","Fan Favorite","Legend of the Arena"]},{id:"survivors_instinct",name:"Survivor's Instinct",description:"Near-death awakens hidden reserves. Low health grants bonuses.",type:"positive",effect:"+20% Evasion below 25% HP",evolutionNames:["Survivor's Instinct","Death Defier","Unkillable"]},{id:"quick_study",name:"Quick Study",description:"Learns from every blow. Accuracy improves throughout the fight.",type:"positive",effect:"+3% Accuracy per round",evolutionNames:["Quick Study","Adaptable","Master Tactician"]},{id:"berserker_rage",name:"Berserker Rage",description:"Abandon defense for overwhelming offense.",type:"positive",effect:"+30% damage, -15% defense",evolutionNames:["Berserker Rage","Blood Frenzy","Unstoppable Force"]},{id:"iron_defense",name:"Iron Defense",description:"An immovable object. Blocking is second nature.",type:"positive",effect:"+25% block effectiveness",evolutionNames:["Iron Defense","Stone Wall","Impenetrable"]},{id:"opportunist",name:"Opportunist",description:"Strikes when the enemy falters. Bonus damage to stunned enemies.",type:"positive",effect:"+40% damage to debuffed enemies",evolutionNames:["Opportunist","Exploiter","Weakness Hunter"]},{id:"last_stand",name:"Last Stand",description:"Refuses to fall. Once per fight, survive a killing blow at 1 HP.",type:"positive",effect:"Survive fatal (1x per fight)",evolutionNames:["Last Stand","Deathless","The Immortal"]},{id:"patient_fighter",name:"Patient Fighter",description:"Conserves energy. Stamina regenerates faster.",type:"positive",effect:"+50% Stamina regen",evolutionNames:["Patient Fighter","Enduring","Tireless"]},{id:"intimidating_presence",name:"Intimidating Presence",description:"Enemies falter before the fight begins.",type:"positive",effect:"Enemies start with -10 Accuracy",evolutionNames:["Intimidating Presence","Terrifying Aura","Walking Nightmare"]}],positive:[{id:"strong_arm",name:"Strong Arm",description:"Natural strength grants bonus damage.",type:"positive",effect:"+3 Attack",statModifier:{attack:3}},{id:"thick_skin",name:"Thick Skin",description:"Hardened by years of punishment.",type:"positive",effect:"+5 Defense",statModifier:{defense:5}},{id:"light_feet",name:"Light Feet",description:"Quick and agile in the arena.",type:"positive",effect:"+8 Evasion",statModifier:{evasion:8}},{id:"keen_eyes",name:"Keen Eyes",description:"Rarely misses a strike.",type:"positive",effect:"+10 Accuracy",statModifier:{accuracy:10}},{id:"endless_stamina",name:"Endless Stamina",description:"Can fight all day without tiring.",type:"positive",effect:"+15 Max Stamina",statModifier:{maxStamina:15}},{id:"born_fighter",name:"Born Fighter",description:"Combat comes naturally.",type:"positive",effect:"+10 Max HP, +2 Attack",statModifier:{maxHP:10,attack:2}},{id:"focused_mind",name:"Focused Mind",description:"Clarity in chaos.",type:"positive",effect:"+10 Max Focus",statModifier:{maxFocus:10}},{id:"quick_reflexes",name:"Quick Reflexes",description:"Reacts before thinking.",type:"positive",effect:"+3 Speed",statModifier:{speed:3}}],negative:[{id:"old_injury",name:"Old Injury",description:"An old wound that never quite healed.",type:"negative",effect:"-10 Max HP",statModifier:{maxHP:-10}},{id:"poor_eyesight",name:"Poor Eyesight",description:"Struggles to land precise hits.",type:"negative",effect:"-8 Accuracy",statModifier:{accuracy:-8}},{id:"glass_jaw",name:"Glass Jaw",description:"One good hit to the head, and it's over.",type:"negative",effect:"+50% damage from head hits",statModifier:{}},{id:"brittle_bones",name:"Brittle Bones",description:"Injuries are more severe.",type:"negative",effect:"+1 week injury heal time",statModifier:{}},{id:"slow_starter",name:"Slow Starter",description:"Takes time to warm up.",type:"negative",effect:"-20% damage rounds 1-2",statModifier:{}},{id:"arrogant",name:"Arrogant",description:"Overconfidence leads to mistakes.",type:"negative",effect:"-5 Evasion when HP > 70%",statModifier:{}},{id:"nervous",name:"Nervous",description:"Crowds make mistakes more likely.",type:"negative",effect:"-5 Accuracy at high Hype",statModifier:{}},{id:"weak_constitution",name:"Weak Constitution",description:"Tires quickly in prolonged fights.",type:"negative",effect:"-10 Max Stamina",statModifier:{maxStamina:-10}},{id:"scarred_lungs",name:"Scarred Lungs",description:"Breathes heavy, moves slow.",type:"negative",effect:"-2 Speed",statModifier:{speed:-2}},{id:"cowardly",name:"Cowardly",description:"Fear takes hold too easily.",type:"negative",effect:"+20% Fear effect duration",statModifier:{}},{id:"reckless",name:"Reckless",description:"Attacks without thinking.",type:"negative",effect:"-5 Defense",statModifier:{defense:-5}},{id:"bad_knee",name:"Bad Knee",description:"An old injury that flares up.",type:"negative",effect:"+30% damage from leg hits",statModifier:{}}]};function De(c=1){var C;const n=k.pick(Ee.firstNames),e=k.pick(Ee.lastNames),a=k.pick(Ee.nicknames),i=k.int(18,45),t=k.pick(ut.birthplaces),s=k.pick(ut.snippets).replace("{birthplace}",t).replace("{age}",String(i)),r=k.pick(["stoic","aggressive","honorable","cunning","fearful","jovial"]),o=Math.floor(c/2),d=va(o),l=Et(),h=k.pick(ya),u={id:h.id,name:h.name,backstory:h.backstory,effect:h.effect,statBonus:h.statBonus,upgraded:!1,upgradeEffect:h.upgradeEffect},f=k.pick(Fe.signature),g={...f,evolutionStage:0,maxEvolution:((C=f.evolutionNames)==null?void 0:C.length)||3},y=k.int(1,2),S=k.pickMultiple(Fe.positive,y).map(x=>({...x})),b=[{...k.pick(Fe.negative)}];return{id:k.id(12),firstName:n,lastName:e,nickname:a,fullName:`${n} '${a}' ${e}`,age:i,birthplace:t,backstory:s,personality:r,baseStats:d,currentStats:{...d},equipment:{weapon:null,armor:null,accessory:null},keepsake:u,inventory:[],signatureTrait:g,traits:S,flaws:b,portrait:l,level:1,experience:0,wins:0,losses:0,kills:0,status:"healthy",injuries:[],scars:[],activeEffects:[],trust:20,trustLevel:"stranger",totalDamageDealt:0,totalDamageTaken:0,perfectParries:0,signatureMoveUses:0,closestCall:d.maxHP,bestWin:"",lettersWritten:[],weeksSurvived:0}}function va(c=0){return{maxHP:k.int(80,120)+c*5,currentHP:0,maxStamina:k.int(80,100)+c*3,currentStamina:0,maxFocus:k.int(50,80)+c*2,currentFocus:0,attack:k.int(8,15)+c,defense:k.int(5,12)+c,speed:k.int(5,12)+c,accuracy:k.int(70,90)+c,evasion:k.int(5,15)+c,critChance:k.int(5,15),critDamage:k.int(140,180)}}function Et(){const c=["#f5d0b9","#d4a574","#8b5a3c","#5c3d2e","#3b2417"],n=["#1a1a1a","#3d2314","#6b4423","#8b6914","#a08060","#c0c0c0","#8b0000"];return{baseIndex:k.int(0,5),eyeIndex:k.int(0,4),hairIndex:k.int(0,7),beardIndex:k.int(0,5),scarIndex:0,warpaintIndex:k.chance(.3)?k.int(1,4):0,hoodIndex:0,skinTone:k.pick(c),hairColor:k.pick(n),injuryOverlays:[]}}function ft(c){c.currentStats.currentHP=c.currentStats.maxHP,c.currentStats.currentStamina=c.currentStats.maxStamina,c.currentStats.currentFocus=0,c.activeEffects=[]}function Sa(c,n){c.injuries.push(n),c.status=n.severity==="severe"?"critical":"injured";for(const[e,a]of Object.entries(n.statPenalty)){const i=e;typeof c.currentStats[i]=="number"&&typeof a=="number"&&(c.currentStats[i]-=a)}if(c.portrait.injuryOverlays.push(`injury_${n.location}_${n.severity}`),k.chance(n.scarChance)){const e=`scar_${n.location}_${c.scars.length}`;c.scars.push(e),c.portrait.scarIndex=Math.min(c.portrait.scarIndex+1,5)}}function Ft(c,n=1){const e=[];c.injuries=c.injuries.filter(a=>{if(a.healTime-=n,a.healTime<=0){e.push(a.id);for(const[i,t]of Object.entries(a.statPenalty)){const s=i;typeof c.currentStats[s]=="number"&&typeof t=="number"&&(c.currentStats[s]+=t)}return!1}return!0}),c.portrait.injuryOverlays=c.portrait.injuryOverlays.filter(a=>!e.some(i=>a.includes(i.split("_")[1]))),c.injuries.length===0?c.status="healthy":c.injuries.some(a=>a.severity==="severe")?c.status="critical":c.status="injured"}function wa(c){c.trust>=90?c.trustLevel="legendary":c.trust>=70?c.trustLevel="bonded":c.trust>=50?c.trustLevel="ally":c.trust>=25?c.trustLevel="acquaintance":c.trustLevel="stranger"}function Te(c,n){c.trust=Math.max(0,Math.min(100,c.trust+n)),wa(c)}function ba(c){const n={...c.baseStats};for(const e of Object.values(c.equipment))if(e!=null&&e.stats)for(const[a,i]of Object.entries(e.stats))typeof i=="number"&&(n[a]+=i);if(c.keepsake.statBonus)for(const[e,a]of Object.entries(c.keepsake.statBonus))typeof a=="number"&&(n[e]+=a);for(const e of[...c.traits,...c.flaws])if(e.statModifier)for(const[a,i]of Object.entries(e.statModifier))typeof i=="number"&&(n[a]+=i);return n.currentHP=n.maxHP,n.currentStamina=n.maxStamina,n.currentFocus=0,n}function xa(c,n,e){const a=[`Fell to ${e} in round ${n}. ${c.location} strike proved fatal.`,`Collapsed from a ${c.weaponType} wound to the ${c.location} in round ${n}.`,`${c.location==="head"?"Skull cracked":c.location==="body"?"Heart pierced":"Leg shattered"} by ${e}'s ${c.weaponType}.`,`Bled out from wounds sustained in round ${n}. The crowd fell silent.`,`${e}'s final blow to the ${c.location} ended it all in round ${n}.`];return k.pick(a)}function ka(c){if(!k.chance(.3))return;const n=["Tell them... I tried.","Don't sell my keepsake...","Run... while you can...","It was... worth it...","Remember my name...","The crowd... they loved me...",`Tell ${c.birthplace}... I'm sorry...`,"One more fight... I could have...","My keepsake... keep it safe...","Honor... above all..."];return k.pick(n)}const te=[{id:"hardy_stock",name:"Hardy Stock",description:"Your bloodline is tough. Start with +10 max HP.",effect:"+10 Max HP",cost:5,tier:1,statBonus:{maxHP:10}},{id:"fighting_spirit",name:"Fighting Spirit",description:"Generations of warriors flow through you. +5 max Stamina.",effect:"+5 Max Stamina",cost:5,tier:1,statBonus:{maxStamina:5}},{id:"quick_learner",name:"Quick Learner",description:"Experience comes faster. +10% XP from all sources.",effect:"+10% XP",cost:5,tier:1},{id:"silver_tongue",name:"Silver Tongue",description:"Better deals at shops. -10% shop prices.",effect:"-10% Shop Prices",cost:5,tier:1},{id:"crowd_favorite",name:"Crowd Favorite",description:"The crowd remembers your lineage. Start with +10 Hype.",effect:"+10 Starting Hype",cost:5,tier:1},{id:"iron_will",name:"Iron Will",description:"Resist fear and panic. Immune to Fear status.",effect:"Fear Immunity",cost:10,tier:2,prerequisite:"hardy_stock"},{id:"second_wind",name:"Second Wind",description:"Recover faster between fights. +20% stamina regen.",effect:"+20% Stamina Regen",cost:10,tier:2,prerequisite:"fighting_spirit"},{id:"veterans_insight",name:"Veteran's Insight",description:"Start with one extra trait choice.",effect:"+1 Trait Choice",cost:10,tier:2,prerequisite:"quick_learner"},{id:"haggler",name:"Haggler",description:"Even better deals. Additional -15% shop prices.",effect:"-15% More Shop Prices",cost:10,tier:2,prerequisite:"silver_tongue"},{id:"showman",name:"Showman",description:"Hype gains increased by 25%.",effect:"+25% Hype Gain",cost:10,tier:2,prerequisite:"crowd_favorite"},{id:"unbreakable",name:"Unbreakable",description:"Survive one fatal blow per run at 1 HP.",effect:"Survive Fatal (1x)",cost:20,tier:3,prerequisite:"iron_will"},{id:"berserker_blood",name:"Berserker Blood",description:"Deal 20% more damage when below 30% HP.",effect:"+20% Low HP Damage",cost:20,tier:3,prerequisite:"second_wind"},{id:"legendary_lineage",name:"Legendary Lineage",description:"All stat bonuses from bloodline perks doubled.",effect:"2x Bloodline Stats",cost:20,tier:3,prerequisite:"veterans_insight"}];function Ca(c,n,e,a,i){const t={id:`legend_${c.id}`,fighter:{id:c.id,fullName:c.fullName,nickname:c.nickname,age:c.age,birthplace:c.birthplace,portrait:{...c.portrait},signatureTrait:c.signatureTrait.name},leagueReached:e,wins:c.wins,kills:c.kills,weeksSurvived:c.weeksSurvived,status:n,causeOfDeath:c.causeOfDeath,lastWords:c.lastWords,promiseType:a,promiseKept:i,bestWin:c.bestWin||"No notable victories",closestCall:c.closestCall,signatureMoveUses:c.signatureMoveUses,perfectParries:c.perfectParries,lettersWritten:[...c.lettersWritten],dateAdded:Date.now()};return p.addToHallOfLegends(t),Ma(c),Ta(c),t}function Ma(c,n){p.addGhostMoment({fighterId:c.id,fighterName:c.firstName,nickname:c.nickname,type:"crowd_chant",triggered:!1}),(c.equipment.weapon||c.equipment.armor)&&p.addGhostMoment({fighterId:c.id,fighterName:c.firstName,nickname:c.nickname,type:"item_drop",triggered:!1}),k.chance(.5)&&p.addGhostMoment({fighterId:c.id,fighterName:c.firstName,nickname:c.nickname,type:"story",triggered:!1})}function Ta(c){const e=.3+p.getMeta().promoterLevel*.05;if(k.chance(e)){const a={id:`heirloom_${c.id}`,name:c.keepsake.name,description:`${c.keepsake.backstory} Once belonged to ${c.fullName}.`,fromFighter:c.fullName,effect:c.keepsake.effect,recovered:!0};p.addHeirloom(a)}}function Ra(c){const n=p.getUntriggeredGhostMoments();if(n.length===0)return null;const e={arena:["crowd_chant","statue"],camp:["story"],shop:["item_drop"]},a=n.filter(t=>e[c].includes(t.type));if(a.length===0||!k.chance(.15))return null;const i=k.pick(a);return p.triggerGhostMoment(i.fighterId,i.type),i}function Ia(c){switch(c.type){case"crowd_chant":return`The crowd chants: "${c.nickname}! ${c.nickname}!" Someone remembers...`;case"item_drop":return`You find a worn item. A tag reads: "Property of ${c.fighterName} '${c.nickname}'"`;case"statue":return`A weathered statue stands in the corner. The plaque reads: "${c.fighterName} '${c.nickname}' - Never Forgotten"`;case"story":return`An old fighter tells tales of ${c.fighterName} '${c.nickname}'. The legend lives on.`;default:return""}}function Pa(){const c=p.getMeta(),n={};let e=!1;for(const a of c.unlockedPerks){const i=te.find(t=>t.id===a);if(i!=null&&i.statBonus)for(const[t,s]of Object.entries(i.statBonus))n[t]=(n[t]||0)+s;a==="legendary_lineage"&&(e=!0)}if(e)for(const a of Object.keys(n))n[a]*=2;return n}function $e(c){const n=p.getMeta(),e=te.find(a=>a.id===c);if(!e)return{canPurchase:!1,reason:"Perk not found"};if(n.unlockedPerks.includes(c))return{canPurchase:!1,reason:"Already owned"};if(e.prerequisite&&!n.unlockedPerks.includes(e.prerequisite)){const a=te.find(i=>i.id===e.prerequisite);return{canPurchase:!1,reason:`Requires: ${(a==null?void 0:a.name)||e.prerequisite}`}}return n.bloodlinePoints<e.cost?{canPurchase:!1,reason:`Need ${e.cost} points (have ${n.bloodlinePoints})`}:{canPurchase:!0,reason:""}}function _a(c){const{canPurchase:n}=$e(c);if(!n)return!1;const e=te.find(a=>a.id===c);return e&&p.spendBloodlinePoints(e.cost)?(p.unlockPerk(c),!0):!1}class ce{static renderPortrait(n,e,a,i,t){const s=n.add.container(a,i),r=t/80,o=n.add.graphics();o.fillStyle(1709072,1),o.fillCircle(0,0,(t/2+5)*1.1),o.fillStyle(657413,1),o.fillCircle(0,0,t/2),o.lineStyle(3,5917242,1),o.strokeCircle(0,0,(t/2+5)*1.1),s.add(o);const d=n.add.graphics(),l=w.Display.Color.HexStringToColor(e.skinTone).color,h=w.Display.Color.HexStringToColor(e.skinTone).darken(40).color;d.fillStyle(h,1),d.fillEllipse(0,t*.42,t*.7,t*.25),d.fillStyle(l,1),d.fillRect(-t*.12,t*.2,t*.24,t*.25),s.add(d);const u=n.add.graphics();u.fillStyle(h,.6),u.fillEllipse(0,t*.05,t*.44,t*.5),u.fillStyle(l,1),u.fillEllipse(0,0,t*.42,t*.48);const f=w.Display.Color.HexStringToColor(e.skinTone).lighten(15).color;u.fillStyle(f,.4),u.fillEllipse(-t*.12,-t*.02,t*.08,t*.1),u.fillEllipse(t*.12,-t*.02,t*.08,t*.1),u.fillStyle(f,.3),u.fillEllipse(0,-t*.05,t*.04,t*.12),s.add(u);const g=n.add.graphics(),y=-t*.06,S=t*.11;g.fillStyle(h,.4),g.fillEllipse(-S,y,t*.1,t*.06),g.fillEllipse(S,y,t*.1,t*.06),g.fillStyle(16119280,1),g.fillEllipse(-S,y,t*.08,t*.045),g.fillEllipse(S,y,t*.08,t*.045);const b=[4863264,2771520,3816016,5914656,2767402],M=b[e.eyeIndex%b.length],C=[{x:0,y:0},{x:1,y:0},{x:-1,y:0},{x:0,y:-.5},{x:.5,y:.5}],x=C[e.eyeIndex%C.length];g.fillStyle(M,1),g.fillCircle(-S+x.x,y+x.y,t*.03),g.fillCircle(S+x.x,y+x.y,t*.03),g.fillStyle(657930,1),g.fillCircle(-S+x.x,y+x.y,t*.015),g.fillCircle(S+x.x,y+x.y,t*.015),g.fillStyle(16777215,.6),g.fillCircle(-S-t*.01+x.x,y-t*.01,t*.008),g.fillCircle(S-t*.01+x.x,y-t*.01,t*.008);const R=w.Display.Color.HexStringToColor(e.hairColor).darken(20).color;g.lineStyle(2*r,R,.9);const B=[()=>{g.moveTo(-S-t*.05,y-t*.06),g.lineTo(-S+t*.04,y-t*.055),g.moveTo(S-t*.04,y-t*.055),g.lineTo(S+t*.05,y-t*.06)},()=>{g.moveTo(-S-t*.05,y-t*.05),g.lineTo(-S+t*.04,y-t*.07),g.moveTo(S-t*.04,y-t*.07),g.lineTo(S+t*.05,y-t*.05)},()=>{g.moveTo(-S-t*.05,y-t*.07),g.lineTo(-S+t*.04,y-t*.06),g.moveTo(S-t*.04,y-t*.06),g.lineTo(S+t*.05,y-t*.07)}];B[e.baseIndex%B.length](),g.strokePath(),s.add(g);const P=n.add.graphics(),H=t*.02;P.fillStyle(h,.3),P.fillEllipse(t*.02,H+t*.05,t*.05,t*.08),P.lineStyle(1.5*r,h,.4),P.moveTo(0,y+t*.06),P.lineTo(0,H+t*.03),P.strokePath(),P.fillStyle(h,.5),P.fillCircle(-t*.025,H+t*.07,t*.015),P.fillCircle(t*.025,H+t*.07,t*.015),s.add(P);const A=n.add.graphics(),F=t*.14,K=w.Display.Color.HexStringToColor(e.skinTone).darken(25).color,Se=[()=>{A.lineStyle(2*r,K,.8),A.moveTo(-t*.06,F),A.lineTo(t*.06,F),A.strokePath(),A.fillStyle(h,.2),A.fillEllipse(0,F-t*.01,t*.06,t*.015)},()=>{A.lineStyle(2*r,K,.8),A.beginPath(),A.arc(0,F-t*.03,t*.06,.3,Math.PI-.3),A.strokePath()},()=>{A.lineStyle(2*r,K,.8),A.beginPath(),A.arc(0,F+t*.05,t*.06,Math.PI+.3,-.3),A.strokePath()},()=>{A.fillStyle(1708560,1),A.fillRect(-t*.05,F-t*.01,t*.1,t*.03),A.fillStyle(15789024,.8),A.fillRect(-t*.04,F-t*.008,t*.08,t*.015),A.lineStyle(1.5*r,K,.8),A.strokeRect(-t*.05,F-t*.01,t*.1,t*.03)},()=>{A.lineStyle(2*r,K,.8),A.moveTo(-t*.06,F+t*.01),A.lineTo(t*.02,F-t*.01),A.lineTo(t*.06,F-t*.02),A.strokePath()}];Se[e.baseIndex%Se.length](),s.add(A);const q=n.add.graphics();if(q.lineStyle(1*r,h,.3),q.moveTo(-t*.18,t*.08),q.lineTo(-t*.08,t*.22),q.lineTo(0,t*.24),q.lineTo(t*.08,t*.22),q.lineTo(t*.18,t*.08),q.strokePath(),s.add(q),e.hairIndex>0){const v=n.add.graphics(),_=w.Display.Color.HexStringToColor(e.hairColor).color,ie=w.Display.Color.HexStringToColor(e.hairColor).lighten(20).color,Q=w.Display.Color.HexStringToColor(e.hairColor).darken(30).color,U=[()=>{},()=>{v.fillStyle(_,1),v.fillEllipse(0,-t*.22,t*.38,t*.18),v.lineStyle(1,Q,.3);for(let Y=-3;Y<=3;Y++)v.moveTo(Y*t*.05,-t*.32),v.lineTo(Y*t*.06,-t*.18);v.strokePath()},()=>{v.fillStyle(_,1),v.fillEllipse(0,-t*.2,t*.42,t*.22),v.fillRect(-t*.23,-t*.22,t*.08,t*.3),v.fillRect(t*.15,-t*.22,t*.08,t*.3),v.fillStyle(ie,.3),v.fillEllipse(-t*.08,-t*.28,t*.1,t*.06)},()=>{v.fillStyle(_,1),v.fillEllipse(0,-t*.18,t*.45,t*.25),v.fillRect(-t*.28,-t*.2,t*.12,t*.5),v.fillRect(t*.16,-t*.2,t*.12,t*.5),v.lineStyle(1,Q,.4),v.moveTo(-t*.22,-t*.1),v.lineTo(-t*.24,t*.25),v.moveTo(t*.22,-t*.1),v.lineTo(t*.24,t*.25),v.strokePath()},()=>{v.fillStyle(_,1),v.beginPath(),v.moveTo(-t*.08,-t*.2),v.lineTo(0,-t*.42),v.lineTo(t*.08,-t*.2),v.closePath(),v.fillPath(),v.lineStyle(1,ie,.3),v.moveTo(0,-t*.4),v.lineTo(0,-t*.22),v.strokePath()},()=>{v.fillStyle(_,1),v.fillEllipse(0,-t*.22,t*.4,t*.16),v.lineStyle(1,Q,.4);for(let Y=-2;Y<=2;Y++)v.moveTo(Y*t*.06,-t*.3),v.lineTo(Y*t*.08+t*.05,-t*.15);v.strokePath()},()=>{v.fillStyle(_,1),v.fillRect(-t*.25,-t*.18,t*.1,t*.25),v.fillRect(t*.15,-t*.18,t*.1,t*.25),v.fillEllipse(0,-t*.2,t*.2,t*.08)},()=>{v.fillStyle(_,1),v.fillEllipse(0,-t*.22,t*.38,t*.15),v.fillStyle(4864554,1),v.fillRect(t*.15,-t*.22,t*.04,t*.08),v.fillStyle(_,1),v.fillRect(t*.18,-t*.2,t*.06,t*.15)}];U[e.hairIndex%U.length](),s.add(v)}if(e.beardIndex>0){const v=n.add.graphics(),_=w.Display.Color.HexStringToColor(e.hairColor).color,ie=w.Display.Color.HexStringToColor(e.hairColor).darken(20).color,Q=[()=>{},()=>{v.fillStyle(_,.3);for(let U=0;U<30;U++){const Y=(Math.random()-.5)*t*.3,qt=t*.1+Math.random()*t*.15;v.fillRect(Y,qt,1,2)}},()=>{v.fillStyle(_,1),v.fillEllipse(0,t*.18,t*.25,t*.12),v.fillRect(-t*.16,F-t*.02,t*.32,t*.1),v.lineStyle(1,ie,.3);for(let U=-2;U<=2;U++)v.moveTo(U*t*.05,t*.12),v.lineTo(U*t*.05,t*.25);v.strokePath()},()=>{v.fillStyle(_,1),v.fillEllipse(0,t*.2,t*.28,t*.18),v.fillEllipse(-t*.04,F-t*.02,t*.06,t*.03),v.fillEllipse(t*.04,F-t*.02,t*.06,t*.03)},()=>{v.fillStyle(_,1),v.beginPath(),v.moveTo(-t*.2,t*.12),v.lineTo(-t*.15,t*.35),v.lineTo(0,t*.4),v.lineTo(t*.15,t*.35),v.lineTo(t*.2,t*.12),v.closePath(),v.fillPath()},()=>{v.fillStyle(_,1),v.fillEllipse(0,t*.2,t*.1,t*.12),v.fillRect(-t*.02,F+t*.02,t*.04,t*.04)}];Q[e.beardIndex%Q.length](),s.add(v)}if(e.scarIndex>0){const v=n.add.graphics(),_=9132634,ie=11567232;v.lineStyle(2.5*r,_,.7);const Q=[()=>{},()=>{v.moveTo(-t*.2,-t*.15),v.lineTo(-t*.05,t*.05),v.strokePath(),v.lineStyle(1*r,ie,.4),v.moveTo(-t*.19,-t*.14),v.lineTo(-t*.04,t*.04),v.strokePath()},()=>{v.moveTo(t*.08,-t*.02),v.lineTo(t*.22,t*.08),v.strokePath()},()=>{v.moveTo(-t*.1,-t*.22),v.lineTo(t*.12,-t*.18),v.strokePath()},()=>{v.moveTo(-t*.1,0),v.lineTo(t*.02,t*.1),v.strokePath(),v.moveTo(t*.02,0),v.lineTo(-t*.1,t*.1),v.strokePath()},()=>{v.moveTo(-t*.18,-t*.1),v.lineTo(-t*.08,t*.02),v.strokePath(),v.moveTo(t*.12,-t*.05),v.lineTo(t*.2,t*.1),v.strokePath(),v.moveTo(0,t*.18),v.lineTo(t*.08,t*.22),v.strokePath()}];Q[e.scarIndex%Q.length](),s.add(v)}if(e.warpaintIndex>0){const v=n.add.graphics(),_=[()=>{},()=>{v.fillStyle(1710618,.7),v.fillRect(-t*.22,y-t*.02,t*.14,t*.04),v.fillRect(t*.08,y-t*.02,t*.14,t*.04)},()=>{v.fillStyle(9109504,.6),v.fillRect(-t*.02,-t*.3,t*.04,t*.5)},()=>{v.lineStyle(3*r,1710618,.7),v.moveTo(-t*.2,-t*.12),v.lineTo(-t*.12,-t*.08),v.lineTo(-t*.2,-t*.04),v.strokePath(),v.moveTo(t*.2,-t*.12),v.lineTo(t*.12,-t*.08),v.lineTo(t*.2,-t*.04),v.strokePath()},()=>{v.fillStyle(9109504,.6),v.fillRect(-S-t*.01,y+t*.04,t*.02,t*.12),v.fillRect(S-t*.01,y+t*.04,t*.02,t*.12)}];_[e.warpaintIndex%_.length](),s.add(v)}if(e.hoodIndex>0){const v=n.add.graphics(),_=[()=>{},()=>{v.fillStyle(2760474,.95),v.beginPath(),v.moveTo(-t*.35,t*.1),v.lineTo(-t*.32,-t*.25),v.lineTo(-t*.15,-t*.38),v.lineTo(0,-t*.42),v.lineTo(t*.15,-t*.38),v.lineTo(t*.32,-t*.25),v.lineTo(t*.35,t*.1),v.closePath(),v.fillPath(),v.fillStyle(657413,.5),v.fillEllipse(0,-t*.05,t*.28,t*.35)},()=>{v.fillStyle(5921370,1),v.fillEllipse(0,-t*.12,t*.4,t*.32),v.fillRect(-t*.02,-t*.25,t*.04,t*.2),v.fillStyle(1710618,1),v.fillRect(-t*.15,y-t*.01,t*.08,t*.03),v.fillRect(t*.07,y-t*.01,t*.08,t*.03),v.fillStyle(9079434,.4),v.fillEllipse(-t*.1,-t*.25,t*.08,t*.04)}];_[e.hoodIndex%_.length](),s.add(v)}for(const v of e.injuryOverlays){const _=n.add.graphics();v.includes("head")?(_.fillStyle(15261904,.9),_.fillRect(-t*.2,-t*.28,t*.4,t*.06),_.fillStyle(9109504,.4),_.fillCircle(-t*.05,-t*.25,t*.04)):v.includes("body")&&(_.fillStyle(4862032,.3),_.fillEllipse(t*.1,t*.15,t*.08,t*.06)),s.add(_)}const J=n.add.graphics();return J.lineStyle(2,13216089,.15),J.strokeCircle(0,0,(t/2+8)*1.1),s.add(J),n.tweens.add({targets:s,scaleX:1.01,scaleY:.99,duration:3e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),s}static renderMiniPortrait(n,e,a,i,t){const s=n.add.container(a,i),r=n.add.graphics();r.fillStyle(1709072,1),r.fillCircle(0,0,t/2+2),r.lineStyle(2,5917242,1),r.strokeCircle(0,0,t/2+2),s.add(r);const o=w.Display.Color.HexStringToColor(e.skinTone).color,d=n.add.graphics();d.fillStyle(o,1),d.fillCircle(0,0,t/2-2),s.add(d);const l=n.add.graphics();return l.fillStyle(16777215,1),l.fillCircle(-t*.15,-t*.08,t*.08),l.fillCircle(t*.15,-t*.08,t*.08),l.fillStyle(2759184,1),l.fillCircle(-t*.15,-t*.08,t*.04),l.fillCircle(t*.15,-t*.08,t*.04),s.add(l),s}}const Ne=52,Dt=200,mt=new Map,Aa={width:180,height:52,fontSize:14,fontColor:"#8b7355",bgColor:2760474,hoverColor:3813162,strokeColor:5917242,hoverStrokeColor:13216089,primary:!1,disabled:!1,icon:void 0},Ba={fontColor:"#c9a959",bgColor:4864554,hoverColor:5917242,strokeColor:13216089,hoverStrokeColor:14334314};class G extends w.GameObjects.Container{constructor(e,a,i,t,s,r={}){super(e,a,i);m(this,"bg");m(this,"labelText");m(this,"iconText");m(this,"hitArea");m(this,"config");m(this,"callback");m(this,"lastTapTime",0);m(this,"isPressed",!1);m(this,"isHovered",!1);m(this,"_disabled",!1);e.add.existing(this),this.config={...Aa,...r.primary?Ba:{},...r},this.callback=s,this._disabled=this.config.disabled,this.config.width=Math.max(this.config.width,Ne),this.config.height=Math.max(this.config.height,Ne),this.bg=e.add.graphics(),this.add(this.bg),this.config.icon&&(this.iconText=e.add.text(-this.config.width/2+25,0,this.config.icon,{fontSize:`${this.config.fontSize+4}px`}).setOrigin(.5),this.add(this.iconText));const o=this.config.icon?10:0;this.labelText=e.add.text(o,0,t,{fontFamily:"Georgia, serif",fontSize:`${this.config.fontSize}px`,color:this.config.fontColor}).setOrigin(this.config.icon?0:.5,.5),this.add(this.labelText);const d=this.config.width+20,l=this.config.height+16;this.hitArea=e.add.rectangle(0,0,d,l,0,0),this.add(this.hitArea),this.hitArea.setInteractive({useHandCursor:!this._disabled}),this.draw(),this.setupInput(),this.setDepth(10)}setupInput(){this.hitArea.on("pointerover",this.onPointerOver,this),this.hitArea.on("pointerout",this.onPointerOut,this),this.hitArea.on("pointerdown",this.onPointerDown,this),this.hitArea.on("pointerup",this.onPointerUp,this),this.hitArea.on("pointerupoutside",()=>{this.isPressed=!1,this.draw()})}onPointerOver(){this._disabled||(this.isHovered=!0,this.draw())}onPointerOut(){this._disabled||(this.isHovered=!1,this.isPressed=!1,this.draw())}onPointerDown(e){this._disabled||(this.isPressed=!0,this.draw(),this.setScale(.95))}onPointerUp(e){if(this._disabled)return;this.setScale(1);const a=this.isPressed;if(this.isPressed=!1,this.draw(),!a)return;const i=Date.now();if(!(i-this.lastTapTime<Dt)){this.lastTapTime=i;try{this.callback()}catch(t){console.error(`[Button] Callback error for "${this.labelText.text}":`,t)}}}draw(){this.bg.clear();const e=this.config.width,a=this.config.height;let i=this.config.bgColor,t=this.config.strokeColor;this._disabled?(i=1709328,t=3811866):this.isPressed?(i=this.config.hoverColor-1052688,t=this.config.hoverStrokeColor):this.isHovered&&(i=this.config.hoverColor,t=this.config.hoverStrokeColor),this.bg.fillStyle(i,1),this.bg.fillRoundedRect(-e/2,-a/2,e,a,8),this.bg.lineStyle(2,t,1),this.bg.strokeRoundedRect(-e/2,-a/2,e,a,8);const s=this._disabled?"#4a3a2a":this.isHovered||this.config.primary?"#c9a959":this.config.fontColor;this.labelText.setColor(s),this.setAlpha(this._disabled?.6:1)}drawDebugHitbox(){const e=this.scene;let a=mt.get(e);a||(a=e.add.graphics(),a.setDepth(9999),mt.set(e,a));const i=this.hitArea.getBounds();a.lineStyle(2,16711680,.8),a.strokeRect(i.x,i.y,i.width,i.height),a.lineStyle(1,65280,.6),a.strokeRect(this.x-this.config.width/2,this.y-this.config.height/2,this.config.width,this.config.height)}setText(e){return this.labelText.setText(e),this}setIcon(e){return this.iconText&&this.iconText.setText(e),this}setDisabled(e){return this._disabled=e,this.hitArea.input.enabled=!e,e?this.hitArea.disableInteractive():this.hitArea.setInteractive({useHandCursor:!0}),this.draw(),this}isDisabled(){return this._disabled}setCallback(e){return this.callback=e,this}destroy(e){this.hitArea.off("pointerover",this.onPointerOver,this),this.hitArea.off("pointerout",this.onPointerOut,this),this.hitArea.off("pointerdown",this.onPointerDown,this),this.hitArea.off("pointerup",this.onPointerUp,this),super.destroy(e)}}class Ea extends w.GameObjects.Container{constructor(e,a,i,t,s,r=44){super(e,a,i);m(this,"bg");m(this,"iconText");m(this,"hitArea");m(this,"callback");m(this,"lastTapTime",0);m(this,"size");m(this,"_disabled",!1);e.add.existing(this),this.callback=s,this.size=Math.max(r,Ne),this.bg=e.add.graphics(),this.add(this.bg),this.iconText=e.add.text(0,0,t,{fontSize:`${Math.floor(this.size*.5)}px`}).setOrigin(.5),this.add(this.iconText);const o=this.size+12;this.hitArea=e.add.rectangle(0,0,o,o,0,0),this.hitArea.setInteractive({useHandCursor:!0}),this.add(this.hitArea),this.draw(!1),this.setupInput(),this.setDepth(10)}setupInput(){this.hitArea.on("pointerover",()=>this.draw(!0)),this.hitArea.on("pointerout",()=>this.draw(!1)),this.hitArea.on("pointerdown",()=>this.setScale(.9)),this.hitArea.on("pointerup",()=>{this.setScale(1);const e=Date.now();e-this.lastTapTime<Dt||(this.lastTapTime=e,this._disabled||this.callback())})}draw(e){this.bg.clear();const a=e?3813162:2760474,i=e?13216089:5917242;this.bg.fillStyle(a,1),this.bg.fillCircle(0,0,this.size/2),this.bg.lineStyle(2,i,1),this.bg.strokeCircle(0,0,this.size/2)}setIcon(e){return this.iconText.setText(e),this}setDisabled(e){return this._disabled=e,this.setAlpha(e?.5:1),this}}const Fa={aggressive:{id:"aggressive",name:"Aggressive",icon:"âš”ï¸",description:"All-out attack. More damage, less defense.",effects:{damageBonus:20,defenseBonus:-15,guardBonus:-20,dodgeBonus:-10,staminaCostMod:10,accuracyBonus:5}},balanced:{id:"balanced",name:"Balanced",icon:"âš–ï¸",description:"No bonuses or penalties. Standard fighting.",effects:{damageBonus:0,defenseBonus:0,guardBonus:0,dodgeBonus:0,staminaCostMod:0,accuracyBonus:0}},defensive:{id:"defensive",name:"Defensive",icon:"ðŸ›¡ï¸",description:"Focus on defense. Better guard and dodge, less damage.",effects:{damageBonus:-15,defenseBonus:20,guardBonus:25,dodgeBonus:15,staminaCostMod:-5,accuracyBonus:-5}}};function Da(c){const n={damage_penalty:0,defense_penalty:0,accuracy_penalty:0,stamina_penalty:0,speed_penalty:0,bleed_dot:0};for(const e of c)for(const a of e.effects)a.type in n&&(n[a.type]+=a.value);return n}const gt={bronze:240,silver:320,gold:420,champion:550};function Oa(c,n=0){const e=gt[c]||gt.bronze,a=Math.min(n,5)*.03;return Math.round(e*(1+a))}function Ot(c){return c<.9?{tier:"struggling",label:"Struggling",description:"Underpowered for this league. Train or upgrade gear.",color:"#cd5c5c"}:c<1.1?{tier:"average",label:"Average",description:"On par with typical fighters in this league.",color:"#8b7355"}:c<1.3?{tier:"strong",label:"Strong",description:"Above average for this league.",color:"#6b8e23"}:{tier:"overpowered",label:"Overpowered",description:"Dominating this league. Ready for promotion.",color:"#daa520"}}const L={hp:.35,damage:1.8,defense:.9,stamina:.25,staminaRegen:2,crit:1.2,critDamage:.15,dodge:1,parry:1.5,speed:3,accuracy:.5,resistance:.3,special:5},Ga={bronze:1,silver:1.05,gold:1.1,champion:1.15};function pe(c,n,e){const a=n??p.getInventory(),i=e??p.getLoadout(),t=tt(a,i),s=p.getWounds(),r=p.getRun();return We(c,t,s,r.league)}function We(c,n,e=[],a="bronze"){const i=c.currentStats,t=Da(e),s=i.maxHP*L.hp,r=i.maxStamina*L.stamina+(n.staminaRegenMod+10)*L.staminaRegen,o=(n.damageMin+n.damageMax)/2,d=(i.attack+o)*L.damage,h=(i.defense+n.totalDefense)*L.defense,u=(i.critChance+n.critChanceMod)*L.crit+i.critDamage*L.critDamage,f=(n.dodgeMod+10)*L.dodge,g=(i.speed+n.speedMod)*L.speed,y=i.defense/5*L.parry,S=(i.accuracy+n.accuracyMod)*L.accuracy,b=(n.bleedResist+n.stunResist+n.poisonResist+n.critResist)*L.resistance;let M=0;n.weaponEffects.length>0&&(M+=n.weaponEffects.length*L.special),n.armorPerks.length>0&&(M+=n.armorPerks.length*L.special*.5);let C=0;c.signatureTrait&&(C=15);let x=0;t.damage_penalty&&(x+=Math.abs(t.damage_penalty)*L.damage*.5),t.defense_penalty&&(x+=Math.abs(t.defense_penalty)*L.defense*.5),t.accuracy_penalty&&(x+=Math.abs(t.accuracy_penalty)*L.accuracy*.5);const R=s+r+g+S,B=d+u,P=h+b,H=C+M,A=y+f,F=x;let K=R+B+P+H+A-F;const Se=Ga[a]||1;K*=Se;const q=Math.round(K),J=Oa(a,0),v=J>0?q/J:1,_=Ot(v);return{power:q,tier:_.tier,tierLabel:_.label,tierDescription:_.description,ratio:v,expectedPower:J,breakdown:{baseStats:Math.round(R),weapon:Math.round(B),armor:Math.round(P),traits:Math.round(H),buffs:Math.round(A),penalties:Math.round(F),details:{hp:Math.round(s),damage:Math.round(d),defense:Math.round(h),stamina:Math.round(r),crit:Math.round(u),dodge:Math.round(f),parry:Math.round(y),speed:Math.round(g),resistances:Math.round(b),special:Math.round(M)}}}}function Ha(c,n){const e=c/Math.max(n,1);return e>=1.5?{label:"Easy",color:"#6b8e23",description:"You outclass this opponent."}:e>=1.15?{label:"Fair",color:"#8b7355",description:"A balanced fight."}:e>=.85?{label:"Even",color:"#daa520",description:"Could go either way."}:e>=.6?{label:"Risky",color:"#cd5c5c",description:"Prepare carefully."}:{label:"Deadly",color:"#8b0000",description:"Expect to lose."}}function La(c,n){const e=n-c;return e>0?{delta:e,text:`+${e}`,color:"#6b8e23"}:e<0?{delta:e,text:`${e}`,color:"#8b0000"}:{delta:0,text:"Â±0",color:"#5a4a3a"}}function re(c){const{tier:n,power:e,expectedPower:a,ratio:i,breakdown:t}=c,s=Ot(i),r=[];t.weapon<t.baseStats*.3&&r.push("Upgrade your weapon for more damage."),t.armor<15&&r.push("Better armor would help your defense."),t.penalties>0&&r.push("You have wounds reducing your power."),n==="overpowered"&&r.push("You might be ready for the next league.");const o=e-a,d=o>=0?`+${o} vs expected`:`${o} vs expected`;return{label:s.label,description:s.description,color:s.color,vsExpected:d,tips:r}}function ae(c){return c.toLocaleString()}class $a extends w.Scene{constructor(){super({key:"RecruitScene"});m(this,"candidates",[]);m(this,"selectedIndex",-1);m(this,"candidateContainers",[]);m(this,"detailsContainer")}create(){const e=p.getRun();k.init(e.seed);const a=p.getMeta();this.candidates=[De(a.promoterLevel),De(a.promoterLevel),De(a.promoterLevel)];const i=Pa();for(const t of this.candidates){for(const[s,r]of Object.entries(i))typeof r=="number"&&s in t.baseStats&&(t.baseStats[s]+=r);t.currentStats=ba(t)}this.createBackground(),this.createHeader(),this.createCandidateCards(),this.createDetailsPanel(),this.createConfirmButton(),this.cameras.main.fadeIn(300)}createBackground(){const{width:e,height:a}=this.cameras.main,i=this.add.graphics();if(i.fillGradientStyle(1709072,1709072,2760474,2760474),i.fillRect(0,0,e,a),this.textures.exists("parchment_overlay")){const t=this.add.image(e/2,a/2,"parchment_overlay");t.setAlpha(.08),t.setDisplaySize(e,a)}}createHeader(){const{width:e}=this.cameras.main;this.add.text(e/2,40,"CHOOSE YOUR FIGHTER",{fontFamily:"Georgia, serif",fontSize:"24px",color:"#c9a959",stroke:"#000000",strokeThickness:3}).setOrigin(.5),this.add.text(e/2,70,"Three souls await judgment. Only one will enter the arena.",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b7355",fontStyle:"italic"}).setOrigin(.5)}createCandidateCards(){const{width:e}=this.cameras.main,a=110,i=e/2-a*1.5,t=180;this.candidates.forEach((s,r)=>{const o=this.createCandidateCard(s,i+r*(a+10),t,r);this.candidateContainers.push(o)})}createCandidateCard(e,a,i,t){const s=this.add.container(a,i),r=110,o=200,d=this.add.graphics();d.fillStyle(2760474,1),d.fillRoundedRect(0,0,r,o,8),d.lineStyle(2,5917242,1),d.strokeRoundedRect(0,0,r,o,8),s.add(d);const l=We(e,ct,[],"bronze"),h=re(l),u=this.add.graphics();u.fillStyle(1709328,.9),u.fillRoundedRect(r/2-30,5,60,18,3),s.add(u);const f=this.add.text(r/2,14,`âš¡${ae(l.power)}`,{fontFamily:"Georgia, serif",fontSize:"10px",color:h.color}).setOrigin(.5);s.add(f);const g=ce.renderMiniPortrait(this,e.portrait,r/2,55,60);s.add(g);const y=this.add.text(r/2,100,e.firstName,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#c9a959"}).setOrigin(.5);s.add(y);const S=this.add.text(r/2,117,`"${e.nickname}"`,{fontFamily:"Georgia, serif",fontSize:"9px",color:"#8b7355",fontStyle:"italic"}).setOrigin(.5);s.add(S);const b=this.add.text(r/2,133,`Age ${e.age}`,{fontFamily:"Georgia, serif",fontSize:"9px",color:"#5a4a3a"}).setOrigin(.5);s.add(b);const M=this.add.text(r/2,155,e.signatureTrait.name,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#6b8e23"}).setOrigin(.5);if(s.add(M),e.flaws.length>0){const x=this.add.text(r/2,173,e.flaws[0].name,{fontFamily:"Georgia, serif",fontSize:"9px",color:"#8b4513"}).setOrigin(.5);s.add(x)}const C=this.add.rectangle(r/2,o/2,r,o,16777215,0);return C.setInteractive({useHandCursor:!0}),s.add(C),C.on("pointerover",()=>{this.selectedIndex!==t&&(d.clear(),d.fillStyle(3813162,1),d.fillRoundedRect(0,0,r,o,8),d.lineStyle(2,9139029,1),d.strokeRoundedRect(0,0,r,o,8))}),C.on("pointerout",()=>{this.selectedIndex!==t&&(d.clear(),d.fillStyle(2760474,1),d.fillRoundedRect(0,0,r,o,8),d.lineStyle(2,5917242,1),d.strokeRoundedRect(0,0,r,o,8))}),C.on("pointerdown",()=>{this.selectCandidate(t)}),s}createDetailsPanel(){const{width:e,height:a}=this.cameras.main;this.detailsContainer=this.add.container(e/2,400);const i=this.add.text(0,0,"Select a fighter to view details",{fontFamily:"Georgia, serif",fontSize:"14px",color:"#5a4a3a",fontStyle:"italic"}).setOrigin(.5);this.detailsContainer.add(i)}updateDetailsPanel(e){this.detailsContainer.removeAll(!0);const a=-100,i=this.add.text(0,a,e.fullName,{fontFamily:"Georgia, serif",fontSize:"18px",color:"#c9a959"}).setOrigin(.5);this.detailsContainer.add(i);const t=this.add.text(0,a+30,e.backstory,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b7355",fontStyle:"italic",wordWrap:{width:320},align:"center"}).setOrigin(.5);this.detailsContainer.add(t);const s=We(e,ct,[],"bronze"),r=re(s),o=this.add.text(0,a+65,`âš¡ POWER: ${ae(s.power)} (${r.label})`,{fontFamily:"Georgia, serif",fontSize:"12px",color:r.color}).setOrigin(.5);this.detailsContainer.add(o);const d=e.currentStats,l=`HP: ${d.maxHP} | ATK: ${d.attack} | DEF: ${d.defense} | SPD: ${d.speed}`,h=this.add.text(0,a+88,l,{fontFamily:"Georgia, serif",fontSize:"12px",color:"#c9a959"}).setOrigin(.5);this.detailsContainer.add(h);const u=this.add.text(0,a+115,`Signature: ${e.signatureTrait.name}`,{fontFamily:"Georgia, serif",fontSize:"13px",color:"#6b8e23"}).setOrigin(.5);this.detailsContainer.add(u);const f=this.add.text(0,a+135,e.signatureTrait.description,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#5a4a3a",wordWrap:{width:280},align:"center"}).setOrigin(.5);if(this.detailsContainer.add(f),e.flaws.length>0){const S=this.add.text(0,a+170,`Flaw: ${e.flaws[0].name}`,{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b4513"}).setOrigin(.5);this.detailsContainer.add(S);const b=this.add.text(0,a+188,e.flaws[0].description,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#5a4a3a"}).setOrigin(.5);this.detailsContainer.add(b)}const g=this.add.text(0,a+218,`Keepsake: ${e.keepsake.name}`,{fontFamily:"Georgia, serif",fontSize:"12px",color:"#c9a959"}).setOrigin(.5);this.detailsContainer.add(g);const y=this.add.text(0,a+236,e.keepsake.effect,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355"}).setOrigin(.5);this.detailsContainer.add(y)}selectCandidate(e){if(this.selectedIndex>=0){const s=this.candidateContainers[this.selectedIndex].first;s.clear(),s.fillStyle(2760474,1),s.fillRoundedRect(0,0,110,200,8),s.lineStyle(2,5917242,1),s.strokeRoundedRect(0,0,110,200,8)}this.selectedIndex=e;const i=this.candidateContainers[e].first;i.clear(),i.fillStyle(3813162,1),i.fillRoundedRect(0,0,110,200,8),i.lineStyle(3,13216089,1),i.strokeRoundedRect(0,0,110,200,8),this.updateDetailsPanel(this.candidates[e])}createConfirmButton(){const{width:e,height:a}=this.cameras.main,i=new G(this,e/2,a-60,"RECRUIT THIS FIGHTER",()=>this.confirmSelection(),{width:240,height:50,primary:!0,disabled:!0});this.events.on("update",()=>{this.selectedIndex>=0&&i.isDisabled()&&i.setDisabled(!1)})}confirmSelection(){if(this.selectedIndex<0)return;const e=this.candidates[this.selectedIndex],a=p.getRun();a.fighter=e,p.updateRun(a),this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("PromiseScene")})}}const Oe=[{id:"sleepless_night",title:"Sleepless Night",description:"Your fighter tosses and turns, haunted by memories. You hear muttering in the dark.",category:"camp",choices:[{id:"comfort",text:"Sit with them, offer comfort",effects:{trust:8,stamina:-10},resultText:"You stay up talking until dawn. The bond strengthens, but rest was lost."},{id:"leave",text:"Let them work through it alone",effects:{trust:-3},resultText:"Sometimes people need space. Whether this was the right call remains to be seen."},{id:"drink",text:"Share a drink to ease the mind",effects:{trust:5,hp:-5},resultText:"The drink helps, but the hangover tomorrow won't be pleasant."}]},{id:"old_friend",title:"An Old Friend",description:"Someone from your fighter's past appears at the camp. Their expression is unreadable.",category:"camp",choices:[{id:"welcome",text:"Welcome them warmly",effects:{trust:5,gold:-15},resultText:"You provide food and drink. The visitor leaves with a smile and a lighter purse for you."},{id:"suspicious",text:"Keep them at arm's length",effects:{trust:-2},resultText:"The visitor leaves, disappointed. Your fighter seems conflicted."},{id:"private",text:"Give them privacy to talk",effects:{trust:3},resultText:"Whatever was said stays between them. Your fighter seems... different after."}]},{id:"rival_encounter",title:"Rival's Shadow",description:"Your fighter's rival has been seen nearby, watching your training sessions.",category:"camp",choices:[{id:"confront",text:"Confront them directly",effects:{trust:3,fame:5},resultText:"A tense exchange of words. The crowd nearby takes notice. Good for reputation."},{id:"ignore",text:"Ignore them completely",effects:{trust:-2},resultText:"Your fighter seems disappointed you didn't stand up for them."},{id:"wave",text:"Wave mockingly",effects:{fame:3},resultText:"A small psychological victory. The rival stalks off, fuming."}]},{id:"injured_rest",title:"The Weight of Wounds",description:"Your fighter's injuries are clearly bothering them. They wince with every movement.",category:"camp",requirements:{hasInjury:!0},choices:[{id:"force_rest",text:"Insist on complete rest",effects:{trust:5,injuryHeal:1},resultText:"A day of nothing but rest and recovery. The wounds begin to close."},{id:"push_through",text:"Tell them to push through",effects:{trust:-5,stamina:10},resultText:"They train through the pain. Tougher, but at what cost?"},{id:"healer",text:"Pay for a healer visit",effects:{gold:-30,trust:3,injuryHeal:1},resultText:"Professional care makes a difference. Money well spent."}]},{id:"crowd_recognition",title:"Famous Face",description:"People in the market are pointing and whispering. Your fighter has been recognized.",category:"camp",requirements:{minWeek:3},choices:[{id:"acknowledge",text:"Wave to the crowd",effects:{fame:8,trust:2},resultText:"The crowd cheers! Your fighter beams with pride."},{id:"humble",text:"Stay humble, keep walking",effects:{trust:5},resultText:"A quiet moment of recognition. Character matters more than fame."},{id:"showoff",text:"Put on a show",effects:{fame:15,stamina:-15,trust:-3},resultText:"A dazzling display! But the exertion takes its toll, and your fighter seems annoyed."}]},{id:"nightmare",title:"Dark Dreams",description:"Your fighter wakes screaming from a nightmare about dying in the arena.",category:"camp",choices:[{id:"promise",text:`"I won't let that happen."`,effects:{trust:10},resultText:"Your words carry weight. The promise hangs in the air between you."},{id:"realistic",text:`"It's a real risk. We both know that."`,effects:{trust:2},resultText:"Honesty is respected, if not comforting."},{id:"dismiss",text:'"Just a dream. Go back to sleep."',effects:{trust:-5},resultText:"Your fighter rolls over, alone with their fears."}]},{id:"shady_surgeon",title:"The Surgeon's Offer",description:'A hooded figure approaches with a leather bag of tools. "I can fix those injuries... permanently. For a price."',category:"offer",requirements:{hasInjury:!0},choices:[{id:"accept",text:"Accept the surgery",effects:{gold:-50,injuryHeal:3,injury:"minor",trust:-5},resultText:"The surgery is painful and the methods questionable, but the wounds heal faster. Something feels... different."},{id:"refuse",text:"Refuse firmly",effects:{trust:5},resultText:'Your fighter relaxes visibly. "Thank you for not selling me to butchers."'},{id:"bargain",text:"Negotiate a better price",effects:{gold:-25,injuryHeal:2,trust:-3},resultText:"A lesser procedure at a lesser price. The results are... acceptable."}]},{id:"cursed_weapon",title:"The Black Blade",description:'A merchant offers a blade that seems to drink in the light. "Powerful. Deadly. But demanding."',category:"offer",choices:[{id:"accept",text:"Take the blade",effects:{gold:-40,hp:-10,buff:"cursed_weapon"},resultText:"The blade feels wrong in the hand, but the power is undeniable."},{id:"refuse",text:"Walk away",effects:{trust:3},resultText:`"Wise choice," your fighter murmurs. Some things aren't worth the cost.`},{id:"examine",text:"Examine it closely first",effects:{gold:-10},resultText:"You pay for an appraisal. The blade is powerful but cursed. Knowledge gained."}]},{id:"sponsor_deal",title:"The Sponsor",description:"A wealthy patron offers gold in exchange for... loyalty. Their smile doesn't reach their eyes.",category:"offer",requirements:{minWeek:2},choices:[{id:"accept",text:"Accept the sponsorship",effects:{gold:100,reputation:-5,trust:-10},resultText:"The gold flows freely, but strings are attached. Your fighter looks at you differently now."},{id:"refuse",text:"Decline politely",effects:{trust:8},resultText:`"We don't need their kind," your fighter says with relief.`},{id:"negotiate",text:"Counter-offer with terms",effects:{gold:50,reputation:-2,trust:-3},resultText:"A compromise is reached. Less gold, fewer strings."}]},{id:"poison_offer",title:"Unfair Advantage",description:`A quiet voice in the dark offers a vial. "Coat your blade. They'll never know."`,category:"offer",choices:[{id:"accept",text:"Take the poison",effects:{gold:-30,trust:-15,buff:"poison_blade"},resultText:"Your fighter's face hardens. Honor is a luxury, after all."},{id:"refuse_loudly",text:"Refuse and report them",effects:{trust:10,fame:5},resultText:"Word spreads of your honor. Your fighter stands taller."},{id:"refuse_quietly",text:"Just say no",effects:{trust:5},resultText:"The figure melts into shadows. Some offers are better forgotten."}]},{id:"letter_home",title:"A Letter Home",description:"Your fighter sits with quill and parchment, struggling to find words.",category:"letter",choices:[{id:"help",text:"Help them write",effects:{trust:8},resultText:"Together you craft a message of hope and determination. The letter is finished."},{id:"private",text:"Give them privacy",effects:{trust:3},resultText:"Some words are too personal to share. The letter is sealed in silence."},{id:"discourage",text:"Suggest they focus on training instead",effects:{trust:-8,stamina:10},resultText:"The parchment is put away. Your fighter trains harder, but something is lost."}]},{id:"letter_response",title:"News From Home",description:"A letter arrives for your fighter. Their hands tremble as they read.",category:"letter",choices:[{id:"ask",text:"Ask what it says",effects:{trust:5},resultText:"They share the news. Family is well. A weight lifts from their shoulders."},{id:"space",text:"Give them time alone",effects:{trust:3},resultText:"When they emerge, their eyes are red but their resolve is firm."},{id:"practical",text:"Remind them we have work to do",effects:{trust:-5},resultText:"The letter is folded away. Duty calls, but at what cost?"}]},{id:"write_legacy",title:"Words for the Future",description:"Your fighter wants to write something to be read if they don't survive.",category:"letter",choices:[{id:"support",text:"Help them prepare this",effects:{trust:12},resultText:"A sobering task, but important. The letter is sealed and stored safely."},{id:"optimistic",text:`"You'll deliver it yourself."`,effects:{trust:5},resultText:"Your confidence is infectious. They smile, but keep writing anyway."},{id:"avoid",text:"Change the subject",effects:{trust:-3},resultText:"The topic is dropped, but the unwritten words hang between you."}]},{id:"stray_dog",title:"The Stray",description:"A scrawny dog has been following your fighter around camp.",category:"event",choices:[{id:"adopt",text:"Keep the dog",effects:{trust:8,gold:-10},resultText:"Your fighter names it immediately. Loyalty comes in many forms."},{id:"feed",text:"Feed it and send it away",effects:{trust:2,gold:-5},resultText:"A small kindness. The dog looks back once before leaving."},{id:"ignore",text:"Ignore it",effects:{trust:-2},resultText:"The dog eventually leaves. Your fighter watches it go with sad eyes."}]},{id:"gambler",title:"Double or Nothing",description:"Your fighter found a dice game in the back alleys.",category:"event",requirements:{minTrust:30},choices:[{id:"allow",text:"Let them gamble",effects:{gold:30,trust:5},resultText:"Lady luck smiles! Your fighter returns with a grin and coin."},{id:"forbid",text:"Forbid it",effects:{trust:-8},resultText:"They obey, but resentment simmers. You're not their parent."},{id:"join",text:"Join the game",effects:{gold:-20,trust:10},resultText:"You lose some coin but gain a memory. Worth every copper."}]},{id:"arena_tour",title:"Sacred Ground",description:"An opportunity to visit the Grand Arena at night, when it's empty.",category:"event",choices:[{id:"go",text:"Go together",effects:{trust:10,fame:3},resultText:"Standing on the sand, imagining the crowds. A moment of shared dreams."},{id:"train",text:"Use the time to train instead",effects:{stamina:15,trust:-2},resultText:"Practical, but something magical is missed."},{id:"alone",text:"Send them alone",effects:{trust:5},resultText:"Some experiences are personal. They return with fire in their eyes."}]},{id:"bad_food",title:"Spoiled Supplies",description:"Your food stores have gone bad. Someone needs to deal with this.",category:"event",choices:[{id:"buy_new",text:"Buy fresh supplies",effects:{gold:-25,trust:3},resultText:"New supplies secured. Your fighter appreciates proper meals."},{id:"make_do",text:"Make do with what's edible",effects:{hp:-10,trust:-3},resultText:"A rough few days. Stomachs suffer, but coin is saved."},{id:"hunt",text:"Go hunting for fresh meat",effects:{stamina:-10,trust:5},resultText:"A successful hunt! Fresh meat and bonding time."}]},{id:"festival",title:"Festival Night",description:"The town is celebrating. Music and laughter fill the streets.",category:"event",choices:[{id:"celebrate",text:"Join the celebration",effects:{gold:-15,trust:8,stamina:-10},resultText:"A night of joy and revelry. Some things matter more than training."},{id:"observe",text:"Watch from the edge",effects:{trust:3},resultText:"You share quiet observations about the crowd. A different kind of bonding."},{id:"train",text:"Use the empty training grounds",effects:{stamina:15,trust:-5},resultText:"Productive, but your fighter keeps glancing toward the music."}]}],Na=[{id:"survival",name:"I'll get you out alive",description:"Promise to prioritize survival. Earlier and cheaper retirement options.",effect:"-30% retirement cost, available after 3 wins",mechanicBonus:{retirementDiscount:.3,earlyRetirement:!0}},{id:"glory",name:"We'll win the belt",description:"Promise to fight for the championship. Greater rewards, harder path.",effect:"+20% gold/fame rewards, +10% enemy stats",mechanicBonus:{rewardBonus:.2,enemyStatBonus:.1}},{id:"honor",name:"We fight with honor",description:"Promise to fight fairly. Crowd loves you, fewer shady opportunities.",effect:"+30% crowd hype gain, no shady offers",mechanicBonus:{hypeBonus:.3,noShadyOffers:!0}},{id:"vengeance",name:"We'll make them pay",description:"Promise to defeat every rival. Bonus damage to rivals, they seek you out.",effect:"+25% damage to rivals, rivals appear more often",mechanicBonus:{rivalDamageBonus:.25,rivalFrequency:2}},{id:"legacy",name:"Your name will echo forever",description:"Promise to build a legend. Extra bloodline points, more fame.",effect:"+50% fame gain, +1 bloodline point per league advanced",mechanicBonus:{fameBonus:.5,bloodlineBonus:1}}];class Wa extends w.Scene{constructor(){super({key:"PromiseScene"});m(this,"selectedPromise",null);m(this,"promiseContainers",new Map)}create(){var t;const{width:e,height:a}=this.cameras.main,i=p.getRun();this.createBackground(),this.createHeader(((t=i.fighter)==null?void 0:t.firstName)||"Fighter"),this.createPromiseCards(),this.createConfirmButton(),this.cameras.main.fadeIn(300)}createBackground(){const{width:e,height:a}=this.cameras.main,i=this.add.graphics();if(i.fillGradientStyle(1709072,1709072,2760474,2760474),i.fillRect(0,0,e,a),this.textures.exists("parchment_overlay")){const t=this.add.image(e/2,a/2,"parchment_overlay");t.setAlpha(.08),t.setDisplaySize(e,a)}}createHeader(e){const{width:a}=this.cameras.main;this.add.text(a/2,40,"MAKE A PROMISE",{fontFamily:"Georgia, serif",fontSize:"24px",color:"#c9a959",stroke:"#000000",strokeThickness:3}).setOrigin(.5),this.add.text(a/2,70,`What will you promise ${e}?`,{fontFamily:"Georgia, serif",fontSize:"13px",color:"#8b7355",fontStyle:"italic"}).setOrigin(.5),this.add.text(a/2,90,"This choice will define your journey together.",{fontFamily:"Georgia, serif",fontSize:"11px",color:"#5a4a3a"}).setOrigin(.5)}createPromiseCards(){const{width:e}=this.cameras.main,a=320,i=100,t=130,s=110;Na.forEach((r,o)=>{const d=t+o*s,l=this.createPromiseCard(r,e/2-a/2,d,a,i);this.promiseContainers.set(r.id,l)})}createPromiseCard(e,a,i,t,s){const r=this.add.container(a,i),o=this.add.graphics();o.fillStyle(2760474,1),o.fillRoundedRect(0,0,t,s,8),o.lineStyle(2,5917242,1),o.strokeRoundedRect(0,0,t,s,8),r.add(o);const d=this.add.text(t/2,18,`"${e.name}"`,{fontFamily:"Georgia, serif",fontSize:"15px",color:"#c9a959"}).setOrigin(.5);r.add(d);const l=this.add.text(t/2,42,e.description,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b7355",wordWrap:{width:t-30},align:"center"}).setOrigin(.5);r.add(l);const h=this.add.text(t/2,75,e.effect,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#6b8e23"}).setOrigin(.5);r.add(h);const u=this.add.rectangle(t/2,s/2,t,s,16777215,0);return u.setInteractive({useHandCursor:!0}),r.add(u),u.on("pointerover",()=>{this.selectedPromise!==e.id&&(o.clear(),o.fillStyle(3813162,1),o.fillRoundedRect(0,0,t,s,8),o.lineStyle(2,9139029,1),o.strokeRoundedRect(0,0,t,s,8))}),u.on("pointerout",()=>{this.selectedPromise!==e.id&&(o.clear(),o.fillStyle(2760474,1),o.fillRoundedRect(0,0,t,s,8),o.lineStyle(2,5917242,1),o.strokeRoundedRect(0,0,t,s,8))}),u.on("pointerdown",()=>{this.selectPromise(e.id,t,s)}),r}selectPromise(e,a,i){if(this.selectedPromise){const s=this.promiseContainers.get(this.selectedPromise);if(s){const r=s.first;r.clear(),r.fillStyle(2760474,1),r.fillRoundedRect(0,0,a,i,8),r.lineStyle(2,5917242,1),r.strokeRoundedRect(0,0,a,i,8)}}this.selectedPromise=e;const t=this.promiseContainers.get(e);if(t){const s=t.first;s.clear(),s.fillStyle(3813162,1),s.fillRoundedRect(0,0,a,i,8),s.lineStyle(3,13216089,1),s.strokeRoundedRect(0,0,a,i,8)}}createConfirmButton(){const{width:e,height:a}=this.cameras.main,i=T.createButton(this,e/2,a-60,"SEAL THIS PROMISE",()=>this.confirmPromise(),{width:220,height:50,primary:!0});i.setAlpha(.5),this.events.on("update",()=>{i.setAlpha(this.selectedPromise?1:.5)})}confirmPromise(){if(!this.selectedPromise)return;p.updateRun({promise:this.selectedPromise}),this.cameras.main.fadeOut(500,0,0,0);const{width:e,height:a}=this.cameras.main,i=this.add.text(e/2,a/2,"PROMISE SEALED",{fontFamily:"Georgia, serif",fontSize:"28px",color:"#c9a959",stroke:"#000000",strokeThickness:4}).setOrigin(.5).setAlpha(0);this.tweens.add({targets:i,alpha:1,duration:300,yoyo:!0,hold:500,onComplete:()=>{this.scene.start("CampScene")}})}}const V=52,pt=8;function E(){const c=/iPhone/.test(navigator.userAgent),n=window.innerHeight>800&&c;return{top:n?44:20,bottom:n?34:10,left:16,right:16}}function ye(c){const{width:n,height:e}=c.cameras.main,a=E();return{x:a.left,y:a.top,width:n-a.left-a.right,height:e-a.top-a.bottom}}function oe(c,n=0){return c.cameras.main.height-E().bottom-n}class Ls extends w.GameObjects.Container{constructor(e){super(e,0,0);m(this,"debugMode",!1);m(this,"debugGraphics");m(this,"contentArea");e.add.existing(this),this.contentArea=ye(e),e.scale.on("resize",this.handleResize,this)}handleResize(){this.contentArea=ye(this.scene),this.updateDebugOverlay()}toggleDebug(){this.debugMode=!this.debugMode,this.updateDebugOverlay()}updateDebugOverlay(){if(this.debugGraphics&&(this.debugGraphics.destroy(),this.debugGraphics=void 0),!this.debugMode)return;this.debugGraphics=this.scene.add.graphics(),this.debugGraphics.setDepth(9999);const{width:e,height:a}=this.scene.cameras.main,i=E();this.debugGraphics.lineStyle(2,65280,.5),this.debugGraphics.strokeRect(i.left,i.top,e-i.left-i.right,a-i.top-i.bottom),this.debugGraphics.lineStyle(1,16711680,.8),this.each(t=>{this.drawInteractiveBounds(t)})}drawInteractiveBounds(e){var a,i;if(this.debugGraphics&&(e instanceof w.GameObjects.Container&&e.each(t=>{this.drawInteractiveBounds(t)}),"input"in e&&((a=e.input)!=null&&a.enabled))){const t=(i=e.getBounds)==null?void 0:i.call(e);t&&this.debugGraphics.strokeRect(t.x,t.y,t.width,t.height)}}getContentArea(){return{...this.contentArea}}destroy(e){var a;this.scene.scale.off("resize",this.handleResize,this),(a=this.debugGraphics)==null||a.destroy(),super.destroy(e)}}class $s extends w.GameObjects.Container{constructor(e,a,i,t=10,s="center"){super(e,a,i);m(this,"spacing");m(this,"alignment");m(this,"items",[]);this.spacing=t,this.alignment=s,e.add.existing(this)}addItem(e){return this.items.push(e),this.add(e),this.layout(),this}removeItem(e){const a=this.items.indexOf(e);return a>-1&&(this.items.splice(a,1),this.remove(e),this.layout()),this}layout(){let e=0;this.items.forEach(a=>{const i=this.getItemHeight(a);if("setPosition"in a){let t=0;(this.alignment==="left"||this.alignment==="right")&&(t=0),a.setPosition(t,e)}e+=i+this.spacing})}getItemHeight(e){return"height"in e?e.height||V:"displayHeight"in e&&e.displayHeight||V}setSpacing(e){return this.spacing=e,this.layout(),this}}class Ns extends w.GameObjects.Container{constructor(e,a,i,t=10){super(e,a,i);m(this,"spacing");m(this,"items",[]);this.spacing=t,e.add.existing(this)}addItem(e){return this.items.push(e),this.add(e),this.layout(),this}layout(){let a=-this.getTotalWidth()/2;this.items.forEach(i=>{const t=this.getItemWidth(i);"setPosition"in i&&i.setPosition(a+t/2,0),a+=t+this.spacing})}getTotalWidth(){return this.items.reduce((e,a,i)=>e+this.getItemWidth(a)+(i>0?this.spacing:0),0)}getItemWidth(e){return"width"in e?e.width||V:"displayWidth"in e&&e.displayWidth||V}}class Ws extends w.GameObjects.Container{constructor(e,a,i,t,s){super(e,a,i);m(this,"contentContainer");m(this,"maskGraphics");m(this,"panelWidth");m(this,"panelHeight");m(this,"contentHeight",0);m(this,"scrollY",0);m(this,"isDragging",!1);m(this,"dragStartY",0);m(this,"scrollStartY",0);this.panelWidth=t,this.panelHeight=s,e.add.existing(this),this.maskGraphics=e.add.graphics(),this.maskGraphics.fillStyle(16777215),this.maskGraphics.fillRect(a,i,t,s);const r=this.maskGraphics.createGeometryMask();this.contentContainer=e.add.container(0,0),this.contentContainer.setMask(r),this.add(this.contentContainer),this.setupScrollInput()}setupScrollInput(){const e=this.scene.add.rectangle(this.panelWidth/2,this.panelHeight/2,this.panelWidth,this.panelHeight,0,0);e.setInteractive(),this.add(e),e.on("pointerdown",a=>{this.isDragging=!0,this.dragStartY=a.y,this.scrollStartY=this.scrollY}),this.scene.input.on("pointermove",a=>{if(!this.isDragging)return;const i=a.y-this.dragStartY;this.scrollTo(this.scrollStartY-i)}),this.scene.input.on("pointerup",()=>{this.isDragging=!1})}addContent(e,a){return"setPosition"in e&&e.setPosition(this.panelWidth/2,this.contentHeight+a/2),this.contentContainer.add(e),this.contentHeight+=a+10,this}scrollTo(e){const a=Math.max(0,this.contentHeight-this.panelHeight);this.scrollY=w.Math.Clamp(e,0,a),this.contentContainer.y=-this.scrollY}getScrollPosition(){return this.scrollY}destroy(e){this.maskGraphics.destroy(),super.destroy(e)}}class Gt extends w.GameObjects.Container{constructor(e,a,i,t,s,r={}){super(e,a,i);m(this,"bg");m(this,"label");m(this,"visualWidth");m(this,"visualHeight");m(this,"touchWidth");m(this,"touchHeight");m(this,"callback");m(this,"isPrimary");e.add.existing(this);const{width:o=180,height:d=52,fontSize:l=14,primary:h=!1}=r;this.visualWidth=o,this.visualHeight=d,this.touchWidth=Math.max(o+pt*2,V),this.touchHeight=Math.max(d+pt*2,V),this.callback=s,this.isPrimary=h,this.bg=e.add.graphics(),this.drawBackground(!1),this.add(this.bg),this.label=e.add.text(0,0,t,{fontFamily:"Georgia, serif",fontSize:`${l}px`,color:h?"#c9a959":"#8b7355"}).setOrigin(.5),this.add(this.label),this.setSize(this.touchWidth,this.touchHeight),this.setInteractive(new w.Geom.Rectangle(-this.touchWidth/2,-this.touchHeight/2,this.touchWidth,this.touchHeight),w.Geom.Rectangle.Contains),this.setupInteraction()}drawBackground(e){this.bg.clear();const a=e?this.isPrimary?5917242:3813162:this.isPrimary?4864554:2760474,i=e||this.isPrimary?13216089:5917242;this.bg.fillStyle(a,1),this.bg.fillRoundedRect(-this.visualWidth/2,-this.visualHeight/2,this.visualWidth,this.visualHeight,8),this.bg.lineStyle(2,i,1),this.bg.strokeRoundedRect(-this.visualWidth/2,-this.visualHeight/2,this.visualWidth,this.visualHeight,8)}setupInteraction(){this.on("pointerover",()=>{this.drawBackground(!0),this.label.setColor("#c9a959")}),this.on("pointerout",()=>{this.drawBackground(!1),this.label.setColor(this.isPrimary?"#c9a959":"#8b7355")}),this.on("pointerdown",()=>{this.scene.tweens.add({targets:this,scaleX:.95,scaleY:.95,duration:50})}),this.on("pointerup",()=>{this.scene.tweens.add({targets:this,scaleX:1,scaleY:1,duration:50,onComplete:()=>this.callback()})})}setText(e){return this.label.setText(e),this}setDisabled(e){return this.setAlpha(e?.5:1),e?this.disableInteractive():this.setInteractive(),this}}const O={primary:13216089,bgDark:1709072,bgPanel:2365973,textGold:"#c9a959",textMedium:"#8b7355",textDark:"#5a4a3a"},yt={panelRadius:10,panelBorder:2};function de(c,n,e,a,i,t={}){const{fill:s=O.bgPanel,alpha:r=.95,stroke:o=O.primary,strokeAlpha:d=.5,radius:l=yt.panelRadius}=t;c.fillStyle(s,r),c.fillRoundedRect(n,e,a,i,l),c.lineStyle(yt.panelBorder,o,d),c.strokeRoundedRect(n,e,a,i,l)}function qa(c,n="fade",e=300){if(p.getSettings().reduceMotion)return vt(c,e);switch(n){case"wipe":return Ya(c,e);case"ink":return za(c,e);case"stamp":return Ua(c,e);default:return vt(c,e)}}function vt(c,n){return new Promise(e=>{c.cameras.main.fadeOut(n),c.cameras.main.once("camerafadeoutcomplete",e)})}function Ya(c,n){return new Promise(e=>{const{width:a,height:i}=c.cameras.main,t=c.add.graphics();t.fillStyle(O.bgDark,1),t.setDepth(1e3);const s=c.add.graphics();s.fillRect(-a,0,a,i),c.tweens.add({targets:s,x:a,duration:n,ease:"Quad.inOut",onUpdate:()=>{t.clear(),t.fillStyle(O.bgDark,1),t.fillRect(0,0,s.x+a,i)},onComplete:()=>{t.destroy(),s.destroy(),e()}})})}function za(c,n){return new Promise(e=>{const{width:a,height:i}=c.cameras.main,t=c.add.container(0,0);t.setDepth(1e3);const s=8,r=[];for(let o=0;o<s;o++){const d=c.add.graphics(),l=Math.random()*a,h=Math.random()*i;d.fillStyle(O.bgDark,1),d.fillCircle(l,h,0),r.push(d),t.add(d)}c.tweens.add({targets:{r:0},r:Math.max(a,i),duration:n,ease:"Quad.in",onUpdate:o=>{const d=o.getValue();r.forEach((l,h)=>{l.clear(),l.fillStyle(O.bgDark,1);const u=h/s*a+(Math.random()-.5)*50,f=Math.floor(h/2)/4*i+(Math.random()-.5)*50;l.fillCircle(u,f,d*(.8+Math.random()*.4))})},onComplete:()=>{t.destroy(),e()}})})}function Ua(c,n){return new Promise(e=>{const{width:a,height:i}=c.cameras.main,t=c.add.container(a/2,i/2);t.setDepth(1e3),t.setScale(0);const s=c.add.graphics();s.fillStyle(9109504,1),s.fillCircle(0,0,80),s.lineStyle(4,5898240,1),s.strokeCircle(0,0,80),t.add(s);const r=c.add.text(0,0,"âš”ï¸",{fontSize:"48px"}).setOrigin(.5);t.add(r);const o=c.add.rectangle(a/2,i/2,a,i,O.bgDark,0);o.setDepth(999),c.tweens.add({targets:o,alpha:1,duration:n*.6}),c.tweens.add({targets:t,scale:1,duration:n*.4,ease:"Back.easeOut",onComplete:()=>{c.time.delayedCall(n*.3,()=>{t.destroy(),o.destroy(),e()})}})})}async function ja(c,n,e="fade",a=300){await qa(c,e,a),c.scene.start(n)}class Va{constructor(n){m(this,"scene");m(this,"container");m(this,"textLines",[]);m(this,"visible",!1);m(this,"updateInterval");this.scene=n}toggle(){this.visible=!this.visible,this.visible?this.show():this.hide()}show(){if(this.container)return;const{width:n,height:e}=this.scene.cameras.main;this.container=this.scene.add.container(10,10),this.container.setDepth(9999),this.container.setScrollFactor(0);const a=this.scene.add.graphics();a.fillStyle(0,.8),a.fillRoundedRect(0,0,200,200,5),this.container.add(a);const i=this.scene.add.text(5,5,"ðŸ”§ DEBUG",{fontFamily:"monospace",fontSize:"10px",color:"#00ff00"});this.container.add(i);for(let t=0;t<12;t++){const s=this.scene.add.text(5,20+t*14,"",{fontFamily:"monospace",fontSize:"9px",color:"#00ff00"});this.textLines.push(s),this.container.add(s)}this.update(),this.updateInterval=this.scene.time.addEvent({delay:500,callback:()=>this.update(),loop:!0}),this.visible=!0}hide(){this.container&&(this.container.destroy(),this.container=void 0),this.textLines=[],this.updateInterval&&(this.updateInterval.destroy(),this.updateInterval=void 0),this.visible=!1}update(){var n,e,a;if(!(!this.visible||this.textLines.length===0))try{const i=p.getRun(),t=p.getInventory(),s=p.getLoadout(),r=t.filter(f=>f.itemType==="weapon"),o=t.filter(f=>f.itemType==="armor"),d=t.filter(f=>f.itemType==="trinket"),l=t.filter(f=>f.itemType==="consumable"),h=this.scene.scene.key;let u="N/A";if(h==="FightScene"){const f=this.scene;if(f.combatState){const g=f.combatState;u=`T:${g.turn} P:${g.phase} R:${g.round}`}f.isInputEnabled!==void 0&&(u+=` In:${f.isInputEnabled}`)}this.textLines[0].setText(`Scene: ${h}`),this.textLines[1].setText(`Gold: ${i.gold}`),this.textLines[2].setText(`Inv Total: ${t.length}`),this.textLines[3].setText(`  Weapons: ${r.length}`),this.textLines[4].setText(`  Armor: ${o.length}`),this.textLines[5].setText(`  Trinkets: ${d.length}`),this.textLines[6].setText(`  Consumables: ${l.length}`),this.textLines[7].setText(`WeaponId: ${((n=s.weaponId)==null?void 0:n.slice(0,8))||"none"}`),this.textLines[8].setText(`ArmorId: ${((e=s.armorId)==null?void 0:e.slice(0,8))||"none"}`),this.textLines[9].setText(`Combat: ${u}`),this.textLines[10].setText(`Fighter: ${((a=i.fighter)==null?void 0:a.firstName)||"none"}`),this.textLines[11].setText(`Week: ${i.week} League: ${i.league}`)}catch(i){this.textLines[0].setText(`Error: ${i}`)}}isVisible(){return this.visible}destroy(){this.hide()}}const at=[{id:"iron_skin",name:"Iron Skin",icon:"ðŸ›¡ï¸",description:"Enemies have +10% HP, but you gain +5% defense.",difficultyValue:1,tags:["defense","enemy_hp"],mods:{enemyHPMod:10,playerDefenseMod:5}},{id:"hungry_crowd",name:"Hungry Crowd",icon:"ðŸ‘¥",description:"Fights give +15% gold, but enemies deal +5% damage.",difficultyValue:1,tags:["gold","enemy_damage"],mods:{goldMod:15,enemyDamageMod:5}},{id:"sharp_weapons",name:"Sharp Weapons",icon:"ðŸ—¡ï¸",description:"All attacks deal +10% damage (both sides).",difficultyValue:1,tags:["damage","symmetric"],mods:{playerDamageMod:10,enemyDamageMod:10}},{id:"treasure_hunter",name:"Treasure Hunter",icon:"ðŸ’Ž",description:"Better loot rarity, but shop prices +10%.",difficultyValue:1,tags:["loot","shop"],mods:{lootRarityMod:1,shopPriceMod:10}},{id:"adrenaline_junkie",name:"Adrenaline Junkie",icon:"âš¡",description:"Start with +20 momentum, but enemies +15% more aggressive.",difficultyValue:1,tags:["momentum","enemy_ai"],mods:{startingStaminaMod:10,enemyAggressionMod:15}},{id:"blood_sport",name:"Blood Sport",icon:"ðŸ©¸",description:"Bleed stacks +1 max, enemies also bleed more.",difficultyValue:2,tags:["bleed"],mods:{bleedStacksMod:1,goldMod:10}},{id:"heavyweight",name:"Heavyweight",icon:"ðŸ‹ï¸",description:"Enemies have +20% HP, loot rarity +1.",difficultyValue:2,tags:["enemy_hp","loot"],mods:{enemyHPMod:20,lootRarityMod:1}},{id:"relentless_foes",name:"Relentless Foes",icon:"ðŸ˜¤",description:"Enemies gain +2 momentum per action, +20% gold.",difficultyValue:2,tags:["enemy_momentum","gold"],mods:{enemyMomentumGain:2,goldMod:20}},{id:"fragile",name:"Fragile",icon:"ðŸ’”",description:"-15% max HP, but +20% damage.",difficultyValue:2,tags:["hp","damage"],mods:{maxHPMod:-15,playerDamageMod:20}},{id:"crowd_favorite",name:"Crowd Favorite",icon:"ðŸŒŸ",description:"Crits deal +25% damage (both sides), +15% gold.",difficultyValue:2,tags:["crit","gold"],mods:{critDamageMod:25,goldMod:15}},{id:"quick_reflexes",name:"Quick Reflexes",icon:"ðŸ’¨",description:"+15% parry window, but -10% stamina regen.",difficultyValue:2,tags:["parry","stamina"],mods:{parryWindowMod:15,staminaRegenMod:-10}},{id:"fortune_seeker",name:"Fortune Seeker",icon:"ðŸ€",description:"+25% gold, +1 affix tier chance, enemies +10% damage.",difficultyValue:2,tags:["gold","affix","enemy_damage"],mods:{goldMod:25,affixTierBoost:1,enemyDamageMod:10}},{id:"no_mercy",name:"No Mercy",icon:"â˜ ï¸",description:"Enemies deal +20% damage, but +30% gold.",difficultyValue:3,tags:["enemy_damage","gold"],mods:{enemyDamageMod:20,goldMod:30}},{id:"brutal_arena",name:"Brutal Arena",icon:"ðŸŸï¸",description:"Both sides +50% wound chance, +2 loot rarity.",difficultyValue:3,tags:["wound","loot"],mods:{woundChanceMod:50,enemyWoundChanceMod:50,lootRarityMod:2}},{id:"armor_piercing",name:"Armor Piercing",icon:"ðŸ› ï¸",description:"Armor break 2x effective, enemies +15% defense.",difficultyValue:3,tags:["armor_break","enemy_defense"],mods:{armorBreakPotent:!0,enemyDefenseMod:15}},{id:"stamina_tax",name:"Stamina Tax",icon:"ðŸ˜°",description:"-25% stamina regen, +35% gold.",difficultyValue:3,tags:["stamina","gold"],mods:{staminaRegenMod:-25,goldMod:35}},{id:"resilient_foes",name:"Resilient Foes",icon:"ðŸ¦¾",description:"Enemies +25% HP and +10% defense, +2 affix tiers.",difficultyValue:3,tags:["enemy_hp","enemy_defense","affix"],mods:{enemyHPMod:25,enemyDefenseMod:10,affixTierBoost:2}},{id:"glass_arena",name:"Glass Arena",icon:"ðŸ”®",description:"All damage +30%, -20% HP (both sides).",difficultyValue:3,tags:["damage","hp","symmetric"],mods:{playerDamageMod:30,enemyDamageMod:30,maxHPMod:-20}},{id:"no_rest",name:"No Rest",icon:"ðŸš«",description:"Cannot heal during fights. +40% gold, +2 loot rarity.",difficultyValue:4,tags:["no_heal","gold","loot"],mods:{noHealing:!0,goldMod:40,lootRarityMod:2},exclusionTags:["heal_focus"]},{id:"dodge_or_die",name:"Dodge or Die",icon:"ðŸŽ¯",description:"Cannot parry, +25% dodge, +50% gold.",difficultyValue:4,tags:["no_parry","dodge","gold"],mods:{noParry:!0,dodgeMod:25,goldMod:50},exclusionTags:["parry_focus"]},{id:"stand_and_fight",name:"Stand and Fight",icon:"ðŸ—¡ï¸",description:"Cannot dodge, +25% parry window, +50% gold.",difficultyValue:4,tags:["no_dodge","parry","gold"],mods:{noDodge:!0,parryWindowMod:25,goldMod:50},exclusionTags:["dodge_focus"]},{id:"elite_enemies",name:"Elite Enemies",icon:"ðŸ‘‘",description:"Enemies +30% HP, +20% damage, always have 2 mutators.",difficultyValue:4,tags:["enemy_hp","enemy_damage","mutators"],mods:{enemyHPMod:30,enemyDamageMod:20,goldMod:45,lootRarityMod:1}},{id:"time_pressure",name:"Time Pressure",icon:"â°",description:"20 turn limit per fight. +60% gold if you win.",difficultyValue:4,tags:["turn_limit","gold"],mods:{turnLimitPerFight:20,goldMod:60}},{id:"death_wish",name:"Death Wish",icon:"ðŸ’€",description:"-30% max HP, enemies +25% damage, but +75% gold and +3 loot rarity.",difficultyValue:5,tags:["hp","enemy_damage","gold","loot"],mods:{maxHPMod:-30,enemyDamageMod:25,goldMod:75,lootRarityMod:3}},{id:"champions_gauntlet",name:"Champion's Gauntlet",icon:"ðŸ†",description:"Enemies +40% HP and damage, but double gold and guaranteed epic loot.",difficultyValue:5,tags:["enemy_hp","enemy_damage","gold","loot"],mods:{enemyHPMod:40,enemyDamageMod:40,goldMod:100,lootRarityMod:3}},{id:"cursed_arena",name:"Cursed Arena",icon:"ðŸ‘»",description:"All items gain curses, but curses are 50% less severe.",difficultyValue:5,tags:["curse","item"],mods:{affixTierBoost:2,goldMod:50}}];function Re(c){return at.find(n=>n.id===c)}function Xa(c,n=3){const e=c.map(r=>Re(r)).filter(Boolean),a=new Set(e.flatMap(r=>r.tags)),i=new Set(e.flatMap(r=>r.exclusionTags||[]));return[...at.filter(r=>{var o;return!(c.includes(r.id)||r.tags.some(d=>i.has(d))||(o=r.exclusionTags)!=null&&o.some(d=>a.has(d)))})].sort(()=>Math.random()-.5).slice(0,n)}function Qa(c){const n={goldMod:0,lootRarityMod:0,affixTierBoost:0};for(const e of c){const a=Re(e);a&&(n.goldMod+=a.mods.goldMod||0,n.lootRarityMod+=a.mods.lootRarityMod||0,n.affixTierBoost+=a.mods.affixTierBoost||0)}return n}class Ka extends w.Scene{constructor(){super({key:"CampScene"});m(this,"fighter");m(this,"gold");m(this,"week");m(this,"league");m(this,"powerResult");m(this,"fighterSprite");m(this,"campfireGlow");m(this,"powerText");m(this,"equipmentModal");m(this,"debugOverlay")}create(){const e=p.getRun();if(!e.fighter){this.scene.start("MainMenuScene");return}if(!p.isDecreeDraftCompleted()&&e.week===0){this.scene.start("DecreeDraftScene");return}this.fighter=e.fighter,this.gold=e.gold,this.week=e.week,this.league=e.league,this.powerResult=pe(this.fighter),this.createBackground(),this.createHeader(),this.createPowerDisplay(),this.createFighterDisplay(),this.createEquipmentPanel(),this.createActionButtons(),this.createBottomBar(),this.checkGhostMoments(),this.checkRelicOpportunity(),this.debugOverlay=new Va(this),p.getSettings().debugMode&&this.debugOverlay.show(),this.cameras.main.fadeIn(300)}toggleDebugOverlay(){this.debugOverlay&&this.debugOverlay.toggle()}createBackground(){const{width:e,height:a}=this.cameras.main,i=this.add.graphics();i.fillGradientStyle(657426,657426,1710112,1710112),i.fillRect(0,0,e,a);for(let t=0;t<20;t++){const s=this.add.graphics();s.fillStyle(16777215,Math.random()*.4+.1),s.fillCircle(Math.random()*e,Math.random()*a*.35,1),this.tweens.add({targets:s,alpha:{from:.2,to:.6},duration:1500+Math.random()*2e3,yoyo:!0,repeat:-1})}i.fillStyle(2762016,1),i.fillRect(0,a*.6,e,a*.4),i.fillStyle(1709333,1),i.beginPath(),i.moveTo(0,a*.45),i.lineTo(e*.2,a*.32),i.lineTo(e*.4,a*.42),i.lineTo(e*.65,a*.28),i.lineTo(e*.85,a*.38),i.lineTo(e,a*.35),i.lineTo(e,a*.6),i.lineTo(0,a*.6),i.closePath(),i.fillPath(),this.createCampfire(e*.5,a*.55)}createCampfire(e,a){const i=this.add.graphics();i.fillStyle(3811866,1),i.fillEllipse(e,a+15,35,12),this.campfireGlow=this.add.graphics();const t=s=>{this.campfireGlow&&(this.campfireGlow.clear(),this.campfireGlow.fillStyle(16737792,.08*s),this.campfireGlow.fillCircle(e,a-5,50*s),this.campfireGlow.fillStyle(16750848,.12*s),this.campfireGlow.fillCircle(e,a-5,30*s),this.campfireGlow.fillStyle(16763904,.25),this.campfireGlow.fillCircle(e,a-8,12))};this.tweens.add({targets:{i:1},i:1.15,duration:180,yoyo:!0,repeat:-1,ease:"Sine.easeInOut",onUpdate:s=>{const r=s.getValue();typeof r=="number"&&t(r)}}),t(1)}createHeader(){const{width:e}=this.cameras.main,a=E(),i=a.top+15;this.add.text(a.left,i,`Week ${this.week+1}`,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#c9a959"});const t={bronze:"#cd7f32",silver:"#c0c0c0",gold:"#ffd700",champion:"#ff4500"};this.add.text(a.left,i+18,this.league.toUpperCase(),{fontFamily:"Georgia, serif",fontSize:"11px",color:t[this.league]||"#8b7355"});const s=p.getRun();this.add.text(e-a.right,i,`ðŸ’° ${this.gold}`,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#c9a959"}).setOrigin(1,0),this.add.text(e-a.right,i+18,`â­ ${s.fame}`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b7355"}).setOrigin(1,0);const r=p.getFatigue();if(r>0){const o=r>70?"#8b0000":r>40?"#daa520":"#8b7355";this.add.text(e-a.right,i+35,`âš¡ ${r}%`,{fontFamily:"Georgia, serif",fontSize:"10px",color:o}).setOrigin(1,0)}this.createDecreeIcons()}createDecreeIcons(){const{width:e}=this.cameras.main,a=E(),i=p.getActiveDecrees();if(i.length===0)return;const t=e/2-(i.length-1)*25/2,s=a.top+60;i.forEach((r,o)=>{const d=Re(r);if(!d)return;const l=t+o*25,h=this.add.text(l,s,d.icon,{fontSize:"16px"}).setOrigin(.5);h.setInteractive({useHandCursor:!0}),h.on("pointerdown",()=>{this.showDecreeTooltip(d,l,s+20)})}),i.length>0&&this.add.text(e/2,s-15,"DECREES",{fontFamily:"Georgia, serif",fontSize:"8px",color:"#5a4a3a"}).setOrigin(.5)}showDecreeTooltip(e,a,i){var d;const{width:t,height:s}=this.cameras.main;(d=this.children.getByName("decreeTooltip"))==null||d.destroy();const r=this.add.container(Math.min(a,t-100),i);r.setName("decreeTooltip"),r.setDepth(200);const o=this.add.graphics();o.fillStyle(1709072,.95),o.fillRoundedRect(-80,0,160,60,5),o.lineStyle(1,13216089,.5),o.strokeRoundedRect(-80,0,160,60,5),r.add(o),r.add(this.add.text(0,10,e.name,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#c9a959"}).setOrigin(.5)),r.add(this.add.text(0,30,e.description,{fontFamily:"Georgia, serif",fontSize:"8px",color:"#8b7355",wordWrap:{width:150}}).setOrigin(.5,0)),this.time.delayedCall(2500,()=>r.destroy())}createPowerDisplay(){const{width:e}=this.cameras.main,i=E().top+50,t=re(this.powerResult),s=this.add.graphics();s.fillStyle(1709328,.9),s.fillRoundedRect(e/2-70,i-12,140,32,6),s.lineStyle(1,5917242,.8),s.strokeRoundedRect(e/2-70,i-12,140,32,6),this.add.text(e/2-55,i,"âš¡",{fontSize:"16px"}).setOrigin(0,.5),this.powerText=this.add.text(e/2-30,i-2,`POWER: ${ae(this.powerResult.power)}`,{fontFamily:"Georgia, serif",fontSize:"12px",color:t.color}).setOrigin(0,.5),this.add.text(e/2-30,i+12,t.label.toUpperCase(),{fontFamily:"Georgia, serif",fontSize:"8px",color:t.color}).setOrigin(0,.5);const r=this.add.rectangle(e/2,i,120,32,0,0);r.setInteractive({useHandCursor:!0}),r.on("pointerdown",()=>this.showPowerBreakdown())}showPowerBreakdown(){const{width:e,height:a}=this.cameras.main,i=this.powerResult.breakdown,t=this.add.graphics();t.fillStyle(0,.7),t.fillRect(0,0,e,a),t.setInteractive(new w.Geom.Rectangle(0,0,e,a),w.Geom.Rectangle.Contains),t.setDepth(100);const s=Math.min(280,e-40),r=320,o=e/2,d=a/2,l=this.add.container(o,d);l.setDepth(101);const h=this.add.graphics();h.fillStyle(1709328,1),h.fillRoundedRect(-s/2,-r/2,s,r,10),h.lineStyle(2,13216089,1),h.strokeRoundedRect(-s/2,-r/2,s,r,10),l.add(h),l.add(this.add.text(0,-r/2+25,"POWER BREAKDOWN",{fontFamily:"Georgia, serif",fontSize:"14px",color:"#c9a959"}).setOrigin(.5));const u=re(this.powerResult);l.add(this.add.text(0,-r/2+45,`Total: ${ae(this.powerResult.power)}`,{fontFamily:"Georgia, serif",fontSize:"18px",color:u.color}).setOrigin(.5)),l.add(this.add.text(0,-r/2+65,`${u.label} Â· ${u.vsExpected}`,{fontFamily:"Georgia, serif",fontSize:"10px",color:u.color}).setOrigin(.5));let f=-r/2+80;const g=(x,R,B="#8b7355")=>{l.add(this.add.text(-s/2+20,f,x,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#5a4a3a"})),l.add(this.add.text(s/2-20,f,`+${R}`,{fontFamily:"Georgia, serif",fontSize:"11px",color:B}).setOrigin(1,0)),f+=22};g("Base Stats",i.baseStats,"#8b7355"),g("Weapon",i.weapon,"#cd5c5c"),g("Armor",i.armor,"#5f9ea0"),g("Traits & Perks",i.traits,"#daa520"),g("Buffs",i.buffs,"#6b8e23"),i.penalties>0&&(l.add(this.add.text(-s/2+20,f,"Penalties",{fontFamily:"Georgia, serif",fontSize:"11px",color:"#5a4a3a"})),l.add(this.add.text(s/2-20,f,`-${i.penalties}`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b0000"}).setOrigin(1,0)),f+=22),f+=10,h.lineStyle(1,5917242,.5),h.moveTo(-s/2+20,f),h.lineTo(s/2-20,f),h.strokePath(),f+=15,l.add(this.add.text(0,f,"DETAILS",{fontFamily:"Georgia, serif",fontSize:"10px",color:"#c9a959"}).setOrigin(.5)),f+=18;const y=i.details,S=-s/2+25,b=10,M=(x,R)=>{l.add(this.add.text(S,f,`${x.label}: ${x.value}`,{fontFamily:"Georgia, serif",fontSize:"9px",color:"#5a4a3a"})),l.add(this.add.text(b,f,`${R.label}: ${R.value}`,{fontFamily:"Georgia, serif",fontSize:"9px",color:"#5a4a3a"})),f+=16};M({label:"HP",value:y.hp},{label:"Damage",value:y.damage}),M({label:"Defense",value:y.defense},{label:"Stamina",value:y.stamina}),M({label:"Crit",value:y.crit},{label:"Dodge",value:y.dodge}),M({label:"Speed",value:y.speed},{label:"Special",value:y.special});const C=new G(this,0,r/2-35,"CLOSE",()=>{t.destroy(),l.destroy()},{width:100,height:40});C.setDepth(102),l.add(C),t.on("pointerdown",()=>{t.destroy(),l.destroy()})}createFighterDisplay(){const{width:e,height:a}=this.cameras.main,i=a*.3;this.fighterSprite=this.add.container(e*.5,i);const t=Math.min(70,e*.18),s=ce.renderPortrait(this,this.fighter.portrait,0,0,t);if(this.fighterSprite.add(s),this.fighter.injuries.length>0){const d=this.add.text(t/2+5,-t/2,"ðŸ©¹",{fontSize:"14px"});this.fighterSprite.add(d)}this.tweens.add({targets:this.fighterSprite,y:i-3,duration:2e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.add.text(e*.5,i+t/2+12,this.fighter.firstName,{fontFamily:"Georgia, serif",fontSize:"13px",color:"#c9a959"}).setOrigin(.5);const r=this.add.rectangle(e*.5,i,t+30,t+30,0,0);r.setInteractive({useHandCursor:!0}),r.on("pointerdown",()=>this.showCharacterInfo()),new Ea(this,e*.5+t/2+20,i,"ðŸŽ¨",()=>{this.goToCustomize()},36).setDepth(5)}createEquipmentPanel(){const{width:e,height:a}=this.cameras.main,i=E(),t=a*.44,s=Math.min(300,e-i.left-i.right-20),r=e/2,o=this.add.container(r,t),d=this.add.graphics();d.fillStyle(1709328,.85),d.fillRoundedRect(-s/2,0,s,55,6),d.lineStyle(1,3811866,1),d.strokeRoundedRect(-s/2,0,s,55,6),o.add(d),o.add(this.add.text(0,8,"EQUIPMENT",{fontFamily:"Georgia, serif",fontSize:"9px",color:"#5a4a3a"}).setOrigin(.5));const l=p.getInventory(),h=p.getLoadout(),u=[{id:h.weaponId,type:"weapon",icon:"âš”ï¸",label:"Weapon"},{id:h.armorId,type:"armor",icon:"ðŸ›¡ï¸",label:"Armor"},{id:h.helmetId,type:"helmet",icon:"â›‘ï¸",label:"Helm"},{id:h.trinket1Id,type:"trinket",icon:"ðŸ’Ž",label:"Trinket"}],f=55,g=8;let S=-(u.length*f+(u.length-1)*g)/2+f/2;u.forEach(b=>{const M=this.add.container(S,35),C=this.add.graphics(),x=!!b.id;C.fillStyle(x?2767402:2760474,1),C.fillRoundedRect(-24,-14,48,28,4),C.lineStyle(1,x?7048739:3811866,1),C.strokeRoundedRect(-24,-14,48,28,4),M.add(C);let R=b.icon;if(b.id){const P=l.find(H=>H.instanceId===b.id);P&&(R=fe(P),j(P).split(" ")[0])}M.add(this.add.text(0,-2,R,{fontSize:"18px"}).setOrigin(.5));const B=this.add.rectangle(0,0,50,30,0,0);B.setInteractive({useHandCursor:!0}),B.on("pointerdown",()=>this.openEquipmentPicker(b.type)),M.add(B),o.add(M),S+=f+g})}openEquipmentPicker(e){const{width:a,height:i}=this.cameras.main,t=p.getInventory(),s=p.getLoadout();let r;switch(e){case"weapon":r=t.filter(x=>x.itemType==="weapon");break;case"armor":r=t.filter(x=>x.itemType==="armor"&&x.slot==="body");break;case"helmet":r=t.filter(x=>x.itemType==="armor"&&x.slot==="helmet");break;case"trinket":r=t.filter(x=>x.itemType==="trinket");break;default:r=[]}const o={legendary:0,epic:1,rare:2,uncommon:3,common:4};r.sort((x,R)=>(o[ee(x)]||5)-(o[ee(R)]||5));const d=this.add.graphics();d.fillStyle(0,.7),d.fillRect(0,0,a,i),d.setInteractive(new w.Geom.Rectangle(0,0,a,i),w.Geom.Rectangle.Contains),d.setDepth(100);const l=Math.min(300,a-30),h=Math.min(450,i-100),u=a/2,f=i/2;this.equipmentModal=this.add.container(u,f),this.equipmentModal.setDepth(101);const g=this.add.graphics();g.fillStyle(1709328,1),g.fillRoundedRect(-l/2,-h/2,l,h,10),g.lineStyle(2,13216089,1),g.strokeRoundedRect(-l/2,-h/2,l,h,10),this.equipmentModal.add(g),this.equipmentModal.add(this.add.text(0,-h/2+20,`SELECT ${e.toUpperCase()}`,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#c9a959"}).setOrigin(.5));const y=-h/2+50,S=65,b=8;let M=y;r.length===0?this.equipmentModal.add(this.add.text(0,0,"No items available",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#5a4a3a"}).setOrigin(.5)):r.slice(0,5).forEach(x=>{const R=this.createEquipmentCard(x,l-30,S,e,s,d);R.y=M+S/2,this.equipmentModal.add(R),M+=S+b});const C=new G(this,0,h/2-35,"CLOSE",()=>{var x;d.destroy(),(x=this.equipmentModal)==null||x.destroy(),this.equipmentModal=void 0},{width:100,height:40});C.setDepth(102),this.equipmentModal.add(C),d.on("pointerdown",()=>{var x;d.destroy(),(x=this.equipmentModal)==null||x.destroy(),this.equipmentModal=void 0})}createEquipmentCard(e,a,i,t,s,r){const o=this.add.container(0,0),d=z(e),l=ee(e);let h=!1;switch(t){case"weapon":h=s.weaponId===e.instanceId;break;case"armor":h=s.armorId===e.instanceId;break;case"helmet":h=s.helmetId===e.instanceId;break;case"trinket":h=s.trinket1Id===e.instanceId||s.trinket2Id===e.instanceId;break}const u=this.add.graphics();u.fillStyle(h?2771498:2760474,1),u.fillRoundedRect(-a/2,-i/2,a,i,6),u.lineStyle(2,Z[l]||5917242,h?1:.6),u.strokeRoundedRect(-a/2,-i/2,a,i,6),o.add(u),o.add(this.add.text(-a/2+20,0,fe(e),{fontSize:"22px"}).setOrigin(.5)),o.add(this.add.text(-a/2+45,-i/2+15,j(e),{fontFamily:"Georgia, serif",fontSize:"11px",color:"#c9a959"}));let f="";if(e.itemType==="weapon"&&d){const y=d;f=`${y.damageMin}-${y.damageMax} DMG`}else e.itemType==="armor"&&d&&(f=`${d.defense} DEF`);if(o.add(this.add.text(-a/2+45,-i/2+32,f,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355"})),h)o.add(this.add.text(a/2-15,0,"âœ“",{fontSize:"18px",color:"#6b8e23"}).setOrigin(1,.5));else{const y=this.powerResult.power,S={...s};switch(t){case"weapon":S.weaponId=e.instanceId;break;case"armor":S.armorId=e.instanceId;break;case"helmet":S.helmetId=e.instanceId;break;case"trinket":S.trinket1Id=e.instanceId;break}const b=pe(this.fighter,p.getInventory(),S),M=La(y,b.power);o.add(this.add.text(a/2-15,-5,M.text,{fontFamily:"Georgia, serif",fontSize:"11px",color:M.color}).setOrigin(1,.5)),o.add(this.add.text(a/2-15,10,"PWR",{fontFamily:"Georgia, serif",fontSize:"8px",color:"#5a4a3a"}).setOrigin(1,.5))}const g=this.add.rectangle(0,0,a,i,0,0);return g.setInteractive({useHandCursor:!0}),g.on("pointerdown",()=>{var y;if(!h){switch(t){case"weapon":p.equipItem(e.instanceId,"weaponId");break;case"armor":p.equipItem(e.instanceId,"armorId");break;case"helmet":p.equipItem(e.instanceId,"helmetId");break;case"trinket":s.trinket1Id?p.equipItem(e.instanceId,"trinket2Id"):p.equipItem(e.instanceId,"trinket1Id");break}r.destroy(),(y=this.equipmentModal)==null||y.destroy(),this.equipmentModal=void 0,this.scene.restart()}}),o.add(g),o}createActionButtons(){const{width:e,height:a}=this.cameras.main,i=ye(this),t=Math.min(150,(i.width-20)/2),s=Math.max(V,54),r=10,o=a*.57,d=i.x+t/2+8,l=i.x+i.width-t/2-8,h=p.getFatigue(),u=h<100,f=p.getSeals();new G(this,d,o,"âš”ï¸ TRAIN",()=>this.goToTraining(),{width:t,height:s,icon:"âš”ï¸",disabled:!u}),new G(this,l,o,"ðŸ›’ SHOP",()=>this.goToShop(),{width:t,height:s});const g=h>0||this.fighter.injuries.length>0||this.fighter.currentStats.currentHP<this.fighter.currentStats.maxHP;new G(this,d,o+s+r,"ðŸ›ï¸ REST",()=>this.doRest(),{width:t,height:s,disabled:!g}),new G(this,l,o+s+r,"âœ‰ï¸ WRITE",()=>this.writeLetter(),{width:t,height:s,primary:f>0}),new G(this,d,o+(s+r)*2,"ðŸ”¥ FORGE",()=>this.goToForge(),{width:t,height:s}),new G(this,l,o+(s+r)*2,"ðŸŒŸ MASTERY",()=>this.goToMastery(),{width:t,height:s})}createBottomBar(){const{width:e}=this.cameras.main,a=E(),i=p.getRun(),t=oe(this,85),s=e-a.left-a.right;this.add.text(a.left,t-15,`${i.fightsInLeague}/${i.fightsToNextLeague} to next league`,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#5a4a3a"});const r=this.add.graphics();r.fillStyle(2760474,1),r.fillRoundedRect(a.left,t,s,8,3);const o=this.add.graphics();o.fillStyle(13216089,1),o.fillRoundedRect(a.left,t,s*(i.fightsInLeague/i.fightsToNextLeague),8,3),new G(this,e/2,oe(this,35),"ðŸ—¡ï¸ ENTER ARENA",()=>this.enterArena(),{width:Math.min(220,e-80),height:52,fontSize:15,primary:!0})}showCharacterInfo(){this.cameras.main.fadeOut(200),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("CharacterSheetScene")})}goToCustomize(){this.cameras.main.fadeOut(200),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("CustomizeScene")})}goToTraining(){p.updateRun({lastCampAction:"train"}),this.cameras.main.fadeOut(200),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("TrainingScene")})}goToShop(){p.updateRun({lastCampAction:"shop"}),this.cameras.main.fadeOut(200),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("ShopScene")})}goToForge(){p.updateRun({lastCampAction:"forge"}),this.cameras.main.fadeOut(200),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("ForgeScene")})}goToCharacterSheet(){this.cameras.main.fadeOut(200),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("CharacterSheetScene")})}goToMastery(){this.cameras.main.fadeOut(200),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("WeaponMasteryScene")})}doRest(){ft(this.fighter),Ft(this.fighter,1),Te(this.fighter,5),p.reduceFatigue(40),p.clearSparringInjuries(),p.updateRun({fighter:this.fighter,week:this.week+1,lastCampAction:"rest"}),T.showNotification(this,"ðŸ’¤ Rested! HP restored, -40 fatigue, +5 Trust"),this.refreshScene()}writeLetter(){p.updateRun({lastCampAction:"letter"}),this.cameras.main.fadeOut(200),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("LetterScene")})}enterArena(){ft(this.fighter),p.updateRun({fighter:this.fighter,lastCampAction:"fight"}),ja(this,"PrepareScene","wipe",350)}checkGhostMoments(){const e=Ra("camp");if(e){const a=Ia(e);this.time.delayedCall(1e3,()=>{T.showNotification(this,a,4e3)})}}checkRelicOpportunity(){const e=p.getRun();e.fightsSinceRelic>=3&&e.consecutiveWins>=2&&this.time.delayedCall(1500,()=>{T.showConfirmDialog(this,"Relic Opportunity!","A mysterious merchant offers you a choice of relics...",()=>this.scene.start("RelicChoiceScene"),()=>p.updateRun({fightsSinceRelic:0}),"VIEW RELICS")})}refreshScene(){this.cameras.main.fadeOut(150),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.restart()})}}const Ja=[{name:"Bruised Ribs",location:"body",severity:"minor",effect:"Hurts to breathe deeply",statPenalty:{maxStamina:-5},healTime:1,scarChance:0},{name:"Split Lip",location:"head",severity:"minor",effect:"Looks worse than it is",statPenalty:{},healTime:1,scarChance:.1},{name:"Twisted Ankle",location:"legs",severity:"minor",effect:"Movement slightly impaired",statPenalty:{speed:-1,evasion:-3},healTime:1,scarChance:0},{name:"Black Eye",location:"head",severity:"minor",effect:"Vision slightly impaired",statPenalty:{accuracy:-5},healTime:1,scarChance:0},{name:"Strained Shoulder",location:"body",severity:"minor",effect:"Arm feels weak",statPenalty:{attack:-2},healTime:2,scarChance:0},{name:"Deep Cut",location:"body",severity:"moderate",effect:"Bleeding wound",statPenalty:{maxHP:-10,defense:-2},healTime:2,scarChance:.3},{name:"Fractured Jaw",location:"head",severity:"moderate",effect:"Speaking and eating is painful",statPenalty:{maxStamina:-8},healTime:3,scarChance:.2},{name:"Torn Muscle",location:"legs",severity:"moderate",effect:"Mobility severely limited",statPenalty:{speed:-3,evasion:-8},healTime:3,scarChance:0},{name:"Cracked Ribs",location:"body",severity:"moderate",effect:"Every breath hurts",statPenalty:{maxStamina:-12,defense:-3},healTime:3,scarChance:0},{name:"Gashed Thigh",location:"legs",severity:"moderate",effect:"Deep wound, heavy bleeding",statPenalty:{maxHP:-8,speed:-2},healTime:2,scarChance:.4},{name:"Concussion",location:"head",severity:"moderate",effect:"Head trauma, dizziness",statPenalty:{accuracy:-10,maxFocus:-10},healTime:2,scarChance:0},{name:"Broken Arm",location:"body",severity:"severe",effect:"Cannot use dominant arm properly",statPenalty:{attack:-8,accuracy:-15},healTime:4,scarChance:.1},{name:"Shattered Knee",location:"legs",severity:"severe",effect:"May never fight the same",statPenalty:{speed:-5,evasion:-15},healTime:5,scarChance:.2},{name:"Skull Fracture",location:"head",severity:"severe",effect:"Life-threatening head trauma",statPenalty:{maxHP:-20,maxFocus:-15},healTime:5,scarChance:.5},{name:"Punctured Lung",location:"body",severity:"severe",effect:"Breathing is agony",statPenalty:{maxStamina:-25,maxHP:-15},healTime:5,scarChance:.3},{name:"Severed Tendon",location:"legs",severity:"severe",effect:"Leg barely functional",statPenalty:{speed:-8,evasion:-20,attack:-3},healTime:5,scarChance:.4},{name:"Facial Disfigurement",location:"head",severity:"severe",effect:"Scarred for life",statPenalty:{},healTime:4,scarChance:1}],Za=[{id:"bandages",name:"Crude Bandages",description:"Dirty cloth strips. Better than nothing.",type:"healing",effect:"Restore 20 HP",value:20,uses:1,price:15},{id:"healing_salve",name:"Healing Salve",description:"A pungent green paste that numbs pain.",type:"healing",effect:"Restore 35 HP",value:35,uses:1,price:30},{id:"surgeons_kit",name:"Surgeon's Kit",description:"Professional medical supplies.",type:"healing",effect:"Restore 50 HP, cure Bleed",value:50,uses:1,price:60},{id:"grit_salts",name:"Grit Salts",description:"Inhale for instant alertness. Burns like hell.",type:"buff",effect:"Restore 30 Stamina",value:30,uses:1,price:25},{id:"focus_tonic",name:"Focus Tonic",description:"A bitter brew that sharpens the mind.",type:"buff",effect:"Gain 20 Focus",value:20,uses:1,price:35},{id:"berserker_draught",name:"Berserker Draught",description:"Red liquid that tastes of iron. +5 Attack for 3 turns.",type:"buff",effect:"+5 Attack (3 turns)",value:5,uses:1,price:45},{id:"iron_skin_oil",name:"Iron-Skin Oil",description:"Protective coating. +5 Defense for 3 turns.",type:"buff",effect:"+5 Defense (3 turns)",value:5,uses:1,price:45},{id:"smoke_bomb",name:"Smoke Bomb",description:"Creates a concealing cloud. Guarantees dodge next attack.",type:"utility",effect:"Guaranteed dodge (1 attack)",value:1,uses:1,price:50},{id:"flash_powder",name:"Flash Powder",description:"Blinds the opponent. -20 Accuracy for 2 turns.",type:"utility",effect:"Enemy -20 Accuracy (2 turns)",value:20,uses:1,price:40},{id:"antivenom",name:"Antivenom",description:"Neutralizes poisons and clears the blood.",type:"healing",effect:"Cure Bleed and Poison",value:0,uses:1,price:35}];class ei extends w.Scene{constructor(){super({key:"ShopScene"});m(this,"gold");m(this,"fighter");m(this,"selectedCategory","items");m(this,"shopStock",[]);m(this,"goldText");m(this,"itemsContainer")}create(){const e=p.getRun();if(!e.fighter){this.scene.start("MainMenuScene");return}this.fighter=e.fighter,this.gold=e.gold,this.generateShopInventory(),this.createBackground(),this.createHeader(),this.createCategoryTabs(),this.createItemList(),this.createBackButton(),this.cameras.main.fadeIn(300)}generateShopInventory(){const e=p.getMeta(),i=p.getRun().league||"bronze",t=3+Math.floor(e.promoterLevel/2),s=3+Math.floor(e.promoterLevel/2),r=["bronze","silver","gold"],o=r.indexOf(i);this.shopStock=[];const d=Xe.filter(f=>r.indexOf(f.leagueMin)<=o);k.shuffle([...d]).slice(0,t).forEach(f=>{const g=ot(f.id,"weapon",f.rarity,i);this.shopStock.push(g)});const h=Ke.filter(f=>r.indexOf(f.leagueMin)<=o);k.shuffle([...h]).slice(0,s).forEach(f=>{const g=ot(f.id,"armor",f.rarity,i,f.slot);this.shopStock.push(g)}),Za.forEach(f=>{const g=ue(f.id,"consumable",void 0,1);this.shopStock.push(g)}),console.log("[Shop] Generated stock:",this.shopStock.length,"items")}createBackground(){const{width:e,height:a}=this.cameras.main,i=this.add.graphics();if(i.fillGradientStyle(1709072,1709072,2760474,2760474),i.fillRect(0,0,e,a),this.textures.exists("parchment_overlay")){const t=this.add.image(e/2,a/2,"parchment_overlay");t.setAlpha(.08),t.setDisplaySize(e,a)}}createHeader(){const{width:e}=this.cameras.main;this.add.text(e/2,35,"ðŸ›’ MERCHANT",{fontFamily:"Georgia, serif",fontSize:"24px",color:"#c9a959",stroke:"#000000",strokeThickness:3}).setOrigin(.5),this.add.text(e/2,65,'"Best wares this side of the arena..."',{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b7355",fontStyle:"italic"}).setOrigin(.5),this.goldText=this.add.text(e-20,20,`ðŸ’° ${this.gold}`,{fontFamily:"Georgia, serif",fontSize:"18px",color:"#ffd700"}).setOrigin(1,0)}createCategoryTabs(){const{width:e}=this.cameras.main,a=100,i=100,t=110,s=e/2-t;[{id:"items",label:"ðŸ§ª Items"},{id:"weapons",label:"âš”ï¸ Weapons"},{id:"armor",label:"ðŸ›¡ï¸ Armor"}].forEach((o,d)=>{const l=s+d*t;T.createButton(this,l,a,o.label,()=>this.selectCategory(o.id),{width:i,height:35,fontSize:"11px"}).setData("category",o.id)})}selectCategory(e){this.selectedCategory=e,this.createItemList()}createItemList(){const{width:e,height:a}=this.cameras.main;this.itemsContainer&&this.itemsContainer.destroy(),this.itemsContainer=this.add.container(0,0);const t={weapons:["weapon"],armor:["armor"],items:["consumable","trinket"]}[this.selectedCategory]||["consumable"],s=this.shopStock.filter(d=>t.includes(d.itemType)),r=150,o=90;s.forEach((d,l)=>{const h=r+l*o;this.createItemCard(d,30,h,e-60,85)}),s.length===0&&this.add.text(e/2,250,"No items available",{fontFamily:"Georgia, serif",fontSize:"14px",color:"#5a4a3a"}).setOrigin(.5)}createItemCard(e,a,i,t,s){const r=this.add.container(a,i);this.itemsContainer.add(r);const o=z(e);if(!o)return;const d=o.rarity||"common",l=o.price||50,h=this.add.graphics(),u={common:3815994,uncommon:1989178,rare:2767466,epic:5909098,legendary:6969882};he(e)&&(h.fillStyle(u[d]||3815994,.3),h.fillRoundedRect(-2,-2,t+4,s+4,10)),h.fillStyle(2760474,1),h.fillRoundedRect(0,0,t,s,8),h.lineStyle(2,u[d]||5917242,1),h.strokeRoundedRect(0,0,t,s,8),r.add(h);const g={common:"#8b8b8b",uncommon:"#2e8b57",rare:"#4169e1",epic:"#a855f7",legendary:"#ffd700"}[d]||"#8b8b8b",y=j(e),S=this.add.text(15,10,y,{fontFamily:"Georgia, serif",fontSize:"13px",color:g,wordWrap:{width:t-100}});r.add(S);const b=oa(e);if(b.length>0){const P=b.slice(0,2).join(" â€¢ "),H=this.add.text(15,32,P,{fontFamily:"Georgia, serif",fontSize:"9px",color:"#c9a959",fontStyle:"italic"});r.add(H)}let M="";if(e.itemType==="weapon"&&"damageMin"in o){const P=o;M=`âš”ï¸ ${P.damageMin}-${P.damageMax}`}else e.itemType==="armor"&&"defense"in o?M=`ðŸ›¡ï¸ ${o.defense}`:"effect"in o&&(M=o.effect);const C=this.add.text(15,he(e)?48:35,M,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355"});r.add(C);const x=this.add.text(t-15,10,`ðŸ’° ${l}`,{fontFamily:"Georgia, serif",fontSize:"14px",color:this.gold>=l?"#ffd700":"#8b0000"}).setOrigin(1,0);r.add(x);const R=this.gold>=l,B=T.createButton(this,t-45,s-22,"BUY",()=>this.buyShopItem(e,l),{width:60,height:28,fontSize:"11px",primary:R});r.add(B),R||B.setAlpha(.5)}buyShopItem(e,a){if(this.gold<a){T.showNotification(this,"Not enough gold!");return}const i=this.gold;this.gold-=a,this.goldText.setText(`ðŸ’° ${this.gold}`),p.addItem(e),console.log("[Shop] onPurchase:",e.instanceId,e.itemType,"gold:",i,"->",this.gold),console.log("[Shop] Affixes:",e.prefixId,e.suffixId,e.curseId),p.updateRun({gold:this.gold});const t=j(e);T.showNotification(this,`Purchased ${t}!`);const s=this.shopStock.findIndex(o=>o.instanceId===e.instanceId);s>=0&&this.shopStock.splice(s,1);const r=p.getInventory();console.log("[Shop] Inventory after purchase:",r.length,"items"),this.createItemList()}createBackButton(){const{width:e,height:a}=this.cameras.main;T.createButton(this,e/2,a-50,"â† BACK TO CAMP",()=>this.returnToCamp(),{width:180,height:45})}returnToCamp(){this.cameras.main.fadeOut(200),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("CampScene")})}}const X={light_attack:{staminaCost:10,baseDamage:1,accuracy:.9,focusGain:5,hypeGain:5},heavy_attack:{staminaCost:25,baseDamage:1.8,accuracy:.75,focusGain:10,hypeGain:15},guard:{staminaCost:5,blockMultiplier:.6,focusGain:3,hypeGain:0},dodge:{staminaCost:15,evasionBonus:.3,focusGain:5,hypeGain:10},special:{staminaCost:20,focusCost:30,baseDamage:2,accuracy:.85,hypeGain:25},item:{staminaCost:0,focusGain:0,hypeGain:-5}},ti={head:{damage:1.2,critBonus:.1,effect:"concuss"},body:{damage:1,critBonus:0,effect:null},legs:{damage:.9,critBonus:-.05,effect:"cripple"}};function ai(c,n){return{player:St(c),enemy:St(n),round:1,turn:c.currentStats.speed>=n.currentStats.speed?"player":"enemy",phase:"select_action",crowdHype:30,log:[],isParryWindow:!1,parryWindowStart:0,winner:null,lastAction:null}}function St(c){return{fighter:c,currentHP:c.currentStats.currentHP,currentStamina:c.currentStats.currentStamina,currentFocus:0,injuryMeter:0,activeEffects:new Map,guardStance:null,lastAction:null,consecutiveGuards:0}}function wt(c,n,e,a,i){const t=c[n],s=c[n==="player"?"enemy":"player"],r=X[e];let o={success:!1,damage:0,damageBlocked:0,targetZone:a,critical:!1,perfectParry:!1,counterDamage:0,statusApplied:null,staminaCost:r.staminaCost,focusGained:0,focusSpent:0,hypeGained:0,message:""};if(t.currentStamina<r.staminaCost)return o.message=`${t.fighter.firstName} is too exhausted!`,o;switch(t.currentStamina-=r.staminaCost,e){case"light_attack":case"heavy_attack":o=ii(c,t,s,e,a);break;case"guard":o=si(t,a);break;case"dodge":o=ni(t);break;case"special":o=ri(c,t,s,a);break;case"item":o=oi(t);break}return t.lastAction=e,c.log.push({round:c.round,actor:n,action:e,result:o,timestamp:Date.now()}),c.crowdHype=Math.max(0,Math.min(100,c.crowdHype+o.hypeGained)),s.currentHP<=0?(c.winner=n,c.phase="end"):t.currentHP<=0&&(c.winner=n==="player"?"enemy":"player",c.phase="end"),c.lastAction=o,o}function ii(c,n,e,a,i){const t=X[a],s=ti[i],r={success:!1,damage:0,damageBlocked:0,targetZone:i,critical:!1,perfectParry:!1,counterDamage:0,statusApplied:null,staminaCost:t.staminaCost,focusGained:0,focusSpent:0,hypeGained:0,message:""};let o=t.accuracy*(n.fighter.currentStats.accuracy/100);if(e.lastAction==="dodge"&&(o-=X.dodge.evasionBonus),n.activeEffects.has("concuss")&&(o-=.15),e.activeEffects.has("cripple")&&i==="legs"&&(o+=.1),k.chance(o)){r.success=!0;let d=n.fighter.currentStats.attack*t.baseDamage;d*=s.damage;const l=n.fighter.currentStats.critChance/100+s.critBonus;k.chance(l)&&(r.critical=!0,d*=n.fighter.currentStats.critDamage/100,r.hypeGained+=10),e.lastAction==="guard"&&e.guardStance===i&&(r.damageBlocked=d*X.guard.blockMultiplier,d-=r.damageBlocked,r.message=`${e.fighter.firstName} blocked! `);const h=e.fighter.currentStats.defense,u=Math.max(1,Math.round(d-h*.3));r.damage=u,e.currentHP-=u,e.currentHP<e.fighter.closestCall&&(e.fighter.closestCall=e.currentHP),e.injuryMeter+=u*.5,r.critical&&(e.injuryMeter+=10),s.effect&&k.chance(.2+(r.critical?.1:0))&&(r.statusApplied=s.effect,e.activeEffects.set(s.effect,3)),r.focusGained=t.focusGain,n.currentFocus=Math.min(n.fighter.currentStats.maxFocus,n.currentFocus+r.focusGained),r.hypeGained+=t.hypeGain;const f=a==="light_attack"?"quick strike":"heavy blow";r.message+=`${n.fighter.firstName}'s ${f} hits the ${i} for ${u} damage!`,r.critical&&(r.message+=" CRITICAL HIT!"),r.statusApplied&&(r.message+=` ${e.fighter.firstName} is ${r.statusApplied}ed!`)}else r.message=`${n.fighter.firstName}'s attack misses!`,e.lastAction==="dodge"&&(r.message=`${e.fighter.firstName} dodges the attack!`,r.hypeGained=5);return r}function si(c,n){c.guardStance=n,c.consecutiveGuards++;const e=X.guard.focusGain*Math.min(c.consecutiveGuards,3);return c.currentFocus=Math.min(c.fighter.currentStats.maxFocus,c.currentFocus+e),{success:!0,damage:0,damageBlocked:0,targetZone:n,critical:!1,perfectParry:!1,counterDamage:0,statusApplied:null,staminaCost:X.guard.staminaCost,focusGained:e,focusSpent:0,hypeGained:0,message:`${c.fighter.firstName} raises guard to protect ${n}!`}}function ni(c){return c.guardStance=null,c.consecutiveGuards=0,{success:!0,damage:0,damageBlocked:0,targetZone:"body",critical:!1,perfectParry:!1,counterDamage:0,statusApplied:null,staminaCost:X.dodge.staminaCost,focusGained:X.dodge.focusGain,focusSpent:0,hypeGained:X.dodge.hypeGain,message:`${c.fighter.firstName} prepares to dodge!`}}function ri(c,n,e,a){const i=X.special;if(n.currentFocus<i.focusCost)return{success:!1,damage:0,damageBlocked:0,targetZone:a,critical:!1,perfectParry:!1,counterDamage:0,statusApplied:null,staminaCost:0,focusGained:0,focusSpent:0,hypeGained:-5,message:`${n.fighter.firstName} lacks focus for a special move!`};n.currentFocus-=i.focusCost,n.fighter.signatureMoveUses++;const t=n.fighter.currentStats.attack*i.baseDamage,s=Math.round(t*k.float(.9,1.2));return e.currentHP-=s,e.injuryMeter+=s*.7,{success:!0,damage:s,damageBlocked:0,targetZone:a,critical:!1,perfectParry:!1,counterDamage:0,statusApplied:null,staminaCost:i.staminaCost,focusGained:0,focusSpent:i.focusCost,hypeGained:i.hypeGain,message:`${n.fighter.firstName} unleashes "${n.fighter.signatureTrait.name}"! ${s} damage!`}}function oi(c,n){return c.currentHP=Math.min(c.fighter.currentStats.maxHP,c.currentHP+30),{success:!0,damage:0,damageBlocked:0,targetZone:"body",critical:!1,perfectParry:!1,counterDamage:0,statusApplied:null,staminaCost:0,focusGained:0,focusSpent:0,hypeGained:-5,message:`${c.fighter.firstName} uses a healing item! Restored 30 HP.`}}function ci(c){for(const n of["player","enemy"]){const e=c[n];e.currentStamina=Math.min(e.fighter.currentStats.maxStamina,e.currentStamina+10);for(const[a,i]of e.activeEffects)a==="bleed"&&(e.currentHP-=5,c.log.push({round:c.round,actor:n,action:"light_attack",result:{success:!0,damage:5,damageBlocked:0,targetZone:"body",critical:!1,perfectParry:!1,counterDamage:0,statusApplied:null,staminaCost:0,focusGained:0,focusSpent:0,hypeGained:0,message:`${e.fighter.firstName} bleeds for 5 damage!`},timestamp:Date.now()})),i<=1?e.activeEffects.delete(a):e.activeEffects.set(a,i-1);e.lastAction!=="guard"&&(e.guardStance=null,e.consecutiveGuards=0)}}function qe(c){ci(c),c.turn=c.turn==="player"?"enemy":"player",c.turn==="player"&&c.round++,c.phase="select_action",c.isParryWindow=!1}function di(c,n){const e=c.injuryMeter/200;if(k.chance(e)){const a=c.injuryMeter>80?"severe":c.injuryMeter>40?"moderate":"minor";return li(a)}return null}function li(c){const n=Ja.filter(a=>a.severity===c);return{...k.pick(n),id:`injury_${k.id(8)}`}}function hi(c,n,e){const a=e==="bronze"?1:e==="silver"?1.5:2,i=1+c.crowdHype/100*.5,t=20+c.round*5,s=10+c.round*2,r=25+c.round*5;return{gold:Math.round(t*a*i),fame:Math.round(s*a*i),xp:Math.round(r*a)}}const ui=[{first:"Brutus",last:"Ironjaw"},{first:"Gaius",last:"Bloodhand"},{first:"Marcus",last:"the Cruel"},{first:"Varro",last:"Steelarm"},{first:"Crixus",last:"the Shadow"},{first:"Spartus",last:"Bonecrusher"},{first:"Drago",last:"the Silent"},{first:"Thorin",last:"Skullsplitter"},{first:"Ragnar",last:"the Red"},{first:"Ulric",last:"Deathbringer"},{first:"Kira",last:"Swiftblade"},{first:"Valeria",last:"the Viper"},{first:"Helena",last:"Ironmaiden"},{first:"Freya",last:"Frostbite"},{first:"Sigrid",last:"the Storm"},{first:"Malik",last:"the Merciless"},{first:"Cyrus",last:"Sandstorm"},{first:"Ajax",last:"the Giant"},{first:"Nero",last:"Blackheart"},{first:"Lucius",last:"Goldmask"},{first:"Gorm",last:"the Grim"},{first:"Fenris",last:"Wolfjaw"},{first:"Balthus",last:"the Beast"},{first:"Corvus",last:"Ravenwing"}],it=[{id:"brute",name:"Brute Force",title:"The Brute",aiType:"brutal",statMultipliers:{maxHP:1.2,attack:1.3,defense:.9,speed:.8},specialAbility:"Heavy blows deal +20% damage",flavorText:"Raw strength and aggression. No finesse, just power.",taunts:["I'll crush your skull!","Weakling! Face a real warrior!","Your bones will crack like twigs!","This ends now!"]},{id:"duelist",name:"Precise Strikes",title:"The Duelist",aiType:"tactical",statMultipliers:{attack:1,defense:1,speed:1.2,accuracy:1.15},specialAbility:"+15% critical chance",flavorText:"Elegant and deadly. Every move calculated.",taunts:["You fight like a farmer.","Too slow. Much too slow.","I've faced better.","Shall we dance?"]},{id:"tank",name:"Iron Wall",title:"The Wall",aiType:"defensive",statMultipliers:{maxHP:1.4,defense:1.4,attack:.8,speed:.7},specialAbility:"+30% block effectiveness",flavorText:"Immovable and patient. Waits for you to tire.",taunts:["Your attacks mean nothing.","I could do this all day.","Tired yet?","I am the wall."]},{id:"assassin",name:"Shadow Strike",title:"The Assassin",aiType:"trickster",statMultipliers:{maxHP:.8,attack:1.1,speed:1.4,evasion:1.3},specialAbility:"+25% dodge chance",flavorText:"Fast and elusive. Strikes from unexpected angles.",taunts:["You can't hit what you can't see.","Too predictable.","Catch me if you can.","Already behind you."]},{id:"berserker",name:"Blood Rage",title:"The Berserker",aiType:"berserker",statMultipliers:{maxHP:1.1,attack:1.2,defense:.7,maxStamina:1.2},specialAbility:"+30% damage when below 50% HP",flavorText:"Grows more dangerous as the fight progresses.",taunts:["BLOOD! MORE BLOOD!","PAIN MAKES ME STRONGER!","RAAAAAAGH!","I CANNOT BE STOPPED!"]},{id:"veteran",name:"Battle Wisdom",title:"The Veteran",aiType:"balanced",statMultipliers:{maxHP:1.1,attack:1.1,defense:1.1,accuracy:1.1},specialAbility:"No weaknesses",flavorText:"Years of experience. Knows every trick in the book.",taunts:["I've seen it all before.","Youth and enthusiasm, meet old age and treachery.","Still learning, I see.","Not bad. But not good enough."]},{id:"showman",name:"Crowd Favorite",title:"The Showman",aiType:"aggressive",statMultipliers:{maxHP:1,attack:1.15,speed:1.1},specialAbility:"+50% crowd hype gain",flavorText:"Fights for glory and applause.",taunts:["Watch closely, crowd!","Let me show you how it's done!","Are you not entertained?!","Remember this moment!"]},{id:"executioner",name:"Final Blow",title:"The Executioner",aiType:"brutal",statMultipliers:{maxHP:1.15,attack:1.25,accuracy:1.1,speed:.9},specialAbility:"+50% damage to enemies below 25% HP",flavorText:"Specializes in finishing wounded opponents.",taunts:["Your end approaches.","I smell your fear.","Time to finish this.","Accept your fate."]}],st=[{id:"armored",name:"Armored",icon:"ðŸ›¡ï¸",description:"High defense, resistant to armor break",shortWarning:"ARMORED: Guard is stronger",weight:{bronze:30,silver:25,gold:20,champion:15},statMods:{defenseMod:30,speedMod:-10},behaviorMods:{defensiveMod:20},specialRules:[{type:"resistance",effect:"armor_break",value:-50}],tags:["defense","slow"]},{id:"shielded",name:"Shielded",icon:"ðŸª–",description:"Blocks first 3 hits, then shield breaks",shortWarning:"SHIELDED: First 3 hits blocked",weight:{bronze:25,silver:30,gold:25,champion:20},statMods:{},behaviorMods:{defensiveMod:15},specialRules:[{type:"passive",effect:"shield_charges",value:3}],tags:["defense","shield"]},{id:"evasive",name:"Evasive",icon:"ðŸ’¨",description:"High dodge, low HP",shortWarning:"EVASIVE: Hard to hit",weight:{bronze:20,silver:25,gold:30,champion:30},statMods:{dodgeMod:40,hpMod:-20},behaviorMods:{aggressionMod:-10},specialRules:[{type:"vulnerability",effect:"stun",value:25}],tags:["dodge","glass"]},{id:"turtle",name:"Turtle",icon:"ðŸ¢",description:"Very defensive, counters after blocking",shortWarning:"TURTLE: Counters after block",weight:{bronze:20,silver:25,gold:25,champion:20},statMods:{defenseMod:20,damageMod:-15},behaviorMods:{defensiveMod:40,aggressionMod:-30},specialRules:[{type:"passive",effect:"counter_on_block",value:8}],tags:["defense","counter"]},{id:"brutal",name:"Brutal",icon:"ðŸ’ª",description:"High damage, less defensive",shortWarning:"BRUTAL: Hits hard",weight:{bronze:30,silver:30,gold:25,champion:20},statMods:{damageMod:25,defenseMod:-15},behaviorMods:{aggressionMod:25},specialRules:[],tags:["damage","aggressive"]},{id:"berserker",name:"Berserker",icon:"ðŸ”¥",description:"Enrages at low HP: +50% damage",shortWarning:"BERSERKER: Enrages at low HP",weight:{bronze:25,silver:30,gold:30,champion:25},statMods:{},behaviorMods:{},specialRules:[{type:"phase_trigger",trigger:"low_hp",threshold:30,effect:"enrage",value:50}],tags:["damage","enrage"]},{id:"relentless",name:"Relentless",icon:"âš¡",description:"Never tires, constant aggression",shortWarning:"RELENTLESS: Never stops attacking",weight:{bronze:20,silver:25,gold:30,champion:30},statMods:{staminaMod:50},behaviorMods:{aggressionMod:35},specialRules:[{type:"passive",effect:"stamina_regen",value:10}],tags:["stamina","aggressive"]},{id:"crusher",name:"Crusher",icon:"ðŸ”¨",description:"Heavy attacks apply double armor break",shortWarning:"CRUSHER: Destroys armor",weight:{bronze:15,silver:25,gold:30,champion:30},statMods:{damageMod:10},behaviorMods:{aggressionMod:15},specialRules:[{type:"passive",effect:"double_armor_break",value:1}],tags:["armor_break","damage"]},{id:"cunning",name:"Cunning",icon:"ðŸ¦Š",description:"Unpredictable, mixes attacks and dodges",shortWarning:"CUNNING: Unpredictable moves",weight:{bronze:15,silver:25,gold:30,champion:35},statMods:{dodgeMod:15,critMod:10},behaviorMods:{},specialRules:[{type:"passive",effect:"random_action_bonus",value:15}],tags:["tactical","dodge","crit"]},{id:"patient",name:"Patient",icon:"ðŸ§˜",description:"Waits for openings, devastating counters",shortWarning:"PATIENT: Waits then strikes",weight:{bronze:15,silver:20,gold:30,champion:35},statMods:{parryMod:30,damageMod:15},behaviorMods:{defensiveMod:25,aggressionMod:-20},specialRules:[{type:"passive",effect:"parry_damage_bonus",value:50}],tags:["parry","counter","tactical"]},{id:"momentum_master",name:"Momentum Master",icon:"ðŸŒŠ",description:"Builds momentum faster, uses specials more",shortWarning:"MOMENTUM: Builds power fast",weight:{bronze:10,silver:20,gold:30,champion:40},statMods:{},behaviorMods:{specialMod:30},specialRules:[{type:"passive",effect:"momentum_gain",value:3}],tags:["momentum","special"]},{id:"venomous",name:"Venomous",icon:"ðŸ",description:"Attacks apply poison",shortWarning:"VENOMOUS: Poison on hit",weight:{bronze:20,silver:30,gold:25,champion:20},statMods:{damageMod:-10},behaviorMods:{},specialRules:[{type:"passive",effect:"poison_on_hit",value:3}],tags:["poison","status"]},{id:"bleeder",name:"Bleeder",icon:"ðŸ©¸",description:"Attacks cause bleeding",shortWarning:"BLEEDER: Causes bleed",weight:{bronze:25,silver:30,gold:25,champion:20},statMods:{},behaviorMods:{aggressionMod:10},specialRules:[{type:"passive",effect:"bleed_on_hit",value:2}],tags:["bleed","status"]},{id:"stunning",name:"Stunning",icon:"ðŸ’«",description:"Heavy attacks can stun",shortWarning:"STUNNING: Can stun you",weight:{bronze:15,silver:25,gold:30,champion:30},statMods:{},behaviorMods:{aggressionMod:5},specialRules:[{type:"passive",effect:"stun_on_heavy",value:25}],tags:["stun","status"]},{id:"vampiric",name:"Vampiric",icon:"ðŸ§›",description:"Heals from damage dealt",shortWarning:"VAMPIRIC: Heals on hit",weight:{bronze:10,silver:20,gold:30,champion:35},statMods:{hpMod:-15},behaviorMods:{aggressionMod:20},specialRules:[{type:"passive",effect:"lifesteal",value:20}],tags:["lifesteal","heal"]},{id:"thorny",name:"Thorny",icon:"ðŸŒµ",description:"Reflects damage when hit",shortWarning:"THORNY: Reflects damage",weight:{bronze:15,silver:25,gold:30,champion:25},statMods:{defenseMod:10},behaviorMods:{defensiveMod:10},specialRules:[{type:"passive",effect:"thorns",value:5}],tags:["thorns","defense"]},{id:"regenerating",name:"Regenerating",icon:"ðŸ’š",description:"Heals each turn",shortWarning:"REGENERATING: Heals over time",weight:{bronze:20,silver:25,gold:25,champion:20},statMods:{hpMod:10},behaviorMods:{defensiveMod:15},specialRules:[{type:"passive",effect:"hp_regen",value:5}],tags:["heal","defense"]},{id:"giant",name:"Giant",icon:"ðŸ¦£",description:"Massive HP pool, slow but devastating",shortWarning:"GIANT: Huge HP pool",weight:{bronze:15,silver:20,gold:25,champion:30},statMods:{hpMod:60,speedMod:-25,damageMod:15},behaviorMods:{aggressionMod:-15},specialRules:[{type:"vulnerability",effect:"bleed",value:25}],tags:["hp","slow","damage"]},{id:"ghost",name:"Ghost",icon:"ðŸ‘»",description:"25% chance to phase through attacks",shortWarning:"GHOST: Can phase through hits",weight:{bronze:5,silver:15,gold:25,champion:35},statMods:{hpMod:-25},behaviorMods:{},specialRules:[{type:"passive",effect:"phase_chance",value:25}],tags:["dodge","special"]}];function ve(c){return st.find(n=>n.id===c)}function fi(c){switch(c){case"bronze":return{oneChance:30,twoChance:0};case"silver":return{oneChance:100,twoChance:15};case"gold":return{oneChance:100,twoChance:35};case"champion":return{oneChance:100,twoChance:60};default:return{oneChance:30,twoChance:0}}}function mi(c){const n=fi(c),e=[];if(Math.random()*100<n.oneChance){const a=st.filter(t=>t.weight[c]>0),i=bt(a,c);if(i&&e.push(i.id),e.length>0&&Math.random()*100<n.twoChance){const t=a.filter(r=>{if(r.id===e[0])return!1;const o=ve(e[0]);return!(o&&r.tags.filter(l=>o.tags.includes(l)).length>1)}),s=bt(t,c);s&&e.push(s.id)}}return e}function bt(c,n){if(c.length===0)return null;const e=c.reduce((i,t)=>i+(t.weight[n]||0),0);let a=Math.random()*e;for(const i of c)if(a-=i.weight[n]||0,a<=0)return i;return c[0]}function gi(c){const n={};for(const e of c){const a=ve(e);if(!a)continue;const i=a.statMods;i.hpMod&&(n.hpMod=(n.hpMod||0)+i.hpMod),i.damageMod&&(n.damageMod=(n.damageMod||0)+i.damageMod),i.defenseMod&&(n.defenseMod=(n.defenseMod||0)+i.defenseMod),i.critMod&&(n.critMod=(n.critMod||0)+i.critMod),i.dodgeMod&&(n.dodgeMod=(n.dodgeMod||0)+i.dodgeMod),i.parryMod&&(n.parryMod=(n.parryMod||0)+i.parryMod),i.staminaMod&&(n.staminaMod=(n.staminaMod||0)+i.staminaMod),i.speedMod&&(n.speedMod=(n.speedMod||0)+i.speedMod)}return n}function pi(c,n){const e=k.pick(it),a=k.pick(ui),i={bronze:1,silver:1.3,gold:1.6,champion:2}[c],t=Math.min(n*2,20),s={maxHP:Math.round((80+t)*i*(e.statMultipliers.maxHP||1)),currentHP:0,maxStamina:Math.round((80+t*.5)*(e.statMultipliers.maxStamina||1)),currentStamina:0,maxFocus:Math.round(60*(e.statMultipliers.maxFocus||1)),currentFocus:0,attack:Math.round((10+t*.3)*i*(e.statMultipliers.attack||1)),defense:Math.round((8+t*.2)*i*(e.statMultipliers.defense||1)),speed:Math.round((8+t*.2)*(e.statMultipliers.speed||1)),accuracy:Math.round(75+t*.5),evasion:Math.round(10+t*.3),critChance:10,critDamage:150};s.currentHP=s.maxHP,s.currentStamina=s.maxStamina;const r={id:`enemy_${k.id(8)}`,firstName:a.first,lastName:a.last,nickname:e.title,fullName:`${a.first} '${e.title}' ${a.last}`,age:k.int(20,50),birthplace:"Unknown",backstory:e.flavorText,personality:yi(e.aiType),baseStats:s,currentStats:{...s},equipment:{weapon:null,armor:null,accessory:null},keepsake:{id:"enemy_keepsake",name:"Fighter's Token",backstory:"A simple token.",effect:"None",statBonus:{},upgraded:!1},inventory:[],signatureTrait:{id:e.id,name:e.name,description:e.specialAbility||"No special ability",type:"neutral",effect:e.specialAbility||""},traits:[],flaws:[],portrait:Et(),level:Math.ceil(n/2),experience:0,wins:k.int(0,n*2),losses:k.int(0,n),kills:k.int(0,n),status:"healthy",injuries:[],scars:[],activeEffects:[],trust:0,trustLevel:"stranger",totalDamageDealt:0,totalDamageTaken:0,perfectParries:0,signatureMoveUses:0,closestCall:s.maxHP,bestWin:"",lettersWritten:[],weeksSurvived:n},o=mi(c),d=r;if(d.mutatorIds=o,o.length>0){const l=gi(o);l.hpMod&&(r.currentStats.maxHP=Math.round(r.currentStats.maxHP*(1+l.hpMod/100)),r.currentStats.currentHP=r.currentStats.maxHP),l.damageMod&&(r.currentStats.attack=Math.round(r.currentStats.attack*(1+l.damageMod/100))),l.defenseMod&&(r.currentStats.defense=Math.round(r.currentStats.defense*(1+l.defenseMod/100))),l.critMod&&(r.currentStats.critChance=Math.round(r.currentStats.critChance*(1+l.critMod/100))),l.dodgeMod&&(r.currentStats.evasion=Math.round(r.currentStats.evasion*(1+l.dodgeMod/100))),l.staminaMod&&(r.currentStats.maxStamina=Math.round(r.currentStats.maxStamina*(1+l.staminaMod/100)),r.currentStats.currentStamina=r.currentStats.maxStamina),l.speedMod&&(r.currentStats.speed=Math.round(r.currentStats.speed*(1+l.speedMod/100)));const h=o.map(u=>{var f;return(f=ve(u))==null?void 0:f.name}).filter(Boolean);h.length>0&&(r.nickname=`${r.nickname} [${h.join(", ")}]`)}return d}function yi(c){return{aggressive:"aggressive",defensive:"stoic",trickster:"cunning",brutal:"aggressive",balanced:"stoic",cautious:"fearful",berserker:"aggressive",tactical:"cunning"}[c]}function vi(c,n){const e=c.enemy,a=c.player,i=e.currentStamina>=25,t=e.currentFocus>=30&&e.currentStamina>=20,s=e.currentStamina>=15,r=e.currentHP/e.fighter.currentStats.maxHP,o=a.currentHP/a.fighter.currentStats.maxHP;let d,l;switch(n){case"aggressive":d=Si(i,t),l=k.chance(.4)?"head":k.chance(.5)?"body":"legs";break;case"defensive":d=wi(s,r,a.lastAction),l=a.guardStance?nt(a.guardStance):"body";break;case"trickster":d=bi(s,t,c),l=xi(a);break;case"brutal":d=ki(i,t),l="head";break;case"balanced":d=Ci(i,t,s),l=k.pick(["head","body","legs"]);break;case"cautious":d=Mi(s,r,o),l="body";break;case"berserker":d=Ti(i,t,r),l=k.chance(.6)?"head":"body";break;case"tactical":d=Ri(c,i,t,s),l=Ii(a);break;default:d="light_attack",l="body"}return{action:d,targetZone:l}}function Si(c,n,e){return n&&k.chance(.3)?"special":c&&k.chance(.5)?"heavy_attack":"light_attack"}function wi(c,n,e){return n<.3&&k.chance(.6)?"guard":e==="heavy_attack"&&c?k.chance(.5)?"dodge":"guard":k.chance(.3)?"guard":c&&k.chance(.2)?"dodge":"light_attack"}function bi(c,n,e){return c&&e.player.lastAction==="heavy_attack"?"dodge":n&&k.chance(.4)?"special":k.chance(.3)?"dodge":"light_attack"}function xi(c){return c.guardStance?nt(c.guardStance):k.pick(["head","body","legs"])}function ki(c,n){return n&&k.chance(.4)?"special":c?"heavy_attack":"light_attack"}function Ci(c,n,e,a){const i=k.random();return n&&i<.15?"special":c&&i<.35?"heavy_attack":i<.45?"guard":e&&i<.55?"dodge":"light_attack"}function Mi(c,n,e){if(n<.4)return k.chance(.5)?"guard":c?"dodge":"guard";if(e<.3)return k.chance(.6)?"light_attack":"heavy_attack";const a=k.random();return a<.3?"guard":c&&a<.4?"dodge":"light_attack"}function Ti(c,n,e){const a=(1-e)*.3;return n&&k.chance(.3+a)?"special":c&&k.chance(.6+a)?"heavy_attack":"light_attack"}function Ri(c,n,e,a){const i=c.player,t=c.enemy;return i.consecutiveGuards>=2&&e?"special":i.lastAction==="heavy_attack"&&a?"dodge":t.currentFocus>=50&&e?"special":(i.currentStamina<20,n?"heavy_attack":"light_attack")}function Ii(c){return c.activeEffects.has("cripple")?"legs":c.activeEffects.has("concuss")?"head":c.guardStance?nt(c.guardStance):k.pick(["head","body","legs"])}function nt(c){const e=["head","body","legs"].filter(a=>a!==c);return k.pick(e)}function Pi(c){const n=it.find(e=>e.id===c.signatureTrait.id);return n!=null&&n.taunts?k.pick(n.taunts):"You'll fall like the rest."}const I={scene:null,combatState:null,isResolvingAction:!1,actionQueue:[],resolutionStartTime:0,onActionComplete:null,onInputStateChange:null,debugMode:!1},_i=3e3;let ne=null;function Ai(c,n,e){I.scene=c,I.combatState=n,I.isResolvingAction=!1,I.actionQueue=[],I.resolutionStartTime=0,I.onInputStateChange=e,I.debugMode=p.getSettings().debugMode||!1,ne&&clearInterval(ne),ne=window.setInterval($i,1e3),Ie("Combat controller initialized")}function Bi(){ne&&(clearInterval(ne),ne=null),I.scene=null,I.combatState=null,I.isResolvingAction=!1,I.actionQueue=[]}function Ei(c){I.combatState=c}function Fi(){return I.combatState?I.isResolvingAction?{canAct:!1,reason:"Action in progress"}:I.combatState.turn!=="player"?{canAct:!1,reason:"Not player turn"}:I.combatState.phase==="end"?{canAct:!1,reason:"Combat ended"}:{canAct:!0,reason:"OK"}:{canAct:!1,reason:"No combat state"}}function Di(c){if(!I.combatState)return!1;const n={light_attack:10,heavy_attack:25,guard:5,dodge:15,special:20,item:0};return I.combatState.player.currentStamina>=n[c]}function Oi(c,n="body"){const e=Fi();return Ie(`playerChooseAction: ${c}, canAct=${e.canAct}, reason=${e.reason}`),e.canAct?Di(c)?c==="special"&&I.combatState.player.currentFocus<30?{success:!1,reason:"Not enough focus"}:(Gi(),{success:!0,reason:"Action started"}):{success:!1,reason:"Not enough stamina"}:{success:!1,reason:e.reason}}function Gi(){I.isResolvingAction=!0,I.resolutionStartTime=Date.now(),I.onInputStateChange&&I.onInputStateChange(!1),Ie("Action resolution started")}function Hi(){I.isResolvingAction=!1,I.resolutionStartTime=0,Ie("Action resolution ended"),I.combatState&&I.combatState.turn==="player"&&I.combatState.phase!=="end"&&!I.combatState.winner&&I.onInputStateChange&&I.onInputStateChange(!0)}function Li(){console.error("[CombatController] FORCE ending resolution (softlock detected)"),I.isResolvingAction=!1,I.resolutionStartTime=0,I.combatState&&I.combatState.phase!=="end"&&qe(I.combatState),I.onInputStateChange&&I.onInputStateChange(!0)}function $i(){if(!I.isResolvingAction)return;const c=Date.now()-I.resolutionStartTime;c>_i&&(console.error(`[CombatController] Softlock detected! Resolution stuck for ${c}ms`),Li())}function Ie(c){I.debugMode&&console.log(`[CombatController] ${c}`)}class xt extends w.GameObjects.Container{constructor(e,a){super(e,a.x,a.y);m(this,"config");m(this,"currentPose","idle");m(this,"torso");m(this,"head");m(this,"armFront");m(this,"armBack");m(this,"legFront");m(this,"legBack");m(this,"weapon");m(this,"shield");m(this,"idleTween");m(this,"baseY");m(this,"skinColor");m(this,"armorColor");m(this,"weaponColor",8421504);this.config=a,this.baseY=a.y;const i=a.fighter.portrait.skinTone;this.skinColor=w.Display.Color.HexStringToColor(i).color;const t=[4864554,5917242,3816010,9127187,3100495];this.armorColor=t[Math.floor(Math.random()*t.length)],this.createBodyParts(),this.setScale(a.scale),a.flipX&&this.setScale(-a.scale,a.scale),e.add.existing(this),this.startIdleAnimation()}createBodyParts(){this.legBack=this.scene.add.graphics(),this.legBack.fillStyle(this.armorColor,1),this.legBack.fillRoundedRect(-8*1,0,16*1,45*1,4),this.legBack.setPosition(-10*1,30*1),this.add(this.legBack),this.armBack=this.scene.add.graphics(),this.armBack.fillStyle(this.skinColor,1),this.armBack.fillRoundedRect(-6*1,0,12*1,35*1,3),this.armBack.setPosition(-18*1,-20*1),this.add(this.armBack),this.torso=this.scene.add.graphics(),this.torso.fillStyle(this.armorColor,1),this.torso.fillRoundedRect(-20*1,-30*1,40*1,60*1,6),this.torso.lineStyle(2,3811866,.5),this.torso.strokeRoundedRect(-18*1,-28*1,36*1,30*1,4),this.torso.fillStyle(3811866,1),this.torso.fillRect(-22*1,20*1,44*1,8*1),this.add(this.torso),this.legFront=this.scene.add.graphics(),this.legFront.fillStyle(this.armorColor,1),this.legFront.fillRoundedRect(-8*1,0,16*1,45*1,4),this.legFront.fillStyle(5917242,1),this.legFront.fillEllipse(0,15*1,10*1,8*1),this.legFront.setPosition(10*1,30*1),this.add(this.legFront),this.head=this.scene.add.graphics(),this.head.fillStyle(this.skinColor,1),this.head.fillRect(-8*1,15*1,16*1,15*1),this.head.fillStyle(this.skinColor,1),this.head.fillEllipse(0,0,28*1,32*1),this.head.fillStyle(16777215,1),this.head.fillEllipse(-7*1,-3*1,6*1,4*1),this.head.fillEllipse(7*1,-3*1,6*1,4*1),this.head.fillStyle(2759184,1),this.head.fillCircle(-6*1,-3*1,2*1),this.head.fillCircle(8*1,-3*1,2*1),this.head.lineStyle(1,9132604,.5),this.head.lineBetween(0,-2*1,0,5*1),this.head.lineStyle(2,5913130,.8),this.head.lineBetween(-5*1,10*1,5*1,10*1),this.head.setPosition(0,-55*1),this.add(this.head),this.weapon=this.scene.add.graphics(),this.weapon.fillStyle(3811866,1),this.weapon.fillRect(-3,0,6,15),this.weapon.fillStyle(this.weaponColor,1),this.weapon.fillRect(-10,-3,20,6),this.weapon.fillStyle(12632256,1),this.weapon.beginPath(),this.weapon.moveTo(-4,-3),this.weapon.lineTo(4,-3),this.weapon.lineTo(2,-55),this.weapon.lineTo(0,-60),this.weapon.lineTo(-2,-55),this.weapon.closePath(),this.weapon.fillPath(),this.weapon.lineStyle(1,16777215,.5),this.weapon.lineBetween(0,-5,0,-55),this.weapon.setPosition(25*1,-15*1),this.weapon.setRotation(-.3),this.add(this.weapon),this.armFront=this.scene.add.graphics(),this.armFront.fillStyle(this.skinColor,1),this.armFront.fillRoundedRect(-6*1,0,12*1,35*1,3),this.armFront.fillStyle(4864554,1),this.armFront.fillRect(-7*1,20*1,14*1,12*1),this.armFront.setPosition(18*1,-20*1),this.add(this.armFront);const a=this.scene.add.graphics();a.fillStyle(0,.3),a.fillEllipse(0,80*1,50*1,15*1),this.add(a),this.sendToBack(a)}startIdleAnimation(){this.stopCurrentAnimation(),this.currentPose="idle",this.idleTween=this.scene.tweens.add({targets:this,y:this.baseY-3,duration:1500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.scene.tweens.add({targets:this.armFront,rotation:-.05,duration:2e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.scene.tweens.add({targets:this.weapon,rotation:-.35,duration:2e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}stopCurrentAnimation(){var e;(e=this.idleTween)==null||e.stop(),this.scene.tweens.killTweensOf(this.armFront),this.scene.tweens.killTweensOf(this.weapon),this.scene.tweens.killTweensOf(this.head),this.scene.tweens.killTweensOf(this)}async playLightAttack(e){this.stopCurrentAnimation(),this.currentPose="attack_light";const a=this.config.flipX?-1:1,i=this.x;return new Promise(t=>{this.scene.tweens.add({targets:this,x:i+40*a,duration:150,ease:"Quad.out",onComplete:()=>{this.scene.tweens.add({targets:this.weapon,rotation:1.5*a,duration:100,ease:"Quad.out",onComplete:()=>{e(),this.scene.tweens.add({targets:this.weapon,rotation:-.3,duration:200,ease:"Quad.out"}),this.scene.tweens.add({targets:this,x:i,duration:200,ease:"Quad.in",onComplete:()=>{this.startIdleAnimation(),t()}})}})}}),this.scene.tweens.add({targets:this.armFront,rotation:.8,duration:250,yoyo:!0,ease:"Quad.inOut"})})}async playHeavyAttack(e){this.stopCurrentAnimation(),this.currentPose="attack_heavy";const a=this.config.flipX?-1:1,i=this.x;return new Promise(t=>{this.scene.tweens.add({targets:this.weapon,rotation:-2,duration:300,ease:"Quad.out",onComplete:()=>{this.scene.tweens.add({targets:this,x:i+60*a,duration:150,ease:"Quad.out"}),this.scene.tweens.add({targets:this.weapon,rotation:2.5*a,duration:150,ease:"Quad.in",onComplete:()=>{p.getSettings().screenShake&&this.scene.cameras.main.shake(100,.01),e(),this.scene.tweens.add({targets:this.weapon,rotation:-.3,duration:400,ease:"Quad.out"}),this.scene.tweens.add({targets:this,x:i,duration:350,ease:"Quad.in",onComplete:()=>{this.startIdleAnimation(),t()}})}})}}),this.scene.tweens.add({targets:this.torso,rotation:.2*a,duration:500,yoyo:!0,ease:"Quad.inOut"})})}async playBlock(){return this.stopCurrentAnimation(),this.currentPose="block",new Promise(e=>{this.scene.tweens.add({targets:this.weapon,rotation:-1.5,y:this.weapon.y-20,duration:150,ease:"Quad.out"}),this.scene.tweens.add({targets:this,y:this.baseY+10,duration:150,ease:"Quad.out",onComplete:()=>{this.scene.time.delayedCall(500,()=>{this.scene.tweens.add({targets:this.weapon,rotation:-.3,y:this.weapon.y+20,duration:200,ease:"Quad.out"}),this.scene.tweens.add({targets:this,y:this.baseY,duration:200,ease:"Quad.out",onComplete:()=>{this.startIdleAnimation(),e()}})})}})})}async playDodge(){this.stopCurrentAnimation(),this.currentPose="dodge";const e=this.config.flipX?1:-1,a=this.x;return new Promise(i=>{this.scene.tweens.add({targets:this,x:a+50*e,y:this.baseY-15,duration:150,ease:"Quad.out",onComplete:()=>{this.scene.tweens.add({targets:this,x:a,y:this.baseY,duration:200,ease:"Quad.in",onComplete:()=>{this.startIdleAnimation(),i()}})}}),this.scene.tweens.add({targets:this.torso,rotation:.3*e,duration:200,yoyo:!0,ease:"Quad.out"})})}async playHit(e){this.stopCurrentAnimation(),this.currentPose="hit";const a=this.config.flipX?1:-1,i=this.x,t=Math.min(e/30,1);return new Promise(s=>{this.scene.tweens.add({targets:this,x:i+25*a*t,duration:100,ease:"Quad.out",onComplete:()=>{this.scene.tweens.add({targets:this,x:i,duration:300,ease:"Quad.out",onComplete:()=>{this.startIdleAnimation(),s()}})}}),this.scene.tweens.add({targets:this.head,rotation:.2*a,duration:100,yoyo:!0,ease:"Quad.out"}),this.scene.tweens.add({targets:this.torso,alpha:.5,duration:50,yoyo:!0,repeat:2})})}async playStagger(){this.stopCurrentAnimation(),this.currentPose="stagger";const e=this.config.flipX?1:-1,a=this.x;return new Promise(i=>{this.scene.tweens.add({targets:this,x:a+50*e,y:this.baseY+20,duration:200,ease:"Quad.out"}),this.scene.tweens.add({targets:this.torso,rotation:.4*e,duration:200,ease:"Quad.out",onComplete:()=>{this.scene.tweens.add({targets:this,x:a,y:this.baseY,duration:500,ease:"Quad.out"}),this.scene.tweens.add({targets:this.torso,rotation:0,duration:500,ease:"Quad.out",onComplete:()=>{this.startIdleAnimation(),i()}})}}),this.scene.tweens.add({targets:this.weapon,rotation:1,duration:300,yoyo:!0,ease:"Quad.out"})})}async playVictory(){return this.stopCurrentAnimation(),this.currentPose="victory",new Promise(e=>{this.scene.tweens.add({targets:this.weapon,rotation:-2,y:this.weapon.y-30,duration:500,ease:"Back.out"}),this.scene.tweens.add({targets:this,y:this.baseY-15,duration:500,ease:"Back.out",onComplete:()=>e()}),this.scene.tweens.add({targets:this.armFront,rotation:-1.2,duration:500,ease:"Back.out"})})}async playDefeat(){return this.stopCurrentAnimation(),this.currentPose="defeat",new Promise(e=>{this.scene.tweens.add({targets:this,y:this.baseY+60,duration:800,ease:"Bounce.out"}),this.scene.tweens.add({targets:this.torso,rotation:1.2,duration:600,ease:"Quad.out"}),this.scene.tweens.add({targets:this.head,rotation:.8,y:this.head.y+30,duration:700,ease:"Quad.out"}),this.scene.tweens.add({targets:this.weapon,rotation:2,x:this.weapon.x+40,y:this.weapon.y+80,duration:500,ease:"Quad.out",onComplete:()=>e()})})}setGuardStance(e){e?this.scene.tweens.add({targets:this.weapon,rotation:-1.2,duration:200,ease:"Quad.out"}):this.scene.tweens.add({targets:this.weapon,rotation:-.3,duration:200,ease:"Quad.out"})}getPose(){return this.currentPose}}class Ni{constructor(n){m(this,"scene");this.scene=n}showDamageNumber(n,e,a,i=!1){if(!p.getSettings().showDamageNumbers)return;const s=i?"#ff4444":"#ffffff",r=i?"28px":"22px",o=this.scene.add.text(n,e,`-${a}`,{fontFamily:"Georgia, serif",fontSize:r,color:s,stroke:"#000000",strokeThickness:3}).setOrigin(.5).setDepth(100);i&&this.createSparkle(n,e,16776960),this.scene.tweens.add({targets:o,y:e-60,alpha:0,duration:1e3,ease:"Quad.out",onComplete:()=>o.destroy()})}showHealNumber(n,e,a){if(!p.getSettings().showDamageNumbers)return;const t=this.scene.add.text(n,e,`+${a}`,{fontFamily:"Georgia, serif",fontSize:"20px",color:"#44ff44",stroke:"#000000",strokeThickness:2}).setOrigin(.5).setDepth(100);this.scene.tweens.add({targets:t,y:e-50,alpha:0,duration:800,ease:"Quad.out",onComplete:()=>t.destroy()})}createSparks(n,e){for(let a=0;a<8;a++){const i=this.scene.add.graphics();i.fillStyle(16763904,1),i.fillCircle(0,0,3),i.setPosition(n,e),i.setDepth(90);const t=Math.PI*2/8*a+Math.random()*.5,s=30+Math.random()*30;this.scene.tweens.add({targets:i,x:n+Math.cos(t)*s,y:e+Math.sin(t)*s,alpha:0,duration:300,ease:"Quad.out",onComplete:()=>i.destroy()})}}createBlood(n,e){if(p.getSettings().bloodFX)for(let i=0;i<5;i++){const t=this.scene.add.graphics();t.fillStyle(9109504,1),t.fillCircle(0,0,2+Math.random()*3),t.setPosition(n,e),t.setDepth(85);const s=Math.random()*Math.PI-Math.PI/2,r=20+Math.random()*40;this.scene.tweens.add({targets:t,x:n+Math.cos(s)*r,y:e+Math.sin(s)*r+30,alpha:.3,duration:500,ease:"Quad.out",onComplete:()=>t.destroy()})}}createSparkle(n,e,a=16777215){for(let i=0;i<6;i++){const t=this.scene.add.graphics();t.fillStyle(a,1),t.beginPath(),t.moveTo(0,-6),t.lineTo(2,-2),t.lineTo(6,0),t.lineTo(2,2),t.lineTo(0,6),t.lineTo(-2,2),t.lineTo(-6,0),t.lineTo(-2,-2),t.closePath(),t.fillPath(),t.setPosition(n,e),t.setDepth(95);const s=Math.PI*2/6*i,r=25+Math.random()*15;this.scene.tweens.add({targets:t,x:n+Math.cos(s)*r,y:e+Math.sin(s)*r,rotation:Math.PI,alpha:0,scale:.3,duration:400,ease:"Quad.out",onComplete:()=>t.destroy()})}}showStatusEffect(n,e,a){const t={bleed:"ðŸ©¸",stun:"ðŸ’«",block:"ðŸ›¡ï¸",dodge:"ðŸ’¨",crit:"âš¡",miss:"âŒ"}[a]||"â“",s=this.scene.add.text(n,e-30,t,{fontSize:"24px"}).setOrigin(.5).setDepth(100);this.scene.tweens.add({targets:s,y:e-70,alpha:0,duration:1e3,ease:"Quad.out",onComplete:()=>s.destroy()})}screenFlash(n=16777215,e=.3){const{width:a,height:i}=this.scene.cameras.main,t=this.scene.add.rectangle(a/2,i/2,a,i,n,e).setDepth(200);this.scene.tweens.add({targets:t,alpha:0,duration:200,onComplete:()=>t.destroy()})}createWeaponTrail(n,e,a,i){const t=this.scene.add.graphics();t.lineStyle(4,16777215,.6),t.beginPath(),t.moveTo(n,e);const s=(n+a)/2+(Math.random()-.5)*30,r=(e+i)/2-20,o=10;for(let d=1;d<=o;d++){const l=d/o,h=l*l,u=1-l,f=u*u,g=f*n+2*u*l*s+h*a,y=f*e+2*u*l*r+h*i;t.lineTo(g,y)}t.strokePath(),t.setDepth(80),this.scene.tweens.add({targets:t,alpha:0,duration:200,onComplete:()=>t.destroy()})}showStatusPopup(n,e,a,i="#ff4444"){const t=this.scene.add.container(n,e-40);t.setDepth(150);const s=this.scene.add.graphics(),r=a.length*8+20;s.fillStyle(0,.8),s.fillRoundedRect(-r/2,-12,r,24,12),t.add(s);const o=this.scene.add.text(0,0,a,{fontFamily:"Georgia, serif",fontSize:"12px",color:i,stroke:"#000000",strokeThickness:1}).setOrigin(.5);t.add(o),t.setScale(0),this.scene.tweens.add({targets:t,scale:1,duration:150,ease:"Back.easeOut"}),this.scene.tweens.add({targets:t,y:e-80,alpha:0,duration:1200,delay:400,ease:"Quad.out",onComplete:()=>t.destroy()})}createDust(n,e){for(let a=0;a<6;a++){const i=this.scene.add.graphics();i.fillStyle(9139029,.6),i.fillCircle(0,0,4+Math.random()*4),i.setPosition(n,e),i.setDepth(70);const t=Math.PI+(Math.random()-.5)*1.2,s=20+Math.random()*30;this.scene.tweens.add({targets:i,x:n+Math.cos(t)*s,y:e+Math.sin(t)*s+10,alpha:0,scale:.5,duration:400,ease:"Quad.out",onComplete:()=>i.destroy()})}}showCombo(n,e,a){if(a<2)return;const i=this.scene.add.text(n,e,`${a}x COMBO!`,{fontFamily:"Georgia, serif",fontSize:"16px",color:"#ffd700",stroke:"#000000",strokeThickness:2}).setOrigin(.5).setDepth(110);i.setScale(0),this.scene.tweens.add({targets:i,scale:1.2,duration:150,yoyo:!0,hold:300,onComplete:()=>{this.scene.tweens.add({targets:i,alpha:0,y:e-30,duration:300,onComplete:()=>i.destroy()})}})}shakeCamera(n=.005,e=100){p.getSettings().screenShake&&this.scene.cameras.main.shake(e,n)}hitStop(n=60){return p.getSettings().reduceMotion?Promise.resolve():new Promise(a=>{this.scene.time.delayedCall(n,a)})}}class Wi extends w.Scene{constructor(){super({key:"FightScene"});m(this,"combatState");m(this,"player");m(this,"enemy");m(this,"selectedAction",null);m(this,"selectedZone","body");m(this,"playerSprite");m(this,"enemySprite");m(this,"vfx");m(this,"playerHealthBar");m(this,"enemyHealthBar");m(this,"playerStaminaBar");m(this,"playerFocusBar");m(this,"combatLog");m(this,"roundText");m(this,"hypeBar");m(this,"actionButtonsContainer");m(this,"zoneButtons",[]);m(this,"isInputEnabled",!0)}create(){const e=p.getRun();if(!e.fighter){this.scene.start("MainMenuScene");return}this.player=e.fighter,this.enemy=pi(e.league,e.week),this.combatState=ai(this.player,this.enemy),console.log(`[Combat] Initialized: player speed=${this.player.currentStats.speed}, enemy speed=${this.enemy.currentStats.speed}`),console.log(`[Combat] First turn: ${this.combatState.turn}`),this.vfx=new Ni(this),this.isInputEnabled=!0,Ai(this,this.combatState,i=>{i?this.enableInput():this.disableInput()}),this.createBackground(),this.createFighters(),this.createCombatUI(),this.createActionPanel();const a=Pi(this.enemy);this.showCombatMessage(a),this.cameras.main.fadeIn(300),this.combatState.turn==="enemy"?(this.showCombatMessage("Enemy strikes first!"),this.disableInput(),this.time.delayedCall(1500,()=>{this.performEnemyTurn()})):this.showTurnIndicator("YOUR TURN")}showTurnIndicator(e){const{width:a,height:i}=this.cameras.main,t=this.add.text(a/2,i*.35,e,{fontFamily:"Georgia, serif",fontSize:"24px",color:e.includes("YOUR")?"#6b8e23":"#cd5c5c",stroke:"#000000",strokeThickness:3}).setOrigin(.5).setAlpha(0);this.tweens.add({targets:t,alpha:1,y:i*.32,duration:300,ease:"Back.easeOut",onComplete:()=>{this.time.delayedCall(800,()=>{this.tweens.add({targets:t,alpha:0,y:i*.28,duration:200,onComplete:()=>t.destroy()})})}})}createBackground(){const{width:e,height:a}=this.cameras.main,i=this.add.graphics();i.fillGradientStyle(3811866,3811866,2760469,2760469),i.fillRect(0,0,e,a),i.fillStyle(4864544,1),i.fillRect(0,a*.55,e,a*.45),i.lineStyle(1,3811861,.3);for(let s=0;s<8;s++){const r=a*.55+s*25;i.moveTo(0,r+Math.random()*10),i.lineTo(e,r+Math.random()*10)}i.strokePath(),i.fillStyle(2759184,.6),i.fillRect(0,a*.2,e,a*.15);for(let s=0;s<15;s++){const r=s/14*e,o=a*.25+Math.random()*20;i.fillStyle(1708560,.8),i.fillCircle(r,o,8+Math.random()*5),i.fillRect(r-5,o,10,15)}const t=this.add.graphics();t.fillStyle(0,.4),t.fillRect(0,0,e,a*.08),t.fillRect(0,a*.92,e,a*.08)}createFighters(){const{width:e,height:a}=this.cameras.main;this.playerSprite=new xt(this,{fighter:this.player,x:e*.25,y:a*.48,scale:.9,flipX:!1}),this.enemySprite=new xt(this,{fighter:this.enemy,x:e*.75,y:a*.48,scale:.9,flipX:!0})}createCombatUI(){const{width:e,height:a}=this.cameras.main,i=E();this.roundText=this.add.text(e/2,i.top+15,`ROUND ${this.combatState.round}`,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#c9a959"}).setOrigin(.5);const t=i.left,s=i.top+40,r=Math.min(140,e*.35),o=18;this.playerHealthBar=this.createHealthBar(t,s,r,o,!0),this.add.text(t,s-15,this.player.firstName,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#c9a959"}),this.playerStaminaBar=this.createResourceBar(t,s+22,r*.8,10,4620980),this.add.text(t,s+20,"STA",{fontFamily:"Georgia, serif",fontSize:"8px",color:"#8b7355"}),this.playerFocusBar=this.createResourceBar(t,s+36,r*.6,8,10040012),this.add.text(t,s+35,"FOC",{fontFamily:"Georgia, serif",fontSize:"8px",color:"#8b7355"});const d=Math.min(140,e*.35),l=e-i.right-d,h=i.top+40;this.enemyHealthBar=this.createHealthBar(l,h,d,o,!1),this.add.text(l+d,h-15,this.enemy.firstName,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b4513"}).setOrigin(1,0);const u=this.enemy;if(u.mutatorIds&&u.mutatorIds.length>0){const g=u.mutatorIds.map(S=>{const b=ve(S);return(b==null?void 0:b.icon)||"â“"}).join(" ");this.add.text(l+d,h+5,g,{fontSize:"14px"}).setOrigin(1,0);const y=ve(u.mutatorIds[0]);y&&this.add.text(l+d,h+22,y.shortWarning,{fontFamily:"Georgia, serif",fontSize:"8px",color:"#cd5c5c"}).setOrigin(1,0)}else this.add.text(l+d,h+5,`"${this.enemy.nickname}"`,{fontFamily:"Georgia, serif",fontSize:"9px",color:"#5a4a3a",fontStyle:"italic"}).setOrigin(1,0);const f=120;this.hypeBar=this.createResourceBar(e/2-f/2,i.top+35,f,10,16766720),this.add.text(e/2,i.top+33,"CROWD",{fontFamily:"Georgia, serif",fontSize:"8px",color:"#8b7355"}).setOrigin(.5,0),this.combatLog=this.add.text(e/2,a*.38,"",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#c9a959",wordWrap:{width:e-40},align:"center",stroke:"#000000",strokeThickness:2}).setOrigin(.5).setDepth(50),this.updateAllBars()}createHealthBar(e,a,i,t,s){const r=this.add.graphics();r.fillStyle(2760474,1),r.fillRoundedRect(e,a,i,t,4),r.lineStyle(1,5917242,1),r.strokeRoundedRect(e,a,i,t,4);const o=this.add.graphics();return{bg:r,fill:o,x:e,y:a,w:i,h:t}}createResourceBar(e,a,i,t,s){const r=this.add.graphics();r.fillStyle(2760474,1),r.fillRoundedRect(e,a,i,t,3);const o=this.add.graphics();return o.fillStyle(s,1),o.fillRoundedRect(e+1,a+1,i-2,t-2,2),{fill:o,x:e,y:a,w:i,h:t}}updateHealthBar(e,a,i){const t=Math.max(0,a/i),s=t>.5?2263842:t>.25?14329120:9109504;e.fill.clear(),e.fill.fillStyle(s,1),e.fill.fillRoundedRect(e.x+2,e.y+2,(e.w-4)*t,e.h-4,3)}updateResourceBar(e,a,i){e.fill.clear(),e.fill.fillStyle(i,1),e.fill.fillRoundedRect(e.x+1,e.y+1,(e.w-2)*Math.max(0,a),e.h-2,2)}updateAllBars(){this.updateHealthBar(this.playerHealthBar,this.combatState.player.currentHP,this.player.currentStats.maxHP),this.updateHealthBar(this.enemyHealthBar,this.combatState.enemy.currentHP,this.enemy.currentStats.maxHP),this.updateResourceBar(this.playerStaminaBar,this.combatState.player.currentStamina/this.player.currentStats.maxStamina,4620980),this.updateResourceBar(this.playerFocusBar,this.combatState.player.currentFocus/this.player.currentStats.maxFocus,10040012),this.updateResourceBar(this.hypeBar,this.combatState.crowdHype/100,16766720)}createActionPanel(){const{width:e,height:a}=this.cameras.main,i=ye(this);E();const t=a*.62,s=["head","body","legs"],r={head:"ðŸŽ¯ HEAD",body:"ðŸŽ¯ BODY",legs:"ðŸŽ¯ LEGS"},o=Math.min(85,(i.width-20)/3);s.forEach((S,b)=>{const M=e/2+(b-1)*(o+8),C=this.createZoneButton(M,t,o,36,r[S],S);this.zoneButtons.push(C)}),this.highlightZone("body"),this.actionButtonsContainer=this.add.container(0,0);const d=[{action:"light_attack",label:"LIGHT",stamina:10,icon:"âš”ï¸"},{action:"heavy_attack",label:"HEAVY",stamina:25,icon:"ðŸ’¥"},{action:"guard",label:"GUARD",stamina:5,icon:"ðŸ›¡ï¸"},{action:"dodge",label:"DODGE",stamina:15,icon:"ðŸ’¨"},{action:"special",label:"SPECIAL",stamina:20,icon:"âœ¨"},{action:"item",label:"ITEM",stamina:0,icon:"ðŸ§ª"}],l=3,h=Math.min(100,(i.width-20)/l),u=Math.max(V,48),f=h+8,g=u+8,y=a*.72;d.forEach((S,b)=>{const M=b%l,C=Math.floor(b/l),x=e/2+(M-1)*f,R=y+C*g;this.createActionButton(x,R,h,u,S.icon,S.label,S.action,S.stamina)})}createZoneButton(e,a,i,t,s,r){const o=this.add.container(e,a),d=this.add.graphics();d.fillStyle(2760474,.9),d.fillRoundedRect(-i/2,-t/2,i,t,5),d.lineStyle(2,5917242,1),d.strokeRoundedRect(-i/2,-t/2,i,t,5),o.add(d);const l=this.add.text(0,0,s,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355"}).setOrigin(.5);return o.add(l),o.setData("zone",r),o.setData("bg",d),o.setData("text",l),o.setSize(i,t),o.setInteractive(new w.Geom.Rectangle(-i/2,-t/2,i,t),w.Geom.Rectangle.Contains),o.on("pointerdown",()=>{this.isInputEnabled&&(this.selectedZone=r,this.highlightZone(r))}),o}highlightZone(e){this.zoneButtons.forEach(a=>{const i=a.getData("zone"),t=a.getData("bg"),s=a.getData("text"),r=i===e,o=a.width,d=a.height;t.clear(),t.fillStyle(r?3811882:2760474,.9),t.fillRoundedRect(-o/2,-d/2,o,d,5),t.lineStyle(2,r?13216089:5917242,1),t.strokeRoundedRect(-o/2,-d/2,o,d,5),s.setColor(r?"#c9a959":"#8b7355")})}createActionButton(e,a,i,t,s,r,o,d){const l=this.add.container(e,a);this.actionButtonsContainer.add(l);const h=this.add.graphics();h.fillStyle(2760474,.95),h.fillRoundedRect(-i/2,-t/2,i,t,6),h.lineStyle(2,5917242,1),h.strokeRoundedRect(-i/2,-t/2,i,t,6),l.add(h);const u=this.add.text(-i/2+10,0,s,{fontSize:"16px"}).setOrigin(0,.5);l.add(u);const f=this.add.text(-i/2+32,-5,r,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#c9a959"});l.add(f);const g=this.add.text(-i/2+32,8,`${d} sta`,{fontFamily:"Georgia, serif",fontSize:"9px",color:"#8b7355"});l.add(g),l.setSize(i,t),l.setInteractive(new w.Geom.Rectangle(-i/2,-t/2,i,t),w.Geom.Rectangle.Contains),l.on("pointerover",()=>{this.isInputEnabled&&(h.clear(),h.fillStyle(3813162,.95),h.fillRoundedRect(-i/2,-t/2,i,t,6),h.lineStyle(2,13216089,1),h.strokeRoundedRect(-i/2,-t/2,i,t,6))}),l.on("pointerout",()=>{h.clear(),h.fillStyle(2760474,.95),h.fillRoundedRect(-i/2,-t/2,i,t,6),h.lineStyle(2,5917242,1),h.strokeRoundedRect(-i/2,-t/2,i,t,6)}),l.on("pointerdown",()=>{var y;if(console.log(`[Combat] Button pressed: ${o}, inputEnabled=${this.isInputEnabled}, turn=${(y=this.combatState)==null?void 0:y.turn}`),!this.isInputEnabled){console.log("[Combat] Input disabled, ignoring");return}this.performAction(o)})}async performAction(e){console.log(`[Combat] performAction: ${e}, turn=${this.combatState.turn}, phase=${this.combatState.phase}, inputEnabled=${this.isInputEnabled}`);const a=Oi(e,this.selectedZone);if(!a.success){console.log(`[Combat] Blocked: ${a.reason}`),this.showCombatMessage(a.reason);return}console.log("[Combat] Starting action:",e);try{await this.animatePlayerAction(e);const i=wt(this.combatState,"player",e,this.selectedZone);if(console.log("[Combat] Action result:",i),Ei(this.combatState),this.showCombatMessage(i.message),i.damage>0){const{width:t,height:s}=this.cameras.main;this.vfx.showDamageNumber(t*.75,s*.4,i.damage,i.critical||!1),this.vfx.createSparks(t*.75,s*.45),i.damage>20?await this.enemySprite.playStagger():await this.enemySprite.playHit(i.damage)}else if(e==="guard"||e==="dodge"){const{width:t,height:s}=this.cameras.main;this.vfx.showStatusEffect(t*.25,s*.35,e==="guard"?"block":"dodge")}if(this.updateAllBars(),this.combatState.winner){await this.endCombat();return}await this.delay(800),await this.performEnemyTurn()}catch(i){console.error("[Combat] Error during action:",i),this.showCombatMessage("Action failed!")}finally{Hi()}}async animatePlayerAction(e){switch(e){case"light_attack":await this.playerSprite.playLightAttack(()=>{const{width:a,height:i}=this.cameras.main;this.vfx.createWeaponTrail(a*.35,i*.4,a*.65,i*.45)});break;case"heavy_attack":await this.playerSprite.playHeavyAttack(()=>{const{width:a,height:i}=this.cameras.main;this.vfx.createWeaponTrail(a*.3,i*.3,a*.7,i*.5),this.vfx.screenFlash(16777215,.2)});break;case"guard":this.playerSprite.setGuardStance(!0),await this.playerSprite.playBlock();break;case"dodge":await this.playerSprite.playDodge();break;case"special":this.vfx.screenFlash(16766720,.3),await this.playerSprite.playHeavyAttack(()=>{const{width:a,height:i}=this.cameras.main;this.vfx.createSparkle(a*.75,i*.4,16766720)});break;default:await this.delay(300)}}async performEnemyTurn(){if(this.combatState.winner)return;qe(this.combatState),this.roundText.setText(`ROUND ${this.combatState.round}`);const e=this.enemy.signatureTrait.id||"balanced",{action:a,targetZone:i}=vi(this.combatState,e),t={light_attack:"âš”ï¸",heavy_attack:"ðŸ’¥",guard:"ðŸ›¡ï¸",dodge:"ðŸ’¨",special:"âœ¨",item:"ðŸ§ª"};this.showCombatMessage(`Enemy prepares: ${t[a]}`),await this.delay(500),await this.animateEnemyAction(a);const s=wt(this.combatState,"enemy",a,i);if(this.showCombatMessage(s.message),s.damage>0){const{width:r,height:o}=this.cameras.main;this.vfx.showDamageNumber(r*.25,o*.4,s.damage,s.critical||!1),this.vfx.createSparks(r*.25,o*.45),p.getSettings().bloodFX&&s.damage>15&&this.vfx.createBlood(r*.25,o*.45),s.damage>20?(this.shakeScreen(),await this.playerSprite.playStagger()):await this.playerSprite.playHit(s.damage)}if(this.updateAllBars(),this.combatState.winner){await this.endCombat();return}await this.delay(500),qe(this.combatState),this.showTurnIndicator("YOUR TURN"),this.enableInput(),console.log("[Combat] Player turn started, input enabled")}async animateEnemyAction(e){switch(e){case"light_attack":await this.enemySprite.playLightAttack(()=>{const{width:a,height:i}=this.cameras.main;this.vfx.createWeaponTrail(a*.65,i*.4,a*.35,i*.45)});break;case"heavy_attack":await this.enemySprite.playHeavyAttack(()=>{const{width:a,height:i}=this.cameras.main;this.vfx.createWeaponTrail(a*.7,i*.3,a*.3,i*.5)});break;case"guard":this.enemySprite.setGuardStance(!0),await this.enemySprite.playBlock();break;case"dodge":await this.enemySprite.playDodge();break;default:await this.delay(300)}}showCombatMessage(e){this.combatLog.setText(e),this.tweens.add({targets:this.combatLog,alpha:{from:1,to:.8},duration:80,yoyo:!0})}shakeScreen(){p.getSettings().screenShake&&this.cameras.main.shake(150,.012)}disableInput(){this.isInputEnabled=!1,this.actionButtonsContainer.setAlpha(.5),this.zoneButtons.forEach(e=>e.setAlpha(.5))}enableInput(){this.isInputEnabled=!0,this.actionButtonsContainer.setAlpha(1),this.zoneButtons.forEach(e=>e.setAlpha(1))}delay(e){return new Promise(a=>this.time.delayedCall(e,a))}async endCombat(){var i;this.disableInput();const e=this.combatState.winner==="player",a=p.getRun();if(e){await this.playerSprite.playVictory(),await this.enemySprite.playDefeat(),this.vfx.screenFlash(16766720,.2),this.player.wins++,this.player.totalDamageDealt+=this.combatState.log.filter(r=>r.actor==="player").reduce((r,o)=>r+o.result.damage,0),this.player.weeksSurvived=a.week+1;const t=di(this.combatState.player);t&&Sa(this.player,t);const s=hi(this.combatState,!0,a.league);p.updateRun({fighter:this.player,gold:a.gold+s.gold,fame:a.fame+s.fame,fightsInLeague:a.fightsInLeague+1,consecutiveWins:a.consecutiveWins+1,fightsSinceRelic:a.fightsSinceRelic+1}),await this.delay(1500),this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("ResultsScene",{won:!0,rewards:s,injury:t,enemy:this.enemy})})}else await this.playerSprite.playDefeat(),await this.enemySprite.playVictory(),this.vfx.screenFlash(9109504,.3),this.player.status="dead",this.player.causeOfDeath=xa({damage:((i=this.combatState.lastAction)==null?void 0:i.damage)||0,location:this.selectedZone,weaponType:"blade"},this.combatState.round,this.enemy.fullName),this.player.lastWords=ka(this.player),this.player.killedBy=this.enemy.fullName,p.updateRun({fighter:this.player,consecutiveWins:0}),p.endRun(!1),this.player.lastWords&&(this.showCombatMessage(`"${this.player.lastWords}"`),await this.delay(2500)),this.cameras.main.fadeOut(500),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("DeathScene")})}shutdown(){Bi()}}class qi extends w.Scene{constructor(){super({key:"ResultsScene"});m(this,"resultsData")}init(e){this.resultsData=e}create(){const{width:e,height:a}=this.cameras.main;if(this.createBackground(),this.createResultsDisplay(),this.createRewardsDisplay(),this.createContinueButton(),this.resultsData.won){const i=p.getRun();i.fighter&&(Te(i.fighter,5),p.updateRun({fighter:i.fighter}))}this.checkLeagueAdvancement(),this.cameras.main.fadeIn(300)}createBackground(){const{width:e,height:a}=this.cameras.main,i=this.add.graphics();i.fillGradientStyle(1709072,1709072,2760474,2760474),i.fillRect(0,0,e,a)}createResultsDisplay(){const{width:e}=this.cameras.main,a=this.resultsData.won?"VICTORY!":"DEFEAT",i=this.resultsData.won?"#c9a959":"#8b0000",t=this.add.text(e/2,80,a,{fontFamily:"Georgia, serif",fontSize:"40px",color:i,stroke:"#000000",strokeThickness:5}).setOrigin(.5);if(t.setScale(0),this.tweens.add({targets:t,scale:1,duration:400,ease:"Back.easeOut"}),this.resultsData.won){const s=this.add.text(e/2,35,"ðŸ‘‘",{fontSize:"32px"}).setOrigin(.5).setAlpha(0);this.tweens.add({targets:s,alpha:1,y:40,duration:300,delay:300,ease:"Back.easeOut"})}else{const s=this.add.text(e/2,35,"ðŸ’€",{fontSize:"32px"}).setOrigin(.5).setAlpha(0);this.tweens.add({targets:s,alpha:1,y:40,duration:300,delay:300})}if(this.resultsData.won){const s=this.add.text(e/2,130,`${this.resultsData.enemy.fullName} has fallen!`,{fontFamily:"Georgia, serif",fontSize:"15px",color:"#8b7355",fontStyle:"italic"}).setOrigin(.5).setAlpha(0);this.tweens.add({targets:s,alpha:1,duration:300,delay:500})}if(this.resultsData.injury){const s=this.add.container(e/2,175),r=this.add.graphics();r.fillStyle(2759184,.8),r.fillRoundedRect(-120,-25,240,50,8),r.lineStyle(2,9127187,1),r.strokeRoundedRect(-120,-25,240,50,8),s.add(r);const o=this.add.text(0,-10,`âš ï¸ ${this.resultsData.injury.name.toUpperCase()}`,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#cd5c5c"}).setOrigin(.5);s.add(o);const d=this.add.text(0,10,this.resultsData.injury.effect,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355",wordWrap:{width:200}}).setOrigin(.5);s.add(d),s.setAlpha(0),this.tweens.add({targets:s,alpha:1,y:170,duration:300,delay:700})}}createRewardsDisplay(){const{width:e}=this.cameras.main,a=230;this.add.text(e/2,a,"â•â•â• REWARDS â•â•â•",{fontFamily:"Georgia, serif",fontSize:"16px",color:"#c9a959"}).setOrigin(.5);const i=this.add.text(e/2-70,a+45,"ðŸ’°",{fontSize:"24px"}).setOrigin(.5).setAlpha(0),t={value:0},s=this.add.text(e/2,a+45,"0 Gold",{fontFamily:"Georgia, serif",fontSize:"22px",color:"#ffd700"}).setOrigin(.5).setAlpha(0),r=this.add.text(e/2-60,a+90,"â­",{fontSize:"20px"}).setOrigin(.5).setAlpha(0),o=this.add.text(e/2,a+90,`+${this.resultsData.rewards.fame} Fame`,{fontFamily:"Georgia, serif",fontSize:"18px",color:"#c0c0c0"}).setOrigin(.5).setAlpha(0),d=this.add.text(e/2-55,a+130,"ðŸ“ˆ",{fontSize:"18px"}).setOrigin(.5).setAlpha(0),l=this.add.text(e/2,a+130,`+${this.resultsData.rewards.xp} XP`,{fontFamily:"Georgia, serif",fontSize:"16px",color:"#8b7355"}).setOrigin(.5).setAlpha(0);this.tweens.add({targets:i,alpha:1,scale:{from:.5,to:1},duration:300,delay:200,ease:"Back.easeOut"}),this.tweens.add({targets:s,alpha:1,duration:200,delay:200}),this.tweens.add({targets:t,value:this.resultsData.rewards.gold,duration:800,delay:200,ease:"Power1",onUpdate:()=>{s.setText(`${Math.floor(t.value)} Gold`)},onComplete:()=>{this.tweens.add({targets:s,scale:1.2,duration:100,yoyo:!0})}}),this.tweens.add({targets:[r,o],alpha:1,y:"-=10",duration:300,delay:600,ease:"Back.easeOut"}),this.tweens.add({targets:[d,l],alpha:1,y:"-=10",duration:300,delay:800,ease:"Back.easeOut"}),this.time.delayedCall(400,()=>{this.createSparkle(e/2-70,a+45)})}createSparkle(e,a){for(let i=0;i<5;i++){const t=this.add.text(e,a,"âœ¨",{fontSize:"12px"}).setOrigin(.5),s=Math.PI*2/5*i,r=20+Math.random()*15;this.tweens.add({targets:t,x:e+Math.cos(s)*r,y:a+Math.sin(s)*r,alpha:0,scale:.5,duration:500,ease:"Power2",onComplete:()=>t.destroy()})}}checkLeagueAdvancement(){const e=p.getRun(),{width:a}=this.cameras.main;if(e.fightsInLeague>=e.fightsToNextLeague){const t={bronze:"silver",silver:"gold",gold:"champion"}[e.league];t&&(this.time.delayedCall(1e3,()=>{const s=this.add.text(a/2,400,`ðŸ† ADVANCED TO ${t.toUpperCase()} LEAGUE!`,{fontFamily:"Georgia, serif",fontSize:"18px",color:"#ffd700",stroke:"#000000",strokeThickness:2}).setOrigin(.5).setAlpha(0);this.tweens.add({targets:s,alpha:1,scale:{from:.5,to:1},duration:500,ease:"Back.out"})}),p.updateRun({league:t,fightsInLeague:0,fightsToNextLeague:t==="champion"?1:3}),p.addBloodlinePoints(5),p.addPromoterXP(25))}}createContinueButton(){const{width:e,height:a}=this.cameras.main;T.createButton(this,e/2,a-80,"CONTINUE",()=>this.continue(),{width:200,height:50,primary:!0})}continue(){this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("CampScene")})}}class Yi extends w.Scene{constructor(){super({key:"DeathScene"});m(this,"fighter");m(this,"legendEntry");m(this,"playerNote","")}create(){const e=p.getRun();if(!e.fighter){this.scene.start("MainMenuScene");return}this.fighter=e.fighter,this.legendEntry=Ca(this.fighter,"dead",e.league,e.promise||"none",!1),this.createBackground(),this.createMemorial(),this.createNoteInput(),this.createButtons(),this.cameras.main.fadeIn(1e3,0,0,0)}createBackground(){const{width:e,height:a}=this.cameras.main,i=this.add.graphics();if(i.fillGradientStyle(657414,657414,1709072,1709072),i.fillRect(0,0,e,a),this.textures.exists("vignette")){const t=this.add.image(e/2,a/2,"vignette");t.setDisplaySize(e,a),t.setAlpha(.8)}}createMemorial(){const{width:e,height:a}=this.cameras.main,i=e/2,t=320,s=500,r=i-t/2,o=40,d=this.add.graphics();d.fillStyle(1709072,.9),d.fillRoundedRect(r,o,t,s,12),d.lineStyle(3,5917242,1),d.strokeRoundedRect(r,o,t,s,12),d.lineStyle(1,3811866,.5),d.strokeRoundedRect(r+8,o+8,t-16,s-16,8),this.add.text(i,o+30,"IN MEMORIAM",{fontFamily:"Georgia, serif",fontSize:"18px",color:"#c9a959",letterSpacing:4}).setOrigin(.5);const l=o+100;ce.renderPortrait(this,this.fighter.portrait,i,l,80),this.add.text(i,l+60,this.fighter.fullName,{fontFamily:"Georgia, serif",fontSize:"16px",color:"#c9a959"}).setOrigin(.5),this.add.text(i,l+82,`${this.fighter.age} winters â€¢ ${this.fighter.birthplace}`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b7355"}).setOrigin(.5),this.fighter.causeOfDeath&&this.add.text(i,l+115,this.fighter.causeOfDeath,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b4513",fontStyle:"italic",wordWrap:{width:280},align:"center"}).setOrigin(.5),this.fighter.lastWords&&this.add.text(i,l+160,`"${this.fighter.lastWords}"`,{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b7355",fontStyle:"italic"}).setOrigin(.5);const h=l+200;this.add.text(i,h,"â”€â”€â”€ LEGACY â”€â”€â”€",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#5a4a3a"}).setOrigin(.5),[`Victories: ${this.fighter.wins}`,`Weeks Survived: ${this.fighter.weeksSurvived}`,`Signature Moves: ${this.fighter.signatureMoveUses}`,`Perfect Parries: ${this.fighter.perfectParries}`,`Closest Call: ${this.fighter.closestCall} HP`].forEach((y,S)=>{this.add.text(i,h+25+S*18,y,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b7355"}).setOrigin(.5)}),p.getRun();const f=h+120;this.add.text(i,f,"âš”ï¸ Promise Broken",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b4513"}).setOrigin(.5),this.add.text(i,f+25,`ðŸ“¿ ${this.fighter.keepsake.name} - Recovered`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#6b8e23"}).setOrigin(.5)}createNoteInput(){const{width:e,height:a}=this.cameras.main;this.add.text(e/2,570,"Leave a note for the fallen:",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b7355"}).setOrigin(.5);const i=this.add.graphics();i.fillStyle(2760474,1),i.fillRoundedRect(e/2-140,585,280,60,6),i.lineStyle(1,5917242,1),i.strokeRoundedRect(e/2-140,585,280,60,6);const t=this.add.text(e/2,615,"Tap to add note...",{fontFamily:"Georgia, serif",fontSize:"11px",color:"#5a4a3a",fontStyle:"italic"}).setOrigin(.5);i.setInteractive(new w.Geom.Rectangle(e/2-140,585,280,60),w.Geom.Rectangle.Contains),i.on("pointerdown",()=>{const s=prompt("Write a note for the fallen:");if(s){this.playerNote=s,this.legendEntry.playerNote=s,t.setText(s.substring(0,40)+(s.length>40?"...":"")),t.setColor("#c9a959"),t.setFontStyle("normal");const r=p.getHallOfLegends(),o=r.find(d=>d.id===this.legendEntry.id);o&&(o.playerNote=s,p.updateMeta({hallOfLegends:r}))}})}createButtons(){const{width:e,height:a}=this.cameras.main;T.createButton(this,e/2,a-60,"RETURN TO MENU",()=>this.returnToMenu(),{width:200,height:50,primary:!0})}returnToMenu(){this.cameras.main.fadeOut(500,0,0,0),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("MainMenuScene")})}}class zi extends w.Scene{constructor(){super({key:"HallOfLegendsScene"});m(this,"legends",[]);m(this,"scrollOffset",0);m(this,"selectedLegend",null);m(this,"detailsContainer")}create(){this.legends=p.getHallOfLegends(),this.createBackground(),this.createHeader(),this.createLegendList(),this.createDetailsPanel(),this.createBackButton(),this.cameras.main.fadeIn(300)}createBackground(){const{width:e,height:a}=this.cameras.main,i=this.add.graphics();if(i.fillGradientStyle(657414,657414,1709072,1709072),i.fillRect(0,0,e,a),this.textures.exists("parchment_overlay")){const t=this.add.image(e/2,a/2,"parchment_overlay");t.setAlpha(.05),t.setDisplaySize(e,a)}}createHeader(){const{width:e}=this.cameras.main;this.add.text(e/2,35,"HALL OF LEGENDS",{fontFamily:"Georgia, serif",fontSize:"24px",color:"#c9a959",stroke:"#000000",strokeThickness:3}).setOrigin(.5),this.add.text(e/2,65,"Those who fought and fell...",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b7355",fontStyle:"italic"}).setOrigin(.5);const a=this.legends.filter(s=>s.status==="dead").length,i=this.legends.filter(s=>s.status==="retired").length,t=this.legends.filter(s=>s.status==="champion").length;this.add.text(e/2,85,`â˜ ï¸ ${a}  |  ðŸ›ï¸ ${i}  |  ðŸ† ${t}`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#5a4a3a"}).setOrigin(.5)}createLegendList(){const{width:e,height:a}=this.cameras.main;if(this.legends.length===0){this.add.text(e/2,200,`No legends yet...

Your fighters will be remembered here.`,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#5a4a3a",align:"center"}).setOrigin(.5);return}const i=110,t=70,s=e-40,r=[...this.legends].sort((o,d)=>d.dateAdded-o.dateAdded);r.slice(0,5).forEach((o,d)=>{this.createLegendCard(o,20,i+d*(t+10),s,t)}),r.length>5&&this.add.text(e/2,i+5*(t+10)+10,`...and ${r.length-5} more`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#5a4a3a"}).setOrigin(.5)}createLegendCard(e,a,i,t,s){var M;const r=this.add.container(a,i),o=this.add.graphics(),d=e.status==="champion"?2763280:e.status==="retired"?1714714:2759194;o.fillStyle(d,1),o.fillRoundedRect(0,0,t,s,8),o.lineStyle(1,5917242,1),o.strokeRoundedRect(0,0,t,s,8),r.add(o);const l=ce.renderMiniPortrait(this,e.fighter.portrait,35,s/2,40);r.add(l);const h=this.add.text(70,12,e.fighter.fullName,{fontFamily:"Georgia, serif",fontSize:"13px",color:"#c9a959"});r.add(h);const u=e.status==="champion"?"ðŸ†":e.status==="retired"?"ðŸ›ï¸":"â˜ ï¸",f=this.add.text(t-15,12,u,{fontSize:"16px"}).setOrigin(1,0);r.add(f);const g=`${e.leagueReached.toUpperCase()} | ${e.wins} wins | ${e.weeksSurvived} weeks`,y=this.add.text(70,32,g,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355"});r.add(y);const S=e.status==="dead"?((M=e.causeOfDeath)==null?void 0:M.substring(0,40))+"...":e.status==="retired"?"Retired with honor":"Became Champion!",b=this.add.text(70,48,S||"",{fontFamily:"Georgia, serif",fontSize:"9px",color:"#5a4a3a",fontStyle:"italic"});r.add(b),o.setInteractive(new w.Geom.Rectangle(0,0,t,s),w.Geom.Rectangle.Contains),o.on("pointerdown",()=>this.showDetails(e)),o.on("pointerover",()=>{o.clear(),o.fillStyle(d+1118481,1),o.fillRoundedRect(0,0,t,s,8),o.lineStyle(2,13216089,1),o.strokeRoundedRect(0,0,t,s,8)}),o.on("pointerout",()=>{o.clear(),o.fillStyle(d,1),o.fillRoundedRect(0,0,t,s,8),o.lineStyle(1,5917242,1),o.strokeRoundedRect(0,0,t,s,8)})}createDetailsPanel(){const{width:e,height:a}=this.cameras.main;this.detailsContainer=this.add.container(e/2,550),this.detailsContainer.setVisible(!1);const i=this.add.graphics();i.fillStyle(1709072,.95),i.fillRoundedRect(-160,-100,320,200,10),i.lineStyle(2,13216089,1),i.strokeRoundedRect(-160,-100,320,200,10),this.detailsContainer.add(i)}showDetails(e){this.selectedLegend=e,this.detailsContainer.removeAll(!0);const a=this.add.graphics();a.fillStyle(1709072,.95),a.fillRoundedRect(-160,-100,320,200,10),a.lineStyle(2,13216089,1),a.strokeRoundedRect(-160,-100,320,200,10),this.detailsContainer.add(a);const i=this.add.text(0,-85,e.fighter.fullName,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#c9a959"}).setOrigin(.5);this.detailsContainer.add(i);const t=this.add.text(0,-65,`âœ¨ ${e.fighter.signatureTrait}`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#6b8e23"}).setOrigin(.5);if(this.detailsContainer.add(t),e.bestWin){const r=this.add.text(0,-45,`Best Victory: ${e.bestWin}`,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355"}).setOrigin(.5);this.detailsContainer.add(r)}if(e.lettersWritten.length>0){const r=this.add.text(0,-25,`ðŸ“œ ${e.lettersWritten.length} letters written`,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355"}).setOrigin(.5);this.detailsContainer.add(r)}if(e.playerNote){const r=this.add.text(0,10,`"${e.playerNote}"`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#c9a959",fontStyle:"italic",wordWrap:{width:280},align:"center"}).setOrigin(.5);this.detailsContainer.add(r)}const s=T.createButton(this,0,70,"CLOSE",()=>this.detailsContainer.setVisible(!1),{width:80,height:30,fontSize:"11px"});this.detailsContainer.add(s),this.detailsContainer.setVisible(!0)}createBackButton(){const{width:e,height:a}=this.cameras.main;T.createButton(this,e/2,a-50,"â† BACK TO MENU",()=>this.returnToMenu(),{width:180,height:45})}returnToMenu(){this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("MainMenuScene")})}}class Ui extends w.Scene{constructor(){super({key:"BloodlinePerksScene"});m(this,"pointsText");m(this,"selectedPerk",null);m(this,"detailsContainer");m(this,"perkContainers",new Map)}create(){this.createBackground(),this.createHeader(),this.createPerkTree(),this.createDetailsPanel(),this.createBackButton(),this.cameras.main.fadeIn(300)}createBackground(){const{width:e,height:a}=this.cameras.main,i=this.add.graphics();i.fillGradientStyle(1709072,1709072,2760474,2760474),i.fillRect(0,0,e,a)}createHeader(){const{width:e}=this.cameras.main,a=p.getMeta();this.add.text(e/2,35,"BLOODLINE PERKS",{fontFamily:"Georgia, serif",fontSize:"24px",color:"#c9a959",stroke:"#000000",strokeThickness:3}).setOrigin(.5),this.add.text(e/2,65,"Permanent upgrades for future fighters",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b7355",fontStyle:"italic"}).setOrigin(.5),this.pointsText=this.add.text(e/2,90,`âš¡ ${a.bloodlinePoints} Points Available`,{fontFamily:"Georgia, serif",fontSize:"16px",color:"#ffd700"}).setOrigin(.5),this.add.text(e/2,110,`Promoter Level: ${a.promoterLevel}`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b7355"}).setOrigin(.5)}createPerkTree(){const{width:e}=this.cameras.main,a=150,i=160,t=te.filter(o=>o.tier===1),s=te.filter(o=>o.tier===2),r=te.filter(o=>o.tier===3);this.add.text(e/2,a-15,"â”€â”€â”€ TIER 1 â”€â”€â”€",{fontFamily:"Georgia, serif",fontSize:"11px",color:"#5a4a3a"}).setOrigin(.5),this.createPerkRow(t,a,e),this.add.text(e/2,a+i-15,"â”€â”€â”€ TIER 2 â”€â”€â”€",{fontFamily:"Georgia, serif",fontSize:"11px",color:"#5a4a3a"}).setOrigin(.5),this.createPerkRow(s,a+i,e),this.add.text(e/2,a+i*2-15,"â”€â”€â”€ TIER 3 â”€â”€â”€",{fontFamily:"Georgia, serif",fontSize:"11px",color:"#5a4a3a"}).setOrigin(.5),this.createPerkRow(r,a+i*2,e)}createPerkRow(e,a,i){const r=i/2-(e.length-1)*75/2;e.forEach((o,d)=>{const l=r+d*75;this.createPerkNode(o,l,a,60)})}createPerkNode(e,a,i,t){const s=this.add.container(a,i);this.perkContainers.set(e.id,s);const o=p.getMeta().unlockedPerks.includes(e.id),{canPurchase:d,reason:l}=$e(e.id),h=this.add.graphics(),u=o?2771498:d?2763322:2760474;h.fillStyle(u,1),h.fillRoundedRect(-t/2,-t/2,t,t,8);const f=o?7048739:d?13216089:5917242;h.lineStyle(2,f,1),h.strokeRoundedRect(-t/2,-t/2,t,t,8),s.add(h);const g=e.tier===1?"â—":e.tier===2?"â—†":"â˜…",y=this.add.text(0,-t/2-10,g,{fontSize:"12px",color:o?"#6b8e23":"#5a4a3a"}).setOrigin(.5);if(s.add(y),o){const b=this.add.text(0,0,"âœ“",{fontSize:"24px",color:"#6b8e23"}).setOrigin(.5);s.add(b)}else{const b=this.add.text(0,8,`${e.cost}`,{fontFamily:"Georgia, serif",fontSize:"16px",color:d?"#ffd700":"#5a4a3a"}).setOrigin(.5);s.add(b)}const S=this.add.text(0,t/2+10,e.name,{fontFamily:"Georgia, serif",fontSize:"9px",color:o?"#6b8e23":"#8b7355",wordWrap:{width:70},align:"center"}).setOrigin(.5,0);s.add(S),h.setInteractive(new w.Geom.Rectangle(-t/2,-t/2,t,t),w.Geom.Rectangle.Contains),h.on("pointerdown",()=>this.selectPerk(e)),h.on("pointerover",()=>{o||(h.clear(),h.fillStyle(u+1118481,1),h.fillRoundedRect(-t/2,-t/2,t,t,8),h.lineStyle(2,13216089,1),h.strokeRoundedRect(-t/2,-t/2,t,t,8))}),h.on("pointerout",()=>{h.clear(),h.fillStyle(u,1),h.fillRoundedRect(-t/2,-t/2,t,t,8),h.lineStyle(2,f,1),h.strokeRoundedRect(-t/2,-t/2,t,t,8)})}createDetailsPanel(){const{width:e,height:a}=this.cameras.main;this.detailsContainer=this.add.container(e/2,650),this.add.text(e/2,630,"Select a perk to view details",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#5a4a3a"}).setOrigin(.5)}selectPerk(e){this.selectedPerk=e,this.updateDetailsPanel()}updateDetailsPanel(){if(!this.selectedPerk)return;const e=this.selectedPerk;this.detailsContainer.removeAll(!0);const i=p.getMeta().unlockedPerks.includes(e.id),{canPurchase:t,reason:s}=$e(e.id),r=this.add.graphics();r.fillStyle(2760474,.95),r.fillRoundedRect(-160,-70,320,140,10),r.lineStyle(2,5917242,1),r.strokeRoundedRect(-160,-70,320,140,10),this.detailsContainer.add(r);const o=this.add.text(0,-55,e.name,{fontFamily:"Georgia, serif",fontSize:"16px",color:"#c9a959"}).setOrigin(.5);this.detailsContainer.add(o);const d=this.add.text(0,-30,e.description,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b7355",wordWrap:{width:280},align:"center"}).setOrigin(.5);this.detailsContainer.add(d);const l=this.add.text(0,0,`Effect: ${e.effect}`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#6b8e23"}).setOrigin(.5);if(this.detailsContainer.add(l),i){const h=this.add.text(0,25,"âœ“ OWNED",{fontFamily:"Georgia, serif",fontSize:"14px",color:"#6b8e23"}).setOrigin(.5);this.detailsContainer.add(h)}else if(t){const h=T.createButton(this,0,40,`BUY (${e.cost} pts)`,()=>this.purchasePerk(e),{width:120,height:35,fontSize:"12px",primary:!0});this.detailsContainer.add(h)}else{const h=this.add.text(0,25,`ðŸ”’ ${s}`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b4513"}).setOrigin(.5);this.detailsContainer.add(h)}}purchasePerk(e){if(_a(e.id)){T.showNotification(this,`Unlocked: ${e.name}!`);const a=p.getMeta();this.pointsText.setText(`âš¡ ${a.bloodlinePoints} Points Available`),this.scene.restart()}}createBackButton(){const{width:e,height:a}=this.cameras.main;T.createButton(this,e/2,a-50,"â† BACK TO MENU",()=>this.returnToMenu(),{width:180,height:45})}returnToMenu(){this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("MainMenuScene")})}}class ji extends w.Scene{constructor(){super({key:"SettingsScene"});m(this,"settings");m(this,"toggleButtons",new Map)}create(){this.settings=p.getSettings(),this.createBackground(),this.createHeader(),this.createSettingsList(),this.createResetButton(),this.createBackButton(),this.cameras.main.fadeIn(300)}createBackground(){const{width:e,height:a}=this.cameras.main,i=this.add.graphics();i.fillGradientStyle(1709072,1709072,2760474,2760474),i.fillRect(0,0,e,a)}createHeader(){const{width:e}=this.cameras.main;this.add.text(e/2,40,"SETTINGS",{fontFamily:"Georgia, serif",fontSize:"28px",color:"#c9a959",stroke:"#000000",strokeThickness:3}).setOrigin(.5)}createSettingsList(){const{width:e}=this.cameras.main,a=100;this.add.text(e/2,a,"â”€â”€â”€ VISUAL â”€â”€â”€",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#5a4a3a"}).setOrigin(.5),this.createToggle("reduceMotion","Reduce Motion","Minimize animations and particles",a+40),this.createToggle("screenShake","Screen Shake","Enable impact screen shake",a+100),this.createToggle("bloodFX","Blood Effects","Show blood during combat",a+160),this.createToggle("grainFX","Grain/Ink FX","Atmospheric visual overlay",a+220),this.add.text(e/2,a+290,"â”€â”€â”€ AUDIO â”€â”€â”€",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#5a4a3a"}).setOrigin(.5),this.createToggle("soundEnabled","Sound Enabled","Enable all game audio",a+330),this.add.text(e/2,a+390,"(Audio features coming soon)",{fontFamily:"Georgia, serif",fontSize:"10px",color:"#5a4a3a",fontStyle:"italic"}).setOrigin(.5),this.add.text(e/2,a+430,"â”€â”€â”€ DEVELOPER â”€â”€â”€",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#5a4a3a"}).setOrigin(.5),this.createToggle("debugMode","Debug Mode","Show debug overlay with game state",a+470)}createToggle(e,a,i,t){const{width:s}=this.cameras.main;this.add.text(30,t,a,{fontFamily:"Georgia, serif",fontSize:"15px",color:"#c9a959"}),this.add.text(30,t+20,i,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355"});const r=!!this.settings[e],o=this.createToggleButton(s-80,t+10,r,d=>{this.settings[e]=d,p.updateSettings({[e]:d})});this.toggleButtons.set(e,o)}createToggleButton(e,a,i,t){const s=this.add.container(e,a);let r=i;const o=60,d=28,l=this.add.graphics(),h=()=>{l.clear(),l.fillStyle(r?3050327:3811866,1),l.fillRoundedRect(0,0,o,d,d/2),l.lineStyle(1,r?7048739:5917242,1),l.strokeRoundedRect(0,0,o,d,d/2)};h(),s.add(l);const u=d-6,f=this.add.graphics(),g=()=>{const y=r?o-u-3:3;f.clear(),f.fillStyle(r?16777215:9139029,1),f.fillCircle(y+u/2,d/2,u/2)};return g(),s.add(f),l.setInteractive(new w.Geom.Rectangle(0,0,o,d),w.Geom.Rectangle.Contains),l.on("pointerdown",()=>{r=!r,h(),g(),t(r)}),s}createResetButton(){const{width:e,height:a}=this.cameras.main;this.add.text(e/2,a-150,"â”€â”€â”€ DANGER ZONE â”€â”€â”€",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b0000"}).setOrigin(.5);const t=T.createButton(this,e/2,a-110,"ðŸ—‘ï¸ RESET ALL DATA",()=>this.showResetConfirmation(),{width:200,height:45}).first;t.clear(),t.fillStyle(3807770,1),t.fillRoundedRect(-100,-22.5,200,45,8),t.lineStyle(2,9109504,1),t.strokeRoundedRect(-100,-22.5,200,45,8)}showResetConfirmation(){T.showConfirmDialog(this,"Reset All Data?",`This will DELETE all save data including:
â€¢ All fighters
â€¢ Hall of Legends
â€¢ Bloodline Perks
â€¢ Settings

This CANNOT be undone!`,()=>this.performReset(),()=>{},"HOLD TO CONFIRM")}performReset(){p.resetAllData(),T.showNotification(this,"All data has been reset"),this.time.delayedCall(1500,()=>{this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("MainMenuScene")})})}createBackButton(){const{width:e,height:a}=this.cameras.main;T.createButton(this,e/2,a-50,"â† BACK TO MENU",()=>this.returnToMenu(),{width:180,height:45})}returnToMenu(){this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("MainMenuScene")})}}class Vi extends w.Scene{constructor(){super({key:"VignetteScene"});m(this,"vignette");m(this,"fighter");m(this,"resultText")}init(e){const a=p.getRun();if(!a.fighter){this.scene.start("MainMenuScene");return}this.fighter=a.fighter,e.specificVignette?this.vignette=Oe.find(i=>i.id===e.specificVignette):this.vignette=this.selectRandomVignette(e.type||"camp")}selectRandomVignette(e){const a=p.getRun(),i=a.completedVignettes,t=Oe.filter(s=>!(s.category!==e||i.includes(s.id)||s.requirements&&(s.requirements.minWeek&&a.week<s.requirements.minWeek||s.requirements.minTrust&&this.fighter.trust<s.requirements.minTrust||s.requirements.maxTrust&&this.fighter.trust>s.requirements.maxTrust||s.requirements.hasInjury&&this.fighter.injuries.length===0)));if(t.length===0){const s=Oe.filter(r=>r.category===e);return k.pick(s)}return k.pick(t)}create(){this.createBackground(),this.createVignetteContent(),this.cameras.main.fadeIn(300)}createBackground(){const{width:e,height:a}=this.cameras.main,i=this.add.graphics();if(i.fillGradientStyle(1709072,1709072,2760474,2760474),i.fillRect(0,0,e,a),this.textures.exists("parchment_overlay")){const t=this.add.image(e/2,a/2,"parchment_overlay");t.setAlpha(.1),t.setDisplaySize(e,a)}}createVignetteContent(){const{width:e,height:a}=this.cameras.main;this.add.text(e/2,50,this.vignette.title,{fontFamily:"Georgia, serif",fontSize:"22px",color:"#c9a959",stroke:"#000000",strokeThickness:2}).setOrigin(.5);const i={camp:"ðŸ•ï¸",offer:"ðŸ’€",letter:"âœ‰ï¸",event:"â“"};this.add.text(e/2,80,i[this.vignette.category]||"ðŸ“œ",{fontSize:"20px"}).setOrigin(.5),this.add.text(e/2,150,this.vignette.description,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#c9a959",wordWrap:{width:320},align:"center",lineSpacing:6}).setOrigin(.5);const t=280,s=90;this.vignette.choices.forEach((r,o)=>{this.createChoiceButton(r,e/2,t+o*s)}),this.resultText=this.add.text(e/2,a-150,"",{fontFamily:"Georgia, serif",fontSize:"13px",color:"#8b7355",fontStyle:"italic",wordWrap:{width:320},align:"center"}).setOrigin(.5)}createChoiceButton(e,a,i){const t=this.add.container(a,i),s=320,r=70,o=this.add.graphics();o.fillStyle(2760474,1),o.fillRoundedRect(-s/2,-r/2,s,r,8),o.lineStyle(2,5917242,1),o.strokeRoundedRect(-s/2,-r/2,s,r,8),t.add(o);const d=this.add.text(0,-10,e.text,{fontFamily:"Georgia, serif",fontSize:"13px",color:"#c9a959",wordWrap:{width:s-30},align:"center"}).setOrigin(.5);t.add(d);const l=[];if(e.effects.trust){const h=e.effects.trust>0?"+":"";l.push(`${h}${e.effects.trust} Trust`)}if(e.effects.gold){const h=e.effects.gold>0?"+":"";l.push(`${h}${e.effects.gold} Gold`)}if(e.effects.hp){const h=e.effects.hp>0?"+":"";l.push(`${h}${e.effects.hp} HP`)}if(e.effects.injury&&l.push(`Risk: ${e.effects.injury} injury`),e.effects.injuryHeal&&l.push(`Heal ${e.effects.injuryHeal} week(s)`),l.length>0){const h=this.add.text(0,18,l.join(" | "),{fontFamily:"Georgia, serif",fontSize:"10px",color:"#6b8e23"}).setOrigin(.5);t.add(h)}o.setInteractive(new w.Geom.Rectangle(-s/2,-r/2,s,r),w.Geom.Rectangle.Contains),o.on("pointerover",()=>{o.clear(),o.fillStyle(3813162,1),o.fillRoundedRect(-s/2,-r/2,s,r,8),o.lineStyle(2,13216089,1),o.strokeRoundedRect(-s/2,-r/2,s,r,8)}),o.on("pointerout",()=>{o.clear(),o.fillStyle(2760474,1),o.fillRoundedRect(-s/2,-r/2,s,r,8),o.lineStyle(2,5917242,1),o.strokeRoundedRect(-s/2,-r/2,s,r,8)}),o.on("pointerdown",()=>{this.selectChoice(e),t.setVisible(!1)})}selectChoice(e){const a=p.getRun();e.effects.trust&&Te(this.fighter,e.effects.trust),e.effects.gold&&(a.gold+=e.effects.gold),e.effects.hp&&(this.fighter.currentStats.currentHP=Math.max(1,Math.min(this.fighter.currentStats.maxHP,this.fighter.currentStats.currentHP+e.effects.hp))),e.effects.stamina&&(this.fighter.currentStats.currentStamina=Math.max(0,Math.min(this.fighter.currentStats.maxStamina,this.fighter.currentStats.currentStamina+e.effects.stamina))),e.effects.injuryHeal&&Ft(this.fighter,e.effects.injuryHeal),a.completedVignettes.includes(this.vignette.id)||a.completedVignettes.push(this.vignette.id),p.updateRun({fighter:this.fighter,gold:a.gold,completedVignettes:a.completedVignettes,lettersWritten:a.lettersWritten}),this.showResult(e.resultText)}showResult(e){const{width:a,height:i}=this.cameras.main;this.tweens.add({targets:this.children.getAll().filter(t=>t.y>200&&t.y<600),alpha:0,duration:300}),this.resultText.setText(e),this.resultText.setAlpha(0),this.tweens.add({targets:this.resultText,alpha:1,duration:500,delay:300}),this.time.delayedCall(800,()=>{T.createButton(this,a/2,i-70,"CONTINUE",()=>this.returnToCamp(),{width:180,height:45,primary:!0})})}returnToCamp(){this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("CampScene")})}}const Xi=[{id:"letter_home",type:"home",name:"Letter Home",icon:"ðŸ ",description:"Write to family or loved ones. Brings comfort and strengthens resolve.",recipient:"your family",guaranteedEffects:[{type:"trust",value:10,description:"+10 Trust"},{type:"resolve",value:15,description:"+15 Resolve (reduces fear effects)"},{type:"letter_stamp",value:1,description:"+1 Letter Stamp"}],positiveChance:.4,positiveEffect:{type:"hp",value:15,description:"The act of writing brings peace. +15 HP"},negativeChance:.1,negativeEffect:{type:"trust",value:-5,description:"Memories bring sadness. -5 Trust"},letterSnippets:["I hope this letter finds you well. The arena is harsh, but I think of you often.","The crowd cheers, but it's your faces I see when I fight.","They call me {nickname} now. I wonder if you'd recognize me.","I've made friends here. And enemies. But I survive.","The gold I've sent should help with the farm. There will be more.","I dream of home. Of the smell of bread. Of peace.","Tell the children I'm fighting for their future.","I've seen death here. It makes me appreciate life more."],closingLines:["With love, {name}","Until we meet again, {name}","Your devoted {name}","Forever yours, {name}"],milestoneRewards:[{count:3,reward:{type:"ability",id:"rally_cry",name:"Rally Cry",description:"Once per fight, read your letter to gain +20 Focus instantly"}},{count:7,reward:{type:"keepsake_upgrade",id:"family_blessing",name:"Family Blessing",description:"Your keepsake now also grants +5% HP regeneration between fights"}},{count:12,reward:{type:"cosmetic",id:"home_banner",name:"Home Banner",description:"A banner with your family crest flies in the arena"}}]},{id:"letter_patron",type:"patron",name:"Letter to a Patron",icon:"ðŸ’°",description:"Request support from a wealthy sponsor. Risky but lucrative.",recipient:"a wealthy patron",guaranteedEffects:[{type:"gold",value:30,description:"+30 Gold immediately"},{type:"letter_stamp",value:1,description:"+1 Letter Stamp"}],positiveChance:.5,positiveEffect:{type:"gold",value:50,description:"Your patron sends extra! +50 Gold"},negativeChance:.25,negativeEffect:{type:"debt",value:40,description:"You now owe them. Debt: 40 gold from next 2 victories"},letterSnippets:["Honorable Patron, your investment in me has not been misplaced.","I write seeking your continued support in the arena.","My victories bring glory to your name as well as mine.","The crowds chant {nickname}. Soon they'll know who backs me.","With better equipment, I could win you greater fame.","I've proven my worth. Now I ask for your faith.","My enemies grow stronger. I need stronger steel to match.","Every coin you invest returns tenfold in glory."],closingLines:["Your humble servant, {name}","In your debt, {name}","Gratefully, {name}","Your champion, {name}"],milestoneRewards:[{count:3,reward:{type:"perk_point",id:"patron_connection",name:"Patron Connection",description:"+1 Bloodline Point and permanent 5% shop discount"}},{count:7,reward:{type:"ability",id:"emergency_funds",name:"Emergency Funds",description:"Once per run, receive 100 gold in desperate times"}},{count:12,reward:{type:"cosmetic",id:"patron_sigil",name:"Patron's Sigil",description:"A golden sigil marks your equipment"}}]},{id:"letter_rival",type:"rival",name:"Letter to a Rival",icon:"âš”ï¸",description:"Taunt your rival or attempt diplomacy. High risk, high reward.",recipient:"your rival",guaranteedEffects:[{type:"hype",value:10,description:"+10 Crowd Hype (carries to next fight)"},{type:"letter_stamp",value:1,description:"+1 Letter Stamp"}],positiveChance:.45,positiveEffect:{type:"enemy_debuff",value:15,description:"Your rival is rattled! -15% accuracy next encounter"},negativeChance:.3,negativeEffect:{type:"buff",value:-1,description:"They use your words against you. Rival gains +10% damage next fight"},letterSnippets:["I know you're watching. Good. Watch me win.","We both know how this ends. In blood. Probably yours.","Perhaps we are not so different, you and I.","Your technique is good. But mine is better.","I've studied your fights. I see your weaknesses.","The crowd will cheer when we finally meet.","May the better fighter win. That would be me.","You think you're special? I've beaten better."],closingLines:["See you in the sand, {name}","Until we dance, {name}","Your future conqueror, {name}","With grudging respect, {name}"],milestoneRewards:[{count:3,reward:{type:"ability",id:"psychological_warfare",name:"Psychological Warfare",description:"Start fights against rivals with +15 Focus"}},{count:7,reward:{type:"perk_point",id:"rival_hunter",name:"Rival Hunter",description:"+25% gold and fame from defeating rivals"}},{count:12,reward:{type:"archetype_hint",id:"duelist_unlock",name:"Duelist's Path",description:"Progress toward unlocking the Street Duelist archetype"}}]},{id:"letter_chaplain",type:"chaplain",name:"Letter to the Chaplain",icon:"âœï¸",description:"Seek spiritual guidance and healing. Pure benefits but costly.",recipient:"the arena chaplain",guaranteedEffects:[{type:"hp",value:20,description:"+20 HP healing"},{type:"status_cure",value:1,description:"Cure Fear and Concussion"},{type:"letter_stamp",value:1,description:"+1 Letter Stamp"}],positiveChance:.35,positiveEffect:{type:"injury_heal",value:1,description:"Blessed recovery! Heal 1 injury week"},negativeChance:.2,negativeEffect:{type:"gold",value:-25,description:"The chaplain requests a donation. -25 Gold"},letterSnippets:["Father, I seek your blessing before my next trial.","I confess my sins and ask for absolution.","The arena tests my faith. Help me stay true.","I've done terrible things. Can I still be forgiven?","Pray for me, Father. The enemy is strong.","I fight not for glory, but for those I love.","Grant me your blessing, that I might survive.","In this world of blood, I seek something pure."],closingLines:["In faith, {name}","Your humble penitent, {name}","Seeking grace, {name}","Bless me, {name}"],milestoneRewards:[{count:3,reward:{type:"ability",id:"divine_protection",name:"Divine Protection",description:"Once per fight, survive a killing blow with 1 HP"}},{count:7,reward:{type:"keepsake_upgrade",id:"blessed_keepsake",name:"Blessed Keepsake",description:"Your keepsake now reduces injury severity by one tier"}},{count:12,reward:{type:"cosmetic",id:"holy_symbol",name:"Holy Symbol",description:"A blessed symbol adorns your equipment"}}]},{id:"letter_future",type:"future_self",name:"Letter to Your Future Self",icon:"ðŸ“œ",description:"Write wisdom for the next generation. Boosts legacy rewards.",recipient:"your future self",guaranteedEffects:[{type:"trust",value:5,description:"+5 Trust (self-reflection)"},{type:"letter_stamp",value:2,description:"+2 Letter Stamps"}],positiveChance:.6,positiveEffect:{type:"buff",value:1,description:"Clarity of purpose! +10% all rewards next fight"},negativeChance:.05,negativeEffect:{type:"focus",value:-10,description:"Dark thoughts intrude. -10 starting Focus next fight"},letterSnippets:["If you're reading this, I'm gone. Learn from my mistakes.","Remember: defense wins fights, offense wins crowds.","Trust your instincts. They've kept you alive this long.","The rival to fear is the one you underestimate.","Your keepsake is more than metal. It's who you are.","Win or lose, fight with honor. That's what matters.","I've learned that trust is earned in blood, not words.","The arena takes everything. Give it nothing but your best."],closingLines:["From the past, {name}","Learn and survive, {name}","Your former self, {name}","Remember me, {name}"],milestoneRewards:[{count:3,reward:{type:"perk_point",id:"legacy_wisdom",name:"Legacy Wisdom",description:"+1 Bloodline Point and new recruits start with +5 in a random stat"}},{count:7,reward:{type:"ability",id:"ghost_guidance",name:"Ghost Guidance",description:"Fallen fighters may appear as ghosts to give combat hints"}},{count:12,reward:{type:"cosmetic",id:"memorial_wings",name:"Memorial Wings",description:"Spectral wings appear on your memorial portrait"}}]}];function Qi(c,n,e){const a=c.letterSnippets[Math.floor(Math.random()*c.letterSnippets.length)],i=c.closingLines[Math.floor(Math.random()*c.closingLines.length)];return a.replace("{name}",n).replace("{nickname}",e)+`

`+i.replace("{name}",n)}function Ki(c){const n=[...c.guaranteedEffects];return Math.random()<c.positiveChance&&n.push(c.positiveEffect),Math.random()<c.negativeChance&&n.push(c.negativeEffect),n}const N=class N extends w.GameObjects.Container{constructor(e,a,i,t,s){super(e,a,i);m(this,"bg");m(this,"textObj");m(this,"effectsContainer");m(this,"riskIndicator");m(this,"config");m(this,"callback");m(this,"isHovered",!1);this.config=t,this.callback=s,this.createCard(),this.setupInteraction(),this.setScale(.8),this.setAlpha(0),e.tweens.add({targets:this,scale:1,alpha:1,duration:300,ease:"Back.out"}),e.add.existing(this)}createCard(){const e=N.WIDTH;this.bg=this.scene.add.graphics(),this.drawBackground(!1),this.add(this.bg);let a=-e/2+15;if(this.config.icon){const i=this.scene.add.text(-e/2+25,0,this.config.icon,{fontSize:"24px"}).setOrigin(.5);this.add(i),a+=35}this.textObj=this.scene.add.text(a,-15,this.config.text,{fontFamily:"Georgia, serif",fontSize:"13px",color:"#c9a959",wordWrap:{width:e-80}}).setOrigin(0,.5),this.add(this.textObj),this.effectsContainer=this.scene.add.container(-e/2+15,20),this.createEffectsPreviews(),this.add(this.effectsContainer),this.config.riskLevel&&this.config.riskLevel!=="safe"&&this.createRiskIndicator()}drawBackground(e){const a=N.WIDTH,i=N.HEIGHT;this.bg.clear(),this.bg.fillStyle(0,.2),this.bg.fillRoundedRect(-a/2+2,-i/2+2,a,i,8);const s={safe:2767402,risky:3815978,dangerous:3811882}[this.config.riskLevel||"safe"],r=e?s+1118481:s;this.bg.fillStyle(r,.95),this.bg.fillRoundedRect(-a/2,-i/2,a,i,8);const d=e?13216089:{safe:7048739,risky:14329120,dangerous:13458524}[this.config.riskLevel||"safe"];this.bg.lineStyle(e?2:1,d,1),this.bg.strokeRoundedRect(-a/2,-i/2,a,i,8),this.bg.fillStyle(d,.5),this.bg.fillRect(-a/2,-i/2+5,4,i-10)}createEffectsPreviews(){let e=0;this.config.effects.slice(0,3).forEach(a=>{const i=a.isPositive?"â–²":"â–¼",t=a.isPositive?"#6b8e23":"#cd5c5c",s=this.scene.add.text(e,0,`${i} ${a.description}`,{fontFamily:"Georgia, serif",fontSize:"10px",color:t});this.effectsContainer.add(s),e+=s.width+15})}createRiskIndicator(){const e={risky:"âš ï¸ RISKY",dangerous:"â˜ ï¸ DANGEROUS"},a={risky:"#daa520",dangerous:"#cd5c5c"};this.riskIndicator=this.scene.add.text(N.WIDTH/2-10,-100/2+10,e[this.config.riskLevel],{fontFamily:"Georgia, serif",fontSize:"9px",color:a[this.config.riskLevel]}).setOrigin(1,0),this.add(this.riskIndicator)}setupInteraction(){const e=new w.Geom.Rectangle(-140,-50,N.WIDTH,N.HEIGHT);this.setSize(N.WIDTH,N.HEIGHT),this.setInteractive(e,w.Geom.Rectangle.Contains),this.on("pointerover",()=>{this.isHovered=!0,this.drawBackground(!0),this.scene.tweens.add({targets:this,x:this.x+5,scaleX:1.02,scaleY:1.02,duration:100})}),this.on("pointerout",()=>{this.isHovered=!1,this.drawBackground(!1),this.scene.tweens.add({targets:this,x:this.x-5,scaleX:1,scaleY:1,duration:100})}),this.on("pointerdown",()=>{this.scene.tweens.add({targets:this,scaleX:.98,scaleY:.98,duration:50})}),this.on("pointerup",()=>{this.scene.tweens.add({targets:this,scaleX:1.1,scaleY:1.1,alpha:0,duration:200,ease:"Quad.in",onComplete:()=>{this.callback()}})})}select(){this.emit("pointerup")}fadeOut(){this.scene.tweens.add({targets:this,alpha:0,y:this.y+20,duration:200,onComplete:()=>this.destroy()})}};m(N,"WIDTH",280),m(N,"HEIGHT",100);let Ye=N;class Ji extends w.Scene{constructor(){super({key:"LetterScene"});m(this,"fighter");m(this,"selectedTemplate");m(this,"letterContent");m(this,"effects",[]);m(this,"phase","select");m(this,"quillSprite");m(this,"parchmentGroup");m(this,"letterTextObj");m(this,"waxSeal")}create(){const e=p.getRun();if(!e.fighter){this.scene.start("MainMenuScene");return}this.fighter=e.fighter,this.phase="select",this.createBackground(),this.showLetterTypeSelection(),this.cameras.main.fadeIn(300)}createBackground(){const{width:e,height:a}=this.cameras.main,i=this.add.graphics();i.fillGradientStyle(1709072,1709072,985605,985605),i.fillRect(0,0,e,a);const t=this.add.graphics();t.fillStyle(16753920,.1),t.fillCircle(e*.8,a*.2,100),this.tweens.add({targets:t,alpha:{from:.1,to:.15},duration:200,yoyo:!0,repeat:-1}),this.add.text(e/2,40,"WRITE A LETTER",{fontFamily:"Georgia, serif",fontSize:"20px",color:"#c9a959"}).setOrigin(.5),this.add.text(e/2,65,"Choose your words carefully...",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b7355",fontStyle:"italic"}).setOrigin(.5),T.createButton(this,50,35,"â† BACK",()=>this.goBack(),{width:80,height:35,fontSize:"11px"})}showLetterTypeSelection(){const{width:e,height:a}=this.cameras.main,i=this.add.container(0,0);i.setData("phase","select");const t=120,s=100;Xi.forEach((d,l)=>{const h=t+l*s,u=d.guaranteedEffects.map(y=>({type:y.type,value:y.value,isPositive:y.value>0||["letter_stamp","status_cure","injury_heal"].includes(y.type),description:y.description}));d.positiveChance>0&&u.push({type:"chance",value:Math.round(d.positiveChance*100),isPositive:!0,description:`${Math.round(d.positiveChance*100)}%: ${d.positiveEffect.description}`});const f=new Ye(this,e/2,h,{id:d.id,text:`${d.icon} ${d.name}`,effects:u.slice(0,3),riskLevel:d.negativeChance>.2?"risky":"safe",icon:d.icon},()=>this.selectLetterType(d)),g=this.add.text(e/2,h+55,d.description,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#6a5a4a",align:"center"}).setOrigin(.5);i.add(f),i.add(g)});const r=p.getSeals(),o=p.getLetterStamps();this.add.text(e-20,a-50,`ðŸ”µ Seals: ${r}`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#4682b4"}).setOrigin(1,.5),this.add.text(e-20,a-30,`ðŸ“œ Stamps: ${o}`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b7355"}).setOrigin(1,.5)}selectLetterType(e){this.selectedTemplate=e,this.phase="write",this.letterContent=Qi(e,this.fighter.firstName,this.fighter.nickname),this.effects=Ki(e),this.children.each(a=>{a.getData("phase")==="select"&&a.destroy()}),this.showWritingPhase()}showWritingPhase(){var s;const{width:e,height:a}=this.cameras.main;this.parchmentGroup=this.add.container(e/2,a/2-50);const i=this.add.graphics();i.fillStyle(13943968,1),i.fillRoundedRect(-160,-180,320,360,5),i.lineStyle(2,9139029,1),i.strokeRoundedRect(-160,-180,320,360,5),i.fillStyle(13219990,.5),i.fillCircle(-100,-100,30),i.fillCircle(80,50,25),this.parchmentGroup.add(i);const t=this.add.text(0,-150,`To ${(s=this.selectedTemplate)==null?void 0:s.recipient}`,{fontFamily:"Georgia, serif",fontSize:"12px",color:"#3a2a1a",fontStyle:"italic"}).setOrigin(.5);this.parchmentGroup.add(t),this.letterTextObj=this.add.text(0,-50,"",{fontFamily:"Georgia, serif",fontSize:"11px",color:"#2a1a0a",wordWrap:{width:280},align:"center",lineSpacing:6}).setOrigin(.5),this.parchmentGroup.add(this.letterTextObj),this.typewriterEffect(this.letterContent||"",()=>{this.showSealButton()}),this.createQuill()}createQuill(){this.quillSprite=this.add.graphics(),this.quillSprite.fillStyle(4864554,1),this.quillSprite.fillTriangle(0,0,-5,30,5,30),this.quillSprite.fillStyle(16119260,1),this.quillSprite.fillTriangle(-2,30,2,30,0,80);const{width:e,height:a}=this.cameras.main;this.quillSprite.setPosition(e/2+100,a/2-100),this.tweens.add({targets:this.quillSprite,x:{from:e/2+80,to:e/2+120},y:{from:a/2-120,to:a/2},duration:2e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}typewriterEffect(e,a){let i=0;const t=e;this.time.addEvent({delay:30,callback:()=>{var s;i++,(s=this.letterTextObj)==null||s.setText(t.substring(0,i)),i>=t.length&&a()},repeat:t.length-1})}showSealButton(){var t,s;const{width:e,height:a}=this.cameras.main;(t=this.quillSprite)==null||t.destroy();const i=this.add.text(e/2,a/2+80,`â€” ${this.fighter.firstName}`,{fontFamily:"Georgia, serif",fontSize:"12px",color:"#2a1a0a",fontStyle:"italic"}).setOrigin(.5);(s=this.parchmentGroup)==null||s.add(i),T.createButton(this,e/2,a-80,"ðŸ”´ SEAL WITH WAX",()=>this.sealLetter(),{width:180,height:50,primary:!0})}sealLetter(){this.phase="seal";const{width:e,height:a}=this.cameras.main;this.waxSeal=this.add.container(e/2,a/2+130);const i=this.add.graphics();i.fillStyle(9109504,1),i.fillCircle(0,0,0),this.waxSeal.add(i),this.tweens.add({targets:{radius:0},radius:25,duration:500,ease:"Quad.out",onUpdate:t=>{const s=t.getValue();typeof s=="number"&&(i.clear(),i.fillStyle(9109504,1),i.fillCircle(0,0,s))},onComplete:()=>{this.stampSeal()}})}stampSeal(){var a;this.cameras.main.flash(100,255,200,200);const e=this.add.text(0,0,"âš”ï¸",{fontSize:"20px"}).setOrigin(.5);(a=this.waxSeal)==null||a.add(e),e.setScale(2),e.setAlpha(0),this.tweens.add({targets:e,scale:1,alpha:1,duration:200,ease:"Back.out",onComplete:()=>{this.time.delayedCall(500,()=>this.showResults())}})}showResults(){this.phase="result";const{width:e,height:a}=this.cameras.main;this.tweens.add({targets:[this.parchmentGroup,this.waxSeal],alpha:0,y:"+=50",duration:500}),this.time.delayedCall(600,()=>{this.displayEffects(),this.applyEffects()})}displayEffects(){const{width:e,height:a}=this.cameras.main;this.add.text(e/2,100,"LETTER SENT",{fontFamily:"Georgia, serif",fontSize:"24px",color:"#c9a959"}).setOrigin(.5);let i=160;this.effects.forEach((t,s)=>{this.time.delayedCall(s*200,()=>{const r=t.value>0||["letter_stamp","status_cure","injury_heal","resolve","buff"].includes(t.type),o=r?"âœ“":"âœ—",d=r?"#6b8e23":"#cd5c5c",l=this.add.text(e/2,i,`${o} ${t.description}`,{fontFamily:"Georgia, serif",fontSize:"14px",color:d}).setOrigin(.5);l.setAlpha(0),this.tweens.add({targets:l,alpha:1,x:e/2,duration:300,ease:"Back.out"}),i+=35})}),this.time.delayedCall(this.effects.length*200+500,()=>{T.createButton(this,e/2,a-80,"CONTINUE",()=>{this.goBack()},{width:160,height:50,primary:!0})})}applyEffects(){const e=p.getRun();let a=0,i=0;this.effects.forEach(r=>{switch(r.type){case"trust":i+=r.value;break;case"gold":a+=r.value;break;case"hp":this.fighter.currentStats&&(this.fighter.currentStats.currentHP=Math.min(this.fighter.currentStats.maxHP,this.fighter.currentStats.currentHP+r.value));break;case"letter_stamp":p.addLetterStamps(r.value),p.addSeals(r.value);break;case"debt":p.addDebt(Math.abs(r.value),2);break;case"resolve":p.reduceFatigue(15);break}}),p.reduceFatigue(15),i!==0&&(this.fighter.trust=Math.max(0,Math.min(100,this.fighter.trust+i)));const t={id:`letter_${Date.now()}`,type:this.selectedTemplate.type,templateId:this.selectedTemplate.id,content:this.letterContent||"",fighterName:this.fighter.fullName,fighterId:this.fighter.id,weekWritten:e.week,wasRead:!1,effects:this.effects,timestamp:Date.now()},s=[...e.lettersWritten,t];p.updateRun({fighter:this.fighter,gold:e.gold+a,lettersWritten:s,lastCampAction:"letter"}),p.incrementLetterCount(this.selectedTemplate.type),this.checkMilestones()}checkMilestones(){if(!this.selectedTemplate)return;const e=p.getLetterCount(this.selectedTemplate.type);for(const a of this.selectedTemplate.milestoneRewards)e>=a.count&&!p.hasLetterReward(a.reward.id)&&(p.unlockLetterReward(a.reward.id),this.time.delayedCall(1e3,()=>{T.showNotification(this,`ðŸŽ‰ UNLOCKED: ${a.reward.name}!`,3e3)}))}goBack(){this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("CampScene")})}}const le=[{id:"iron_ring",name:"Iron Ring",description:"+5 Defense",rarity:"common",icon:"ðŸ’",auraColor:"#808080",particleType:"none",statModifiers:{defense:5},lore:"Simple iron, but reassuring."},{id:"fighters_tooth",name:"Fighter's Tooth",description:"+3 Attack",rarity:"common",icon:"ðŸ¦·",auraColor:"#f5f5dc",particleType:"none",statModifiers:{attack:3},lore:"A trophy from your first kill."},{id:"worn_boots",name:"Worn Boots",description:"+2 Speed, +5 Evasion",rarity:"common",icon:"ðŸ‘¢",auraColor:"#8b4513",particleType:"none",statModifiers:{speed:2,evasion:5},lore:"Comfortable and broken in."},{id:"lucky_coin",name:"Lucky Coin",description:"+10% Gold rewards",rarity:"common",icon:"ðŸª™",auraColor:"#ffd700",particleType:"sparkle",passiveEffect:"gold_bonus_10",lore:"Tails you win."},{id:"bandolier",name:"Bandolier",description:"+1 Item slot, items 10% more effective",rarity:"common",icon:"ðŸŽ’",auraColor:"#654321",particleType:"none",passiveEffect:"extra_item_slot",lore:"Room for more tricks."},{id:"crowd_favor",name:"Crowd's Favor",description:"+15% Hype gain",rarity:"common",icon:"ðŸ“£",auraColor:"#ffa500",particleType:"sparkle",passiveEffect:"hype_bonus_15",lore:"They love you. For now."},{id:"blood_amulet",name:"Blood Amulet",description:"Heal 5 HP on kill",rarity:"uncommon",icon:"ðŸ“¿",auraColor:"#8b0000",particleType:"blood",triggerEffect:{condition:"on_kill",effect:"heal",value:5},lore:"Drinks deep from the dying."},{id:"berserker_band",name:"Berserker Band",description:"+20% damage when below 50% HP",rarity:"uncommon",icon:"ðŸ”´",auraColor:"#ff4500",particleType:"flame",triggerEffect:{condition:"on_low_hp",effect:"damage_boost",value:20},lore:"Pain is just weakness leaving."},{id:"focused_lens",name:"Focused Lens",description:"+10 Accuracy, +5% Crit Chance",rarity:"uncommon",icon:"ðŸ”",auraColor:"#87ceeb",particleType:"sparkle",statModifiers:{accuracy:10,critChance:5},lore:"See the gaps in their defense."},{id:"shadow_cloak",name:"Shadow Cloak",description:"+15 Evasion, 20% chance to dodge on turn start",rarity:"uncommon",icon:"ðŸ§¥",auraColor:"#2f2f4f",particleType:"shadow",statModifiers:{evasion:15},triggerEffect:{condition:"on_turn_start",effect:"auto_dodge",value:1,chance:.2},lore:"Become one with darkness."},{id:"wrath_stone",name:"Wrath Stone",description:"Gain +2 Focus per hit taken",rarity:"uncommon",icon:"ðŸ’Ž",auraColor:"#9932cc",particleType:"sparkle",passiveEffect:"focus_on_hit",lore:"Channel your rage."},{id:"healers_charm",name:"Healer's Charm",description:"All healing +30%",rarity:"uncommon",icon:"ðŸ’š",auraColor:"#32cd32",particleType:"holy",passiveEffect:"healing_boost_30",lore:"Blessed by temple healers."},{id:"warriors_belt",name:"Warrior's Belt",description:"+20 Max Stamina, Stamina regen +20%",rarity:"uncommon",icon:"ðŸ¥‹",auraColor:"#8b4513",particleType:"none",statModifiers:{maxStamina:20},passiveEffect:"stamina_regen_20",lore:"Hold everything together."},{id:"champions_medal",name:"Champion's Medal",description:"+5 to all stats",rarity:"rare",icon:"ðŸ…",auraColor:"#ffd700",particleType:"sparkle",statModifiers:{attack:5,defense:5,speed:5,accuracy:5,evasion:5,maxHP:10,maxStamina:10},lore:"Earned by a true champion."},{id:"phoenix_feather",name:"Phoenix Feather",description:"Survive fatal blow once per fight with 20% HP",rarity:"rare",icon:"ðŸª¶",auraColor:"#ff6347",particleType:"flame",triggerEffect:{condition:"on_low_hp",effect:"death_save",value:20},lore:"Rise from the ashes."},{id:"vampiric_blade",name:"Vampiric Essence",description:"Heal 10% of damage dealt",rarity:"rare",icon:"ðŸ©¸",auraColor:"#8b0000",particleType:"blood",triggerEffect:{condition:"on_hit",effect:"lifesteal",value:10},lore:"Your wounds feed on theirs."},{id:"executioners_eye",name:"Executioner's Eye",description:"+50% damage to enemies below 30% HP",rarity:"rare",icon:"ðŸ‘ï¸",auraColor:"#4b0082",particleType:"shadow",triggerEffect:{condition:"on_hit",effect:"execute_bonus",value:50},lore:"See the moment of death."},{id:"mirror_shield",name:"Mirror Shield",description:"Perfect parries deal 150% counter damage",rarity:"rare",icon:"ðŸªž",auraColor:"#c0c0c0",particleType:"sparkle",triggerEffect:{condition:"on_parry",effect:"counter_boost",value:150},lore:"Return their violence twofold."},{id:"crowd_roar",name:"Crowd's Roar",description:"At 80+ Hype, +30% damage and heal 5 HP per turn",rarity:"rare",icon:"ðŸŽ­",auraColor:"#ffd700",particleType:"sparkle",passiveEffect:"crowd_power",lore:"Their cheers fuel your strength."},{id:"storm_caller",name:"Storm Caller",description:"Critical hits chain to deal 30% damage to all",rarity:"rare",icon:"âš¡",auraColor:"#1e90ff",particleType:"sparkle",triggerEffect:{condition:"on_crit",effect:"chain_lightning",value:30},lore:"Call down the thunder."},{id:"crown_of_blood",name:"Crown of Blood",description:"Killing an enemy fully heals you and grants +5 permanent HP",rarity:"legendary",icon:"ðŸ‘‘",auraColor:"#8b0000",particleType:"blood",triggerEffect:{condition:"on_kill",effect:"full_heal_plus",value:5},lore:"The arena throne, paid in blood."},{id:"gods_hand",name:"God's Hand",description:"Start every fight with full Focus. Special costs no Focus.",rarity:"legendary",icon:"âœ‹",auraColor:"#ffd700",particleType:"holy",passiveEffect:"unlimited_special",lore:"Touched by the divine."},{id:"shadow_twin",name:"Shadow Twin",description:"25% chance for attacks to hit twice",rarity:"legendary",icon:"ðŸ‘¥",auraColor:"#2f2f4f",particleType:"shadow",triggerEffect:{condition:"on_hit",effect:"double_strike",value:25,chance:.25},lore:"Your shadow fights beside you."},{id:"immortal_will",name:"Immortal Will",description:"Cannot die while you have Stamina. Damage drains Stamina instead.",rarity:"legendary",icon:"ðŸ’€",auraColor:"#4b0082",particleType:"shadow",passiveEffect:"stamina_as_hp",lore:"Death cannot claim the determined."},{id:"arena_heart",name:"Heart of the Arena",description:"Crowd Hype starts at 100 and never decreases. +50% all rewards.",rarity:"legendary",icon:"â¤ï¸â€ðŸ”¥",auraColor:"#ff4500",particleType:"flame",passiveEffect:"permanent_hype",lore:"The arena itself fights for you."}];le.filter(c=>c.rarity==="common").map(c=>c.id),le.filter(c=>c.rarity==="uncommon").map(c=>c.id),le.filter(c=>c.rarity==="rare").map(c=>c.id),le.filter(c=>c.rarity==="legendary").map(c=>c.id);const Zi={common:50,uncommon:35,rare:12,legendary:3};function es(c=0){const n={...Zi};n.legendary+=Math.floor(c/3),n.rare+=Math.floor(c/2);const e=Object.values(n).reduce((i,t)=>i+t,0);let a=Math.random()*e;for(const[i,t]of Object.entries(n))if(a-=t,a<=0)return i;return"common"}function ts(c=3,n=[]){const e=le.filter(i=>!n.includes(i.id)),a=[];for(let i=0;i<c&&e.length>0;i++){const t=es(),s=e.filter(r=>r.rarity===t);if(s.length>0){const r=Math.floor(Math.random()*s.length);a.push(s[r]);const o=e.findIndex(d=>d.id===s[r].id);e.splice(o,1)}else{const r=Math.floor(Math.random()*e.length);a.push(e[r]),e.splice(r,1)}}return a}const D=class D extends w.GameObjects.Container{constructor(e,a,i,t,s){super(e,a,i);m(this,"bg");m(this,"glowLayer");m(this,"particleEmitter");m(this,"relic");m(this,"callback");m(this,"revealed",!1);this.relic=t,this.callback=s,this.createCard(),e.add.existing(this)}createCard(){const e=D.WIDTH,a=D.HEIGHT,i=D.RARITY_COLORS[this.relic.rarity];this.glowLayer=this.scene.add.graphics(),this.add(this.glowLayer),this.animateGlow(i),this.bg=this.scene.add.graphics(),this.drawBackground(!1),this.add(this.bg);const t=this.scene.add.graphics();t.fillStyle(i,.8),t.fillRect(-e/2,-a/2,e,30),this.add(t);const s=this.scene.add.text(0,-a/2+15,this.relic.rarity.toUpperCase(),{fontFamily:"Georgia, serif",fontSize:"12px",color:"#ffffff",fontStyle:"bold"}).setOrigin(.5);this.add(s);const r=this.scene.add.text(0,-35,this.relic.icon,{fontSize:"48px"}).setOrigin(.5);this.add(r),this.createAuraEffect(i);const o=this.scene.add.text(0,15,this.relic.name,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#c9a959",fontStyle:"bold",wordWrap:{width:e-20},align:"center"}).setOrigin(.5);this.add(o);const d=this.scene.add.text(0,50,this.relic.description,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#ffffff",wordWrap:{width:e-30},align:"center"}).setOrigin(.5,0);this.add(d);const l=this.scene.add.text(0,a/2-30,`"${this.relic.lore}"`,{fontFamily:"Georgia, serif",fontSize:"9px",color:"#8b7355",fontStyle:"italic",wordWrap:{width:e-20},align:"center"}).setOrigin(.5);this.add(l),this.setupInteraction()}drawBackground(e){const a=D.WIDTH,i=D.HEIGHT,t=D.RARITY_COLORS[this.relic.rarity];this.bg.clear(),this.bg.fillStyle(0,.4),this.bg.fillRoundedRect(-a/2+4,-i/2+4,a,i,12);const s=e?3815994:2763306;this.bg.fillStyle(s,.95),this.bg.fillRoundedRect(-a/2,-i/2,a,i,12),this.bg.lineStyle(e?4:3,t,1),this.bg.strokeRoundedRect(-a/2,-i/2,a,i,12),this.bg.lineStyle(1,t,.3),this.bg.strokeRoundedRect(-a/2+8,-i/2+8,a-16,i-16,8)}animateGlow(e){const a=D.WIDTH,i=D.HEIGHT,t=s=>{this.glowLayer.clear(),this.glowLayer.fillStyle(e,s*.3),this.glowLayer.fillRoundedRect(-a/2-10,-i/2-10,a+20,i+20,15)};this.scene.tweens.add({targets:{alpha:.5},alpha:1,duration:1e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut",onUpdate:s=>{const r=s.getValue();typeof r=="number"&&t(r)}}),t(.5)}createAuraEffect(e){const a=this.scene.add.graphics();this.add(a);let i=0;this.scene.time.addEvent({delay:50,callback:()=>{a.clear();for(let t=0;t<6;t++){const s=i+t*Math.PI/3,r=Math.cos(s)*40,o=Math.sin(s)*40-35;a.fillStyle(e,.5-t*.08),a.fillCircle(r,o,3-t*.3)}i+=.05},loop:!0})}setupInteraction(){const e=D.WIDTH,a=D.HEIGHT,i=new w.Geom.Rectangle(-e/2,-a/2,e,a);this.setSize(e,a),this.setInteractive(i,w.Geom.Rectangle.Contains),this.on("pointerover",()=>{this.drawBackground(!0),this.scene.tweens.add({targets:this,scaleX:1.05,scaleY:1.05,y:this.y-10,duration:150,ease:"Back.out"})}),this.on("pointerout",()=>{this.drawBackground(!1),this.scene.tweens.add({targets:this,scaleX:1,scaleY:1,y:this.y+10,duration:150})}),this.on("pointerdown",()=>{this.scene.tweens.add({targets:this,scaleX:.95,scaleY:.95,duration:50})}),this.on("pointerup",()=>{this.selectAnimation()})}selectAnimation(){const e=D.RARITY_COLORS[this.relic.rarity];for(let a=0;a<20;a++){const i=Math.random()*Math.PI*2,t=100+Math.random()*150,s=this.scene.add.graphics();s.fillStyle(e,1),s.fillCircle(0,0,4),this.add(s),this.scene.tweens.add({targets:s,x:Math.cos(i)*t,y:Math.sin(i)*t,alpha:0,scale:0,duration:500,ease:"Quad.out",onComplete:()=>s.destroy()})}this.scene.tweens.add({targets:this,scaleX:1.5,scaleY:1.5,alpha:0,duration:400,ease:"Quad.in",onComplete:()=>{this.callback()}})}reveal(){return new Promise(e=>{if(this.revealed){e();return}this.setScale(1,0),this.scene.tweens.add({targets:this,scaleY:1,duration:400,ease:"Back.out",delay:Math.random()*200,onComplete:()=>{this.revealed=!0,this.playRevealEffect(),e()}})})}playRevealEffect(){const e=D.RARITY_COLORS[this.relic.rarity],a=this.scene.add.graphics();a.fillStyle(e,.5),a.fillRoundedRect(-180/2,-240/2,D.WIDTH,D.HEIGHT,12),this.add(a),this.scene.tweens.add({targets:a,alpha:0,duration:300,onComplete:()=>a.destroy()}),this.relic.rarity==="legendary"&&this.scene.cameras.main.shake(200,.01)}};m(D,"WIDTH",180),m(D,"HEIGHT",240),m(D,"RARITY_COLORS",{common:8421504,uncommon:2031360,rare:28893,legendary:16744448});let ze=D;class as extends w.Scene{constructor(){super({key:"RelicChoiceScene"});m(this,"relicChoices",[]);m(this,"relicCards",[]);m(this,"selectedRelic")}create(){const e=p.getRun();this.relicChoices=ts(3,e.relics),this.createBackground(),this.createHeader(),this.revealRelics(),this.cameras.main.fadeIn(300)}createBackground(){const{width:e,height:a}=this.cameras.main,i=this.add.graphics();i.fillGradientStyle(657429,657429,1708069,1708069),i.fillRect(0,0,e,a);for(let s=0;s<50;s++){const r=this.add.graphics();r.fillStyle(10040012,Math.random()*.3),r.fillCircle(0,0,2),r.setPosition(Math.random()*e,Math.random()*a),this.tweens.add({targets:r,y:r.y-100,alpha:0,duration:3e3+Math.random()*2e3,repeat:-1,delay:Math.random()*2e3})}const t=this.add.graphics();t.fillStyle(0,.5),t.fillRect(0,0,e,60),t.fillRect(0,a-60,e,60)}createHeader(){const{width:e}=this.cameras.main,a=this.add.text(e/2,50,"CHOOSE A RELIC",{fontFamily:"Georgia, serif",fontSize:"28px",color:"#c9a959",stroke:"#000000",strokeThickness:4}).setOrigin(.5);this.tweens.add({targets:a,alpha:{from:1,to:.8},duration:1e3,yoyo:!0,repeat:-1}),this.add.text(e/2,85,"A mysterious power calls to you...",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b7355",fontStyle:"italic"}).setOrigin(.5)}async revealRelics(){const{width:e,height:a}=this.cameras.main,i=200,t=e/2-i;for(let s=0;s<this.relicChoices.length;s++){const r=this.relicChoices[s],o=t+s*i,d=new ze(this,o,a/2,r,()=>{this.selectRelic(r,s)});d.setScale(1,0),this.relicCards.push(d)}await this.playRevealSequence()}async playRevealSequence(){this.cameras.main.flash(200,150,100,200);for(let e=0;e<this.relicCards.length;e++)await this.delay(300),await this.relicCards[e].reveal();this.time.delayedCall(500,()=>{this.createSkipButton()})}delay(e){return new Promise(a=>{this.time.delayedCall(e,a)})}createSkipButton(){const{width:e,height:a}=this.cameras.main;T.createButton(this,e/2,a-50,"SKIP (No Relic)",()=>this.skipRelic(),{width:150,height:40,fontSize:"11px"})}selectRelic(e,a){this.selectedRelic||(this.selectedRelic=e,this.relicCards.forEach((i,t)=>{t!==a&&this.tweens.add({targets:i,alpha:0,y:i.y+50,duration:300})}),p.addRelic(e.id),this.time.delayedCall(500,()=>{this.showAcquisitionEffect(e)}))}showAcquisitionEffect(e){const{width:a,height:i}=this.cameras.main,t=this.add.text(a/2,i/2,e.icon,{fontSize:"64px"}).setOrigin(.5);t.setScale(0),this.tweens.add({targets:t,scale:2,duration:500,ease:"Back.out"});const s=this.add.text(a/2,i/2+80,e.name,{fontFamily:"Georgia, serif",fontSize:"24px",color:"#c9a959"}).setOrigin(.5);s.setAlpha(0),this.tweens.add({targets:s,alpha:1,duration:300,delay:300}),this.time.delayedCall(1500,()=>{this.returnToCamp()})}skipRelic(){T.showConfirmDialog(this,"Skip Relic?","Are you sure you want to pass on this opportunity?",()=>this.returnToCamp(),()=>{},"YES, SKIP")}returnToCamp(){p.updateRun({fightsSinceRelic:0}),this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("CampScene")})}}const is=[{id:"footwork",name:"Footwork Drills",icon:"ðŸ‘£",description:"Practice agility and positioning. Improves dodge and unlocks counter techniques.",statChanges:{dodge:3,speed:2,accuracy:1},fatigueCost:15,injuryRisk:.05,techniqueId:"sidestep_counter",previewText:"+3 Dodge, +2 Speed, +1 Acc | Unlocks Sidestep Counter",trainingText:"You spend hours dancing between training posts, learning to move without thinking."},{id:"guard_parry",name:"Guard & Parry",icon:"ðŸ›¡ï¸",description:"Master defensive timing. Wider parry window and bonus focus on perfect parries.",statChanges:{defense:3,accuracy:-1},fatigueCost:20,injuryRisk:.1,techniqueId:"riposte_mastery",previewText:"+3 Defense, -1 Acc | Unlocks Riposte Mastery",trainingText:"Wooden swords crack against your shield as you perfect your timing."},{id:"power_strikes",name:"Power Strikes",icon:"ðŸ’ª",description:"Train raw strength. Heavy attacks gain armor break but cost more stamina.",statChanges:{attack:4,maxStamina:-5},fatigueCost:25,injuryRisk:.15,techniqueId:"crushing_blow",previewText:"+4 Attack, -5 Max Stamina | Unlocks Crushing Blow",trainingText:"You lift stones and swing weighted weapons until your arms scream."},{id:"bleed_craft",name:"Bleed Craft",icon:"ðŸ©¸",description:"Learn to cut deep. Light attacks have a chance to cause bleeding.",statChanges:{attack:1,accuracy:2},fatigueCost:15,injuryRisk:.08,techniqueId:"arterial_strike",previewText:"+1 Attack, +2 Acc | Unlocks Arterial Strike",trainingText:"The trainer shows you exactly where to cut for maximum effect."},{id:"endurance",name:"Endurance Training",icon:"ðŸƒ",description:"Build stamina and resilience. More stamina, faster recovery.",statChanges:{maxStamina:15,maxHP:10,attack:-1},fatigueCost:30,injuryRisk:.03,techniqueId:"second_wind",previewText:"+15 Stamina, +10 HP, -1 Attack | Unlocks Second Wind",trainingText:"Run. Lift. Carry. Repeat. Your body adapts to the punishment."},{id:"crowd_play",name:"Crowd Play",icon:"ðŸŽ­",description:"Learn to work the audience. Hype builds faster, special moves cost less.",statChanges:{maxFocus:10,accuracy:1},fatigueCost:10,injuryRisk:.02,techniqueId:"showmanship",previewText:"+10 Focus, +1 Acc | Unlocks Showmanship",trainingText:"An old performer teaches you how to make the crowd love you."}],Ht=[{id:"sidestep_counter",name:"Sidestep Counter",icon:"â†ªï¸",description:"After a successful dodge, your next attack deals bonus damage.",maxLevel:3,effects:[{level:1,description:"+15% damage after dodge",modifier:{type:"counter_damage",value:15}},{level:2,description:"+25% damage after dodge",modifier:{type:"counter_damage",value:25}},{level:3,description:"+35% damage after dodge, costs no stamina",modifier:{type:"counter_damage",value:35}}],combatModifier:{trigger:"on_dodge"}},{id:"riposte_mastery",name:"Riposte Mastery",icon:"âš”ï¸",description:"Perfect parries grant focus and allow an instant counter-attack.",maxLevel:3,effects:[{level:1,description:"+10 Focus on perfect parry",modifier:{type:"focus_gain",value:10}},{level:2,description:"+15 Focus, 20% stun chance",modifier:{type:"focus_gain",value:15}},{level:3,description:"+20 Focus, 35% stun, free counter",modifier:{type:"focus_gain",value:20}}],combatModifier:{trigger:"on_parry"}},{id:"crushing_blow",name:"Crushing Blow",icon:"ðŸ’¥",description:"Heavy attacks break through armor and can stagger enemies.",maxLevel:3,effects:[{level:1,description:"Heavy ignores 20% armor",modifier:{type:"armor_break",value:20}},{level:2,description:"Heavy ignores 35% armor",modifier:{type:"armor_break",value:35}},{level:3,description:"Heavy ignores 50% armor, 25% stun",modifier:{type:"armor_break",value:50}}],combatModifier:{action:"heavy_attack"}},{id:"arterial_strike",name:"Arterial Strike",icon:"ðŸ©¸",description:"Light attacks have a chance to cause bleeding damage over time.",maxLevel:3,effects:[{level:1,description:"15% bleed chance on light",modifier:{type:"bleed_chance",value:15}},{level:2,description:"25% bleed, stronger effect",modifier:{type:"bleed_chance",value:25}},{level:3,description:"35% bleed, can stack 3x",modifier:{type:"bleed_chance",value:35}}],combatModifier:{action:"light_attack"}},{id:"second_wind",name:"Second Wind",icon:"ðŸ’¨",description:"Recover stamina when low, gaining a burst of energy.",maxLevel:3,effects:[{level:1,description:"Recover 15 stamina when below 20%",modifier:{type:"stamina_cost",value:-15}},{level:2,description:"Recover 25 stamina, +10 HP",modifier:{type:"stamina_cost",value:-25}},{level:3,description:"Recover 35 stamina, +15 HP, once per fight",modifier:{type:"stamina_cost",value:-35}}],combatModifier:{passive:!0}},{id:"showmanship",name:"Showmanship",icon:"âœ¨",description:"Special moves cost less focus and generate more crowd hype.",maxLevel:3,effects:[{level:1,description:"-5 focus cost, +10% hype",modifier:{type:"hype_bonus",value:10}},{level:2,description:"-10 focus cost, +20% hype",modifier:{type:"hype_bonus",value:20}},{level:3,description:"-15 focus cost, +30% hype, gold bonus",modifier:{type:"hype_bonus",value:30}}],combatModifier:{action:"special"}}],kt=[{id:"bruised_ribs",name:"Bruised Ribs",effect:"-5 Max Stamina for 1 fight",duration:1},{id:"sprained_wrist",name:"Sprained Wrist",effect:"-2 Attack for 1 fight",duration:1},{id:"twisted_ankle",name:"Twisted Ankle",effect:"-3 Dodge for 1 fight",duration:1},{id:"sore_muscles",name:"Sore Muscles",effect:"-1 to all stats for 1 fight",duration:1},{id:"black_eye",name:"Black Eye",effect:"-3 Accuracy for 1 fight",duration:1}];function me(c){return Ht.find(n=>n.id===c)}function ss(c,n){const e=me(c);if(e)return e.effects.find(a=>a.level===n)}function ns(c){return Math.random()<c?kt[Math.floor(Math.random()*kt.length)]:null}class rs extends w.Scene{constructor(){super({key:"TrainingScene"});m(this,"fighter");m(this,"selectedProgram",null);m(this,"trainingDummy");m(this,"detailPanel")}create(){const e=p.getRun();if(!e.fighter){this.scene.start("CampScene");return}this.fighter=e.fighter,this.createBackground(),this.createHeader(),this.createTrainingDummy(),this.createProgramCards(),this.createFatigueDisplay(),this.createBackButton(),this.cameras.main.fadeIn(300)}createBackground(){const{width:e,height:a}=this.cameras.main,i=this.add.graphics();i.fillGradientStyle(2762016,2762016,1709328,1709328),i.fillRect(0,0,e,a),i.fillStyle(3811866,1),i.fillRect(0,a*.5,e,a*.5),i.lineStyle(1,2759178,.5);for(let t=0;t<10;t++){const s=a*.5+t*30;i.moveTo(0,s),i.lineTo(e,s)}i.strokePath(),this.drawWeaponRack(50,a*.35),this.createTorch(40,a*.2),this.createTorch(e-40,a*.2)}drawWeaponRack(e,a){const i=this.add.graphics();i.fillStyle(3811866,1),i.fillRect(e-25,a,50,120),i.lineStyle(2,2759178,1),i.strokeRect(e-25,a,50,120),i.lineStyle(4,8421504,1),i.moveTo(e-15,a+20),i.lineTo(e-15,a+100),i.strokePath(),i.moveTo(e,a+15),i.lineTo(e,a+105),i.strokePath(),i.moveTo(e+15,a+25),i.lineTo(e+15,a+95),i.strokePath()}createTorch(e,a){const i=this.add.container(e,a),t=this.add.graphics();t.fillStyle(4864554,1),t.fillRect(-8,0,16,25),i.add(t);const s=this.add.graphics(),r=o=>{s.clear(),s.fillStyle(16737792,.2*o),s.fillCircle(0,-10,30*o),s.fillStyle(16755200,.3*o),s.fillCircle(0,-10,15)};this.tweens.add({targets:{i:1},i:1.3,duration:200,yoyo:!0,repeat:-1,onUpdate:o=>{const d=o.getValue();typeof d=="number"&&r(d)}}),r(1),i.add(s)}createHeader(){const{width:e}=this.cameras.main,a=E();this.add.text(e/2,a.top+20,"TRAINING YARD",{fontFamily:"Georgia, serif",fontSize:"22px",color:"#c9a959",stroke:"#000000",strokeThickness:2}).setOrigin(.5),this.add.text(e/2,a.top+48,"Choose a training program",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b7355"}).setOrigin(.5)}createTrainingDummy(){const{width:e,height:a}=this.cameras.main;this.trainingDummy=this.add.container(e*.75,a*.38);const i=this.add.graphics();i.fillStyle(3811866,1),i.fillRect(-8,0,16,100),this.trainingDummy.add(i);const t=this.add.graphics();t.fillStyle(6969930,1),t.fillEllipse(0,-20,50,70),t.fillRect(-40,-30,20,10),t.fillRect(20,-30,20,10),t.fillCircle(0,-65,20),t.lineStyle(2,9109504,.5),t.strokeCircle(0,-30,15),t.strokeCircle(0,10,12),this.trainingDummy.add(t),this.tweens.add({targets:this.trainingDummy,rotation:.03,duration:2e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}createProgramCards(){const{width:e,height:a}=this.cameras.main,i=ye(this),t=Math.min(160,(i.width-30)/2),s=90,r=2,o=i.x+t/2+10,d=a*.52,l=t+10,h=s+10,u=p.getFatigue();is.forEach((f,g)=>{const y=g%r,S=Math.floor(g/r),b=o+y*l,M=d+S*h,C=u+f.fatigueCost<=100,x=p.getTechniqueLevel(f.techniqueId),R=me(f.techniqueId);this.createProgramCard(b,M,t,s,f,C,x,(R==null?void 0:R.maxLevel)||3)})}createProgramCard(e,a,i,t,s,r,o,d){const l=this.add.container(e,a),h=this.add.graphics(),u=r?2760474:1709328;h.fillStyle(u,.95),h.fillRoundedRect(-i/2,-t/2,i,t,8),h.lineStyle(2,r?5917242:3811866,1),h.strokeRoundedRect(-i/2,-t/2,i,t,8),l.add(h);const f=this.add.text(-i/2+15,-t/2+12,s.icon,{fontSize:"20px"});l.add(f);const g=this.add.text(-i/2+40,-t/2+10,s.name,{fontFamily:"Georgia, serif",fontSize:"11px",color:r?"#c9a959":"#5a4a3a"});l.add(g);const y=this.add.text(i/2-15,-t/2+10,"",{fontFamily:"Georgia, serif",fontSize:"10px",color:"#c9a959"}).setOrigin(1,0);let S="";for(let x=0;x<d;x++)S+=x<o?"â—":"â—‹";y.setText(S),l.add(y);const b=this.formatStatChanges(s.statChanges),M=this.add.text(0,-5,b,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355",align:"center"}).setOrigin(.5);l.add(M);const C=this.add.text(-i/2+10,t/2-22,`âš¡${s.fatigueCost}`,{fontFamily:"Georgia, serif",fontSize:"9px",color:r?"#daa520":"#5a3a1a"});if(l.add(C),s.injuryRisk>.1){const x=this.add.text(i/2-10,t/2-22,"âš ï¸",{fontSize:"10px"}).setOrigin(1,0);l.add(x)}return r?(l.setSize(i,t),l.setInteractive(new w.Geom.Rectangle(-i/2,-t/2,i,t),w.Geom.Rectangle.Contains),l.on("pointerover",()=>{h.clear(),h.fillStyle(3813162,.95),h.fillRoundedRect(-i/2,-t/2,i,t,8),h.lineStyle(2,13216089,1),h.strokeRoundedRect(-i/2,-t/2,i,t,8),this.showProgramDetail(s,o)}),l.on("pointerout",()=>{h.clear(),h.fillStyle(u,.95),h.fillRoundedRect(-i/2,-t/2,i,t,8),h.lineStyle(2,5917242,1),h.strokeRoundedRect(-i/2,-t/2,i,t,8),this.hideProgramDetail()}),l.on("pointerdown",()=>{this.selectProgram(s)})):l.setAlpha(.6),l}formatStatChanges(e){const a=[];return e.attack&&a.push(`${e.attack>0?"+":""}${e.attack} ATK`),e.defense&&a.push(`${e.defense>0?"+":""}${e.defense} DEF`),e.accuracy&&a.push(`${e.accuracy>0?"+":""}${e.accuracy} ACC`),e.dodge&&a.push(`${e.dodge>0?"+":""}${e.dodge} DOD`),e.speed&&a.push(`${e.speed>0?"+":""}${e.speed} SPD`),e.maxStamina&&a.push(`${e.maxStamina>0?"+":""}${e.maxStamina} STA`),e.maxHP&&a.push(`${e.maxHP>0?"+":""}${e.maxHP} HP`),e.maxFocus&&a.push(`${e.maxFocus>0?"+":""}${e.maxFocus} FOC`),a.join(", ")}showProgramDetail(e,a){this.hideProgramDetail();const{width:i,height:t}=this.cameras.main,s=Math.min(280,i-40),r=120;this.detailPanel=this.add.container(i/2,t*.35);const o=this.add.graphics();o.fillStyle(1709072,.95),o.fillRoundedRect(-s/2,-r/2,s,r,10),o.lineStyle(2,13216089,1),o.strokeRoundedRect(-s/2,-r/2,s,r,10),this.detailPanel.add(o);const d=this.add.text(0,-r/2+15,e.name,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#c9a959"}).setOrigin(.5);this.detailPanel.add(d);const l=this.add.text(0,-15,e.description,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355",wordWrap:{width:s-30},align:"center"}).setOrigin(.5);this.detailPanel.add(l);const h=me(e.techniqueId);if(h){const u=a+1,f=ss(e.techniqueId,u);let g=`${h.icon} ${h.name}`;f?g+=` (Lv.${u}): ${f.description}`:a>=h.maxLevel&&(g+=" (MAXED)");const y=this.add.text(0,r/2-25,g,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#6495ed",wordWrap:{width:s-20},align:"center"}).setOrigin(.5);this.detailPanel.add(y)}}hideProgramDetail(){var e;(e=this.detailPanel)==null||e.destroy(),this.detailPanel=void 0}createFatigueDisplay(){const{width:e}=this.cameras.main,a=E(),i=p.getFatigue();this.add.text(e/2,a.top+72,"FATIGUE",{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355"}).setOrigin(.5);const t=150,s=12,r=e/2-t/2,o=a.top+85,d=this.add.graphics();d.fillStyle(2760474,1),d.fillRoundedRect(r,o,t,s,4);const l=this.add.graphics(),h=i>70?9109504:i>40?14329120:2263842;l.fillStyle(h,1),l.fillRoundedRect(r+2,o+2,(t-4)*(i/100),s-4,3),this.add.text(e/2+t/2+10,o+s/2,`${i}%`,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355"}).setOrigin(0,.5),i>=80&&this.add.text(e/2,o+20,"âš ï¸ High fatigue reduces stamina regen!",{fontFamily:"Georgia, serif",fontSize:"9px",color:"#daa520"}).setOrigin(.5)}selectProgram(e){this.selectedProgram=e,this.trainingDummy&&this.tweens.add({targets:this.trainingDummy,rotation:.3,duration:100,yoyo:!0,repeat:2,ease:"Quad.out"}),this.showTrainingConfirmation(e)}showTrainingConfirmation(e){const{width:a,height:i}=this.cameras.main;T.showConfirmDialog(this,`Train: ${e.name}?`,`${e.previewText}

Fatigue +${e.fatigueCost}%`+(e.injuryRisk>.1?`
Injury Risk: ${Math.round(e.injuryRisk*100)}%`:""),()=>this.completeTraining(e),()=>{this.selectedProgram=null},"TRAIN")}completeTraining(e){const a=p.getRun();if(!a.fighter)return;const i={};for(const[l,h]of Object.entries(e.statChanges))if(typeof h=="number"){const u=l;typeof a.fighter.currentStats[u]=="number"&&(a.fighter.currentStats[u]+=h,i[l]=h)}const t=p.getTechniqueLevel(e.techniqueId),s=me(e.techniqueId);let r=t;s&&t<s.maxLevel&&(r=t+1,p.setTechniqueLevel(e.techniqueId,r)),p.addTrainingHistory({programId:e.id,programName:e.name,timestamp:Date.now(),statChanges:i,techniqueUnlocked:s==null?void 0:s.name,techniqueLevel:r}),p.addFatigue(e.fatigueCost);const o=ns(e.injuryRisk);o&&(p.addSparringInjury(o.id),T.showNotification(this,`âš ï¸ ${o.name}: ${o.effect}`,3e3)),Te(a.fighter,3),p.updateRun({fighter:a.fighter,week:a.week+1,lastCampAction:"train"});const d=this.formatStatDelta(i,(s==null?void 0:s.name)||"",r);T.showNotification(this,`${e.trainingText}

${d}`,3500),this.time.delayedCall(3500,()=>{this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("CampScene")})})}formatStatDelta(e,a,i){const t=["ðŸ“Š STAT CHANGES:"];for(const[s,r]of Object.entries(e)){const o=r>0?"+":"";t.push(`  ${s}: ${o}${r}`)}return a&&i>0&&t.push(`
ðŸŽ¯ ${a} Lv.${i}`),t.join(`
`)}createBackButton(){const e=E();new Gt(this,e.left+50,oe(this,30),"â† BACK",()=>{this.cameras.main.fadeOut(200),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("CampScene")})},{width:90,height:44,fontSize:12})}}const Lt=[{id:"brute",name:"Brute",title:"The Crusher",icon:"ðŸ’ª",description:"A massive fighter who relies on raw power. Devastating damage but poor stamina management.",preferredWeaponTypes:["hammer","axe","greatsword"],preferredArmorTypes:["light","medium"],statMods:{hp:20,attack:8,defense:-2,stamina:-15,speed:-2,accuracy:-10},passives:[{id:"crushing_blows",name:"Crushing Blows",description:"Heavy attacks deal 25% more damage",effect:"heavy_damage_bonus"}],strengths:[{type:"high_damage",description:"Devastating heavy attacks",value:25}],weaknesses:[{type:"dodge",description:"Slow attacks easy to dodge",damageMultiplier:1,effectChanceMultiplier:1.3},{type:"parry",description:"Telegraphed swings easy to parry",damageMultiplier:1,effectChanceMultiplier:1.25},{type:"stamina_drain",description:"Burns out quickly",damageMultiplier:1,effectChanceMultiplier:1}],behavior:{preferredActions:[{action:"heavy_attack",weight:50},{action:"light_attack",weight:25},{action:"guard",weight:15},{action:"dodge",weight:10}],enrageThreshold:30,enrageEffect:"Attack +20%, but accuracy -15%"},taunts:["I'll crush you!","You're nothing but a bug.","One hit is all I need."],enrageTaunts:["NOW YOU DIE!","RAAARGH!"],leagueMin:"bronze",leagueWeight:{bronze:25,silver:15,gold:10}},{id:"duelist",name:"Duelist",title:"The Blade Dancer",icon:"ðŸ¤º",description:"A technical fighter with excellent parry and dodge. Weak against armor-breaking attacks.",preferredWeaponTypes:["sword","dagger","spear"],preferredArmorTypes:["light"],statMods:{hp:-10,attack:0,defense:-3,stamina:10,speed:4,accuracy:15,critChance:10,dodge:15},passives:[{id:"riposte",name:"Riposte",description:"Successful parries deal counter damage",effect:"parry_counter"}],strengths:[{type:"high_dodge",description:"Excellent evasion",value:15},{type:"parry_master",description:"Master parrier",value:20}],weaknesses:[{type:"armor_break",description:"Light armor breaks easily",damageMultiplier:1.25,effectChanceMultiplier:1.5},{type:"stun",description:"Stunned easily",damageMultiplier:1,effectChanceMultiplier:1.4}],behavior:{preferredActions:[{action:"light_attack",weight:35},{action:"dodge",weight:30},{action:"guard",weight:20,condition:"player_guarding"},{action:"heavy_attack",weight:10},{action:"special",weight:5}]},taunts:["Your form is sloppy.","I'll dance circles around you.","Try to hit me."],leagueMin:"bronze",leagueWeight:{bronze:15,silver:25,gold:20}},{id:"shieldbearer",name:"Shieldbearer",title:"The Wall",icon:"ðŸ›¡ï¸",description:"A defensive specialist who relies on their shield. Vulnerable to guard-crushing attacks.",preferredWeaponTypes:["sword","mace"],preferredArmorTypes:["heavy"],statMods:{hp:15,attack:-3,defense:12,stamina:-5,speed:-2,accuracy:5},passives:[{id:"shield_wall",name:"Shield Wall",description:"Guard blocks 75% damage instead of 60%",effect:"improved_guard"}],strengths:[{type:"high_defense",description:"Incredible blocking",value:75},{type:"armor",description:"Heavy armor",value:12}],weaknesses:[{type:"armor_break",description:"Armor break devastates",damageMultiplier:1.3,effectChanceMultiplier:1.5},{type:"pressure",description:"Aggressive combos overwhelm",damageMultiplier:1.1,effectChanceMultiplier:1}],behavior:{preferredActions:[{action:"guard",weight:45},{action:"light_attack",weight:30},{action:"heavy_attack",weight:15},{action:"dodge",weight:10}]},taunts:["You can't break through.","My shield has never failed.","Come and try."],leagueMin:"bronze",leagueWeight:{bronze:20,silver:20,gold:15}},{id:"berserker",name:"Berserker",title:"The Mad",icon:"ðŸ˜¤",description:"A wild fighter who grows stronger as they take damage. Control effects shut them down.",preferredWeaponTypes:["axe","greatsword","hammer"],preferredArmorTypes:["light","furs"],statMods:{hp:10,attack:5,defense:-5,stamina:15,speed:2,accuracy:-5},passives:[{id:"blood_rage",name:"Blood Rage",description:"Gains +5% damage for every 10% HP lost",effect:"low_hp_damage_boost"}],strengths:[{type:"enrage",description:"Stronger when wounded",value:50},{type:"stamina",description:"High endurance",value:15}],weaknesses:[{type:"stun",description:"Rage interrupted by stuns",damageMultiplier:1,effectChanceMultiplier:1.5},{type:"poison",description:"Poison drains rage",damageMultiplier:1.2,effectChanceMultiplier:1.3}],behavior:{preferredActions:[{action:"heavy_attack",weight:40},{action:"light_attack",weight:35},{action:"special",weight:15,condition:"low_hp"},{action:"dodge",weight:10}],enrageThreshold:50,enrageEffect:"Attack +30%, Speed +2, Defense -5"},taunts:["BLOOD!","Pain makes me stronger!","You'll feed my rage!"],enrageTaunts:["YES! MORE!","I CANNOT BE STOPPED!"],leagueMin:"bronze",leagueWeight:{bronze:15,silver:20,gold:25}},{id:"spearman",name:"Spearman",title:"The Reacher",icon:"ðŸ”±",description:"A fighter with superior reach who strikes first. Vulnerable when pressured up close.",preferredWeaponTypes:["spear"],preferredArmorTypes:["medium"],statMods:{hp:0,attack:2,defense:0,stamina:5,speed:5,accuracy:12},passives:[{id:"reach_advantage",name:"Reach Advantage",description:"Always attacks first in a round",effect:"first_strike"}],strengths:[{type:"first_strike",description:"Always strikes first",value:100},{type:"high_dodge",description:"Can keep distance",value:10}],weaknesses:[{type:"pressure",description:"Collapses under pressure",damageMultiplier:1.15,effectChanceMultiplier:1},{type:"momentum",description:"Loses to momentum",damageMultiplier:1.2,effectChanceMultiplier:1}],behavior:{preferredActions:[{action:"light_attack",weight:45},{action:"heavy_attack",weight:25},{action:"dodge",weight:20},{action:"guard",weight:10}]},taunts:["You can't reach me.","Stay back!","I strike before you move."],leagueMin:"bronze",leagueWeight:{bronze:20,silver:20,gold:15}},{id:"executioner",name:"Executioner",title:"The Dread",icon:"ðŸ’€",description:"A terrifying fighter with fear-inducing presence. Burns stamina quickly.",preferredWeaponTypes:["axe","greatsword","hammer"],preferredArmorTypes:["heavy"],statMods:{hp:20,attack:10,defense:5,stamina:-20,speed:-3,accuracy:0,critChance:15},passives:[{id:"dread_presence",name:"Dread Presence",description:"Enemy loses 5 focus when hit",effect:"fear_aura"}],strengths:[{type:"fear",description:"Drains focus",value:5},{type:"high_damage",description:"Massive damage",value:20}],weaknesses:[{type:"stamina_drain",description:"Exhausts quickly",damageMultiplier:1,effectChanceMultiplier:1},{type:"dodge",description:"Slow and predictable",damageMultiplier:1,effectChanceMultiplier:1.3}],behavior:{preferredActions:[{action:"heavy_attack",weight:55},{action:"light_attack",weight:20},{action:"guard",weight:15,condition:"low_stamina"},{action:"special",weight:10}]},taunts:["Your execution awaits.","I am death.","Fear me."],leagueMin:"silver",leagueWeight:{bronze:5,silver:20,gold:25}},{id:"trickster",name:"Trickster",title:"The Cunning",icon:"ðŸŽ­",description:"A dirty fighter who uses poison and debuffs. Weak raw defense.",preferredWeaponTypes:["dagger","flail"],preferredArmorTypes:["light"],statMods:{hp:-15,attack:-2,defense:-5,stamina:10,speed:4,accuracy:10,critChance:20,dodge:10},passives:[{id:"dirty_tricks",name:"Dirty Tricks",description:"25% chance to apply random debuff on hit",effect:"random_debuff"}],strengths:[{type:"poison",description:"Poison attacks",value:35},{type:"high_dodge",description:"Slippery",value:10}],weaknesses:[{type:"armor_break",description:"No armor to break",damageMultiplier:1.2,effectChanceMultiplier:1},{type:"pressure",description:"Crumbles under aggression",damageMultiplier:1.25,effectChanceMultiplier:1}],behavior:{preferredActions:[{action:"light_attack",weight:40},{action:"dodge",weight:30},{action:"special",weight:20},{action:"heavy_attack",weight:10}]},taunts:["Let's play a game.","Trust nothing.","Surprise!"],leagueMin:"silver",leagueWeight:{bronze:5,silver:20,gold:20}},{id:"knight",name:"Knight",title:"The Honorable",icon:"ðŸ°",description:"A balanced, well-armored warrior. Weak to bleed and armor break stacks.",preferredWeaponTypes:["sword","mace"],preferredArmorTypes:["heavy"],statMods:{hp:15,attack:3,defense:10,stamina:0,speed:-1,accuracy:8},passives:[{id:"plate_armor",name:"Plate Armor",description:"40% bleed resistance, 20% crit resistance",effect:"heavy_armor_bonuses"}],strengths:[{type:"armor",description:"Full plate protection",value:10},{type:"high_defense",description:"Excellent defense",value:40}],weaknesses:[{type:"bleed",description:"Armor gaps allow bleed",damageMultiplier:1.25,effectChanceMultiplier:1.3},{type:"armor_break",description:"Stacking breaks devastate",damageMultiplier:1.35,effectChanceMultiplier:1.4}],behavior:{preferredActions:[{action:"light_attack",weight:35},{action:"guard",weight:30},{action:"heavy_attack",weight:25},{action:"dodge",weight:10}]},taunts:["For honor!","Face me fairly.","My armor is my faith."],leagueMin:"silver",leagueWeight:{bronze:5,silver:15,gold:25}},{id:"pit_fighter",name:"Pit Fighter",title:"The Survivor",icon:"âš”ï¸",description:"A balanced arena veteran. No major weaknesses but no major strengths.",preferredWeaponTypes:["sword","axe","mace"],preferredArmorTypes:["medium"],statMods:{hp:5,attack:2,defense:2,stamina:5,speed:1,accuracy:5},passives:[{id:"arena_experience",name:"Arena Experience",description:"Gains momentum 20% faster",effect:"momentum_boost"}],strengths:[{type:"stamina",description:"Good endurance",value:5}],weaknesses:[],behavior:{preferredActions:[{action:"light_attack",weight:35},{action:"heavy_attack",weight:25},{action:"guard",weight:20},{action:"dodge",weight:15},{action:"special",weight:5}]},taunts:["I've seen better.","Another day, another fight.","Let's get this over with."],leagueMin:"bronze",leagueWeight:{bronze:30,silver:20,gold:10}},{id:"veteran",name:"Veteran",title:"The Scarred",icon:"ðŸŽ–ï¸",description:"A grizzled warrior with experience against everything. Adapts mid-fight.",preferredWeaponTypes:["sword","axe","spear","mace"],preferredArmorTypes:["medium","heavy"],statMods:{hp:10,attack:4,defense:4,stamina:10,speed:0,accuracy:10,critChance:5},passives:[{id:"battle_wisdom",name:"Battle Wisdom",description:"Adapts to enemy patterns, +10% counter damage per round",effect:"adaptive_combat"}],strengths:[{type:"stamina",description:"High endurance",value:10}],weaknesses:[{type:"momentum",description:"Slow to adapt to aggression",damageMultiplier:1.1,effectChanceMultiplier:1}],behavior:{preferredActions:[{action:"light_attack",weight:30},{action:"guard",weight:25},{action:"heavy_attack",weight:20},{action:"dodge",weight:15},{action:"special",weight:10}]},taunts:["I've killed better than you.","Younglings...","This won't take long."],leagueMin:"silver",leagueWeight:{bronze:0,silver:15,gold:30}}];function os(c){return Lt.find(n=>n.id===c)}function cs(c){const n=["bronze","silver","gold"],e=n.indexOf(c);return Lt.filter(a=>n.indexOf(a.leagueMin)<=e)}function ds(c){const n=cs(c),e=n.map(t=>t.leagueWeight[c]),a=e.reduce((t,s)=>t+s,0);let i=Math.random()*a;for(let t=0;t<n.length;t++)if(i-=e[t],i<=0)return n[t];return n[0]}class ls extends w.Scene{constructor(){super({key:"PrepareScene"});m(this,"fighter");m(this,"inventory");m(this,"loadout");m(this,"enemyClass");m(this,"currentTab","weapons");m(this,"scrollY",0);m(this,"maxScroll",0);m(this,"itemListContainer");m(this,"statsPanel");m(this,"loadoutDisplay");m(this,"selectedItem")}create(){const e=p.getRun();if(!e.fighter){this.scene.start("CampScene");return}this.fighter=e.fighter,this.inventory=p.getInventory(),this.loadout=p.getLoadout(),console.log("[Prepare] Scene created"),console.log("[Prepare] Inventory:",this.inventory.length,"items"),console.log("[Prepare] Weapons:",this.inventory.filter(i=>i.itemType==="weapon").length),console.log("[Prepare] Armor:",this.inventory.filter(i=>i.itemType==="armor").length),this.inventory.forEach(i=>{console.log(`[Prepare]   - ${i.itemType}: ${i.itemId} (${i.instanceId})`)});const a=this.registry.get("enemyClassId");a&&(this.enemyClass=os(a)),this.createBackground(),this.createHeader(),this.createTabs(),this.createItemList(),this.createStatsPanel(),this.createLoadoutDisplay(),this.createBottomButtons(),this.createEnemyPreview(),this.cameras.main.fadeIn(200)}createBackground(){const{width:e,height:a}=this.cameras.main,i=this.add.graphics();i.fillGradientStyle(1709328,1709328,657413,657413),i.fillRect(0,0,e,a),i.lineStyle(2,3811866,1),i.strokeRect(5,5,e-10,a-10)}createHeader(){const{width:e}=this.cameras.main,a=E();this.add.text(e/2,a.top+20,"PREPARE FOR BATTLE",{fontFamily:"Georgia, serif",fontSize:"18px",color:"#c9a959"}).setOrigin(.5),this.add.text(e/2,a.top+42,"Choose your equipment",{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b7355"}).setOrigin(.5)}createTabs(){const{width:e}=this.cameras.main,a=E(),i=a.top+70,t=[{id:"weapons",label:"Weapons",icon:"âš”ï¸"},{id:"armor",label:"Armor",icon:"ðŸ›¡ï¸"},{id:"trinkets",label:"Trinkets",icon:"ðŸ’Ž"},{id:"consumables",label:"Items",icon:"ðŸ§ª"}],s=(e-a.left-a.right)/t.length;t.forEach((r,o)=>{const d=a.left+s*o+s/2,l=r.id===this.currentTab,h=this.add.graphics();h.fillStyle(l?3811866:1709328,1),h.fillRect(a.left+s*o,i,s,35),l&&(h.lineStyle(2,13216089,1),h.strokeRect(a.left+s*o,i,s,35)),this.add.text(d,i+17,`${r.icon} ${r.label}`,{fontFamily:"Georgia, serif",fontSize:"11px",color:l?"#c9a959":"#5a4a3a"}).setOrigin(.5);const u=this.add.rectangle(d,i+17,s,35);u.setInteractive(),u.on("pointerdown",()=>{this.currentTab=r.id,this.scrollY=0,this.refreshItemList(),this.scene.restart()})})}createItemList(){const{width:e,height:a}=this.cameras.main,i=E(),t=i.left+10,s=i.top+115,r=e*.55-i.left,o=a*.5,d=this.add.graphics();d.fillStyle(657413,.8),d.fillRoundedRect(t-5,s-5,r+10,o+10,5),d.lineStyle(1,3811866,1),d.strokeRoundedRect(t-5,s-5,r+10,o+10,5),this.itemListContainer=this.add.container(t,s);const l=this.getFilteredItems(),h=60,u=8;let f=0;if(l.forEach(g=>{const y=this.createItemCard(g,0,f,r,h);this.itemListContainer.add(y),f+=h+u}),this.maxScroll=Math.max(0,f-o),this.maxScroll>0){const g=this.add.zone(t+r/2,s+o/2,r,o);g.setInteractive(),this.input.on("wheel",(S,b,M,C)=>{g.getBounds().contains(S.x,S.y)&&(this.scrollY=w.Math.Clamp(this.scrollY+C*.5,0,this.maxScroll),this.itemListContainer.y=s-this.scrollY)});let y=0;g.on("pointerdown",S=>{y=S.y}),g.on("pointermove",S=>{if(S.isDown){const b=y-S.y;this.scrollY=w.Math.Clamp(this.scrollY+b,0,this.maxScroll),this.itemListContainer.y=s-this.scrollY,y=S.y}})}if(l.length===0){const g=this.add.text(r/2,o/2,"No items in this category",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#5a4a3a"}).setOrigin(.5);this.itemListContainer.add(g)}}getFilteredItems(){switch(this.currentTab){case"weapons":return this.inventory.filter(e=>e.itemType==="weapon");case"armor":return this.inventory.filter(e=>e.itemType==="armor");case"trinkets":return this.inventory.filter(e=>e.itemType==="trinket");case"consumables":return this.inventory.filter(e=>e.itemType==="consumable");default:return[]}}createItemCard(e,a,i,t,s){const r=this.add.container(a,i),o=z(e),d=ee(e),l=this.isItemEquipped(e),h=this.add.graphics();h.fillStyle(l?2767402:1709328,1),h.fillRoundedRect(0,0,t,s,5),h.lineStyle(2,Z[d]||3811866,l?1:.5),h.strokeRoundedRect(0,0,t,s,5),r.add(h),this.add.text(12,s/2,fe(e),{fontSize:"22px"}).setOrigin(0,.5),r.add(r.last),this.add.text(45,12,j(e),{fontFamily:"Georgia, serif",fontSize:"12px",color:"#c9a959"}),r.add(r.last),this.add.text(t-10,12,dt[d],{fontFamily:"Georgia, serif",fontSize:"9px",color:`#${Z[d].toString(16).padStart(6,"0")}`}).setOrigin(1,0),r.add(r.last);let u="";if(e.itemType==="weapon"&&o){const f=o;u=`${f.damageMin}-${f.damageMax} DMG`,f.effects.length>0&&(u+=` | ${f.effects[0].description}`)}else if(e.itemType==="armor"&&o){const f=o;u=`${f.defense} DEF`,f.perks.length>0&&(u+=` | ${f.perks[0].description}`)}else e.itemType==="consumable"&&(u=`x${e.quantity}`);return this.add.text(45,s-18,u,{fontFamily:"Georgia, serif",fontSize:"9px",color:"#5a4a3a",wordWrap:{width:t-60}}),r.add(r.last),l&&(this.add.text(t-10,s-18,"âœ“ EQUIPPED",{fontFamily:"Georgia, serif",fontSize:"9px",color:"#6b8e23"}).setOrigin(1,0),r.add(r.last)),r.setSize(t,s),r.setInteractive(new w.Geom.Rectangle(0,0,t,s),w.Geom.Rectangle.Contains),r.on("pointerover",()=>{h.clear(),h.fillStyle(2762016,1),h.fillRoundedRect(0,0,t,s,5),h.lineStyle(2,Z[d]||3811866,1),h.strokeRoundedRect(0,0,t,s,5)}),r.on("pointerout",()=>{h.clear(),h.fillStyle(l?2767402:1709328,1),h.fillRoundedRect(0,0,t,s,5),h.lineStyle(2,Z[d]||3811866,l?1:.5),h.strokeRoundedRect(0,0,t,s,5)}),r.on("pointerdown",()=>{this.selectItem(e)}),r}isItemEquipped(e){const a=this.loadout;return a.weaponId===e.instanceId||a.armorId===e.instanceId||a.helmetId===e.instanceId||a.shieldId===e.instanceId||a.trinket1Id===e.instanceId||a.trinket2Id===e.instanceId||a.consumable1Id===e.instanceId||a.consumable2Id===e.instanceId}selectItem(e){this.selectedItem=e,this.showItemDetails(e)}showItemDetails(e){const{width:a,height:i}=this.cameras.main,t=z(e);if(!t)return;const s=this.add.graphics();s.fillStyle(0,.7),s.fillRect(0,0,a,i),s.setInteractive(new w.Geom.Rectangle(0,0,a,i),w.Geom.Rectangle.Contains);const r=Math.min(300,a-40),o=350,d=a/2-r/2,l=i/2-o/2,h=this.add.container(d,l),u=this.add.graphics();u.fillStyle(1709328,1),u.fillRoundedRect(0,0,r,o,10),u.lineStyle(2,Z[ee(e)],1),u.strokeRoundedRect(0,0,r,o,10),h.add(u),h.add(this.add.text(r/2,20,`${fe(e)} ${j(e)}`,{fontFamily:"Georgia, serif",fontSize:"16px",color:"#c9a959"}).setOrigin(.5)),h.add(this.add.text(r/2,40,dt[ee(e)],{fontFamily:"Georgia, serif",fontSize:"11px",color:`#${Z[ee(e)].toString(16).padStart(6,"0")}`}).setOrigin(.5));let f=70;if(e.itemType==="weapon"){const C=t;h.add(this.add.text(20,f,`Damage: ${C.damageMin}-${C.damageMax}`,{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b7355"})),f+=20,h.add(this.add.text(20,f,`Light Cost: ${C.lightStaminaCost} | Heavy: ${C.heavyStaminaCost}`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#5a4a3a"})),f+=20,C.effects.length>0&&(h.add(this.add.text(20,f,"Effects:",{fontFamily:"Georgia, serif",fontSize:"11px",color:"#c9a959"})),f+=18,C.effects.forEach(x=>{h.add(this.add.text(30,f,`â€¢ ${x.description}`,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#6b8e23"})),f+=16})),f+=10,h.add(this.add.text(20,f,C.damageDescription,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#5a4a3a",wordWrap:{width:r-40}})),f+=30,h.add(this.add.text(20,f,`"${C.lore}"`,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#4a3a2a",fontStyle:"italic",wordWrap:{width:r-40}}))}else if(e.itemType==="armor"){const C=t;h.add(this.add.text(20,f,`Defense: ${C.defense}`,{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b7355"})),f+=20;const x=[];C.staminaRegenMod!==0&&x.push(`Stamina: ${C.staminaRegenMod>0?"+":""}${C.staminaRegenMod}`),C.dodgeMod!==0&&x.push(`Dodge: ${C.dodgeMod>0?"+":""}${C.dodgeMod}%`),C.speedMod!==0&&x.push(`Speed: ${C.speedMod>0?"+":""}${C.speedMod}`),x.length>0&&(h.add(this.add.text(20,f,x.join(" | "),{fontFamily:"Georgia, serif",fontSize:"10px",color:"#5a4a3a"})),f+=20),C.perks.length>0&&(h.add(this.add.text(20,f,"Perks:",{fontFamily:"Georgia, serif",fontSize:"11px",color:"#c9a959"})),f+=18,C.perks.forEach(R=>{h.add(this.add.text(30,f,`â€¢ ${R.description}`,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#6b8e23"})),f+=16})),f+=10,h.add(this.add.text(20,f,`"${C.lore}"`,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#4a3a2a",fontStyle:"italic",wordWrap:{width:r-40}}))}const g=this.isItemEquipped(e),y=o-50,S=this.add.container(r/2,y),b=this.add.graphics();b.fillStyle(g?5909018:2771498,1),b.fillRoundedRect(-70,-20,140,40,5),S.add(b),S.add(this.add.text(0,0,g?"UNEQUIP":"EQUIP",{fontFamily:"Georgia, serif",fontSize:"14px",color:"#c9a959"}).setOrigin(.5)),S.setSize(140,40),S.setInteractive(),S.on("pointerdown",()=>{g?this.unequipItem(e):this.equipItem(e),s.destroy(),h.destroy(),this.scene.restart()}),h.add(S);const M=this.add.text(r-15,10,"âœ•",{fontSize:"18px",color:"#8b7355"}).setOrigin(1,0);M.setInteractive(),M.on("pointerdown",()=>{s.destroy(),h.destroy()}),h.add(M),s.on("pointerdown",()=>{s.destroy(),h.destroy()})}equipItem(e){switch(e.itemType){case"weapon":p.equipItem(e.instanceId,"weaponId");break;case"armor":e.slot==="body"?p.equipItem(e.instanceId,"armorId"):e.slot==="helmet"?p.equipItem(e.instanceId,"helmetId"):e.slot==="shield"&&p.equipItem(e.instanceId,"shieldId");break;case"trinket":this.loadout.trinket1Id?this.loadout.trinket2Id?p.equipItem(e.instanceId,"trinket1Id"):p.equipItem(e.instanceId,"trinket2Id"):p.equipItem(e.instanceId,"trinket1Id");break;case"consumable":this.loadout.consumable1Id?this.loadout.consumable2Id?p.equipItem(e.instanceId,"consumable1Id"):p.equipItem(e.instanceId,"consumable2Id"):p.equipItem(e.instanceId,"consumable1Id");break}this.loadout=p.getLoadout()}unequipItem(e){p.unequipItem(e.instanceId),this.loadout=p.getLoadout()}createStatsPanel(){const{width:e,height:a}=this.cameras.main,i=E(),t=e*.55+10,s=i.top+115,r=e-t-i.right-10,o=a*.35;this.statsPanel=this.add.container(t,s);const d=this.add.graphics();d.fillStyle(657413,.8),d.fillRoundedRect(0,0,r,o,5),d.lineStyle(1,3811866,1),d.strokeRoundedRect(0,0,r,o,5),this.statsPanel.add(d),this.statsPanel.add(this.add.text(r/2,15,"LOADOUT STATS",{fontFamily:"Georgia, serif",fontSize:"11px",color:"#c9a959"}).setOrigin(.5));const l=tt(this.inventory,this.loadout);let h=35;const u=(f,g,y="#8b7355")=>{this.statsPanel.add(this.add.text(10,h,f,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#5a4a3a"})),this.statsPanel.add(this.add.text(r-10,h,g,{fontFamily:"Georgia, serif",fontSize:"10px",color:y}).setOrigin(1,0)),h+=16};u("Damage",`${l.damageMin}-${l.damageMax}`),u("Defense",`${l.totalDefense}`),u("Accuracy",`${l.accuracyMod>=0?"+":""}${l.accuracyMod}%`),u("Crit Chance",`${l.critChanceMod>=0?"+":""}${l.critChanceMod}%`),u("Speed",`${l.speedMod>=0?"+":""}${l.speedMod}`),u("Dodge",`${l.dodgeMod>=0?"+":""}${l.dodgeMod}%`),l.bleedResist>0&&u("Bleed Resist",`${l.bleedResist}%`,"#6b8e23"),l.stunResist>0&&u("Stun Resist",`${l.stunResist}%`,"#6b8e23"),l.poisonResist>0&&u("Poison Resist",`${l.poisonResist}%`,"#6b8e23")}createLoadoutDisplay(){const{width:e,height:a}=this.cameras.main,i=E(),t=e*.55+10,s=i.top+115+a*.36,r=e-t-i.right-10,o=a*.14;this.loadoutDisplay=this.add.container(t,s);const d=this.add.graphics();d.fillStyle(657413,.8),d.fillRoundedRect(0,0,r,o,5),d.lineStyle(1,3811866,1),d.strokeRoundedRect(0,0,r,o,5),this.loadoutDisplay.add(d),this.loadoutDisplay.add(this.add.text(r/2,12,"EQUIPPED",{fontFamily:"Georgia, serif",fontSize:"10px",color:"#c9a959"}).setOrigin(.5));const l=[{id:this.loadout.weaponId,label:"âš”ï¸"},{id:this.loadout.armorId,label:"ðŸ›¡ï¸"},{id:this.loadout.helmetId,label:"â›‘ï¸"},{id:this.loadout.trinket1Id,label:"ðŸ’Ž"},{id:this.loadout.consumable1Id,label:"ðŸ§ª"}],h=(r-20)/l.length;l.forEach((u,f)=>{const g=10+h*f+h/2,y=o/2+8,S=this.add.graphics();S.fillStyle(u.id?2767402:1709328,1),S.fillRoundedRect(g-18,y-15,36,30,3),S.lineStyle(1,u.id?7048739:3811866,1),S.strokeRoundedRect(g-18,y-15,36,30,3),this.loadoutDisplay.add(S);let b=u.label;if(u.id){const M=this.inventory.find(C=>C.instanceId===u.id);M&&(b=fe(M))}this.loadoutDisplay.add(this.add.text(g,y,b,{fontSize:"16px"}).setOrigin(.5))})}createEnemyPreview(){const{width:e,height:a}=this.cameras.main,i=E(),t=a*.68,s=e-i.left-i.right,r=p.getRun();if(!this.enemyClass){const y=r.league==="bronze"||r.league==="silver"||r.league==="gold"?r.league:"bronze";this.enemyClass=ds(y),this.registry.set("enemyClassId",this.enemyClass.id)}const o=this.enemyClass,d=this.add.graphics();d.fillStyle(2759194,.9),d.fillRoundedRect(i.left,t,s,85,5),d.lineStyle(1,9109504,.5),d.strokeRoundedRect(i.left,t,s,85,5),this.add.text(i.left+15,t+10,`${o.icon} FACING: ${o.name.toUpperCase()}`,{fontFamily:"Georgia, serif",fontSize:"12px",color:"#c9a959"}),this.add.text(i.left+15,t+28,o.title,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355"});const l=pe(this.fighter),h=re(l),u=l.expectedPower*(.9+Math.random()*.2),f=Ha(l.power,u);if(this.add.text(s-15,t+10,`âš¡ ${ae(l.power)}`,{fontFamily:"Georgia, serif",fontSize:"11px",color:h.color}).setOrigin(1,0),this.add.text(s-15,t+28,`vs ~${ae(Math.round(u))}`,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355"}).setOrigin(1,0),this.add.text(s-15,t+46,f.label.toUpperCase(),{fontFamily:"Georgia, serif",fontSize:"11px",color:f.color}).setOrigin(1,0),o.weaknesses.length>0){const y=o.weaknesses.slice(0,2).map(S=>S.type).join(", ");this.add.text(i.left+15,t+48,`âš ï¸ Weak to: ${y}`,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#6b8e23"})}const g=this.getMutatorWarning(r.league);g?this.add.text(s/2,t+68,g,{fontFamily:"Georgia, serif",fontSize:"9px",color:"#cd5c5c"}).setOrigin(.5):this.add.text(i.left+15,t+68,f.description,{fontFamily:"Georgia, serif",fontSize:"9px",color:"#5a4a3a"})}getMutatorWarning(e){switch(e){case"bronze":return"âš ï¸ Some enemies may have mutations";case"silver":return"âš ï¸ Enemies always have a mutation";case"gold":return"âš ï¸ Enemies may have multiple mutations";case"champion":return"ðŸ’€ Elite enemies with powerful mutations";default:return null}}createBottomButtons(){const{width:e}=this.cameras.main,a=E(),i=oe(this,40);new G(this,a.left+70,i,"â† BACK",()=>{this.cameras.main.fadeOut(200),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("CampScene")})},{width:110,height:44}),new G(this,e-a.right-90,i,"ðŸ—¡ï¸ FIGHT",()=>{p.setLoadout(this.loadout),this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("FightScene")})},{width:150,height:44,primary:!0})}refreshItemList(){this.itemListContainer&&this.itemListContainer.destroy(),this.createItemList()}}class hs extends w.Scene{constructor(){super({key:"CharacterSheetScene"});m(this,"fighter");m(this,"currentTab","stats")}create(){const e=p.getRun();if(!e.fighter){this.scene.start("CampScene");return}this.fighter=e.fighter,this.createBackground(),this.createHeader(),this.createPortrait(),this.createTabs(),this.createContent(),this.createBackButton(),this.cameras.main.fadeIn(200)}createBackground(){const{width:e,height:a}=this.cameras.main,i=this.add.graphics();i.fillGradientStyle(1709328,1709328,657413,657413),i.fillRect(0,0,e,a),i.lineStyle(1,3811866,.5),i.strokeRect(10,10,e-20,a-20)}createHeader(){const{width:e}=this.cameras.main,a=E();this.add.text(e/2,a.top+15,"CHARACTER SHEET",{fontFamily:"Georgia, serif",fontSize:"16px",color:"#c9a959"}).setOrigin(.5)}createPortrait(){const e=E(),a=70,i=e.left+a/2+20,t=e.top+70;ce.renderPortrait(this,this.fighter.portrait,i,t,a),this.add.text(i+a/2+15,t-20,this.fighter.fullName,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#c9a959"}),this.add.text(i+a/2+15,t,`"${this.fighter.nickname}"`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b7355",fontStyle:"italic"});const s=p.getRun();this.add.text(i+a/2+15,t+18,`${s.league.toUpperCase()} League | Week ${s.week+1}`,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#5a4a3a"}),this.add.text(i+a/2+15,t+35,`Wins: ${this.fighter.wins} | Streak: ${s.consecutiveWins}`,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#6b8e23"})}createTabs(){const{width:e}=this.cameras.main,a=E(),i=a.top+125,t=[{id:"stats",label:"Stats"},{id:"techniques",label:"Techniques"},{id:"history",label:"History"}],s=(e-a.left-a.right)/t.length;t.forEach((r,o)=>{const d=a.left+s*o+s/2,l=r.id===this.currentTab,h=this.add.graphics();h.fillStyle(l?3811866:1709328,1),h.fillRect(a.left+s*o,i,s,30),l&&(h.lineStyle(2,13216089,1),h.strokeRect(a.left+s*o,i,s,30)),this.add.text(d,i+15,r.label,{fontFamily:"Georgia, serif",fontSize:"12px",color:l?"#c9a959":"#5a4a3a"}).setOrigin(.5);const u=this.add.rectangle(d,i+15,s,30);u.setInteractive(),u.on("pointerdown",()=>{this.currentTab=r.id,this.scene.restart()})})}createContent(){const{width:e,height:a}=this.cameras.main,i=E(),t=i.top+165,s=a-t-80;switch(this.currentTab){case"stats":this.createStatsContent(i.left+10,t,e-i.left-i.right-20,s);break;case"techniques":this.createTechniquesContent(i.left+10,t,e-i.left-i.right-20,s);break;case"history":this.createHistoryContent(i.left+10,t,e-i.left-i.right-20,s);break}}createStatsContent(e,a,i,t){const s=this.add.container(e,a),r=this.add.graphics();r.fillStyle(657413,.6),r.fillRoundedRect(0,0,i,t,5),s.add(r),p.getRun();const o=p.getInventory(),d=p.getLoadout(),l=tt(o,d);let h=15;const u=18,f=15,g=i/2+10,y=P=>{s.add(this.add.text(f,h,P,{fontFamily:"Georgia, serif",fontSize:"12px",color:"#c9a959"})),h+=u+5},S=(P,H,A=f,F="#8b7355")=>{s.add(this.add.text(A,h,`${P}: ${H}`,{fontFamily:"Georgia, serif",fontSize:"10px",color:F}))},b=(P,H)=>{S(P.label,P.value,f),H&&S(H.label,H.value,g),h+=u};y("ðŸ“Š CORE STATS");const M=this.fighter.currentStats;this.fighter.baseStats,b({label:"HP",value:`${M.currentHP}/${M.maxHP}`},{label:"Stamina",value:`${M.currentStamina}/${M.maxStamina}`}),b({label:"Focus",value:`${M.maxFocus}`},{label:"Speed",value:`${M.speed}`}),h+=5,y("âš”ï¸ OFFENSE"),b({label:"Attack",value:`${M.attack}`},{label:"Weapon DMG",value:`${l.damageMin}-${l.damageMax}`}),b({label:"Accuracy",value:`${M.accuracy}%`},{label:"Crit Chance",value:`${M.critChance}%`}),b({label:"Crit Damage",value:`${M.critDamage}%`}),h+=5,y("ðŸ›¡ï¸ DEFENSE"),b({label:"Defense",value:`${M.defense+l.totalDefense}`},{label:"Dodge",value:`${l.dodgeMod>=0?"+":""}${l.dodgeMod}%`}),(l.bleedResist>0||l.stunResist>0)&&b({label:"Bleed Resist",value:`${l.bleedResist}%`},{label:"Stun Resist",value:`${l.stunResist}%`}),h+=5,y("ðŸ“‹ STATUS");const C=p.getFatigue(),x=C>70?"#8b0000":C>40?"#daa520":"#6b8e23";s.add(this.add.text(f,h,`Fatigue: ${C}%`,{fontFamily:"Georgia, serif",fontSize:"10px",color:x})),s.add(this.add.text(g,h,`Trust: ${this.fighter.trust}%`,{fontFamily:"Georgia, serif",fontSize:"10px",color:this.fighter.trust>70?"#6b8e23":"#8b7355"})),h+=u,this.fighter.injuries.length>0&&(h+=5,y("ðŸ©¹ INJURIES"),this.fighter.injuries.forEach(P=>{s.add(this.add.text(f,h,`â€¢ ${P.name}`,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b0000"})),h+=u})),h+=5;const R=p.getStance(),B=Fa[R];s.add(this.add.text(f,h,`Current Stance: ${B.icon} ${B.name}`,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#c9a959"}))}createTechniquesContent(e,a,i,t){const s=this.add.container(e,a),r=this.add.graphics();r.fillStyle(657413,.6),r.fillRoundedRect(0,0,i,t,5),s.add(r);const o=p.getTechniques(),d=Object.keys(o);let l=15;s.add(this.add.text(i/2,l,"LEARNED TECHNIQUES",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#c9a959"}).setOrigin(.5,0)),l+=30,d.length===0?s.add(this.add.text(i/2,l+30,`No techniques learned yet.
Train to unlock techniques!`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#5a4a3a",align:"center"}).setOrigin(.5,0)):d.forEach(u=>{const f=o[u],g=me(u);if(!g)return;const y=this.add.graphics();y.fillStyle(2760474,1),y.fillRoundedRect(10,l,i-20,55,5),y.lineStyle(1,5917242,1),y.strokeRoundedRect(10,l,i-20,55,5),s.add(y),s.add(this.add.text(25,l+10,`${g.icon} ${g.name}`,{fontFamily:"Georgia, serif",fontSize:"12px",color:"#c9a959"})),s.add(this.add.text(i-25,l+10,`Lv.${f}/${g.maxLevel}`,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#6b8e23"}).setOrigin(1,0)),s.add(this.add.text(25,l+30,g.description,{fontFamily:"Georgia, serif",fontSize:"9px",color:"#5a4a3a",wordWrap:{width:i-50}})),l+=65}),l+=20,s.add(this.add.text(15,l,"Available to Learn:",{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355"})),l+=20,Ht.filter(u=>!o[u.id]).slice(0,3).forEach(u=>{s.add(this.add.text(25,l,`${u.icon} ${u.name} - Train to unlock`,{fontFamily:"Georgia, serif",fontSize:"9px",color:"#4a3a2a"})),l+=16})}createHistoryContent(e,a,i,t){const s=this.add.container(e,a),r=this.add.graphics();r.fillStyle(657413,.6),r.fillRoundedRect(0,0,i,t,5),s.add(r);let o=15;const d=p.getLastFightResult();if(s.add(this.add.text(i/2,o,"LAST FIGHT",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#c9a959"}).setOrigin(.5,0)),o+=25,d){const u=d.result==="win"?"#6b8e23":"#8b0000";s.add(this.add.text(15,o,`vs ${d.enemyName} (${d.enemyClass})`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b7355"})),o+=18,s.add(this.add.text(15,o,d.result.toUpperCase(),{fontFamily:"Georgia, serif",fontSize:"14px",color:u})),o+=20,s.add(this.add.text(15,o,`Damage Dealt: ${d.damageDealt} | Taken: ${d.damageTaken}`,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#5a4a3a"})),o+=18,d.result==="win"&&(s.add(this.add.text(15,o,`Earned: ${d.goldEarned}ðŸ’° ${d.fameEarned}â­`,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#c9a959"})),o+=18)}else s.add(this.add.text(i/2,o,"No fights yet",{fontFamily:"Georgia, serif",fontSize:"10px",color:"#5a4a3a"}).setOrigin(.5,0)),o+=25;o+=15,s.add(this.add.text(i/2,o,"LAST TRAINING",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#c9a959"}).setOrigin(.5,0)),o+=25;const l=p.getLastTraining();l?(s.add(this.add.text(15,o,l.programName,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b7355"})),o+=20,Object.entries(l.statChanges).forEach(([f,g])=>{const y=g>0?"#6b8e23":"#8b0000",S=g>0?"+":"";s.add(this.add.text(25,o,`${f}: ${S}${g}`,{fontFamily:"Georgia, serif",fontSize:"10px",color:y})),o+=16}),l.techniqueUnlocked&&(s.add(this.add.text(15,o,`Technique: ${l.techniqueUnlocked} (Lv.${l.techniqueLevel})`,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#c9a959"})),o+=18)):s.add(this.add.text(i/2,o,"No training yet",{fontFamily:"Georgia, serif",fontSize:"10px",color:"#5a4a3a"}).setOrigin(.5,0)),o+=20;const h=p.getTrainingHistory();h.length>1&&(s.add(this.add.text(15,o,"Previous Sessions:",{fontFamily:"Georgia, serif",fontSize:"10px",color:"#5a4a3a"})),o+=18,h.slice(-3).reverse().forEach(u=>{u!==l&&(s.add(this.add.text(25,o,`â€¢ ${u.programName}`,{fontFamily:"Georgia, serif",fontSize:"9px",color:"#4a3a2a"})),o+=14)}))}createBackButton(){const{width:e}=this.cameras.main;new Gt(this,e/2,oe(this,35),"â† BACK TO CAMP",()=>{this.cameras.main.fadeOut(200),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("CampScene")})},{width:180,height:44,fontSize:13})}}const $t=[{id:"aggressive",name:"Aggressive",icon:"âš”ï¸",description:"Strike first, strike hard. Offense is the best defense.",effects:{damageBonus:8,guardBonus:-10},drawback:"-10% guard effectiveness"},{id:"defensive",name:"Defensive",icon:"ðŸ›¡ï¸",description:"Patience wins battles. Wait for openings.",effects:{guardBonus:15,damageBonus:-5},drawback:"-5 damage"},{id:"opportunist",name:"Opportunist",icon:"ðŸŽ¯",description:"Exploit weaknesses. Every opening is a chance to strike.",effects:{critBonus:8,dodgeBonus:5,maxHPBonus:-10},drawback:"-10 max HP"},{id:"balanced",name:"Balanced",icon:"âš–ï¸",description:"Adapt to any situation. No extremes.",effects:{damageBonus:3,defenseBonus:3,staminaBonus:5},drawback:"No significant bonuses"}],Nt=[{id:"soldier",name:"Former Soldier",icon:"ðŸª–",description:"You served in the army before the arena called.",perk:"+5 Defense, trained in formation fighting",perkEffect:{statBonus:{stat:"defense",value:5}},drawback:"Lower evasion from rigid training",drawbackEffect:{statPenalty:{stat:"evasion",value:-3}}},{id:"street_fighter",name:"Street Fighter",icon:"ðŸ‘Š",description:"Grew up scrapping in alleys. No rules.",perk:"+5 Crit chance, dirty fighting instincts",perkEffect:{statBonus:{stat:"critChance",value:5}},drawback:"Less disciplined defense",drawbackEffect:{statPenalty:{stat:"defense",value:-2}}},{id:"noble",name:"Disgraced Noble",icon:"ðŸ‘‘",description:"Once wealthy, now seeking glory to restore honor.",perk:"+10% starting gold, trained in fencing",perkEffect:{statBonus:{stat:"accuracy",value:5},special:"extra_gold"},drawback:"Lower max HP from soft upbringing",drawbackEffect:{statPenalty:{stat:"maxHP",value:-5}}},{id:"farmer",name:"Farm Hand",icon:"ðŸŒ¾",description:"Years of hard labor built endurance.",perk:"+15 Stamina, tireless worker",perkEffect:{statBonus:{stat:"maxStamina",value:15}},drawback:"Slow reactions from rural life",drawbackEffect:{statPenalty:{stat:"speed",value:-2}}},{id:"hunter",name:"Hunter",icon:"ðŸ¹",description:"Tracked prey through wilderness for years.",perk:"+10 Accuracy, patient stalker",perkEffect:{statBonus:{stat:"accuracy",value:10}},drawback:"Less raw power",drawbackEffect:{statPenalty:{stat:"attack",value:-2}}},{id:"pit_slave",name:"Pit Slave",icon:"â›“ï¸",description:"Forced to fight since childhood. Survival instinct.",perk:"+10 Max HP, hardened survivor",perkEffect:{statBonus:{stat:"maxHP",value:10}},drawback:"Emotional scars affect focus",drawbackEffect:{statPenalty:{stat:"maxFocus",value:-5}}}],Ct=[{id:"quick_feet",name:"Quick Feet",icon:"ðŸ‘Ÿ",description:"Dodge costs less stamina.",effect:"-3 stamina cost for dodge actions",mechanicType:"passive",modifier:{type:"dodge_cost",value:-3}},{id:"heavy_hitter",name:"Heavy Hitter",icon:"ðŸ’ª",description:"Heavy attacks hit harder but cost more.",effect:"+15% heavy attack damage, +5 stamina cost",mechanicType:"passive",modifier:{type:"heavy_damage",value:15}},{id:"counter_stance",name:"Counter Stance",icon:"â†©ï¸",description:"Successful parries deal small retaliation damage.",effect:"Parry deals 3 damage back",mechanicType:"trigger",modifier:{type:"parry_counter",value:3}},{id:"adrenaline_surge",name:"Adrenaline Surge",icon:"âš¡",description:"Gain momentum faster when hit.",effect:"+50% momentum gain when taking damage",mechanicType:"passive",modifier:{type:"momentum_on_hit",value:50}},{id:"iron_skin",name:"Iron Skin",icon:"ðŸ§±",description:"First hit each fight deals reduced damage.",effect:"First damage taken reduced by 30%",mechanicType:"trigger",modifier:{type:"first_hit_reduction",value:30}},{id:"opening_strike",name:"Opening Strike",icon:"ðŸŽª",description:"First attack of fight has bonus crit chance.",effect:"+25% crit chance on first attack",mechanicType:"trigger",modifier:{type:"first_attack_crit",value:25}}],Ue=["#f5d0b9","#e8c4a8","#d4a574","#a67c52","#8b5a3c","#5c3d2e","#3b2417"],je=["#1a1a1a","#3d2314","#6b4423","#8b6914","#a08060","#c0c0c0","#8b0000","#4a0080"],Mt=["#3d2314","#5a4a3a","#3388cc","#228b22","#8b4513","#4a0080"],Ve=["#8b0000","#00008b","#006400","#4b0082","#daa520","#2f4f4f","#800080","#ff4500"],W={face:6,eyes:5,hair:8,beard:6,scar:4,warpaint:5,hood:4};function us(c){return $t.find(n=>n.id===c)}function fs(c){return Nt.find(n=>n.id===c)}function ms(){return{faceIndex:Math.floor(Math.random()*W.face),eyeIndex:Math.floor(Math.random()*W.eyes),hairIndex:Math.floor(Math.random()*W.hair),beardIndex:Math.floor(Math.random()*W.beard),scarIndex:Math.floor(Math.random()*W.scar),warpaintIndex:Math.floor(Math.random()*W.warpaint),hoodIndex:Math.floor(Math.random()*W.hood),skinTone:Ue[Math.floor(Math.random()*Ue.length)],hairColor:je[Math.floor(Math.random()*je.length)],eyeColor:Mt[Math.floor(Math.random()*Mt.length)],accentColor:Ve[Math.floor(Math.random()*Ve.length)]}}function gs(c,n){const e={};if(c){const a=us(c);if(a){const i=a.effects;i.damageBonus&&(e.attack=(e.attack||0)+i.damageBonus),i.defenseBonus&&(e.defense=(e.defense||0)+i.defenseBonus),i.guardBonus&&(e.guard=(e.guard||0)+i.guardBonus),i.critBonus&&(e.critChance=(e.critChance||0)+i.critBonus),i.dodgeBonus&&(e.evasion=(e.evasion||0)+i.dodgeBonus),i.maxHPBonus&&(e.maxHP=(e.maxHP||0)+i.maxHPBonus),i.staminaBonus&&(e.maxStamina=(e.maxStamina||0)+i.staminaBonus)}}if(n){const a=fs(n);if(a){if(a.perkEffect.statBonus){const{stat:i,value:t}=a.perkEffect.statBonus;e[i]=(e[i]||0)+t}if(a.drawbackEffect.statPenalty){const{stat:i,value:t}=a.drawbackEffect.statPenalty;e[i]=(e[i]||0)+t}}}return e}class ps extends w.Scene{constructor(){super({key:"CustomizeScene"});m(this,"fighter");m(this,"currentTab","cosmetics");m(this,"selectedPhilosophy",null);m(this,"selectedBackground",null);m(this,"selectedTechnique",null);m(this,"cosmetics",{firstName:"",lastName:"",nickname:"",faceIndex:0,eyeIndex:0,hairIndex:0,beardIndex:0,scarIndex:0,warpaintIndex:0,hoodIndex:0,skinTone:"#d4a574",hairColor:"#3d2314",eyeColor:"#5a4a3a",accentColor:"#8b0000"});m(this,"portraitContainer");m(this,"statsContainer");m(this,"contentContainer");m(this,"powerText")}create(){const e=p.getRun();if(!e.fighter){this.scene.start("RecruitScene");return}this.fighter=e.fighter;const a=p.getCustomization();this.selectedPhilosophy=a.philosophyId,this.selectedBackground=a.backgroundId,this.selectedTechnique=a.startingTechniqueId,this.cosmetics={firstName:a.cosmetics.firstName||this.fighter.firstName,lastName:a.cosmetics.lastName||this.fighter.lastName,nickname:a.cosmetics.nickname||this.fighter.nickname,faceIndex:a.cosmetics.faceIndex||this.fighter.portrait.baseIndex,eyeIndex:a.cosmetics.eyeIndex||this.fighter.portrait.eyeIndex,hairIndex:a.cosmetics.hairIndex||this.fighter.portrait.hairIndex,beardIndex:a.cosmetics.beardIndex||this.fighter.portrait.beardIndex,scarIndex:a.cosmetics.scarIndex||this.fighter.portrait.scarIndex,warpaintIndex:a.cosmetics.warpaintIndex||0,hoodIndex:a.cosmetics.hoodIndex||0,skinTone:a.cosmetics.skinTone||this.fighter.portrait.skinTone,hairColor:a.cosmetics.hairColor||this.fighter.portrait.hairColor,eyeColor:a.cosmetics.eyeColor||"#5a4a3a",accentColor:a.cosmetics.accentColor||"#8b0000"},this.createBackground(),this.createHeader(),this.createPortraitPreview(),this.createTabs(),this.createContent(),this.createStatsPreview(),this.createBottomButtons(),this.cameras.main.fadeIn(200)}createBackground(){const{width:e,height:a}=this.cameras.main,i=this.add.graphics();i.fillGradientStyle(1709328,1709328,657413,657413),i.fillRect(0,0,e,a),i.lineStyle(2,3811866,1),i.strokeRect(5,5,e-10,a-10)}createHeader(){const{width:e}=this.cameras.main,a=E();this.add.text(e/2,a.top+20,"CUSTOMIZE FIGHTER",{fontFamily:"Georgia, serif",fontSize:"18px",color:"#c9a959"}).setOrigin(.5)}createPortraitPreview(){const{width:e}=this.cameras.main,i=E().top+80;this.portraitContainer=this.add.container(e/2,i),this.updatePortraitPreview(),this.add.text(e/2,i+50,`${this.cosmetics.firstName} "${this.cosmetics.nickname}" ${this.cosmetics.lastName}`,{fontFamily:"Georgia, serif",fontSize:"12px",color:"#c9a959"}).setOrigin(.5)}updatePortraitPreview(){if(!this.portraitContainer)return;this.portraitContainer.removeAll(!0);const e={...this.fighter.portrait,baseIndex:this.cosmetics.faceIndex,eyeIndex:this.cosmetics.eyeIndex,hairIndex:this.cosmetics.hairIndex,beardIndex:this.cosmetics.beardIndex,scarIndex:this.cosmetics.scarIndex,skinTone:this.cosmetics.skinTone,hairColor:this.cosmetics.hairColor},a=ce.renderPortrait(this,e,0,0,70);this.portraitContainer.add(a);const i=this.add.graphics();i.fillStyle(parseInt(this.cosmetics.accentColor.replace("#",""),16),1),i.fillRoundedRect(-12,40,24,8,2),this.portraitContainer.add(i)}createTabs(){const{width:e}=this.cameras.main,a=E(),i=a.top+140,t=[{id:"cosmetics",label:"Appearance",icon:"ðŸŽ¨"},{id:"build",label:"Build",icon:"âš”ï¸"}],s=(e-a.left-a.right)/t.length;t.forEach((r,o)=>{const d=a.left+s*o+s/2,l=r.id===this.currentTab,h=this.add.graphics();h.fillStyle(l?3811866:1709328,1),h.fillRect(a.left+s*o,i,s,35),l&&(h.lineStyle(2,13216089,1),h.strokeRect(a.left+s*o,i,s,35)),this.add.text(d,i+17,`${r.icon} ${r.label}`,{fontFamily:"Georgia, serif",fontSize:"12px",color:l?"#c9a959":"#5a4a3a"}).setOrigin(.5);const u=this.add.rectangle(d,i+17,s,35,0,0);u.setInteractive({useHandCursor:!0}),u.on("pointerdown",()=>{this.currentTab!==r.id&&(this.currentTab=r.id,this.scene.restart())})})}createContent(){const{width:e,height:a}=this.cameras.main,i=E(),t=i.top+185,s=a*.38;this.contentContainer=this.add.container(0,t),this.currentTab==="cosmetics"?this.createCosmeticsContent(i.left+10,0,e-i.left-i.right-20,s):this.createBuildContent(i.left+10,0,e-i.left-i.right-20,s)}createCosmeticsContent(e,a,i,t){const s=this.add.graphics();s.fillStyle(657413,.6),s.fillRoundedRect(e,a,i,t,5),this.contentContainer.add(s);let r=a+15;const o=45;[{label:"Face",key:"faceIndex",max:W.face},{label:"Eyes",key:"eyeIndex",max:W.eyes},{label:"Hair",key:"hairIndex",max:W.hair},{label:"Beard",key:"beardIndex",max:W.beard},{label:"Scars",key:"scarIndex",max:W.scar}].forEach(h=>{this.createPartSelector(e+10,r,i-20,h.label,h.key,h.max),r+=o}),r+=10,this.createColorSelector(e+10,r,"Skin","skinTone",Ue),r+=o,this.createColorSelector(e+10,r,"Hair Color","hairColor",je),r+=o,this.createColorSelector(e+10,r,"Banner","accentColor",Ve);const l=new G(this,e+i/2,r+o+20,"ðŸŽ² Randomize",()=>{const h=ms();this.cosmetics={...this.cosmetics,...h},this.updatePortraitPreview(),this.updateStatsPreview()},{width:140,height:40});this.contentContainer.add(l)}createPartSelector(e,a,i,t,s,r){const o=this.cosmetics[s];this.contentContainer.add(this.add.text(e,a+10,t,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b7355"}));const d=new G(this,e+i-90,a+10,"â—€",()=>{this.cosmetics[s]=(o-1+r)%r,this.updatePortraitPreview()},{width:36,height:30});this.contentContainer.add(d),this.contentContainer.add(this.add.text(e+i-55,a+10,`${o+1}/${r}`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#c9a959"}).setOrigin(.5,0));const l=new G(this,e+i-20,a+10,"â–¶",()=>{this.cosmetics[s]=(o+1)%r,this.updatePortraitPreview()},{width:36,height:30});this.contentContainer.add(l)}createColorSelector(e,a,i,t,s){const r=this.cosmetics[t];s.indexOf(r),this.contentContainer.add(this.add.text(e,a+10,i,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b7355"}));const o=22,d=e+80;s.slice(0,6).forEach((l,h)=>{const u=d+h*(o+4),f=l===r,g=this.add.graphics();g.fillStyle(parseInt(l.replace("#",""),16),1),g.fillRoundedRect(u,a+5,o,o,3),f&&(g.lineStyle(2,13216089,1),g.strokeRoundedRect(u,a+5,o,o,3)),this.contentContainer.add(g);const y=this.add.rectangle(u+o/2,a+5+o/2,o,o,0,0);y.setInteractive({useHandCursor:!0}),y.on("pointerdown",()=>{this.cosmetics[t]=l,this.updatePortraitPreview(),this.scene.restart()}),this.contentContainer.add(y)})}createBuildContent(e,a,i,t){const s=this.add.graphics();s.fillStyle(657413,.6),s.fillRoundedRect(e,a,i,t,5),this.contentContainer.add(s);let r=a+10;this.contentContainer.add(this.add.text(e+10,r,"COMBAT PHILOSOPHY",{fontFamily:"Georgia, serif",fontSize:"10px",color:"#c9a959"})),r+=20,this.createOptionRow(e+5,r,i-10,$t,"philosophy"),r+=70,this.contentContainer.add(this.add.text(e+10,r,"BACKGROUND",{fontFamily:"Georgia, serif",fontSize:"10px",color:"#c9a959"})),r+=20,this.createOptionRow(e+5,r,i-10,Nt,"background"),r+=70,this.contentContainer.add(this.add.text(e+10,r,"STARTING TECHNIQUE",{fontFamily:"Georgia, serif",fontSize:"10px",color:"#c9a959"})),r+=20,this.createOptionRow(e+5,r,i-10,Ct,"technique")}createOptionRow(e,a,i,t,s){const r=Math.min(70,(i-20)/4),o=5;let d=e+10;t.slice(0,4).forEach(l=>{const h=s==="philosophy"&&this.selectedPhilosophy===l.id||s==="background"&&this.selectedBackground===l.id||s==="technique"&&this.selectedTechnique===l.id,u=this.add.container(d,a),f=this.add.graphics();f.fillStyle(h?2771498:1709328,1),f.fillRoundedRect(0,0,r,55,4),f.lineStyle(h?2:1,h?7048739:3811866,1),f.strokeRoundedRect(0,0,r,55,4),u.add(f),u.add(this.add.text(r/2,15,l.icon,{fontSize:"18px"}).setOrigin(.5)),u.add(this.add.text(r/2,38,l.name.split(" ")[0],{fontFamily:"Georgia, serif",fontSize:"9px",color:h?"#c9a959":"#8b7355"}).setOrigin(.5));const g=this.add.rectangle(r/2,27,r,55,0,0);g.setInteractive({useHandCursor:!0}),g.on("pointerdown",()=>{s==="philosophy"?this.selectedPhilosophy=this.selectedPhilosophy===l.id?null:l.id:s==="background"?this.selectedBackground=this.selectedBackground===l.id?null:l.id:this.selectedTechnique=this.selectedTechnique===l.id?null:l.id,this.updateStatsPreview(),this.scene.restart()}),u.add(g),this.contentContainer.add(u),d+=r+o})}createStatsPreview(){const{width:e,height:a}=this.cameras.main,i=E(),t=a*.72,s=65;this.statsContainer=this.add.container(0,t);const r=this.add.graphics();r.fillStyle(1709328,.9),r.fillRoundedRect(i.left+10,0,e-i.left-i.right-20,s,5),r.lineStyle(1,3811866,1),r.strokeRoundedRect(i.left+10,0,e-i.left-i.right-20,s,5),this.statsContainer.add(r),this.updateStatsPreview()}updateStatsPreview(){if(!this.statsContainer)return;this.statsContainer.each(l=>{l instanceof w.GameObjects.Text&&l.destroy()});const{width:e}=this.cameras.main,a=E(),i=gs(this.selectedPhilosophy,this.selectedBackground),t=pe(this.fighter),s=re(t);this.statsContainer.add(this.add.text(a.left+20,10,"STAT CHANGES",{fontFamily:"Georgia, serif",fontSize:"9px",color:"#c9a959"})),this.statsContainer.add(this.add.text(e-a.right-25,10,`âš¡ ${ae(t.power)}`,{fontFamily:"Georgia, serif",fontSize:"11px",color:s.color}).setOrigin(1,0));let r=a.left+20;const o=30,d={attack:"ATK",defense:"DEF",maxHP:"HP",maxStamina:"STA",critChance:"CRIT",evasion:"DODGE",accuracy:"ACC",guard:"GUARD"};if(Object.entries(i).forEach(([l,h])=>{if(h===0)return;const u=d[l]||l.toUpperCase(),f=h>0?"#6b8e23":"#cd5c5c",g=h>0?`+${h}`:`${h}`;this.statsContainer.add(this.add.text(r,o,`${u}: ${g}`,{fontFamily:"Georgia, serif",fontSize:"10px",color:f})),r+=70}),Object.keys(i).length===0&&this.statsContainer.add(this.add.text(a.left+20,o,"No stat changes selected",{fontFamily:"Georgia, serif",fontSize:"10px",color:"#5a4a3a"})),this.selectedTechnique){const l=Ct.find(h=>h.id===this.selectedTechnique);l&&this.statsContainer.add(this.add.text(a.left+20,48,`${l.icon} ${l.effect}`,{fontFamily:"Georgia, serif",fontSize:"9px",color:"#6b8e23"}))}}createBottomButtons(){const{width:e}=this.cameras.main,a=E(),i=oe(this,40);new G(this,a.left+70,i,"â† BACK",()=>{this.cameras.main.fadeOut(200),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("CampScene")})},{width:100,height:44}),new G(this,e-a.right-80,i,"âœ“ CONFIRM",()=>{this.saveCustomization(),this.cameras.main.fadeOut(200),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("CampScene")})},{width:120,height:44,primary:!0})}saveCustomization(){if(p.setCustomization({philosophyId:this.selectedPhilosophy,backgroundId:this.selectedBackground,startingTechniqueId:this.selectedTechnique,cosmetics:this.cosmetics}),p.applyCustomizationToFighter(),this.selectedTechnique){const e=p.getRun();e.techniques[this.selectedTechnique]=1,p.updateRun({techniques:e.techniques})}}}class ys extends w.Scene{constructor(){super({key:"DecreeDraftScene"});m(this,"options",[]);m(this,"selectedIndex",-1);m(this,"cardContainers",[])}create(){const e=p.getActiveDecrees();this.options=Xa(e,3),this.createBackground(),this.createHeader(),this.createDecreeCards(),this.createBottomUI(),this.cameras.main.fadeIn(300)}createBackground(){const{width:e,height:a}=this.cameras.main,i=this.add.graphics();i.fillGradientStyle(1709072,1709072,2760474,2760474),i.fillRect(0,0,e,a),i.lineStyle(2,O.primary,.3),i.strokeRect(15,15,e-30,a-30)}createHeader(){const{width:e}=this.cameras.main;this.add.text(e/2,40,"ðŸ“œ ARENA DECREE",{fontFamily:"Georgia, serif",fontSize:"26px",color:O.textGold,stroke:"#000000",strokeThickness:3}).setOrigin(.5),this.add.text(e/2,75,"Choose a decree to modify your run",{fontFamily:"Georgia, serif",fontSize:"12px",color:O.textMedium,fontStyle:"italic"}).setOrigin(.5);const a=p.getActiveDecrees().length;a>0&&this.add.text(e/2,100,`Active Decrees: ${a}/3`,{fontFamily:"Georgia, serif",fontSize:"11px",color:O.textDark}).setOrigin(.5)}createDecreeCards(){const{width:e,height:a}=this.cameras.main,i=Math.min(280,e-40),t=160,s=140,r=t+15;this.options.forEach((o,d)=>{const l=s+d*r,h=this.createDecreeCard(o,e/2,l,i,t,d);this.cardContainers.push(h)})}createDecreeCard(e,a,i,t,s,r){const o=this.add.container(a,i),d=this.add.graphics();de(d,-t/2,0,t,s,{fill:2365973,stroke:O.primary,strokeAlpha:.3}),o.add(d);const l=this.add.text(-t/2+20,15,e.icon,{fontSize:"28px"});o.add(l);const u=p.isDecreeNew(e.id)?`${e.name} âœ¨`:e.name,f=this.add.text(-t/2+60,15,u,{fontFamily:"Georgia, serif",fontSize:"16px",color:O.textGold});o.add(f);const g="â­".repeat(e.difficultyValue),y=this.add.text(t/2-20,15,g,{fontSize:"12px"}).setOrigin(1,0);o.add(y);const S=this.add.text(-t/2+20,50,e.description,{fontFamily:"Georgia, serif",fontSize:"12px",color:O.textMedium,wordWrap:{width:t-40}});o.add(S);const b=Qa([e.id]),M=[];if(b.goldMod>0&&M.push(`+${b.goldMod}% Gold`),b.lootRarityMod>0&&M.push(`+${b.lootRarityMod} Loot`),b.affixTierBoost>0&&M.push(`+${b.affixTierBoost} Affix`),M.length>0){const R=this.add.text(-t/2+20,s-35,`Rewards: ${M.join(", ")}`,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#6b8e23"});o.add(R)}const C=this.add.graphics();C.setVisible(!1),o.add(C),o.setData("highlight",C),o.setData("decree",e),o.setData("index",r);const x=this.add.rectangle(0,s/2,t,s,0,0);return x.setInteractive({useHandCursor:!0}),o.add(x),x.on("pointerover",()=>{d.clear(),de(d,-t/2,0,t,s,{fill:3811872,stroke:O.primary,strokeAlpha:.6})}),x.on("pointerout",()=>{this.selectedIndex!==r&&(d.clear(),de(d,-t/2,0,t,s,{fill:2365973,stroke:O.primary,strokeAlpha:.3}))}),x.on("pointerdown",()=>{this.selectDecree(r)}),o}selectDecree(e){this.selectedIndex=e,this.cardContainers.forEach((a,i)=>{a.getData("decree");const t=a.list[0],s=280,r=160;t.clear(),i===e?de(t,-s/2,0,s,r,{fill:4864554,stroke:O.primary,strokeAlpha:1}):de(t,-s/2,0,s,r,{fill:2365973,stroke:O.primary,strokeAlpha:.3})})}createBottomUI(){const{width:e,height:a}=this.cameras.main,i=new G(this,e/2,a-80,"ACCEPT DECREE",()=>this.confirmSelection(),{width:180,height:50,primary:!0});if(this.add.existing(i),p.getActiveDecrees().length===0)this.add.text(e/2,a-40,"You must choose at least one decree",{fontFamily:"Georgia, serif",fontSize:"10px",color:O.textDark,fontStyle:"italic"}).setOrigin(.5);else{const s=new G(this,e/2,a-30,"Skip (No additional decree)",()=>this.skip(),{width:200,height:35});this.add.existing(s)}}confirmSelection(){if(this.selectedIndex<0){T.showNotification(this,"Select a decree first!");return}const e=this.options[this.selectedIndex];p.addDecree(e.id),p.completeDecreeDraft(),this.showConfirmAnimation(e)}showConfirmAnimation(e){const{width:a,height:i}=this.cameras.main,t=this.add.container(a/2,i/2);t.setDepth(100),t.setScale(0);const s=this.add.graphics();s.fillStyle(9109504,1),s.fillCircle(0,0,60),s.lineStyle(3,5898240,1),s.strokeCircle(0,0,60),t.add(s);const r=this.add.text(0,-5,e.icon,{fontSize:"36px"}).setOrigin(.5);t.add(r);const o=this.add.text(0,30,"SEALED",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#ffd700"}).setOrigin(.5);t.add(o),this.tweens.add({targets:t,scale:1,duration:300,ease:"Back.easeOut",onComplete:()=>{this.time.delayedCall(800,()=>{this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("CampScene")})})}})}skip(){p.completeDecreeDraft(),this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("CampScene")})}}class vs extends w.Scene{constructor(){super({key:"ForgeScene"});m(this,"gold");m(this,"embers");m(this,"inventory",[]);m(this,"selectedItem",null);m(this,"goldText");m(this,"embersText");m(this,"itemListContainer");m(this,"forgeOptionsContainer");m(this,"previewContainer")}create(){const e=p.getRun();if(!e.fighter){this.scene.start("MainMenuScene");return}this.gold=e.gold,this.embers=e.embers||0,this.inventory=p.getInventory().filter(a=>a.itemType==="weapon"||a.itemType==="armor"),this.createBackground(),this.createHeader(),this.createItemList(),this.createForgePanel(),this.createBackButton(),this.cameras.main.fadeIn(300)}createBackground(){const{width:e,height:a}=this.cameras.main,i=this.add.graphics();i.fillGradientStyle(1709072,1709072,3809050,3809050),i.fillRect(0,0,e,a);const t=this.add.graphics();t.fillStyle(16737792,.05),t.fillCircle(e/2,a*.75,200)}createHeader(){const{width:e}=this.cameras.main;this.add.text(e/2,30,"ðŸ”¥ THE FORGE ðŸ”¥",{fontFamily:"Georgia, serif",fontSize:"22px",color:"#ff9944",stroke:"#000000",strokeThickness:3}).setOrigin(.5),this.add.text(e/2,55,'"Heat. Steel. Will."',{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b7355",fontStyle:"italic"}).setOrigin(.5),this.goldText=this.add.text(e-20,15,`ðŸ’° ${this.gold}`,{fontFamily:"Georgia, serif",fontSize:"16px",color:"#ffd700"}).setOrigin(1,0),this.embersText=this.add.text(e-20,35,`ðŸ”¥ ${this.embers}`,{fontFamily:"Georgia, serif",fontSize:"16px",color:"#ff6600"}).setOrigin(1,0)}createItemList(){const{width:e,height:a}=this.cameras.main;this.itemListContainer&&this.itemListContainer.destroy(),this.itemListContainer=this.add.container(0,0),this.add.text(15,85,"SELECT EQUIPMENT:",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#c9a959"});const i=110,t=55,s=e*.45;if(this.inventory.length===0){this.add.text(15,i+20,"No equipment to forge.",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#5a4a3a",fontStyle:"italic"});return}this.inventory.forEach((r,o)=>{const d=i+o*t;this.createItemEntry(r,15,d,s,50)})}createItemEntry(e,a,i,t,s){var M;const r=this.add.container(a,i);this.itemListContainer.add(r);const o=((M=this.selectedItem)==null?void 0:M.instanceId)===e.instanceId,d=z(e),l=(d==null?void 0:d.rarity)||"common",h=this.add.graphics();h.fillStyle(o?4864554:2760474,1),h.fillRoundedRect(0,0,t,s,6),h.lineStyle(2,o?16750916:5917242,1),h.strokeRoundedRect(0,0,t,s,6),r.add(h);const f={common:"#8b8b8b",uncommon:"#2e8b57",rare:"#4169e1",epic:"#a855f7",legendary:"#ffd700"}[l]||"#8b8b8b",g=j(e),y=this.add.text(10,8,g,{fontFamily:"Georgia, serif",fontSize:"11px",color:f,wordWrap:{width:t-20}});r.add(y);const S=e.itemType==="weapon"?"âš”ï¸":"ðŸ›¡ï¸",b=this.add.text(t-25,s/2,S,{fontSize:"14px"}).setOrigin(.5);if(r.add(b),he(e)){const C=this.add.text(10,s-15,"âœ¨ Affixed",{fontFamily:"Georgia, serif",fontSize:"9px",color:"#c9a959"});r.add(C)}r.setSize(t,s),r.setInteractive(new w.Geom.Rectangle(0,0,t,s),w.Geom.Rectangle.Contains),r.on("pointerdown",()=>{this.selectItem(e)}),r.on("pointerover",()=>{o||(h.clear(),h.fillStyle(3811882,1),h.fillRoundedRect(0,0,t,s,6),h.lineStyle(2,9071178,1),h.strokeRoundedRect(0,0,t,s,6))}),r.on("pointerout",()=>{o||(h.clear(),h.fillStyle(2760474,1),h.fillRoundedRect(0,0,t,s,6),h.lineStyle(2,5917242,1),h.strokeRoundedRect(0,0,t,s,6))})}selectItem(e){this.selectedItem=e,this.createItemList(),this.createForgePanel(),this.createPreview()}createForgePanel(){const{width:e,height:a}=this.cameras.main;this.forgeOptionsContainer&&this.forgeOptionsContainer.destroy(),this.forgeOptionsContainer=this.add.container(0,0);const i=e*.5,t=85,s=e*.48,r=this.add.graphics();if(r.fillStyle(1709072,.9),r.fillRoundedRect(i,t,s,a-180,8),r.lineStyle(2,5917242,1),r.strokeRoundedRect(i,t,s,a-180,8),this.forgeOptionsContainer.add(r),!this.selectedItem){const u=this.add.text(i+s/2,t+80,`Select an item
to forge`,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#5a4a3a",align:"center"}).setOrigin(.5);this.forgeOptionsContainer.add(u);return}const o=this.getForgeOptions(this.selectedItem),d=this.add.text(i+15,t+15,"FORGE OPTIONS:",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#ff9944"});this.forgeOptionsContainer.add(d);let l=t+45;const h=65;o.forEach(u=>{this.createForgeOption(u,i+10,l,s-20,h-5),l+=h})}getForgeOptions(e){const a=z(e),i=(a==null?void 0:a.rarity)||"common",s=p.getRun().league||"bronze",r={bronze:1,silver:1.5,gold:2,champion:3},o={common:1,uncommon:1.5,rare:2,epic:3,legendary:5},d=r[s]||1,l=o[i]||1,h=Math.floor(50*d*l),u=[];if(u.push({id:"reroll_prefix",name:"ðŸ”„ Reroll Prefix",description:e.prefixId?"Replace current prefix":"Add a new prefix",goldCost:h,embersCost:1,available:this.gold>=h&&this.embers>=1,action:()=>this.rerollPrefix(e)}),u.push({id:"reroll_suffix",name:"ðŸ”„ Reroll Suffix",description:e.suffixId?"Replace current suffix":"Add a new suffix",goldCost:h,embersCost:1,available:this.gold>=h&&this.embers>=1,action:()=>this.rerollSuffix(e)}),e.curseId){const f=ge(e.curseId);u.push({id:"cleanse_curse",name:"âœï¸ Cleanse Curse",description:f?`Remove: ${f.name}`:"Remove the curse",goldCost:h*3,embersCost:5,available:this.gold>=h*3&&this.embers>=5,action:()=>this.cleanseCurse(e)})}return u.push({id:"temper",name:"ðŸ”¨ Temper",description:"+5% to all affix stats",goldCost:Math.floor(h*.5),embersCost:0,available:this.gold>=Math.floor(h*.5)&&he(e),action:()=>this.temperItem(e)}),u}createForgeOption(e,a,i,t,s){const r=this.add.container(a,i);this.forgeOptionsContainer.add(r);const o=this.add.graphics();o.fillStyle(e.available?3811882:1710618,1),o.fillRoundedRect(0,0,t,s,6),o.lineStyle(1,e.available?5917242:3815994,1),o.strokeRoundedRect(0,0,t,s,6),r.add(o);const d=this.add.text(10,8,e.name,{fontFamily:"Georgia, serif",fontSize:"12px",color:e.available?"#c9a959":"#5a5a5a"});r.add(d);const l=this.add.text(10,28,e.description,{fontFamily:"Georgia, serif",fontSize:"9px",color:e.available?"#8b7355":"#4a4a4a"});r.add(l);const h=`ðŸ’°${e.goldCost}${e.embersCost>0?` ðŸ”¥${e.embersCost}`:""}`,u=this.add.text(t-10,10,h,{fontFamily:"Georgia, serif",fontSize:"10px",color:e.available?"#ffd700":"#5a5a5a"}).setOrigin(1,0);r.add(u),e.available&&(r.setSize(t,s),r.setInteractive(new w.Geom.Rectangle(0,0,t,s),w.Geom.Rectangle.Contains),r.on("pointerover",()=>{o.clear(),o.fillStyle(4864554,1),o.fillRoundedRect(0,0,t,s,6),o.lineStyle(2,16750916,1),o.strokeRoundedRect(0,0,t,s,6)}),r.on("pointerout",()=>{o.clear(),o.fillStyle(3811882,1),o.fillRoundedRect(0,0,t,s,6),o.lineStyle(1,5917242,1),o.strokeRoundedRect(0,0,t,s,6)}),r.on("pointerdown",()=>{e.action()}))}createPreview(){const{width:e,height:a}=this.cameras.main;if(this.previewContainer&&this.previewContainer.destroy(),!this.selectedItem)return;this.previewContainer=this.add.container(0,0);const i=a-85,t=e-30,s=this.add.graphics();s.fillStyle(2760474,.95),s.fillRoundedRect(15,i,t,70,6),s.lineStyle(1,5917242,1),s.strokeRoundedRect(15,i,t,70,6),this.previewContainer.add(s);const r=this.selectedItem,o=r.prefixId?Ce(r.prefixId):null,d=r.suffixId?Me(r.suffixId):null,l=r.curseId?ge(r.curseId):null;let h="Current: ";o&&(h+=`[${o.name}] `),d&&(h+=`[${d.name}] `),l&&(h+=`[âš ï¸ ${l.name}]`),!o&&!d&&!l&&(h+="No affixes");const u=this.add.text(25,i+12,h,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#c9a959"});if(this.previewContainer.add(u),he(r)){const f=At(r);let g="";const y=(f.damageMin+f.damageMax)/2;y>0&&(g+=`+${Math.round(y)} DMG `),f.defense>0&&(g+=`+${f.defense} DEF `),f.maxHP>0&&(g+=`+${f.maxHP} HP `),f.critChance>0&&(g+=`+${Math.round(f.critChance*100)}% CRIT `),f.bleedChance>0&&(g+=`+${Math.round(f.bleedChance*100)}% BLEED `);const S=this.add.text(25,i+32,g||"Various bonuses",{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355"});this.previewContainer.add(S)}if(l){const f=this.add.text(25,i+50,`âš ï¸ ${l.downside}`,{fontFamily:"Georgia, serif",fontSize:"9px",color:"#8b0000"});this.previewContainer.add(f)}}rerollPrefix(e){const a=z(e),i=(a==null?void 0:a.rarity)||"common",s=p.getRun().league||"bronze",r=this.getForgeOptions(e).find(d=>d.id==="reroll_prefix");this.gold-=r.goldCost,this.embers-=r.embersCost;const o=He(e.itemType,i,s);e.prefixId=o.prefixId||e.prefixId,this.onForgeComplete(e,"Prefix rerolled!")}rerollSuffix(e){const a=z(e),i=(a==null?void 0:a.rarity)||"common",s=p.getRun().league||"bronze",r=this.getForgeOptions(e).find(d=>d.id==="reroll_suffix");this.gold-=r.goldCost,this.embers-=r.embersCost;const o=He(e.itemType,i,s);e.suffixId=o.suffixId||e.suffixId,this.onForgeComplete(e,"Suffix rerolled!")}cleanseCurse(e){const a=this.getForgeOptions(e).find(i=>i.id==="cleanse_curse");this.gold-=a.goldCost,this.embers-=a.embersCost,e.curseId=void 0,this.onForgeComplete(e,"Curse cleansed!")}temperItem(e){const a=this.getForgeOptions(e).find(i=>i.id==="temper");this.gold-=a.goldCost,this.embers-=a.embersCost,T.showNotification(this,"Item tempered! (+5% to affix stats)"),this.onForgeComplete(e,"Item tempered!")}onForgeComplete(e,a){p.updateItem(e),p.updateRun({gold:this.gold,embers:this.embers}),this.goldText.setText(`ðŸ’° ${this.gold}`),this.embersText.setText(`ðŸ”¥ ${this.embers}`),this.playForgeReveal(a),this.createItemList(),this.createForgePanel(),this.createPreview()}playForgeReveal(e){const{width:a,height:i}=this.cameras.main,t=this.add.graphics();t.fillStyle(16737792,.3),t.fillRect(0,0,a,i),this.tweens.add({targets:t,alpha:0,duration:500,onComplete:()=>t.destroy()}),T.showNotification(this,e)}createBackButton(){const{width:e,height:a}=this.cameras.main;T.createButton(this,e/2,a-30,"â† BACK TO CAMP",()=>this.returnToCamp(),{width:180,height:40})}returnToCamp(){this.cameras.main.fadeOut(200),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("CampScene")})}}const Wt=[{weaponType:"sword",name:"Way of the Blade",icon:"âš”ï¸",description:"Master the versatile art of sword combat",nodes:[{id:"sword_precision",name:"Precision Strikes",description:"+10% accuracy with all attacks",icon:"ðŸŽ¯",tier:1,cost:1,effects:[{stat:"accuracy",value:.1,isPercent:!0,description:"+10% Accuracy"}]},{id:"sword_riposte",name:"Riposte",description:"After parrying, next attack deals +25% damage",icon:"âš¡",tier:1,cost:1,effects:[{special:"riposte_damage",value:.25,description:"+25% damage after parry"}]},{id:"sword_finesse",name:"Finesse",description:"-2 stamina cost on light attacks",icon:"ðŸ’¨",tier:2,cost:2,requires:["sword_precision"],effects:[{stat:"lightAttackCost",value:-2,description:"-2 Stamina on light attacks"}]},{id:"sword_counter",name:"Counter Master",description:"+15% parry window",icon:"ðŸ›¡ï¸",tier:2,cost:2,requires:["sword_riposte"],effects:[{stat:"parryWindow",value:.15,isPercent:!0,description:"+15% Parry window"}]},{id:"sword_flourish",name:"Deadly Flourish",description:"Critical hits ignore 20% defense",icon:"âœ¨",tier:2,cost:2,requires:["sword_precision"],effects:[{special:"crit_armor_pierce",value:.2,description:"Crits ignore 20% DEF"}]},{id:"sword_dance",name:"Blade Dancer",description:"Consecutive hits increase crit chance by 5%",icon:"ðŸ’ƒ",tier:3,cost:3,requires:["sword_finesse","sword_flourish"],effects:[{special:"combo_crit",value:.05,description:"+5% Crit per consecutive hit"}]},{id:"sword_master",name:"Sword Master",description:"+15% damage with all sword attacks",icon:"ðŸ‘‘",tier:3,cost:3,requires:["sword_counter"],effects:[{stat:"damage",value:.15,isPercent:!0,description:"+15% Sword damage"}]}]},{weaponType:"axe",name:"Path of the Cleaver",icon:"ðŸª“",description:"Crush armor and break defenses",nodes:[{id:"axe_rend",name:"Rending Blows",description:"+1 Armor Break stack on hit",icon:"ðŸ’¥",tier:1,cost:1,effects:[{stat:"armorBreak",value:1,description:"+1 Armor Break per hit"}]},{id:"axe_brutal",name:"Brutal Force",description:"+15% heavy attack damage",icon:"ðŸ’ª",tier:1,cost:1,effects:[{special:"heavy_damage",value:.15,description:"+15% Heavy damage"}]},{id:"axe_shatter",name:"Armor Shatter",description:"At 3+ Armor Break, enemy takes 10% more damage",icon:"ðŸ”¨",tier:2,cost:2,requires:["axe_rend"],effects:[{special:"armor_break_bonus",value:.1,description:"+10% dmg at 3+ Armor Break"}]},{id:"axe_overhead",name:"Overhead Slam",description:"Heavy attacks have 10% stun chance",icon:"â¬‡ï¸",tier:2,cost:2,requires:["axe_brutal"],effects:[{special:"heavy_stun",value:.1,description:"10% Stun on heavy attacks"}]},{id:"axe_executioner",name:"Executioner",description:"+25% damage vs enemies below 30% HP",icon:"â˜ ï¸",tier:2,cost:2,requires:["axe_brutal"],effects:[{special:"execute_damage",value:.25,description:"+25% dmg vs low HP"}]},{id:"axe_breaker",name:"Shield Breaker",description:"Attacks vs guarding enemies deal +30% damage",icon:"ðŸ›¡ï¸ðŸ’”",tier:3,cost:3,requires:["axe_shatter"],effects:[{special:"guard_damage",value:.3,description:"+30% vs guarding"}]},{id:"axe_cleave",name:"Devastating Cleave",description:"Heavy attacks apply 2 Armor Break",icon:"ðŸŒ€",tier:3,cost:3,requires:["axe_overhead","axe_shatter"],effects:[{stat:"heavyArmorBreak",value:2,description:"+2 Armor Break on heavy"}]}]},{weaponType:"dagger",name:"Art of the Shadow",icon:"ðŸ—¡ï¸",description:"Swift strikes and deadly crits",nodes:[{id:"dagger_swift",name:"Swift Cuts",description:"-3 stamina on light attacks",icon:"ðŸ’¨",tier:1,cost:1,effects:[{stat:"lightAttackCost",value:-3,description:"-3 Stamina on lights"}]},{id:"dagger_vital",name:"Vital Targets",description:"+10% critical chance",icon:"ðŸŽ¯",tier:1,cost:1,effects:[{stat:"critChance",value:.1,isPercent:!0,description:"+10% Crit chance"}]},{id:"dagger_bleed",name:"Deep Cuts",description:"Crits apply 2 stacks of bleed",icon:"ðŸ©¸",tier:2,cost:2,requires:["dagger_vital"],effects:[{special:"crit_bleed",value:2,description:"Crits apply 2 Bleed"}]},{id:"dagger_evade",name:"Evasive Strikes",description:"+10% dodge chance",icon:"ðŸ‘»",tier:2,cost:2,requires:["dagger_swift"],effects:[{stat:"dodge",value:.1,isPercent:!0,description:"+10% Dodge"}]},{id:"dagger_poison",name:"Poison Edge",description:"Attacks have 15% chance to poison (3 dmg/turn)",icon:"â˜ ï¸",tier:2,cost:2,requires:["dagger_bleed"],effects:[{special:"poison_chance",value:.15,description:"15% Poison chance"}]},{id:"dagger_assassin",name:"Assassin Strike",description:"+50% crit damage",icon:"ðŸ’€",tier:3,cost:3,requires:["dagger_bleed","dagger_vital"],effects:[{stat:"critDamage",value:.5,isPercent:!0,description:"+50% Crit damage"}]},{id:"dagger_shadow",name:"Shadow Step",description:"Successful dodge grants +20% damage on next attack",icon:"ðŸŒ‘",tier:3,cost:3,requires:["dagger_evade"],effects:[{special:"dodge_damage",value:.2,description:"+20% dmg after dodge"}]}]},{weaponType:"spear",name:"Way of the Reach",icon:"ðŸ”±",description:"Keep enemies at distance with superior reach",nodes:[{id:"spear_reach",name:"Extended Reach",description:"+5% accuracy, can attack before enemy closes",icon:"ðŸ“",tier:1,cost:1,effects:[{stat:"accuracy",value:.05,isPercent:!0,description:"+5% Accuracy"}]},{id:"spear_thrust",name:"Piercing Thrust",description:"Light attacks ignore 10% armor",icon:"âž¡ï¸",tier:1,cost:1,effects:[{special:"light_pierce",value:.1,description:"Lights pierce 10% DEF"}]},{id:"spear_poke",name:"Keep at Bay",description:"First attack each combat has +15% damage",icon:"ðŸ›‘",tier:2,cost:2,requires:["spear_reach"],effects:[{special:"first_strike",value:.15,description:"+15% first attack damage"}]},{id:"spear_impale",name:"Impaling Strike",description:"Heavy attacks cause 2 bleed stacks",icon:"ðŸ©¸",tier:2,cost:2,requires:["spear_thrust"],effects:[{special:"heavy_bleed",value:2,description:"Heavies apply 2 Bleed"}]},{id:"spear_stance",name:"Defensive Stance",description:"+10% parry window when at full stamina",icon:"ðŸ›¡ï¸",tier:2,cost:2,requires:["spear_reach"],effects:[{special:"full_stamina_parry",value:.1,description:"+10% Parry at full stamina"}]},{id:"spear_legion",name:"Legion Tactics",description:"Guard regenerates 3 stamina instead of costing",icon:"ðŸ›ï¸",tier:3,cost:3,requires:["spear_stance"],effects:[{special:"guard_regen",value:3,description:"Guard gives +3 stamina"}]},{id:"spear_master",name:"Spear Master",description:"+20% damage when enemy below 50% stamina",icon:"ðŸ‘‘",tier:3,cost:3,requires:["spear_impale","spear_poke"],effects:[{special:"stamina_damage",value:.2,description:"+20% dmg vs low stamina"}]}]},{weaponType:"mace",name:"Path of the Crusher",icon:"ðŸ”¨",description:"Stun enemies and break their will",nodes:[{id:"mace_concussion",name:"Concussive Blows",description:"+10% stun chance on all attacks",icon:"ðŸ’«",tier:1,cost:1,effects:[{stat:"stunChance",value:.1,isPercent:!0,description:"+10% Stun chance"}]},{id:"mace_weight",name:"Weighted Strikes",description:"+10% damage with heavy attacks",icon:"ðŸ’ª",tier:1,cost:1,effects:[{special:"heavy_damage",value:.1,description:"+10% Heavy damage"}]},{id:"mace_followup",name:"Follow-Up Strike",description:"Stunned enemies take +20% damage",icon:"âš¡",tier:2,cost:2,requires:["mace_concussion"],effects:[{special:"stun_damage",value:.2,description:"+20% vs Stunned"}]},{id:"mace_guard_crush",name:"Guard Crush",description:"Heavy attacks vs guarding apply 2 Armor Break",icon:"ðŸ›¡ï¸ðŸ’¥",tier:2,cost:2,requires:["mace_weight"],effects:[{special:"guard_armor_break",value:2,description:"2 Armor Break vs guard"}]},{id:"mace_intimidate",name:"Intimidating Presence",description:"Enemies have -5% accuracy",icon:"ðŸ˜°",tier:2,cost:2,requires:["mace_concussion"],effects:[{special:"enemy_accuracy_debuff",value:-.05,description:"Enemy -5% Accuracy"}]},{id:"mace_shockwave",name:"Shockwave",description:"Stuns last 1 additional turn",icon:"ðŸŒŠ",tier:3,cost:3,requires:["mace_followup","mace_intimidate"],effects:[{special:"stun_duration",value:1,description:"+1 Stun duration"}]},{id:"mace_skull_crack",name:"Skull Cracker",description:"Heavy attacks have 20% stun chance",icon:"ðŸ’€",tier:3,cost:3,requires:["mace_guard_crush","mace_concussion"],effects:[{special:"heavy_stun",value:.2,description:"20% Stun on heavy"}]}]},{weaponType:"greatsword",name:"Way of the Colossus",icon:"ðŸ—¡ï¸",description:"Overwhelm foes with massive strikes",nodes:[{id:"great_momentum",name:"Building Momentum",description:"+1 Momentum gain per attack",icon:"ðŸ”„",tier:1,cost:1,effects:[{stat:"momentumGain",value:1,description:"+1 Momentum gain"}]},{id:"great_sweeping",name:"Sweeping Strikes",description:"+15% damage on heavy attacks",icon:"ðŸŒ€",tier:1,cost:1,effects:[{special:"heavy_damage",value:.15,description:"+15% Heavy damage"}]},{id:"great_unstoppable",name:"Unstoppable Force",description:"Attacks can't be parried at 3+ Momentum",icon:"ðŸš€",tier:2,cost:2,requires:["great_momentum"],effects:[{special:"unparryable",value:3,description:"Unparryable at 3+ Momentum"}]},{id:"great_cleave",name:"Mighty Cleave",description:"Heavy attacks deal +5 flat damage",icon:"âš”ï¸",tier:2,cost:2,requires:["great_sweeping"],effects:[{special:"heavy_flat_damage",value:5,description:"+5 Heavy damage"}]},{id:"great_endurance",name:"Enduring Strength",description:"-5 stamina cost on heavy attacks",icon:"ðŸ’ª",tier:2,cost:2,requires:["great_sweeping"],effects:[{stat:"heavyAttackCost",value:-5,description:"-5 Heavy stamina"}]},{id:"great_execution",name:"Execution",description:"Heavy attacks at 5+ Momentum deal +40% damage",icon:"â˜ ï¸",tier:3,cost:3,requires:["great_unstoppable","great_cleave"],effects:[{special:"momentum_execute",value:.4,description:"+40% dmg at 5+ Momentum"}]},{id:"great_intimidate",name:"Overwhelming Presence",description:"At 3+ Momentum, enemy dodge reduced by 10%",icon:"ðŸ˜±",tier:3,cost:3,requires:["great_endurance","great_unstoppable"],effects:[{special:"reduce_enemy_dodge",value:-.1,description:"Enemy -10% Dodge"}]}]}];function be(c){return Wt.find(n=>n.weaponType===c)}function Ss(c,n){const e=be(c);return e?e.nodes.filter(a=>n.includes(a.id)):[]}function Tt(c,n,e,a){if(e-a<c.cost)return{canUnlock:!1,reason:`Need ${c.cost} Mastery Points`};if(c.requires){for(const t of c.requires)if(!n.includes(t))return{canUnlock:!1,reason:"Requires previous node"}}if(c.exclusive){for(const t of c.exclusive)if(n.includes(t))return{canUnlock:!1,reason:"Exclusive with another node"}}const i={1:0,2:2,3:4};return a<i[c.tier]?{canUnlock:!1,reason:`Need ${i[c.tier]} points in tree`}:{canUnlock:!0}}function Rt(c,n){return Ss(c,n).reduce((a,i)=>a+i.cost,0)}class ws extends w.Scene{constructor(){super({key:"WeaponMasteryScene"});m(this,"masteryPoints",0);m(this,"currentWeaponType","sword");m(this,"unlockedNodes",[]);m(this,"treeContainer");m(this,"infoPanel");m(this,"selectedNode",null)}create(){var i;const e=p.getRun();this.masteryPoints=e.masteryPoints||0;const a=e.loadout;if(a!=null&&a.weaponId){const t=e.inventory.find(s=>s.instanceId===a.weaponId);if(t){const s=Qe(t.itemId);s&&(this.currentWeaponType=s.type)}}this.unlockedNodes=((i=e.weaponMastery)==null?void 0:i[this.currentWeaponType])||[],this.createBackground(),this.createHeader(),this.createWeaponTabs(),this.createTree(),this.createInfoPanel(),this.createBackButton(),this.cameras.main.fadeIn(300)}createBackground(){const{width:e,height:a}=this.cameras.main,i=this.add.graphics();i.fillGradientStyle(1709072,1709072,2760474,2760474),i.fillRect(0,0,e,a)}createHeader(){const{width:e}=this.cameras.main,a=be(this.currentWeaponType),i=a?`${a.icon} ${a.name}`:"âš”ï¸ Weapon Mastery";this.add.text(e/2,30,i,{fontFamily:"Georgia, serif",fontSize:"20px",color:"#c9a959",stroke:"#000000",strokeThickness:3}).setOrigin(.5),this.add.text(e-20,25,`ðŸŒŸ ${this.masteryPoints}`,{fontFamily:"Georgia, serif",fontSize:"18px",color:"#ffd700"}).setOrigin(1,0),this.add.text(e-20,45,"Mastery Points",{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355"}).setOrigin(1,0)}createWeaponTabs(){const{width:e}=this.cameras.main,a=70,i=Wt.map(r=>r.weaponType),t=Math.min(50,(e-20)/i.length),s=e/2-i.length*t/2+t/2;i.forEach((r,o)=>{const d=be(r);if(!d)return;const l=s+o*t,h=r===this.currentWeaponType,u=this.add.graphics();u.fillStyle(h?4864554:2760474,1),u.fillRoundedRect(l-t/2+2,a,t-4,35,4),h&&(u.lineStyle(2,13216089,1),u.strokeRoundedRect(l-t/2+2,a,t-4,35,4));const f=this.add.text(l,a+17,d.icon,{fontSize:"18px"}).setOrigin(.5);if(!h){f.setAlpha(.6);const g=this.add.rectangle(l,a+17,t-4,35);g.setInteractive({useHandCursor:!0}),g.on("pointerdown",()=>{this.currentWeaponType=r,this.scene.restart()})}})}createTree(){const{width:e,height:a}=this.cameras.main;this.treeContainer&&this.treeContainer.destroy(),this.treeContainer=this.add.container(0,0);const i=be(this.currentWeaponType);if(!i){this.add.text(e/2,a/2,"No skill tree for this weapon",{fontFamily:"Georgia, serif",fontSize:"14px",color:"#5a4a3a"}).setOrigin(.5);return}const t=120,s=120,r=50,o=new Map;i.nodes.forEach(h=>{o.has(h.tier)||o.set(h.tier,[]),o.get(h.tier).push(h)});const d=new Map;for(const[h,u]of o){const f=t+(h-1)*s,g=e/(u.length+1);u.forEach((y,S)=>{const b=g*(S+1);d.set(y.id,{x:b,y:f})})}const l=this.add.graphics();l.lineStyle(2,5917242,.6),i.nodes.forEach(h=>{if(h.requires){const u=d.get(h.id);if(!u)return;h.requires.forEach(f=>{const g=d.get(f);g&&(l.beginPath(),l.moveTo(g.x,g.y+r/2),l.lineTo(u.x,u.y-r/2),l.strokePath())})}}),this.treeContainer.add(l),i.nodes.forEach(h=>{const u=d.get(h.id);u&&this.createNode(h,u.x,u.y,r)})}createNode(e,a,i,t){const s=this.unlockedNodes.includes(e.id),r=Rt(this.currentWeaponType,this.unlockedNodes),o=Tt(e,this.unlockedNodes,this.masteryPoints+r,r),d=this.add.container(a,i);this.treeContainer.add(d);const l=this.add.graphics();let h=2760474,u=5917242;s?(h=3828282,u=6986346):o.canUnlock&&(h=4868650,u=13216089),l.fillStyle(h,1),l.fillRoundedRect(-t/2,-t/2,t,t,8),l.lineStyle(2,u,1),l.strokeRoundedRect(-t/2,-t/2,t,t,8),d.add(l);const f=this.add.text(0,-5,e.icon,{fontSize:"20px"}).setOrigin(.5);if(d.add(f),!s){const g=this.add.text(0,t/2-12,`${e.cost}ðŸŒŸ`,{fontFamily:"Georgia, serif",fontSize:"10px",color:o.canUnlock?"#ffd700":"#5a4a3a"}).setOrigin(.5);d.add(g)}d.setSize(t,t),d.setInteractive(new w.Geom.Rectangle(-t/2,-t/2,t,t),w.Geom.Rectangle.Contains),d.on("pointerover",()=>{l.clear(),l.fillStyle(s?4885066:3815978,1),l.fillRoundedRect(-t/2,-t/2,t,t,8),l.lineStyle(3,13216089,1),l.strokeRoundedRect(-t/2,-t/2,t,t,8)}),d.on("pointerout",()=>{l.clear(),l.fillStyle(h,1),l.fillRoundedRect(-t/2,-t/2,t,t,8),l.lineStyle(2,u,1),l.strokeRoundedRect(-t/2,-t/2,t,t,8)}),d.on("pointerdown",()=>{this.selectNode(e)})}selectNode(e){this.selectedNode=e,this.createInfoPanel()}createInfoPanel(){const{width:e,height:a}=this.cameras.main;this.infoPanel&&this.infoPanel.destroy(),this.infoPanel=this.add.container(0,0);const i=a-180,t=130,s=this.add.graphics();if(s.fillStyle(1709072,.95),s.fillRoundedRect(15,i,e-30,t,8),s.lineStyle(2,5917242,1),s.strokeRoundedRect(15,i,e-30,t,8),this.infoPanel.add(s),!this.selectedNode){const g=this.add.text(e/2,i+t/2,"Tap a node to view details",{fontFamily:"Georgia, serif",fontSize:"14px",color:"#5a4a3a",fontStyle:"italic"}).setOrigin(.5);this.infoPanel.add(g);return}const r=this.selectedNode,o=this.unlockedNodes.includes(r.id),d=Rt(this.currentWeaponType,this.unlockedNodes),l=Tt(r,this.unlockedNodes,this.masteryPoints+d,d),h=this.add.text(25,i+15,`${r.icon} ${r.name}`,{fontFamily:"Georgia, serif",fontSize:"16px",color:o?"#6a9a6a":"#c9a959"});this.infoPanel.add(h);const u=this.add.text(25,i+40,r.description,{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b7355",wordWrap:{width:e-70}});this.infoPanel.add(u);let f=i+65;if(r.effects.forEach(g=>{const y=this.add.text(25,f,`â€¢ ${g.description}`,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#c9a959"});this.infoPanel.add(y),f+=14}),o){const g=this.add.text(e-25,i+15,"âœ“ UNLOCKED",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#6a9a6a"}).setOrigin(1,0);this.infoPanel.add(g)}else if(l.canUnlock){const g=T.createButton(this,e-70,i+t-30,`UNLOCK (${r.cost}ðŸŒŸ)`,()=>this.unlockNode(r),{width:110,height:35,fontSize:"11px",primary:!0});this.infoPanel.add(g)}else{const g=this.add.text(e-25,i+15,l.reason||"Locked",{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b0000"}).setOrigin(1,0);this.infoPanel.add(g)}}unlockNode(e){if(this.masteryPoints<e.cost){T.showNotification(this,"Not enough Mastery Points!");return}this.masteryPoints-=e.cost,this.unlockedNodes.push(e.id);const i={...p.getRun().weaponMastery};i[this.currentWeaponType]=[...this.unlockedNodes],p.updateRun({masteryPoints:this.masteryPoints,weaponMastery:i}),T.showNotification(this,`Unlocked: ${e.name}!`),this.scene.restart()}createBackButton(){const{width:e,height:a}=this.cameras.main;T.createButton(this,e/2,a-35,"â† BACK",()=>this.returnToCamp(),{width:150,height:40})}returnToCamp(){this.cameras.main.fadeOut(200),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("CampScene")})}}const It={fight:{icon:"âš”ï¸",name:"Fight",description:"Standard arena battle"},elite:{icon:"ðŸ’€",name:"Elite Fight",description:"Tough enemy, better rewards"},shop:{icon:"ðŸ›’",name:"Merchant",description:"Buy weapons, armor, items"},clinic:{icon:"ðŸ¥",name:"Clinic",description:"Heal wounds and injuries"},event:{icon:"â“",name:"Event",description:"A mysterious encounter"},forge:{icon:"ðŸ”¥",name:"Forge",description:"Upgrade equipment"},rival:{icon:"ðŸ‘Š",name:"Rival",description:"Face your nemesis"},champion:{icon:"ðŸ‘‘",name:"Champion",description:"League boss battle"}},Pt={bronze:{rows:6,nodesPerRow:[2,3],eliteChance:.15,shopCount:1,forgeCount:1,clinicCount:1,eventCount:1,hasRival:!1},silver:{rows:7,nodesPerRow:[2,4],eliteChance:.2,shopCount:2,forgeCount:1,clinicCount:1,eventCount:2,hasRival:!0},gold:{rows:8,nodesPerRow:[3,4],eliteChance:.25,shopCount:2,forgeCount:2,clinicCount:2,eventCount:2,hasRival:!0},champion:{rows:5,nodesPerRow:[2,3],eliteChance:.4,shopCount:1,forgeCount:1,clinicCount:1,eventCount:1,hasRival:!0}};function bs(c,n){var r;const e=Pt[c]||Pt.bronze,a=ks(n||Date.now()),i=[];let t=0;const s=[];for(let o=0;o<e.rows;o++){const[d,l]=e.nodesPerRow,h=d+Math.floor(a()*(l-d+1)),u=[];for(let f=0;f<h;f++){const g=`node_${t++}`,y=(f+.5)/h;let S="fight";o===e.rows-1&&f===Math.floor(h/2)?S="champion":o>0&&o<e.rows-1&&a()<e.eliteChance&&(S="elite"),i.push({id:g,type:S,x:y,y:o,connections:[],completed:!1}),u.push(g)}s.push(u)}for(let o=0;o<s.length-1;o++){const d=s[o],l=s[o+1];d.forEach((h,u)=>{const f=i.find(S=>S.id===h),g=1+(a()>.5?1:0),y=[...l];for(let S=0;S<g&&y.length>0;S++){const b=y.map(B=>{const P=i.find(A=>A.id===B);return 1-Math.abs(P.x-f.x)*.5}),M=b.reduce((B,P)=>B+P,0);let C=a()*M,x=0;for(let B=0;B<b.length;B++)if(C-=b[B],C<=0){x=B;break}const R=y.splice(x,1)[0];f.connections.push(R)}})}if(xs(i,e,a),e.hasRival){const o=Math.floor(e.rows*.6),d=i.filter(l=>l.y===o&&l.type==="fight");d.length>0&&(d[Math.floor(a()*d.length)].type="rival")}return{league:c,nodes:i,currentNodeId:null,startNodeIds:s[0],bossNodeId:((r=i.find(o=>o.type==="champion"))==null?void 0:r.id)||i[i.length-1].id}}function xs(c,n,e){const a={shop:n.shopCount,forge:n.forgeCount,clinic:n.clinicCount,event:n.eventCount},t=[...c.filter(r=>r.type==="fight"&&r.y>0&&r.y<c.reduce((o,d)=>Math.max(o,d.y),0))].sort(()=>e()-.5);let s=0;for(const[r,o]of Object.entries(a))for(let d=0;d<o&&s<t.length;d++,s++)t[s].type=r}function ks(c){let n=c;return()=>(n=n*1103515245+12345&2147483647,n/2147483647)}function ke(c,n){return c.nodes.find(e=>e.id===n)}function Cs(c){if(!c.currentNodeId)return c.nodes.filter(e=>c.startNodeIds.includes(e.id));const n=ke(c,c.currentNodeId);return n?c.nodes.filter(e=>n.connections.includes(e.id)&&!e.completed):[]}function Ms(c,n){const e=ke(c,n);e&&(e.completed=!0,c.currentNodeId=n)}class Ts extends w.Scene{constructor(){super({key:"RunMapScene"});m(this,"runMap");m(this,"nodeContainers",new Map);m(this,"selectedNodeId",null);m(this,"infoPanel")}create(){const e=p.getRun();e.runMap?this.runMap=e.runMap:(this.runMap=bs(e.league,e.seed),p.updateRun({runMap:this.runMap})),this.createBackground(),this.createHeader(),this.drawConnections(),this.drawNodes(),this.createInfoPanel(),this.createBottomUI(),this.cameras.main.fadeIn(300)}createBackground(){const{width:e,height:a}=this.cameras.main,i=this.add.graphics();i.fillGradientStyle(1709072,1709072,2760474,2760474),i.fillRect(0,0,e,a);for(let t=0;t<50;t++){const s=Math.random()*e,r=Math.random()*a,o=1+Math.random()*2;i.fillStyle(3811866,.1+Math.random()*.1),i.fillCircle(s,r,o)}}createHeader(){const{width:e}=this.cameras.main,a=p.getRun(),i={bronze:"Bronze League",silver:"Silver League",gold:"Gold League",champion:"Championship"};this.add.text(e/2,30,`ðŸ—ºï¸ ${i[a.league]||"Arena"}`,{fontFamily:"Georgia, serif",fontSize:"20px",color:"#c9a959",stroke:"#000000",strokeThickness:3}).setOrigin(.5);const t=this.runMap.nodes.filter(r=>r.completed).length,s=this.runMap.nodes.length;this.add.text(e/2,55,`Progress: ${t}/${s}`,{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b7355"}).setOrigin(.5)}drawConnections(){const{width:e,height:a}=this.cameras.main,i=80,t=a-200,s=t-i,r=Math.max(...this.runMap.nodes.map(d=>d.y)),o=this.add.graphics();this.runMap.nodes.forEach(d=>{const l=40+d.x*(e-80),h=t-d.y/r*s;d.connections.forEach(u=>{const f=ke(this.runMap,u);if(!f)return;const g=40+f.x*(e-80),y=t-f.y/r*s,S=this.isNodeAccessible(u),b=d.completed?S?13216089:5917242:3815994;o.lineStyle(2,b,.8),o.beginPath(),o.moveTo(l,h),o.lineTo(g,y),o.strokePath()})})}drawNodes(){const{width:e,height:a}=this.cameras.main,i=80,t=a-200,s=t-i,r=Math.max(...this.runMap.nodes.map(d=>d.y)),o=40;this.runMap.nodes.forEach(d=>{const l=40+d.x*(e-80),h=t-d.y/r*s;this.createNodeVisual(d,l,h,o)})}createNodeVisual(e,a,i,t){const s=this.add.container(a,i);this.nodeContainers.set(e.id,s);const r=It[e.type],o=this.isNodeAccessible(e.id),d=this.runMap.currentNodeId===e.id,l=this.add.graphics();let h=2760474,u=5917242;e.completed?(h=1718810,u=3828282):o?(h=3815978,u=13216089):d&&(h=4864554,u=16766720),l.fillStyle(h,1),l.fillCircle(0,0,t/2),l.lineStyle(3,u,1),l.strokeCircle(0,0,t/2),s.add(l);const f=this.add.text(0,0,r.icon,{fontSize:"18px"}).setOrigin(.5);if(s.add(f),d){const g=this.add.graphics();g.lineStyle(2,16766720,.5),g.strokeCircle(0,0,t/2+5),s.add(g),this.tweens.add({targets:g,alpha:{from:1,to:.3},duration:800,yoyo:!0,repeat:-1})}if(e.completed){const g=this.add.text(t/2-5,-t/2+5,"âœ“",{fontSize:"12px",color:"#4a8a4a"}).setOrigin(.5);s.add(g)}o&&!e.completed&&(s.setSize(t,t),s.setInteractive(new w.Geom.Circle(0,0,t/2),w.Geom.Circle.Contains),s.on("pointerover",()=>{l.clear(),l.fillStyle(4868666,1),l.fillCircle(0,0,t/2),l.lineStyle(3,16766720,1),l.strokeCircle(0,0,t/2)}),s.on("pointerout",()=>{l.clear(),l.fillStyle(h,1),l.fillCircle(0,0,t/2),l.lineStyle(3,u,1),l.strokeCircle(0,0,t/2)}),s.on("pointerdown",()=>{this.selectNode(e.id)}))}isNodeAccessible(e){return Cs(this.runMap).some(i=>i.id===e)}selectNode(e){this.selectedNodeId=e,this.updateInfoPanel()}createInfoPanel(){const{width:e,height:a}=this.cameras.main;this.infoPanel=this.add.container(0,0);const i=a-190,t=100,s=this.add.graphics();s.fillStyle(1709072,.95),s.fillRoundedRect(15,i,e-30,t,8),s.lineStyle(2,5917242,1),s.strokeRoundedRect(15,i,e-30,t,8),this.infoPanel.add(s);const r=this.add.text(e/2,i+t/2,"Select a node to travel",{fontFamily:"Georgia, serif",fontSize:"14px",color:"#5a4a3a",fontStyle:"italic"}).setOrigin(.5);this.infoPanel.add(r)}updateInfoPanel(){const{width:e,height:a}=this.cameras.main,i=a-190,t=100;this.infoPanel.destroy(),this.infoPanel=this.add.container(0,0);const s=this.add.graphics();if(s.fillStyle(1709072,.95),s.fillRoundedRect(15,i,e-30,t,8),s.lineStyle(2,5917242,1),s.strokeRoundedRect(15,i,e-30,t,8),this.infoPanel.add(s),!this.selectedNodeId){const u=this.add.text(e/2,i+t/2,"Select a node to travel",{fontFamily:"Georgia, serif",fontSize:"14px",color:"#5a4a3a",fontStyle:"italic"}).setOrigin(.5);this.infoPanel.add(u);return}const r=ke(this.runMap,this.selectedNodeId);if(!r)return;const o=It[r.type],d=this.add.text(25,i+15,`${o.icon} ${o.name}`,{fontFamily:"Georgia, serif",fontSize:"16px",color:"#c9a959"});this.infoPanel.add(d);const l=this.add.text(25,i+40,o.description,{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b7355"});this.infoPanel.add(l);const h=T.createButton(this,e-80,i+t/2,"TRAVEL",()=>this.travelToNode(r),{width:100,height:40,fontSize:"14px",primary:!0});this.infoPanel.add(h)}travelToNode(e){Ms(this.runMap,e.id),p.updateRun({runMap:this.runMap}),this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{switch(e.type){case"fight":case"elite":this.scene.start("PrepareScene",{nodeType:e.type});break;case"champion":this.scene.start("PrepareScene",{nodeType:"champion"});break;case"rival":this.scene.start("PrepareScene",{nodeType:"rival"});break;case"shop":this.scene.start("ShopScene");break;case"forge":this.scene.start("ForgeScene");break;case"clinic":this.scene.start("CampScene");break;case"event":this.scene.start("VignetteScene");break;default:this.scene.start("CampScene")}})}createBottomUI(){const{width:e,height:a}=this.cameras.main;T.createButton(this,e/2,a-40,"â† BACK TO CAMP",()=>this.returnToCamp(),{width:180,height:45})}returnToCamp(){this.cameras.main.fadeOut(200),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("CampScene")})}}function Rs(c,n){return n===0?0:Math.round(c.length/n*100)}function Is(c){return{enemies:"ðŸ’€",mutators:"ðŸ§¬",affixes:"âœ¨",decrees:"ðŸ“œ",biomes:"ðŸ›ï¸",signatures:"âš¡",weapons:"âš”ï¸",armor:"ðŸ›¡ï¸"}[c]||"ðŸ“–"}function Ps(c){return{enemies:"Enemy Classes",mutators:"Enemy Mutators",affixes:"Item Affixes",decrees:"Arena Decrees",biomes:"Arena Biomes",signatures:"Signature Moves",weapons:"Weapons",armor:"Armor"}[c]||c}const _s=[{id:"biome_standard_pit",name:"The Pit",icon:"ðŸ›ï¸",description:"A standard arena with no special rules",ambience:"The roar of the crowd echoes off stone walls.",mods:[],specialRules:[],visualTheme:"stone"},{id:"biome_mud",name:"Muddy Arena",icon:"ðŸŸ¤",description:"Slippery footing reduces mobility",ambience:"Rain has turned the arena floor to treacherous mud.",mods:[{stat:"dodge",value:-.1,isPercent:!0,target:"both",description:"-10% Dodge for all"},{stat:"staminaRegen",value:-1,target:"both",description:"-1 Stamina regen"}],specialRules:[{type:"passive",effect:"Falls cause 5 damage when dodge fails",value:5}],visualTheme:"mud"},{id:"biome_frozen",name:"Frozen Courtyard",icon:"â„ï¸",description:"Ice reduces stamina recovery",ambience:"Frost clings to every surface. Breath turns to mist.",mods:[{stat:"staminaRegen",value:-2,target:"both",description:"-2 Stamina regen"}],specialRules:[{type:"combat",effect:"Bleed deals 50% less damage",value:-.5}],visualTheme:"ice"},{id:"biome_chapel",name:"Ruined Chapel",icon:"â›ª",description:"Sacred ground offers protection",ambience:"Broken stained glass casts colored shadows.",mods:[{stat:"defense",value:3,target:"both",description:"+3 Defense for all"}],specialRules:[{type:"passive",effect:"Wounds are less likely (-10%)",value:-.1}],visualTheme:"chapel"},{id:"biome_iron_cage",name:"Iron Cage",icon:"â¬›",description:"No escape, no mercy",ambience:"Iron bars surround you. The crowd demands blood.",mods:[{stat:"damage",value:.1,isPercent:!0,target:"both",description:"+10% Damage for all"}],specialRules:[{type:"combat",effect:"Cannot flee or dodge backwards",value:0},{type:"reward",effect:"+20% gold on win",value:.2}],visualTheme:"iron"},{id:"biome_fire_pit",name:"Fire Pit",icon:"ðŸ”¥",description:"Flames lick at the arena edges",ambience:"Heat radiates from the burning coals surrounding the pit.",mods:[{stat:"staminaRegen",value:-1,target:"both",description:"-1 Stamina regen"}],specialRules:[{type:"combat",effect:"Knocked down fighters take 3 fire damage",value:3},{type:"passive",effect:"Bleed causes +1 extra damage per tick",value:1}],visualTheme:"fire"},{id:"biome_colosseum",name:"Grand Colosseum",icon:"ðŸŸï¸",description:"The biggest stage. The crowd is watching.",ambience:"Thousands watch. Every action earns cheers or jeers.",mods:[],specialRules:[{type:"passive",effect:"+50% Hype gain from all sources",value:.5},{type:"reward",effect:"+25% Fame on win",value:.25}],visualTheme:"grand"},{id:"biome_dungeon",name:"Prison Dungeon",icon:"â›“ï¸",description:"Dark and cramped. Fear is your enemy.",ambience:"Chains rattle. The smell of rust and despair hangs heavy.",mods:[{stat:"accuracy",value:-.05,isPercent:!0,target:"both",description:"-5% Accuracy (darkness)"}],specialRules:[{type:"passive",effect:"Enemy has +10% crit chance",value:.1}],visualTheme:"dungeon"},{id:"biome_garden",name:"Nobleman's Garden",icon:"ðŸŒ³",description:"A genteel setting for violence",ambience:"Roses bloom around the fighting circle. How civilized.",mods:[{stat:"staminaRegen",value:1,target:"both",description:"+1 Stamina regen"}],specialRules:[{type:"reward",effect:"+10% gold but no Embers",value:.1}],visualTheme:"garden"},{id:"biome_blood_sand",name:"Blood Sands",icon:"ðŸœï¸",description:"The sand remembers every fallen warrior",ambience:"The sand is stained red from countless battles.",mods:[{stat:"bleedDamage",value:.25,isPercent:!0,target:"both",description:"+25% Bleed damage"}],specialRules:[{type:"passive",effect:"Wounds heal 50% slower",value:-.5}],visualTheme:"desert"}],As=[{id:"sig_fury_strike",name:"Fury Strike",icon:"ðŸ’¥",description:"A devastating blow that ignores armor",type:"active",cooldown:4,levels:[{level:1,xpRequired:0,effect:"Deals 150% damage, ignores 20% DEF",value:1.5},{level:2,xpRequired:50,effect:"Deals 175% damage, ignores 30% DEF",value:1.75},{level:3,xpRequired:150,effect:"Deals 200% damage, ignores 40% DEF",value:2},{level:4,xpRequired:300,effect:"Deals 225% damage, ignores 50% DEF",value:2.25},{level:5,xpRequired:500,effect:"Deals 250% damage, ignores 60% DEF",value:2.5}],tags:["damage","armor-pierce"]},{id:"sig_bleed_mastery",name:"Blood Ritual",icon:"ðŸ©¸",description:"Your attacks cause grievous wounds",type:"passive",triggerCondition:"On critical hit",levels:[{level:1,xpRequired:0,effect:"Crits apply 2 bleed stacks",value:2},{level:2,xpRequired:50,effect:"Crits apply 3 bleed stacks",value:3},{level:3,xpRequired:150,effect:"Crits apply 4 bleed stacks",value:4},{level:4,xpRequired:300,effect:"Crits apply 5 bleed stacks",value:5},{level:5,xpRequired:500,effect:"Crits apply 6 bleed + enemy takes +10% bleed dmg",value:6}],tags:["bleed","crit"]},{id:"sig_execute",name:"Executioner's Mark",icon:"â˜ ï¸",description:"Finish wounded foes with deadly precision",type:"passive",triggerCondition:"Enemy below 25% HP",levels:[{level:1,xpRequired:0,effect:"+20% damage vs low HP enemies",value:.2},{level:2,xpRequired:50,effect:"+30% damage vs low HP enemies",value:.3},{level:3,xpRequired:150,effect:"+40% damage vs low HP enemies",value:.4},{level:4,xpRequired:300,effect:"+50% damage vs low HP enemies",value:.5},{level:5,xpRequired:500,effect:"+60% damage, +10% crit vs low HP",value:.6}],tags:["execute","damage"]},{id:"sig_iron_skin",name:"Iron Skin",icon:"ðŸ›¡ï¸",description:"Harden your body against attacks",type:"active",cooldown:5,levels:[{level:1,xpRequired:0,effect:"Block next attack, gain 10% DEF for 2 turns",value:.1},{level:2,xpRequired:50,effect:"Block next attack, gain 15% DEF for 2 turns",value:.15},{level:3,xpRequired:150,effect:"Block next 2 attacks, gain 20% DEF for 3 turns",value:.2},{level:4,xpRequired:300,effect:"Block next 2 attacks, gain 25% DEF for 3 turns",value:.25},{level:5,xpRequired:500,effect:"Block next 3 attacks, gain 30% DEF for 4 turns",value:.3}],tags:["defense","buff"]},{id:"sig_counter",name:"Counter Stance",icon:"âš¡",description:"Turn enemy attacks into opportunities",type:"passive",triggerCondition:"On successful parry",levels:[{level:1,xpRequired:0,effect:"After parry, auto-attack for 50% damage",value:.5},{level:2,xpRequired:50,effect:"After parry, auto-attack for 75% damage",value:.75},{level:3,xpRequired:150,effect:"After parry, auto-attack for 100% damage",value:1},{level:4,xpRequired:300,effect:"After parry, attack for 100% + 15% crit",value:1},{level:5,xpRequired:500,effect:"After parry, attack for 125% + 25% crit",value:1.25}],tags:["parry","counter"]},{id:"sig_last_stand",name:"Last Stand",icon:"ðŸ”¥",description:"Fight harder when near death",type:"passive",triggerCondition:"HP below 30%",levels:[{level:1,xpRequired:0,effect:"+15% damage when low HP",value:.15},{level:2,xpRequired:50,effect:"+20% damage, +5% dodge when low HP",value:.2},{level:3,xpRequired:150,effect:"+25% damage, +10% dodge when low HP",value:.25},{level:4,xpRequired:300,effect:"+30% damage, +15% dodge when low HP",value:.3},{level:5,xpRequired:500,effect:"+35% damage, +20% dodge, heal 10% on kill",value:.35}],tags:["survival","clutch"]},{id:"sig_momentum_master",name:"Momentum Master",icon:"ðŸŒ€",description:"Build and use momentum more effectively",type:"passive",triggerCondition:"On attack",levels:[{level:1,xpRequired:0,effect:"+1 Momentum gain on hit",value:1},{level:2,xpRequired:50,effect:"+1 Momentum, burst costs 1 less",value:1},{level:3,xpRequired:150,effect:"+2 Momentum, burst costs 1 less",value:2},{level:4,xpRequired:300,effect:"+2 Momentum, burst costs 2 less",value:2},{level:5,xpRequired:500,effect:"+3 Momentum, burst gives +30% damage",value:3}],tags:["momentum","utility"]},{id:"sig_crowd_pleaser",name:"Crowd Pleaser",icon:"ðŸ‘",description:"The crowd loves you, and it shows",type:"passive",triggerCondition:"On kill or critical hit",levels:[{level:1,xpRequired:0,effect:"+10% hype gain from actions",value:.1},{level:2,xpRequired:50,effect:"+15% hype gain, hype boosts heal slightly",value:.15},{level:3,xpRequired:150,effect:"+20% hype gain, heal +3 HP per hype boost",value:.2},{level:4,xpRequired:300,effect:"+25% hype gain, heal +5 HP per hype boost",value:.25},{level:5,xpRequired:500,effect:"+30% hype, +10 HP on crowd favorite",value:.3}],tags:["hype","heal"]},{id:"sig_stamina_flow",name:"Endless Stamina",icon:"ðŸ’¨",description:"Your endurance knows no bounds",type:"passive",triggerCondition:"Per turn",levels:[{level:1,xpRequired:0,effect:"+2 stamina regen per turn",value:2},{level:2,xpRequired:50,effect:"+3 stamina regen per turn",value:3},{level:3,xpRequired:150,effect:"+4 stamina regen, -1 light attack cost",value:4},{level:4,xpRequired:300,effect:"+5 stamina regen, -2 light attack cost",value:5},{level:5,xpRequired:500,effect:"+6 stamina regen, heavy costs -3",value:6}],tags:["stamina","sustain"]},{id:"sig_intimidation",name:"Intimidating Presence",icon:"ðŸ˜ˆ",description:"Your presence weakens enemies",type:"passive",triggerCondition:"At fight start",levels:[{level:1,xpRequired:0,effect:"Enemy starts with -5% damage",value:-.05},{level:2,xpRequired:50,effect:"Enemy starts with -8% damage",value:-.08},{level:3,xpRequired:150,effect:"Enemy -10% damage, -5% accuracy",value:-.1},{level:4,xpRequired:300,effect:"Enemy -12% damage, -8% accuracy",value:-.12},{level:5,xpRequired:500,effect:"Enemy -15% damage, -10% accuracy, -5% crit",value:-.15}],tags:["debuff","control"]}];class Bs extends w.Scene{constructor(){super({key:"CodexScene"});m(this,"selectedCategory","enemies");m(this,"categoryButtons",[]);m(this,"itemListContainer");m(this,"detailPanel");m(this,"selectedItem",null)}create(){this.createBackground(),this.createHeader(),this.createCategoryTabs(),this.createItemList(),this.createDetailPanel(),this.createBackButton(),this.cameras.main.fadeIn(300)}createBackground(){const{width:e,height:a}=this.cameras.main,i=this.add.graphics();i.fillGradientStyle(1709072,1709072,2760474,2760474),i.fillRect(0,0,e,a)}createHeader(){const{width:e}=this.cameras.main;this.add.text(e/2,30,"ðŸ“– CODEX",{fontFamily:"Georgia, serif",fontSize:"22px",color:"#c9a959",stroke:"#000000",strokeThickness:3}).setOrigin(.5),this.add.text(e/2,55,"Your collection of discoveries",{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b7355",fontStyle:"italic"}).setOrigin(.5)}createCategoryTabs(){const{width:e}=this.cameras.main,a=["enemies","mutators","affixes","decrees","biomes","signatures","weapons","armor"],i=30,t=4,s=(e-30)/t,r=80;a.forEach((o,d)=>{const l=Math.floor(d/t),u=15+d%t*s+s/2,f=r+l*(i+5),g=o===this.selectedCategory,y=Is(o),S=this.add.container(u,f),b=this.add.graphics();b.fillStyle(g?4864554:2760474,1),b.fillRoundedRect(-s/2+2,-i/2,s-4,i,4),g&&(b.lineStyle(2,13216089,1),b.strokeRoundedRect(-s/2+2,-i/2,s-4,i,4)),S.add(b);const M=this.add.text(0,0,`${y}`,{fontSize:"14px"}).setOrigin(.5);S.add(M),g||(S.setSize(s-4,i),S.setInteractive(new w.Geom.Rectangle(-s/2+2,-i/2,s-4,i),w.Geom.Rectangle.Contains),S.on("pointerdown",()=>{this.selectedCategory=o,this.scene.restart()})),this.categoryButtons.push(S)})}createItemList(){const{width:e,height:a}=this.cameras.main;this.itemListContainer&&this.itemListContainer.destroy(),this.itemListContainer=this.add.container(0,0);const i=this.getItemsForCategory(this.selectedCategory),t=this.getDiscoveredIds(this.selectedCategory),s=Ps(this.selectedCategory),r=Rs(t,i.length);this.add.text(20,145,`${s} (${t.length}/${i.length})`,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#c9a959"});const o=e-40,d=8,l=168,h=this.add.graphics();h.fillStyle(2760474,1),h.fillRoundedRect(20,l,o,d,4),this.itemListContainer.add(h);const u=this.add.graphics();u.fillStyle(13216089,1),u.fillRoundedRect(20,l,o*(r/100),d,4),this.itemListContainer.add(u);const f=190,g=50,y=Math.floor((e-30)/(g+5));i.forEach((S,b)=>{const M=Math.floor(b/y),x=20+b%y*(g+5),R=f+M*(g+5),B=t.includes(S.id);this.createItemTile(S,x,R,g,B)})}createItemTile(e,a,i,t,s){const r=this.add.container(a+t/2,i+t/2);this.itemListContainer.add(r);const o=this.add.graphics();if(o.fillStyle(s?3815978:1710618,1),o.fillRoundedRect(-t/2,-t/2,t,t,4),o.lineStyle(1,s?5917242:2763306,1),o.strokeRoundedRect(-t/2,-t/2,t,t,4),r.add(o),s){const d=this.add.text(0,0,e.icon,{fontSize:"20px"}).setOrigin(.5);r.add(d),r.setSize(t,t),r.setInteractive(new w.Geom.Rectangle(-t/2,-t/2,t,t),w.Geom.Rectangle.Contains),r.on("pointerdown",()=>{this.selectItem({...e,discovered:!0})})}else{const d=this.add.text(0,0,"?",{fontFamily:"Georgia, serif",fontSize:"20px",color:"#3a3a3a"}).setOrigin(.5);r.add(d)}}selectItem(e){this.selectedItem=e,this.updateDetailPanel()}createDetailPanel(){const{width:e,height:a}=this.cameras.main;this.detailPanel=this.add.container(0,0);const i=a-180,t=130,s=this.add.graphics();s.fillStyle(1709072,.95),s.fillRoundedRect(15,i,e-30,t,8),s.lineStyle(2,5917242,1),s.strokeRoundedRect(15,i,e-30,t,8),this.detailPanel.add(s);const r=this.add.text(e/2,i+t/2,"Tap an entry to view details",{fontFamily:"Georgia, serif",fontSize:"14px",color:"#5a4a3a",fontStyle:"italic"}).setOrigin(.5);this.detailPanel.add(r)}updateDetailPanel(){const{width:e,height:a}=this.cameras.main,i=a-180,t=130;this.detailPanel.destroy(),this.detailPanel=this.add.container(0,0);const s=this.add.graphics();if(s.fillStyle(1709072,.95),s.fillRoundedRect(15,i,e-30,t,8),s.lineStyle(2,5917242,1),s.strokeRoundedRect(15,i,e-30,t,8),this.detailPanel.add(s),!this.selectedItem)return;const r=this.selectedItem,o=this.add.text(25,i+15,`${r.icon} ${r.name}`,{fontFamily:"Georgia, serif",fontSize:"16px",color:"#c9a959"});this.detailPanel.add(o);const d=this.add.text(25,i+45,r.description,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b7355",wordWrap:{width:e-60}});this.detailPanel.add(d)}getItemsForCategory(e){switch(e){case"enemies":return it.map(i=>({id:i.id,name:i.name,icon:i.icon||"ðŸ‘¤",description:i.description||"",discovered:!1}));case"mutators":return st.map(i=>({id:i.id,name:i.name,icon:i.icon,description:i.description,discovered:!1}));case"affixes":return[...Je,...Ze,...et].map(i=>({id:i.id,name:i.name,icon:"âœ¨",description:i.description,discovered:!1}));case"decrees":return at.map(i=>({id:i.id,name:i.name,icon:i.icon,description:i.description,discovered:!1}));case"biomes":return _s.map(i=>({id:i.id,name:i.name,icon:i.icon,description:i.description,discovered:!1}));case"signatures":return As.map(i=>({id:i.id,name:i.name,icon:i.icon,description:i.description,discovered:!1}));case"weapons":return Xe.map(i=>({id:i.id,name:i.name,icon:i.icon||"âš”ï¸",description:i.damageDescription||i.lore||"",discovered:!1}));case"armor":return Ke.map(i=>({id:i.id,name:i.name,icon:"ðŸ›¡ï¸",description:i.description||"",discovered:!1}));default:return[]}}getDiscoveredIds(e){var i,t;p.getMeta();const a=p.getRun();switch(e){case"enemies":return a.seenEnemyClasses||[];case"mutators":return a.seenMutatorIds||[];case"affixes":return a.seenAffixIds||[];case"decrees":return a.seenDecreeIds||[];case"biomes":return[];case"signatures":return a.signatureId?[a.signatureId]:[];case"weapons":return((i=a.inventory)==null?void 0:i.filter(s=>s.itemType==="weapon").map(s=>s.itemId))||[];case"armor":return((t=a.inventory)==null?void 0:t.filter(s=>s.itemType==="armor").map(s=>s.itemId))||[];default:return[]}}createBackButton(){const{width:e,height:a}=this.cameras.main;T.createButton(this,e/2,a-35,"â† BACK",()=>this.returnToMenu(),{width:150,height:40})}returnToMenu(){this.cameras.main.fadeOut(200),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("MainMenuScene")})}}class Es extends w.Scene{constructor(){super({key:"RunSummaryScene"});m(this,"summaryData")}init(e){var t;const a=p.getRun(),i=a.fighter;this.summaryData={won:e.won,leagueReached:a.league,peakPower:i?pe(i,a.inventory||[],a.loadout).power:0,fightsWon:a.week,fightsTotal:a.week+(e.won?0:1),goldEarned:a.gold,contractsCompleted:((t=a.completedContracts)==null?void 0:t.length)||0,signatureLevel:a.signatureLevel||1,causeOfDeath:e.causeOfDeath,equippedGear:this.getEquippedGearNames(a),activeDecrees:a.activeDecreeIds||[],buildTitle:this.generateBuildTitle(a)}}create(){this.createBackground(),this.createSummaryCard(),this.createButtons(),this.cameras.main.fadeIn(300)}createBackground(){const{width:e,height:a}=this.cameras.main,i=this.add.graphics();i.fillGradientStyle(this.summaryData.won?1714714:2759194,this.summaryData.won?1714714:2759194,this.summaryData.won?2767402:3811882,this.summaryData.won?2767402:3811882),i.fillRect(0,0,e,a)}createSummaryCard(){const{width:e,height:a}=this.cameras.main,i=this.summaryData,t=i.won?"ðŸ† VICTORY ðŸ†":"ðŸ’€ FALLEN ðŸ’€",s=i.won?"#ffd700":"#8b0000";this.add.text(e/2,40,t,{fontFamily:"Georgia, serif",fontSize:"28px",color:s,stroke:"#000000",strokeThickness:4}).setOrigin(.5),this.add.text(e/2,75,`"${i.buildTitle}"`,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#c9a959",fontStyle:"italic"}).setOrigin(.5);const r=20,o=100,d=e-40,l=a-220,h=this.add.graphics();h.fillStyle(1709072,.9),h.fillRoundedRect(r,o,d,l,10),h.lineStyle(2,i.won?4876874:6965834,1),h.strokeRoundedRect(r,o,d,l,10);let u=o+20;const f=r+20,g=r+d-20,y={bronze:"ðŸ¥‰",silver:"ðŸ¥ˆ",gold:"ðŸ¥‡",champion:"ðŸ‘‘"};this.add.text(f,u,"League Reached:",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b7355"}),this.add.text(g,u,`${y[i.leagueReached]||""} ${i.leagueReached.toUpperCase()}`,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#c9a959"}).setOrigin(1,0),u+=30,this.add.text(f,u,"Peak Power:",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b7355"}),this.add.text(g,u,`âš¡ ${i.peakPower}`,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#ffd700"}).setOrigin(1,0),u+=30,this.add.text(f,u,"Fights Won:",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b7355"}),this.add.text(g,u,`${i.fightsWon}/${i.fightsTotal}`,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#c9a959"}).setOrigin(1,0),u+=30,this.add.text(f,u,"Contracts Completed:",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b7355"}),this.add.text(g,u,`${i.contractsCompleted}`,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#c9a959"}).setOrigin(1,0),u+=30,this.add.text(f,u,"Gold Earned:",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b7355"}),this.add.text(g,u,`ðŸ’° ${i.goldEarned}`,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#ffd700"}).setOrigin(1,0),u+=40,this.add.text(f,u,"Final Loadout:",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#c9a959"}),u+=20,i.equippedGear.slice(0,3).forEach(S=>{this.add.text(f+10,u,`â€¢ ${S}`,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355"}),u+=16}),u+=10,i.activeDecrees.length>0&&(this.add.text(f,u,"Active Decrees:",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#c9a959"}),u+=20,i.activeDecrees.forEach(S=>{const b=Re(S);b&&(this.add.text(f+10,u,`${b.icon} ${b.name}`,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355"}),u+=16)})),!i.won&&i.causeOfDeath&&(u=o+l-40,this.add.text(e/2,u,`Cause of Death: ${i.causeOfDeath}`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b0000",fontStyle:"italic"}).setOrigin(.5))}createButtons(){const{width:e,height:a}=this.cameras.main;T.createButton(this,e/2,a-80,"âš”ï¸ NEW RUN",()=>this.startNewRun(),{width:200,height:50,fontSize:"18px",primary:!0}),T.createButton(this,e/2,a-30,"â† MAIN MENU",()=>this.returnToMenu(),{width:180,height:40})}startNewRun(){p.endRun(this.summaryData.won),this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("RecruitScene")})}returnToMenu(){this.cameras.main.fadeOut(200),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("MainMenuScene")})}getEquippedGearNames(e){const a=[],i=e.inventory||[],t=e.loadout;if(t!=null&&t.weaponId){const s=i.find(r=>r.instanceId===t.weaponId);s&&a.push(j(s))}if(t!=null&&t.armorId){const s=i.find(r=>r.instanceId===t.armorId);s&&a.push(j(s))}if(t!=null&&t.helmetId){const s=i.find(r=>r.instanceId===t.helmetId);s&&a.push(j(s))}return a}generateBuildTitle(e){const a={bronze:["Novice","Newcomer","Hopeful"],silver:["Contender","Rising Star","Warrior"],gold:["Champion","Legend","Master"],champion:["Immortal","Godslayer","Undefeated"]},i=e.league||"bronze",t=a[i][Math.floor(Math.random()*a[i].length)],s=["Blade","Shield","Shadow","Storm","Iron","Blood"];return`The ${s[Math.floor(Math.random()*s.length)]} ${t}`}}const Fs=()=>{const c=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),n=window.innerHeight>window.innerWidth;let e=390,a=844;return!c&&!n&&(e=600,a=900),{type:w.AUTO,parent:"game-container",width:e,height:a,backgroundColor:"#1a1410",scale:{mode:w.Scale.FIT,autoCenter:w.Scale.CENTER_BOTH,min:{width:320,height:480},max:{width:600,height:1200}},render:{pixelArt:!1,antialias:!0,roundPixels:!0},input:{activePointers:3,touch:{capture:!0}},scene:[Ut,ga,pa,$a,Wa,Ka,ei,Wi,qi,Yi,zi,Ui,ji,Vi,Ji,as,rs,ls,hs,ps,ys,vs,ws,Ts,Bs,Es],physics:{default:"arcade",arcade:{debug:!1}}}},Ds=Fs(),Os=new w.Game(Ds);window.addEventListener("resize",()=>{Os.scale.refresh()});document.addEventListener("touchstart",c=>{c.target instanceof HTMLCanvasElement&&c.preventDefault()},{passive:!1});document.addEventListener("touchmove",c=>{c.target instanceof HTMLCanvasElement&&c.preventDefault()},{passive:!1});document.addEventListener("contextmenu",c=>{c.preventDefault()});
