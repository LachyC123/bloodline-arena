var Q=Object.defineProperty;var Z=(r,s,e)=>s in r?Q(r,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[s]=e;var m=(r,s,e)=>Z(r,typeof s!="symbol"?s+"":s,e);import{P as S}from"./phaser-0RJB29YE.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const t of i)if(t.type==="childList")for(const n of t.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&a(n)}).observe(document,{childList:!0,subtree:!0});function e(i){const t={};return i.integrity&&(t.integrity=i.integrity),i.referrerPolicy&&(t.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?t.credentials="include":i.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function a(i){if(i.ep)return;i.ep=!0;const t=e(i);fetch(i.href,t)}})();class ee extends S.Scene{constructor(){super({key:"BootScene"})}init(){console.log("[BootScene] Initializing...")}preload(){}create(){console.log("[BootScene] Created - transitioning to PreloadScene"),this.registry.set("initialized",!0),this.registry.set("gameVersion","1.0.0"),this.scene.start("PreloadScene")}}const N="bloodline_arena_save",C=1,$={reduceMotion:!1,screenShake:!0,bloodFX:!0,grainFX:!0,soundEnabled:!0,musicVolume:.7,sfxVolume:.8},F={seed:0,week:0,league:"bronze",fightsInLeague:0,fightsToNextLeague:3,gold:50,fame:0,fighter:null,promise:null,rivalId:null,friendId:null,completedVignettes:[],lettersWritten:[],lastCampAction:null,inProgress:!1},W={promoterXP:0,promoterLevel:1,bloodlinePoints:0,unlockedPerks:[],hallOfLegends:[],heirlooms:[],totalRuns:0,totalWins:0,totalDeaths:0,ghostMoments:[]};class te{constructor(){m(this,"data");m(this,"autoSaveInterval",null);this.data=this.getDefaultData(),this.load()}getDefaultData(){return{version:C,settings:{...$},run:{...F},meta:{...W},lastSaved:Date.now()}}load(){try{const s=localStorage.getItem(N);if(s){const e=JSON.parse(s);return e.version!==C?this.migrate(e):this.data=this.mergeWithDefaults(e),console.log("Save data loaded successfully"),!0}}catch(s){console.error("Failed to load save data:",s)}return this.data=this.getDefaultData(),!1}mergeWithDefaults(s){return{version:C,settings:{...$,...s.settings},run:{...F,...s.run},meta:{...W,...s.meta},lastSaved:s.lastSaved||Date.now()}}migrate(s){console.log(`Migrating save from version ${s.version} to ${C}`),this.data=this.mergeWithDefaults(s),this.data.version=C,this.save()}save(){try{return this.data.lastSaved=Date.now(),localStorage.setItem(N,JSON.stringify(this.data)),console.log("Game saved"),!0}catch(s){return console.error("Failed to save game:",s),!1}}startAutoSave(s=3e4){this.stopAutoSave(),this.autoSaveInterval=window.setInterval(()=>{this.save()},s)}stopAutoSave(){this.autoSaveInterval!==null&&(clearInterval(this.autoSaveInterval),this.autoSaveInterval=null)}getSettings(){return{...this.data.settings}}updateSettings(s){this.data.settings={...this.data.settings,...s},this.save()}getRun(){return{...this.data.run}}updateRun(s){this.data.run={...this.data.run,...s},this.save()}hasActiveRun(){return this.data.run.inProgress&&this.data.run.fighter!==null}startNewRun(s){this.data.run={...F,seed:s??Math.floor(Math.random()*2147483647),inProgress:!0},this.data.meta.totalRuns++,this.save()}endRun(s){s?this.data.meta.totalWins++:this.data.meta.totalDeaths++,this.data.run.inProgress=!1,this.save()}getMeta(){return{...this.data.meta}}updateMeta(s){this.data.meta={...this.data.meta,...s},this.save()}addPromoterXP(s){this.data.meta.promoterXP+=s;const e=Math.floor(this.data.meta.promoterXP/100)+1;e>this.data.meta.promoterLevel&&(this.data.meta.promoterLevel=e,this.data.meta.bloodlinePoints+=e),this.save()}addBloodlinePoints(s){this.data.meta.bloodlinePoints+=s,this.save()}spendBloodlinePoints(s){return this.data.meta.bloodlinePoints>=s?(this.data.meta.bloodlinePoints-=s,this.save(),!0):!1}unlockPerk(s){this.data.meta.unlockedPerks.includes(s)||(this.data.meta.unlockedPerks.push(s),this.save())}hasPerk(s){return this.data.meta.unlockedPerks.includes(s)}addToHallOfLegends(s){this.data.meta.hallOfLegends.push(s),this.save()}getHallOfLegends(){return[...this.data.meta.hallOfLegends]}addHeirloom(s){this.data.meta.heirlooms.push(s),this.save()}getHeirlooms(){return[...this.data.meta.heirlooms]}addGhostMoment(s){this.data.meta.ghostMoments.push(s),this.save()}getUntriggeredGhostMoments(){return this.data.meta.ghostMoments.filter(s=>!s.triggered)}triggerGhostMoment(s,e){const a=this.data.meta.ghostMoments.find(i=>i.fighterId===s&&i.type===e&&!i.triggered);a&&(a.triggered=!0,this.save())}resetAllData(){this.data=this.getDefaultData(),this.save(),console.log("All save data has been reset")}exportSave(){return JSON.stringify(this.data,null,2)}importSave(s){try{const e=JSON.parse(s);return this.data=this.mergeWithDefaults(e),this.save(),!0}catch(e){return console.error("Failed to import save:",e),!1}}}const g=new te;class ae{constructor(s){m(this,"scene");this.scene=s}generateUIAssets(){this.generateParchmentOverlay(),this.generateVignette(),this.generateParticle()}generatePortraitAssets(){}generateArenaAssets(){this.generateArenaOverlay(),this.generateCrowdSilhouette()}generateEffectAssets(){this.generateSpark(),this.generateBloodDrop(),this.generateDustPuff()}generateIconAssets(){}generateParchmentOverlay(){const e=this.scene.make.graphics({x:0,y:0});for(let a=0;a<512;a+=4)for(let i=0;i<512;i+=4){const t=Math.random()*.1,n=S.Display.Color.GetColor(Math.floor(180+t*30),Math.floor(160+t*30),Math.floor(120+t*30));e.fillStyle(n,.02+Math.random()*.03),e.fillRect(i,a,4,4)}for(let a=0;a<20;a++){const i=Math.random()*512,t=Math.random()*512,n=20+Math.random()*40;e.fillStyle(9139029,.02),e.fillCircle(i,t,n)}e.generateTexture("parchment_overlay",512,512),e.destroy()}generateVignette(){const e=this.scene.make.graphics({x:0,y:0}),a=512/2,i=512/2,t=512*.7;for(let n=t;n>0;n-=2){const o=Math.pow(1-n/t,2)*.8;e.fillStyle(0,o*.1),e.fillCircle(a,i,n)}e.fillStyle(0,.3),e.fillRect(0,0,512,30),e.fillRect(0,482,512,30),e.fillRect(0,0,30,512),e.fillRect(482,0,30,512),e.generateTexture("vignette",512,512),e.destroy()}generateParticle(){const e=this.scene.make.graphics({x:0,y:0});for(let a=16/2;a>0;a--){const i=a/8;e.fillStyle(16777215,i),e.fillCircle(16/2,16/2,a)}e.generateTexture("particle",16,16),e.destroy()}generateArenaOverlay(){const a=this.scene.make.graphics({x:0,y:0});a.fillGradientStyle(0,0,1709072,1709072,.3),a.fillRect(0,0,512,512);for(let i=0;i<5;i++){const t=102.4*i;a.fillStyle(0,.05+i*.02),a.fillRect(0,t,512,512/10)}a.fillStyle(16753920,.03),a.fillCircle(50,100,80),a.fillCircle(462,100,80),a.generateTexture("arena_overlay",512,512),a.destroy()}generateCrowdSilhouette(){const a=this.scene.make.graphics({x:0,y:0});a.fillStyle(1709072,1);for(let i=0;i<256;i+=20){const t=8+Math.random()*6,n=44+Math.random()*10;a.fillCircle(i+10,n,t),a.fillRect(i+2,n+t-2,16,20)}a.generateTexture("crowd_silhouette",256,64),a.destroy()}generateSpark(){const e=this.scene.make.graphics({x:0,y:0});e.fillStyle(16776960,1),e.fillCircle(8/2,8/2,8/4),e.fillStyle(16753920,.5),e.fillCircle(8/2,8/2,8/2),e.generateTexture("spark",8,8),e.destroy()}generateBloodDrop(){const e=this.scene.make.graphics({x:0,y:0});e.fillStyle(9109504,1),e.fillCircle(12/2,12/2+2,12/3),e.fillTriangle(12/2,0,12/2-12/4,12/2,12/2+12/4,12/2),e.generateTexture("blood_drop",12,12),e.destroy()}generateDustPuff(){const e=this.scene.make.graphics({x:0,y:0});for(let a=0;a<5;a++){const i=16+(Math.random()-.5)*32*.4,t=32/2+(Math.random()-.5)*32*.4,n=4+Math.random()*6;e.fillStyle(9139029,.2),e.fillCircle(i,t,n)}e.generateTexture("dust_puff",32,32),e.destroy()}static generateIcon(s,e,a,i=32){const t=s.make.graphics({x:0,y:0});a(t,i),t.generateTexture(e,i,i),t.destroy()}}function ie(r){return`./${r.replace(/^\/+/,"")}`}class se extends S.Scene{constructor(){super({key:"PreloadScene"});m(this,"diag",{totalToLoad:0,totalComplete:0,totalFailed:0,lastFileKey:"",lastFileUrl:"",failedFiles:[],startTime:0});m(this,"progressBar");m(this,"diagText");m(this,"statusText");m(this,"failedText");m(this,"retryBtn");m(this,"continueBtn");m(this,"loadComplete",!1);m(this,"timedOut",!1);m(this,"transitionStarted",!1);m(this,"timeoutTimer");m(this,"TIMEOUT_MS",8e3);m(this,"BAR_WIDTH",260);m(this,"BAR_HEIGHT",18)}init(){this.diag={totalToLoad:0,totalComplete:0,totalFailed:0,lastFileKey:"",lastFileUrl:"",failedFiles:[],startTime:Date.now()},this.loadComplete=!1,this.timedOut=!1,this.transitionStarted=!1,console.log("═══════════════════════════════════════"),console.log("[PRELOAD] Scene initialized"),console.log('[PRELOAD] BASE_URL = "./"'),console.log("═══════════════════════════════════════")}preload(){this.createDiagnosticUI(),this.setupLoaderEvents(),this.startTimeout(),this.queueAssets(),this.generateProceduralAssets(),this.diag.totalToLoad=this.load.totalToLoad,this.updateDiagnostics(),console.log(`[PRELOAD] Queued ${this.diag.totalToLoad} files`)}createDiagnosticUI(){const{width:e,height:a}=this.cameras.main,i=e/2,t=a/2;this.add.rectangle(i,t,e,a,1709072),this.add.text(i,t-120,"BLOODLINE ARENA",{fontFamily:"Georgia, serif",fontSize:"24px",color:"#c9a959",stroke:"#000000",strokeThickness:3}).setOrigin(.5),this.add.text(i,t-90,"Loading...",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b7355",fontStyle:"italic"}).setOrigin(.5);const n=i-this.BAR_WIDTH/2,o=t-30,c=this.add.graphics();c.fillStyle(3811866,1),c.fillRoundedRect(n-2,o-2,this.BAR_WIDTH+4,this.BAR_HEIGHT+4,4),c.fillStyle(1709072,1),c.fillRoundedRect(n,o,this.BAR_WIDTH,this.BAR_HEIGHT,3),this.progressBar=this.add.graphics(),this.statusText=this.add.text(i,t+10,"Initializing...",{fontFamily:"monospace",fontSize:"11px",color:"#8b7355"}).setOrigin(.5),this.diagText=this.add.text(i,t+45,"",{fontFamily:"monospace",fontSize:"10px",color:"#6a6a5a",align:"center"}).setOrigin(.5),this.failedText=this.add.text(i,t+90,"",{fontFamily:"monospace",fontSize:"9px",color:"#aa6666",align:"center",wordWrap:{width:e-40}}).setOrigin(.5,0)}setupLoaderEvents(){this.load.on("progress",e=>{this.updateProgressBar(e)}),this.load.on("filestart",e=>{this.diag.lastFileKey=e.key;const a=typeof e.src=="string"?e.src:String(e.src??e.url??"(unknown)");this.diag.lastFileUrl=a,this.statusText.setText(`Loading: ${e.key}`),console.log(`[PRELOAD] Loading: ${e.key} -> ${a}`)}),this.load.on("filecomplete",e=>{this.diag.totalComplete++,console.log(`[PRELOAD] ✓ Complete: ${e}`),this.updateDiagnostics()}),this.load.on("loaderror",e=>{this.diag.totalFailed++;const a=typeof e.src=="string"?e.src:String(e.src??e.url??"(unknown)");this.diag.failedFiles.push({key:e.key,url:a}),console.error(`[PRELOAD] ✗ FAILED: ${e.key} -> ${a}`),this.updateDiagnostics(),this.updateFailedList(),this.createFallbackTexture(e.key)}),this.load.once("complete",()=>{this.loadComplete=!0,console.log("[PRELOAD] ═══ LOADER COMPLETE ═══"),console.log(`[PRELOAD] Success: ${this.diag.totalComplete}, Failed: ${this.diag.totalFailed}`),this.clearTimeout(),this.diag.totalFailed>0?this.showErrorUI():this.startTransition()})}startTimeout(){console.log(`[PRELOAD] Starting ${this.TIMEOUT_MS}ms timeout`),this.timeoutTimer=this.time.delayedCall(this.TIMEOUT_MS,()=>{!this.loadComplete&&!this.transitionStarted&&(this.timedOut=!0,console.error("[PRELOAD] ⚠ TIMEOUT - Loading took too long!"),console.error("[PRELOAD] Pending files may have 404ed or stalled"),this.showErrorUI())})}clearTimeout(){this.timeoutTimer&&(this.timeoutTimer.destroy(),this.timeoutTimer=void 0)}queueAssets(){[{key:"ui_panel",path:"assets/ui/panel.svg"},{key:"ui_button",path:"assets/ui/button.svg"},{key:"ui_frame",path:"assets/ui/frame.svg"},{key:"overlay_vignette",path:"assets/overlays/vignette.svg"},{key:"overlay_grain",path:"assets/overlays/grain.svg"},{key:"arena_bg",path:"assets/arena/background.svg"},{key:"icon_main",path:"assets/icons/icon.svg"}].forEach(({key:a,path:i})=>{const t=ie(i);console.log(`[PRELOAD] Queue: ${a} -> ${t}`),this.load.svg(a,t)})}generateProceduralAssets(){try{const e=new ae(this);e.generateUIAssets(),e.generatePortraitAssets(),e.generateArenaAssets(),e.generateEffectAssets(),e.generateIconAssets(),console.log("[PRELOAD] Procedural assets generated")}catch(e){console.error("[PRELOAD] Procedural asset error:",e)}}updateProgressBar(e){if(!this.progressBar)return;const{width:a,height:i}=this.cameras.main,t=a/2-this.BAR_WIDTH/2,n=i/2-30,o=Math.max(0,(this.BAR_WIDTH-4)*e);this.progressBar.clear(),o>0&&(this.progressBar.fillStyle(13216089,1),this.progressBar.fillRoundedRect(t+2,n+2,o,this.BAR_HEIGHT-4,2))}updateDiagnostics(){const e=((Date.now()-this.diag.startTime)/1e3).toFixed(1),a=[`Files: ${this.diag.totalComplete}/${this.diag.totalToLoad} loaded, ${this.diag.totalFailed} failed`,`Time: ${e}s`,`Last: ${this.diag.lastFileKey||"(none)"}`];this.diagText.setText(a.join(`
`))}updateFailedList(){if(this.diag.failedFiles.length===0){this.failedText.setText("");return}const e=`⚠ FAILED FILES (${this.diag.failedFiles.length}):
`,a=this.diag.failedFiles.slice(-5).map(i=>`${i.key}: ${i.url}`).join(`
`);this.failedText.setText(e+a)}createFallbackTexture(e){if(this.textures.exists(e))return;const a=this.make.graphics({x:0,y:0});a.fillStyle(3811866,1),a.fillRect(0,0,64,64),a.lineStyle(2,5917242,1),a.strokeRect(2,2,60,60),a.lineStyle(1,9127187,.5),a.moveTo(8,8),a.lineTo(56,56),a.moveTo(56,8),a.lineTo(8,56),a.strokePath(),a.generateTexture(e,64,64),a.destroy(),console.log(`[PRELOAD] Created fallback texture: ${e}`)}createAllFallbacks(){["ui_panel","ui_button","ui_frame","overlay_vignette","overlay_grain","arena_bg","icon_main","parchment_overlay","vignette","particle"].forEach(a=>{this.textures.exists(a)||this.createFallbackTexture(a)})}showErrorUI(){const{width:e,height:a}=this.cameras.main,i=e/2;this.clearTimeout();const t=this.timedOut?"TIMEOUT":`${this.diag.totalFailed} file(s) failed`;this.statusText.setText(`Loading issue: ${t}`),this.statusText.setColor("#cc8866"),this.createAllFallbacks(),this.retryBtn=this.createButton(i,a/2+150,"Retry Loading",()=>{console.log("[PRELOAD] User clicked Retry"),this.scene.restart()}),this.continueBtn=this.createButton(i,a/2+195,"Continue (Safe Mode)",()=>{console.log("[PRELOAD] User clicked Continue (Safe Mode)"),this.startTransition(!0)})}createButton(e,a,i,t){const n=this.add.container(e,a),o=this.add.graphics();o.fillStyle(3811866,1),o.fillRoundedRect(-90,-16,180,32,6),o.lineStyle(2,9139029,1),o.strokeRoundedRect(-90,-16,180,32,6);const c=this.add.text(0,0,i,{fontFamily:"Georgia, serif",fontSize:"12px",color:"#c9a959"}).setOrigin(.5);return n.add([o,c]),o.setInteractive(new S.Geom.Rectangle(-90,-16,180,32),S.Geom.Rectangle.Contains),o.on("pointerdown",t),o.on("pointerover",()=>{o.clear(),o.fillStyle(4864554,1),o.fillRoundedRect(-90,-16,180,32,6),o.lineStyle(2,13216089,1),o.strokeRoundedRect(-90,-16,180,32,6)}),o.on("pointerout",()=>{o.clear(),o.fillStyle(3811866,1),o.fillRoundedRect(-90,-16,180,32,6),o.lineStyle(2,9139029,1),o.strokeRoundedRect(-90,-16,180,32,6)}),n}startTransition(e=!1){if(this.transitionStarted)return;this.transitionStarted=!0,this.clearTimeout(),this.retryBtn&&this.retryBtn.setVisible(!1),this.continueBtn&&this.continueBtn.setVisible(!1),e&&this.createAllFallbacks();try{g.load(),g.startAutoSave(3e4)}catch(i){console.warn("[PRELOAD] SaveSystem error:",i)}const a=document.getElementById("loading-screen");a&&(a.style.opacity="0",a.style.pointerEvents="none"),this.statusText.setText("Loading complete, entering MainMenu..."),this.statusText.setColor("#8b7355"),this.updateProgressBar(1),console.log("═══════════════════════════════════════"),console.log("[PRELOAD] Starting transition to MainMenuScene"),console.log("═══════════════════════════════════════"),this.time.delayedCall(400,()=>{console.log('[PRELOAD] >>> this.scene.start("MainMenuScene")'),this.scene.start("MainMenuScene")})}create(){console.log("[PRELOAD] create() called"),!this.transitionStarted&&this.loadComplete&&(this.diag.totalFailed>0?this.showErrorUI():this.startTransition())}update(){this.transitionStarted||this.updateDiagnostics()}}class x{static createButton(s,e,a,i,t,n={}){const{width:o=180,height:c=45,fontSize:l="14px",primary:h=!1}=n,u=s.add.container(e,a),p=s.add.graphics(),y=h?4864554:2760474,k=h?13216089:5917242;p.fillStyle(y,1),p.fillRoundedRect(-o/2,-c/2,o,c,8),p.lineStyle(2,k,1),p.strokeRoundedRect(-o/2,-c/2,o,c,8),u.add(p);const b=s.add.text(0,0,i,{fontFamily:"Georgia, serif",fontSize:l,color:h?"#c9a959":"#8b7355"}).setOrigin(.5);return u.add(b),p.setInteractive(new S.Geom.Rectangle(-o/2,-c/2,o,c),S.Geom.Rectangle.Contains),p.on("pointerover",()=>{p.clear(),p.fillStyle(y+1118481,1),p.fillRoundedRect(-o/2,-c/2,o,c,8),p.lineStyle(2,13216089,1),p.strokeRoundedRect(-o/2,-c/2,o,c,8),b.setColor("#c9a959")}),p.on("pointerout",()=>{p.clear(),p.fillStyle(y,1),p.fillRoundedRect(-o/2,-c/2,o,c,8),p.lineStyle(2,k,1),p.strokeRoundedRect(-o/2,-c/2,o,c,8),b.setColor(h?"#c9a959":"#8b7355")}),p.on("pointerdown",()=>{s.tweens.add({targets:u,scaleX:.95,scaleY:.95,duration:50,yoyo:!0,onComplete:t})}),u}static showNotification(s,e,a=2e3){const{width:i,height:t}=s.cameras.main,n=s.add.container(i/2,100);n.setDepth(1e3);const o=20,c=s.add.text(0,0,e,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#c9a959"}).setOrigin(.5),l=c.width+o*2,h=c.height+o,u=s.add.graphics();return u.fillStyle(2760474,.95),u.fillRoundedRect(-l/2,-h/2,l,h,8),u.lineStyle(2,13216089,.5),u.strokeRoundedRect(-l/2,-h/2,l,h,8),n.add(u),n.add(c),n.setAlpha(0),n.y=80,s.tweens.add({targets:n,alpha:1,y:100,duration:200,ease:"Back.out"}),s.time.delayedCall(a,()=>{s.tweens.add({targets:n,alpha:0,y:80,duration:200,onComplete:()=>n.destroy()})}),n}static showConfirmDialog(s,e,a,i,t,n="CONFIRM"){const{width:o,height:c}=s.cameras.main,l=s.add.container(o/2,c/2);l.setDepth(1e3);const h=s.add.rectangle(0,0,o,c,0,.7);h.setInteractive(),l.add(h);const u=320,p=280,y=s.add.graphics();y.fillStyle(1709072,1),y.fillRoundedRect(-u/2,-p/2,u,p,12),y.lineStyle(3,13216089,1),y.strokeRoundedRect(-u/2,-p/2,u,p,12),l.add(y);const k=s.add.text(0,-p/2+30,e,{fontFamily:"Georgia, serif",fontSize:"18px",color:"#c9a959"}).setOrigin(.5);l.add(k);const b=s.add.text(0,-20,a,{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b7355",wordWrap:{width:u-40},align:"center"}).setOrigin(.5);l.add(b);const w=this.createButton(s,-70,p/2-50,"CANCEL",()=>{l.destroy(),t()},{width:100,height:40,fontSize:"12px"});l.add(w);const d=this.createButton(s,70,p/2-50,n,()=>{l.destroy(),i()},{width:100,height:40,fontSize:"12px",primary:!0});return l.add(d),l.setScale(.8),l.setAlpha(0),s.tweens.add({targets:l,scale:1,alpha:1,duration:200,ease:"Back.out"}),l}static createProgressBar(s,e,a,i,t,n,o,c=13216089){const l=s.add.container(e,a),h=s.add.graphics();h.fillStyle(2760474,1),h.fillRoundedRect(0,0,i,t,t/4),l.add(h);const u=s.add.graphics(),p=n/o*(i-4);return u.fillStyle(c,1),u.fillRoundedRect(2,2,Math.max(0,p),t-4,(t-4)/4),l.add(u),l}static createPanel(s,e,a,i,t){const n=s.add.graphics();return n.fillStyle(2760474,.95),n.fillRoundedRect(e,a,i,t,10),n.lineStyle(2,5917242,1),n.strokeRoundedRect(e,a,i,t,10),n.lineStyle(1,3811866,.5),n.strokeRoundedRect(e+5,a+5,i-10,t-10,8),n}static createDivider(s,e,a,i){const t=s.add.graphics();return t.lineStyle(1,5917242,.5),t.moveTo(e-i/2,a),t.lineTo(e+i/2,a),t.strokePath(),t.fillStyle(13216089,.5),t.fillCircle(e,a,3),t}}class re extends S.Scene{constructor(){super({key:"MainMenuScene"});m(this,"menuContainer")}create(){const{width:e,height:a}=this.cameras.main;this.createBackground(),this.createTitle(),this.createMenu(),this.createAmbientEffects(),this.cameras.main.fadeIn(500,0,0,0),this.playAmbience()}createBackground(){const{width:e,height:a}=this.cameras.main,i=this.add.graphics();if(i.fillGradientStyle(1709072,1709072,2760474,2760474),i.fillRect(0,0,e,a),this.textures.exists("parchment_overlay")){const t=this.add.image(e/2,a/2,"parchment_overlay");t.setAlpha(.1),t.setDisplaySize(e,a)}if(this.textures.exists("vignette")){const t=this.add.image(e/2,a/2,"vignette");t.setDisplaySize(e,a),t.setAlpha(.5)}}createTitle(){const{width:e}=this.cameras.main,a=e/2;this.add.text(a,120,"BLOODLINE",{fontFamily:"Georgia, serif",fontSize:"48px",color:"#c9a959",stroke:"#000000",strokeThickness:6}).setOrigin(.5),this.add.text(a,175,"ARENA",{fontFamily:"Georgia, serif",fontSize:"36px",color:"#8b7355",stroke:"#000000",strokeThickness:4,letterSpacing:8}).setOrigin(.5);const i=this.add.graphics();i.lineStyle(2,13216089,.5),i.moveTo(a-100,210),i.lineTo(a+100,210),i.strokePath(),this.add.text(a,235,"Blood. Honor. Legacy.",{fontFamily:"Georgia, serif",fontSize:"14px",color:"#5a4a3a",fontStyle:"italic"}).setOrigin(.5)}createMenu(){const{width:e,height:a}=this.cameras.main,i=e/2,t=320,n=70;this.menuContainer=this.add.container(0,0);const o=g.hasActiveRun();if(o){const b=x.createButton(this,i,t,"CONTINUE RUN",()=>this.continueRun(),{width:260,height:55,primary:!0});this.menuContainer.add(b)}const c=o?t+n:t,l=x.createButton(this,i,c,o?"NEW RUN":"BEGIN YOUR LEGEND",()=>this.startNewRun(),{width:260,height:55,primary:!o});this.menuContainer.add(l);const h=x.createButton(this,i,c+n,"HALL OF LEGENDS",()=>this.openHallOfLegends(),{width:260,height:55});this.menuContainer.add(h);const u=x.createButton(this,i,c+n*2,"BLOODLINE PERKS",()=>this.openBloodlinePerks(),{width:260,height:55});this.menuContainer.add(u);const p=x.createButton(this,i,c+n*3,"SETTINGS",()=>this.openSettings(),{width:260,height:55});this.menuContainer.add(p);const y=g.getMeta(),k=`Runs: ${y.totalRuns} | Wins: ${y.totalWins} | Deaths: ${y.totalDeaths}`;this.add.text(i,a-60,k,{fontFamily:"Georgia, serif",fontSize:"12px",color:"#5a4a3a"}).setOrigin(.5),this.add.text(i,a-35,"v1.0.0",{fontFamily:"Georgia, serif",fontSize:"10px",color:"#3a3025"}).setOrigin(.5)}createAmbientEffects(){const{width:e,height:a}=this.cameras.main;if(!g.getSettings().reduceMotion){if(this.textures.exists("particle"))try{this.add.particles(0,0,"particle",{x:{min:0,max:e},y:{min:0,max:a},scale:{start:.5,end:0},alpha:{start:.3,end:0},speed:{min:10,max:30},angle:{min:-90,max:-90},lifespan:4e3,frequency:200,blendMode:"ADD"})}catch(t){console.warn("[MainMenu] Particle effect failed:",t)}this.tweens.add({targets:this.cameras.main,alpha:{from:1,to:.95},duration:100,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}}playAmbience(){g.getSettings().soundEnabled}continueRun(){this.cameras.main.fadeOut(300,0,0,0),this.cameras.main.once("camerafadeoutcomplete",()=>{const e=g.getRun();e.fighter&&e.lastCampAction==="fight"?this.scene.start("FightScene"):this.scene.start("CampScene")})}startNewRun(){g.hasActiveRun()?x.showConfirmDialog(this,"Abandon Current Run?","Starting a new run will end your current fighter's journey. This cannot be undone.",()=>{g.endRun(!1),this.beginNewRun()},()=>{}):this.beginNewRun()}beginNewRun(){g.startNewRun(),this.cameras.main.fadeOut(300,0,0,0),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("RecruitScene")})}openHallOfLegends(){this.cameras.main.fadeOut(300,0,0,0),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("HallOfLegendsScene")})}openBloodlinePerks(){this.cameras.main.fadeOut(300,0,0,0),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("BloodlinePerksScene")})}openSettings(){this.cameras.main.fadeOut(300,0,0,0),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("SettingsScene")})}}class _{constructor(s){m(this,"seed");m(this,"initialSeed");this.initialSeed=s??Math.floor(Math.random()*2147483647),this.seed=this.initialSeed}reset(){this.seed=this.initialSeed}setSeed(s){this.initialSeed=s,this.seed=s}getSeed(){return this.initialSeed}mulberry32(){let s=this.seed+=1831565813;return s=Math.imul(s^s>>>15,s|1),s^=s+Math.imul(s^s>>>7,s|61),((s^s>>>14)>>>0)/4294967296}random(){return this.mulberry32()}randomInt(s,e){return Math.floor(this.random()*(e-s+1))+s}randomFloat(s,e){return this.random()*(e-s)+s}chance(s){return this.random()<s}pick(s){if(s.length===0)throw new Error("Cannot pick from empty array");return s[this.randomInt(0,s.length-1)]}pickMultiple(s,e){if(e>s.length)throw new Error("Cannot pick more elements than array length");const a=[...s],i=[];for(let t=0;t<e;t++){const n=this.randomInt(0,a.length-1);i.push(a[n]),a.splice(n,1)}return i}shuffle(s){const e=[...s];for(let a=e.length-1;a>0;a--){const i=this.randomInt(0,a);[e[a],e[i]]=[e[i],e[a]]}return e}weightedPick(s){const e=s.reduce((i,[,t])=>i+t,0);let a=this.random()*e;for(const[i,t]of s)if(a-=t,a<=0)return i;return s[s.length-1][0]}randomId(s=8){const e="abcdefghijklmnopqrstuvwxyz0123456789";let a="";for(let i=0;i<s;i++)a+=e[this.randomInt(0,e.length-1)];return a}roll(s){const e=s.match(/^(\d+)d(\d+)([+-]\d+)?$/);if(!e)throw new Error(`Invalid dice notation: ${s}`);const a=parseInt(e[1],10),i=parseInt(e[2],10);let n=e[3]?parseInt(e[3],10):0;for(let o=0;o<a;o++)n+=this.randomInt(1,i);return n}bellCurve(s,e,a=3){let i=0;for(let t=0;t<a;t++)i+=this.randomFloat(s,e);return i/a}}let T=new _;const f={init(r){T=new _(r)},getSeed(){return T.getSeed()},reset(){T.reset()},random(){return T.random()},int(r,s){return T.randomInt(r,s)},float(r,s){return T.randomFloat(r,s)},chance(r){return T.chance(r)},pick(r){return T.pick(r)},pickMultiple(r,s){return T.pickMultiple(r,s)},shuffle(r){return T.shuffle(r)},weightedPick(r){return T.weightedPick(r)},id(r){return T.randomId(r)},roll(r){return T.roll(r)},bellCurve(r,s,e){return T.bellCurve(r,s,e)},create(r){return new _(r)}},M={firstNames:["Aldric","Bjorn","Cassius","Doran","Edric","Falco","Gareth","Harald","Ivan","Jorik","Kael","Lothar","Milo","Nils","Osric","Pavel","Quinn","Ragnar","Soren","Theron","Ulric","Viktor","Werner","Xander","Yoren","Zephyr","Edda","Freya","Greta","Helga","Ingrid","Jutta","Katla","Liv","Mira","Nessa","Olga","Petra","Runa","Sigrid","Thora","Una","Vera","Wren","Ylva","Zara","Brynn","Astrid"],lastNames:["Ashford","Blackwood","Coldstream","Dunmore","Elderstone","Fairweather","Grimshaw","Hartwell","Ironside","Jarvik","Korvin","Lockwood","Moorland","Northcott","Oakhart","Pembrook","Queensbury","Ravencroft","Stonebridge","Thornwood","Underhill","Varr","Windermere","Yarwood","Brann","Voss","Krenn","Dahl","Falk","Griff"],nicknames:["Tin Smile","Left Hook","The Silent","Red Fist","Iron Jaw","The Gentle","Blood Eye","One Shot","The Grim","Lucky","The Bear","Swift Blade","The Butcher","Old Bones","The Crow","Steel Shin","Thunder","The Wall","Widow Maker","The Ghost","Bone Breaker","The Hound","Scarface","The Ox","Quickdraw","The Jackal","Stone Cold","Fury","The Serpent","Nightshade","Pale Death","The Anvil","Copperhead","The Reaper","Mercy","Grudge"]},Y={birthplaces:["Nordheim","the Dustlands","Port Veras","the Iron Hills","Greymarsh","Ashenvale","the Frozen Coast","Thornwick","the Capital","Saltmere","the Border Wastes","Kingsridge","the Outer Reaches","Mirefall","Stonehaven"],snippets:["Born in {birthplace}, {age} winters have hardened this fighter. Sold into the arena to pay family debts.","A former soldier from {birthplace}, discharged after {age} years. The arena is all that remains.","Once a farmer's child in {birthplace}. At {age}, the crops failed, and fighting became the only trade.","Raised in the slums of {birthplace}. At {age}, the arena offers a chance at something more than survival.","A disgraced noble from {birthplace}, now {age} and fighting to reclaim lost honor.","Born to arena champions in {birthplace}. At {age}, the bloodline demands its due.","An orphan of {birthplace}'s plague years. Now {age}, with nothing left to lose.","A freed slave from {birthplace}, {age} years old. The arena is freedom, strange as it seems.","A wanderer from {birthplace} who found purpose at {age}. The roar of crowds calls.","Convicted of a crime in {birthplace} at a young age. Now {age}, fighting for redemption.","A blacksmith's apprentice from {birthplace}, {age} years old. Strong arms, stronger will.","Born during the siege of {birthplace}. {age} years of war made a natural fighter."]},ne=[{id:"mothers_coin",name:"Mother's Coin",backstory:'A worn copper coin, pressed into small hands on the day of departure. "For luck," she said.',effect:"+5 starting Focus",statBonus:{maxFocus:5},upgradeEffect:"+10 starting Focus, +5% gold gain"},{id:"broken_whistle",name:"Broken Whistle",backstory:"Once called the family dog. Now only a memory of simpler times rattles inside.",effect:"+5 max Stamina",statBonus:{maxStamina:5},upgradeEffect:"+10 max Stamina"},{id:"old_ribbon",name:"Old Ribbon",backstory:"Faded blue, from someone who promised to wait. They probably moved on.",effect:"+1 Trust per camp rest",statBonus:{},upgradeEffect:"+2 Trust per rest, reduced injury severity"},{id:"clay_figurine",name:"Clay Figurine",backstory:"A child's crude sculpture of a warrior. Made with love, if not skill.",effect:"+5% crowd hype gain",statBonus:{},upgradeEffect:"+15% crowd hype gain"},{id:"tooth_necklace",name:"Tooth Necklace",backstory:"A beast's fang from a hunt that almost ended everything. A reminder of survival.",effect:"+3 Attack",statBonus:{attack:3},upgradeEffect:"+5 Attack, +5% crit chance"},{id:"prayer_beads",name:"Prayer Beads",backstory:"Worn smooth by generations of whispered hopes. The gods may be listening.",effect:"+8 max HP",statBonus:{maxHP:8},upgradeEffect:"+15 max HP"},{id:"lucky_dice",name:"Lucky Dice",backstory:"Won these from a dying man. He said they always rolled true. Hasn't failed yet.",effect:"+5% critical chance",statBonus:{critChance:5},upgradeEffect:"+10% critical chance"},{id:"faded_letter",name:"Faded Letter",backstory:"The ink has run, the words nearly lost. But the feeling remains.",effect:"Start with 10 extra Trust",statBonus:{},upgradeEffect:"Start with 25 extra Trust"},{id:"iron_ring",name:"Iron Ring",backstory:"A wedding band? A slave's mark? Both have the same weight now.",effect:"+3 Defense",statBonus:{defense:3},upgradeEffect:"+5 Defense, reduced bleed duration"},{id:"dried_flower",name:"Dried Flower",backstory:"Picked the morning of recruitment. Already dead, but still beautiful.",effect:"Injuries heal 1 week faster",statBonus:{},upgradeEffect:"Injuries heal 2 weeks faster, +10 HP when resting"}],I={signature:[{id:"tin_smile",name:"Tin Smile",description:"Cannot be intimidated. Fear effects have no power here.",type:"positive",effect:"Immune to Fear",evolutionNames:["Tin Smile","Iron Grin","Steel Sneer"]},{id:"gentle_giant",name:"Gentle Giant",description:"The crowd loves a merciful warrior. Showing mercy grants bonus hype.",type:"positive",effect:"+20 Hype on merciful actions",evolutionNames:["Gentle Giant","Noble Warrior","The Beloved"]},{id:"vengeful",name:"Vengeful",description:"Pain fuels rage. Damage taken increases attack power temporarily.",type:"positive",effect:"+2 Attack per 10% HP lost",evolutionNames:["Vengeful","Wrathful","Avatar of Vengeance"]},{id:"crowd_pleaser",name:"Crowd Pleaser",description:"Fighting is an art. Style matters as much as substance.",type:"positive",effect:"+50% Hype gain",evolutionNames:["Crowd Pleaser","Fan Favorite","Legend of the Arena"]},{id:"survivors_instinct",name:"Survivor's Instinct",description:"Near-death awakens hidden reserves. Low health grants bonuses.",type:"positive",effect:"+20% Evasion below 25% HP",evolutionNames:["Survivor's Instinct","Death Defier","Unkillable"]},{id:"quick_study",name:"Quick Study",description:"Learns from every blow. Accuracy improves throughout the fight.",type:"positive",effect:"+3% Accuracy per round",evolutionNames:["Quick Study","Adaptable","Master Tactician"]},{id:"berserker_rage",name:"Berserker Rage",description:"Abandon defense for overwhelming offense.",type:"positive",effect:"+30% damage, -15% defense",evolutionNames:["Berserker Rage","Blood Frenzy","Unstoppable Force"]},{id:"iron_defense",name:"Iron Defense",description:"An immovable object. Blocking is second nature.",type:"positive",effect:"+25% block effectiveness",evolutionNames:["Iron Defense","Stone Wall","Impenetrable"]},{id:"opportunist",name:"Opportunist",description:"Strikes when the enemy falters. Bonus damage to stunned enemies.",type:"positive",effect:"+40% damage to debuffed enemies",evolutionNames:["Opportunist","Exploiter","Weakness Hunter"]},{id:"last_stand",name:"Last Stand",description:"Refuses to fall. Once per fight, survive a killing blow at 1 HP.",type:"positive",effect:"Survive fatal (1x per fight)",evolutionNames:["Last Stand","Deathless","The Immortal"]},{id:"patient_fighter",name:"Patient Fighter",description:"Conserves energy. Stamina regenerates faster.",type:"positive",effect:"+50% Stamina regen",evolutionNames:["Patient Fighter","Enduring","Tireless"]},{id:"intimidating_presence",name:"Intimidating Presence",description:"Enemies falter before the fight begins.",type:"positive",effect:"Enemies start with -10 Accuracy",evolutionNames:["Intimidating Presence","Terrifying Aura","Walking Nightmare"]}],positive:[{id:"strong_arm",name:"Strong Arm",description:"Natural strength grants bonus damage.",type:"positive",effect:"+3 Attack",statModifier:{attack:3}},{id:"thick_skin",name:"Thick Skin",description:"Hardened by years of punishment.",type:"positive",effect:"+5 Defense",statModifier:{defense:5}},{id:"light_feet",name:"Light Feet",description:"Quick and agile in the arena.",type:"positive",effect:"+8 Evasion",statModifier:{evasion:8}},{id:"keen_eyes",name:"Keen Eyes",description:"Rarely misses a strike.",type:"positive",effect:"+10 Accuracy",statModifier:{accuracy:10}},{id:"endless_stamina",name:"Endless Stamina",description:"Can fight all day without tiring.",type:"positive",effect:"+15 Max Stamina",statModifier:{maxStamina:15}},{id:"born_fighter",name:"Born Fighter",description:"Combat comes naturally.",type:"positive",effect:"+10 Max HP, +2 Attack",statModifier:{maxHP:10,attack:2}},{id:"focused_mind",name:"Focused Mind",description:"Clarity in chaos.",type:"positive",effect:"+10 Max Focus",statModifier:{maxFocus:10}},{id:"quick_reflexes",name:"Quick Reflexes",description:"Reacts before thinking.",type:"positive",effect:"+3 Speed",statModifier:{speed:3}}],negative:[{id:"old_injury",name:"Old Injury",description:"An old wound that never quite healed.",type:"negative",effect:"-10 Max HP",statModifier:{maxHP:-10}},{id:"poor_eyesight",name:"Poor Eyesight",description:"Struggles to land precise hits.",type:"negative",effect:"-8 Accuracy",statModifier:{accuracy:-8}},{id:"glass_jaw",name:"Glass Jaw",description:"One good hit to the head, and it's over.",type:"negative",effect:"+50% damage from head hits",statModifier:{}},{id:"brittle_bones",name:"Brittle Bones",description:"Injuries are more severe.",type:"negative",effect:"+1 week injury heal time",statModifier:{}},{id:"slow_starter",name:"Slow Starter",description:"Takes time to warm up.",type:"negative",effect:"-20% damage rounds 1-2",statModifier:{}},{id:"arrogant",name:"Arrogant",description:"Overconfidence leads to mistakes.",type:"negative",effect:"-5 Evasion when HP > 70%",statModifier:{}},{id:"nervous",name:"Nervous",description:"Crowds make mistakes more likely.",type:"negative",effect:"-5 Accuracy at high Hype",statModifier:{}},{id:"weak_constitution",name:"Weak Constitution",description:"Tires quickly in prolonged fights.",type:"negative",effect:"-10 Max Stamina",statModifier:{maxStamina:-10}},{id:"scarred_lungs",name:"Scarred Lungs",description:"Breathes heavy, moves slow.",type:"negative",effect:"-2 Speed",statModifier:{speed:-2}},{id:"cowardly",name:"Cowardly",description:"Fear takes hold too easily.",type:"negative",effect:"+20% Fear effect duration",statModifier:{}},{id:"reckless",name:"Reckless",description:"Attacks without thinking.",type:"negative",effect:"-5 Defense",statModifier:{defense:-5}},{id:"bad_knee",name:"Bad Knee",description:"An old injury that flares up.",type:"negative",effect:"+30% damage from leg hits",statModifier:{}}]},oe={stoic:{battle_start:['"..."',`"Let's get this done."`,'"Another day."'],taking_damage:['"Tch."',`"I've had worse."`,'"..."'],dealing_damage:['"..."','"Down."','"Fall."'],low_health:['"Not yet."','"Still standing."','"..."'],victory:[`"It's done."`,'"..."','"Next."'],defeat:['"..."','"So it ends."'],rest:[`"A moment's peace."`,'"..."'],training:['"Again."','"..."'],shop:['"What do you have?"','"..."'],idle:['"..."','"Waiting."']},aggressive:{battle_start:['"Blood! Blood! BLOOD!"','"COME ON!"',`"I'll tear you apart!"`],taking_damage:['"Is that all?!"','"MORE!"','"HA! Again!"'],dealing_damage:['"YES!"','"FEEL IT!"','"DIE!"'],low_health:[`"I'm not done!"`,'"NEVER!"','"MORE BLOOD!"'],victory:[`"WHO'S NEXT?!"`,'"WEAK!"','"HA HA HA!"'],defeat:['"No... MORE!"',`"This isn't..."`],rest:['"Bah, wasting time."','"When do we fight?"'],training:['"Hit me harder!"','"AGAIN!"'],shop:['"Give me something deadly."','"Sharper. Deadlier."'],idle:[`"Where's the fight?"`,'"Boring..."']},honorable:{battle_start:['"May the best warrior win."','"I fight with honor."','"Ancestors, guide my blade."'],taking_damage:['"A fair blow."','"Well struck."','"Nngh... honorable."'],dealing_damage:['"Forgive me."','"For glory!"','"Stand down, with honor."'],low_health:['"I will not yield."','"Honor demands I stand."','"Not like this..."'],victory:['"A good fight. You have my respect."','"The ancestors smile."','"Glory earned."'],defeat:['"I die... with honor."','"A worthy opponent."'],rest:['"I must center myself."','"Quiet contemplation."'],training:['"Discipline makes the warrior."','"Honor in preparation."'],shop:['"A fine blade for a fair price."','"Quality, not trickery."'],idle:['"Patience is a virtue."','"The fight will come."']},cunning:{battle_start:['"I already know how this ends."',`"You've already lost."`,'"Interesting..."'],taking_damage:['"As expected."','"I let you have that one."','"Clever. But not clever enough."'],dealing_damage:['"Predictable."','"Just as planned."','"Too easy."'],low_health:['"All part of the plan."',`"You think you've won?"`,'"Not yet..."'],victory:['"Exactly as I foresaw."','"Was there ever any doubt?"','"Outplayed."'],defeat:['"Impossible... how did..."','"I miscalculated."'],rest:['"Time to think."','"Planning the next move."'],training:['"Mind over muscle."','"Knowing the enemy."'],shop:['"What advantages can I gain?"','"Everything has a use."'],idle:['"Observing. Always observing."','"Everyone has a weakness."']},fearful:{battle_start:['"Oh gods, oh gods..."',`"I don't want to do this."`,'"Please... I just want to live."'],taking_damage:['"AHHH!"','"No no no!"','"Please stop!"'],dealing_damage:['"S-sorry!"','"I had to!"','"Please fall!"'],low_health:[`"I don't want to die!"`,'"Please, mercy!"','"Gods save me!"'],victory:['"I... I did it?"',`"I'm alive! I'm alive!"`,'"Thank the gods..."'],defeat:['"I knew it... I knew..."','"Mother..."'],rest:['"Safe... for now."','"Maybe I can run..."'],training:[`"I'll try..."`,`"Please don't hit too hard."`],shop:['"Something protective, please."','"Anything to help me survive."'],idle:['"Why am I here?"','"There has to be another way..."']},jovial:{battle_start:[`"Let's have some fun!"`,'"Nice day for a fight, eh?"','"May the best looking one win!"'],taking_damage:['"Ow! Good one!"','"Ha! That tickled!"',`"Oh, you're serious!"`],dealing_damage:['"Haha! How about that?"',`"Didn't see that coming!"`,`"Tag! You're it!"`],low_health:['"Getting interesting now!"','"Ha... ha... okay, serious time."',`"You're making this dramatic!"`],victory:['"Good game! Drinks are on me!"','"That was fun! Again sometime?"','"Haha! What a rush!"'],defeat:['"Heh... well played..."',`"Guess the joke's on me..."`],rest:['"Time for ale and stories!"','"Rest is good for the soul!"'],training:[`"Let's make it a game!"`,'"Winner buys the drinks!"'],shop:['"Got anything shiny?"',`"Ooh, what's this do?"`],idle:['"Anyone want to hear a joke?"','"Bored bored bored..."']}};function G(r=1){var B;const s=f.pick(M.firstNames),e=f.pick(M.lastNames),a=f.pick(M.nicknames),i=f.int(18,45),t=f.pick(Y.birthplaces),n=f.pick(Y.snippets).replace("{birthplace}",t).replace("{age}",String(i)),o=f.pick(["stoic","aggressive","honorable","cunning","fearful","jovial"]),c=Math.floor(r/2),l=ce(c),h=z(),u=f.pick(ne),p={id:u.id,name:u.name,backstory:u.backstory,effect:u.effect,statBonus:u.statBonus,upgraded:!1,upgradeEffect:u.upgradeEffect},y=f.pick(I.signature),k={...y,evolutionStage:0,maxEvolution:((B=y.evolutionNames)==null?void 0:B.length)||3},b=f.int(1,2),w=f.pickMultiple(I.positive,b).map(J=>({...J})),d=[{...f.pick(I.negative)}];return{id:f.id(12),firstName:s,lastName:e,nickname:a,fullName:`${s} '${a}' ${e}`,age:i,birthplace:t,backstory:n,personality:o,baseStats:l,currentStats:{...l},equipment:{weapon:null,armor:null,accessory:null},keepsake:p,inventory:[],signatureTrait:k,traits:w,flaws:d,portrait:h,level:1,experience:0,wins:0,losses:0,kills:0,status:"healthy",injuries:[],scars:[],activeEffects:[],trust:20,trustLevel:"stranger",totalDamageDealt:0,totalDamageTaken:0,perfectParries:0,signatureMoveUses:0,closestCall:l.maxHP,bestWin:"",lettersWritten:[],weeksSurvived:0}}function ce(r=0){return{maxHP:f.int(80,120)+r*5,currentHP:0,maxStamina:f.int(80,100)+r*3,currentStamina:0,maxFocus:f.int(50,80)+r*2,currentFocus:0,attack:f.int(8,15)+r,defense:f.int(5,12)+r,speed:f.int(5,12)+r,accuracy:f.int(70,90)+r,evasion:f.int(5,15)+r,critChance:f.int(5,15),critDamage:f.int(140,180)}}function z(){const r=["#f5d0b9","#d4a574","#8b5a3c","#5c3d2e","#3b2417"],s=["#1a1a1a","#3d2314","#6b4423","#8b6914","#a08060","#c0c0c0","#8b0000"];return{baseIndex:f.int(0,5),eyeIndex:f.int(0,4),hairIndex:f.int(0,7),beardIndex:f.int(0,5),scarIndex:0,warpaintIndex:f.chance(.3)?f.int(1,4):0,hoodIndex:0,skinTone:f.pick(r),hairColor:f.pick(s),injuryOverlays:[]}}function j(r){r.currentStats.currentHP=r.currentStats.maxHP,r.currentStats.currentStamina=r.currentStats.maxStamina,r.currentStats.currentFocus=0,r.activeEffects=[]}function le(r,s){r.injuries.push(s),r.status=s.severity==="severe"?"critical":"injured";for(const[e,a]of Object.entries(s.statPenalty)){const i=e;typeof r.currentStats[i]=="number"&&typeof a=="number"&&(r.currentStats[i]-=a)}if(r.portrait.injuryOverlays.push(`injury_${s.location}_${s.severity}`),f.chance(s.scarChance)){const e=`scar_${s.location}_${r.scars.length}`;r.scars.push(e),r.portrait.scarIndex=Math.min(r.portrait.scarIndex+1,5)}}function K(r,s=1){const e=[];r.injuries=r.injuries.filter(a=>{if(a.healTime-=s,a.healTime<=0){e.push(a.id);for(const[i,t]of Object.entries(a.statPenalty)){const n=i;typeof r.currentStats[n]=="number"&&typeof t=="number"&&(r.currentStats[n]+=t)}return!1}return!0}),r.portrait.injuryOverlays=r.portrait.injuryOverlays.filter(a=>!e.some(i=>a.includes(i.split("_")[1]))),r.injuries.length===0?r.status="healthy":r.injuries.some(a=>a.severity==="severe")?r.status="critical":r.status="injured"}function de(r){r.trust>=90?r.trustLevel="legendary":r.trust>=70?r.trustLevel="bonded":r.trust>=50?r.trustLevel="ally":r.trust>=25?r.trustLevel="acquaintance":r.trustLevel="stranger"}function O(r,s){r.trust=Math.max(0,Math.min(100,r.trust+s)),de(r)}function E(r,s){const e=oe[r.personality];return e&&e[s]?f.pick(e[s]):""}function he(r){const s={...r.baseStats};for(const e of Object.values(r.equipment))if(e!=null&&e.stats)for(const[a,i]of Object.entries(e.stats))typeof i=="number"&&(s[a]+=i);if(r.keepsake.statBonus)for(const[e,a]of Object.entries(r.keepsake.statBonus))typeof a=="number"&&(s[e]+=a);for(const e of[...r.traits,...r.flaws])if(e.statModifier)for(const[a,i]of Object.entries(e.statModifier))typeof i=="number"&&(s[a]+=i);return s.currentHP=s.maxHP,s.currentStamina=s.maxStamina,s.currentFocus=0,s}function ue(r,s,e){const a=[`Fell to ${e} in round ${s}. ${r.location} strike proved fatal.`,`Collapsed from a ${r.weaponType} wound to the ${r.location} in round ${s}.`,`${r.location==="head"?"Skull cracked":r.location==="body"?"Heart pierced":"Leg shattered"} by ${e}'s ${r.weaponType}.`,`Bled out from wounds sustained in round ${s}. The crowd fell silent.`,`${e}'s final blow to the ${r.location} ended it all in round ${s}.`];return f.pick(a)}function fe(r){if(!f.chance(.3))return;const s=["Tell them... I tried.","Don't sell my keepsake...","Run... while you can...","It was... worth it...","Remember my name...","The crowd... they loved me...",`Tell ${r.birthplace}... I'm sorry...`,"One more fight... I could have...","My keepsake... keep it safe...","Honor... above all..."];return f.pick(s)}const P=[{id:"hardy_stock",name:"Hardy Stock",description:"Your bloodline is tough. Start with +10 max HP.",effect:"+10 Max HP",cost:5,tier:1,statBonus:{maxHP:10}},{id:"fighting_spirit",name:"Fighting Spirit",description:"Generations of warriors flow through you. +5 max Stamina.",effect:"+5 Max Stamina",cost:5,tier:1,statBonus:{maxStamina:5}},{id:"quick_learner",name:"Quick Learner",description:"Experience comes faster. +10% XP from all sources.",effect:"+10% XP",cost:5,tier:1},{id:"silver_tongue",name:"Silver Tongue",description:"Better deals at shops. -10% shop prices.",effect:"-10% Shop Prices",cost:5,tier:1},{id:"crowd_favorite",name:"Crowd Favorite",description:"The crowd remembers your lineage. Start with +10 Hype.",effect:"+10 Starting Hype",cost:5,tier:1},{id:"iron_will",name:"Iron Will",description:"Resist fear and panic. Immune to Fear status.",effect:"Fear Immunity",cost:10,tier:2,prerequisite:"hardy_stock"},{id:"second_wind",name:"Second Wind",description:"Recover faster between fights. +20% stamina regen.",effect:"+20% Stamina Regen",cost:10,tier:2,prerequisite:"fighting_spirit"},{id:"veterans_insight",name:"Veteran's Insight",description:"Start with one extra trait choice.",effect:"+1 Trait Choice",cost:10,tier:2,prerequisite:"quick_learner"},{id:"haggler",name:"Haggler",description:"Even better deals. Additional -15% shop prices.",effect:"-15% More Shop Prices",cost:10,tier:2,prerequisite:"silver_tongue"},{id:"showman",name:"Showman",description:"Hype gains increased by 25%.",effect:"+25% Hype Gain",cost:10,tier:2,prerequisite:"crowd_favorite"},{id:"unbreakable",name:"Unbreakable",description:"Survive one fatal blow per run at 1 HP.",effect:"Survive Fatal (1x)",cost:20,tier:3,prerequisite:"iron_will"},{id:"berserker_blood",name:"Berserker Blood",description:"Deal 20% more damage when below 30% HP.",effect:"+20% Low HP Damage",cost:20,tier:3,prerequisite:"second_wind"},{id:"legendary_lineage",name:"Legendary Lineage",description:"All stat bonuses from bloodline perks doubled.",effect:"2x Bloodline Stats",cost:20,tier:3,prerequisite:"veterans_insight"}];function me(r,s,e,a,i){const t={id:`legend_${r.id}`,fighter:{id:r.id,fullName:r.fullName,nickname:r.nickname,age:r.age,birthplace:r.birthplace,portrait:{...r.portrait},signatureTrait:r.signatureTrait.name},leagueReached:e,wins:r.wins,kills:r.kills,weeksSurvived:r.weeksSurvived,status:s,causeOfDeath:r.causeOfDeath,lastWords:r.lastWords,promiseType:a,promiseKept:i,bestWin:r.bestWin||"No notable victories",closestCall:r.closestCall,signatureMoveUses:r.signatureMoveUses,perfectParries:r.perfectParries,lettersWritten:[...r.lettersWritten],dateAdded:Date.now()};return g.addToHallOfLegends(t),ge(r),pe(r),t}function ge(r,s){g.addGhostMoment({fighterId:r.id,fighterName:r.firstName,nickname:r.nickname,type:"crowd_chant",triggered:!1}),(r.equipment.weapon||r.equipment.armor)&&g.addGhostMoment({fighterId:r.id,fighterName:r.firstName,nickname:r.nickname,type:"item_drop",triggered:!1}),f.chance(.5)&&g.addGhostMoment({fighterId:r.id,fighterName:r.firstName,nickname:r.nickname,type:"story",triggered:!1})}function pe(r){const e=.3+g.getMeta().promoterLevel*.05;if(f.chance(e)){const a={id:`heirloom_${r.id}`,name:r.keepsake.name,description:`${r.keepsake.backstory} Once belonged to ${r.fullName}.`,fromFighter:r.fullName,effect:r.keepsake.effect,recovered:!0};g.addHeirloom(a)}}function ye(r){const s=g.getUntriggeredGhostMoments();if(s.length===0)return null;const e={arena:["crowd_chant","statue"],camp:["story"],shop:["item_drop"]},a=s.filter(t=>e[r].includes(t.type));if(a.length===0||!f.chance(.15))return null;const i=f.pick(a);return g.triggerGhostMoment(i.fighterId,i.type),i}function Se(r){switch(r.type){case"crowd_chant":return`The crowd chants: "${r.nickname}! ${r.nickname}!" Someone remembers...`;case"item_drop":return`You find a worn item. A tag reads: "Property of ${r.fighterName} '${r.nickname}'"`;case"statue":return`A weathered statue stands in the corner. The plaque reads: "${r.fighterName} '${r.nickname}' - Never Forgotten"`;case"story":return`An old fighter tells tales of ${r.fighterName} '${r.nickname}'. The legend lives on.`;default:return""}}function ke(){const r=g.getMeta(),s={};let e=!1;for(const a of r.unlockedPerks){const i=P.find(t=>t.id===a);if(i!=null&&i.statBonus)for(const[t,n]of Object.entries(i.statBonus))s[t]=(s[t]||0)+n;a==="legendary_lineage"&&(e=!0)}if(e)for(const a of Object.keys(s))s[a]*=2;return s}function H(r){const s=g.getMeta(),e=P.find(a=>a.id===r);if(!e)return{canPurchase:!1,reason:"Perk not found"};if(s.unlockedPerks.includes(r))return{canPurchase:!1,reason:"Already owned"};if(e.prerequisite&&!s.unlockedPerks.includes(e.prerequisite)){const a=P.find(i=>i.id===e.prerequisite);return{canPurchase:!1,reason:`Requires: ${(a==null?void 0:a.name)||e.prerequisite}`}}return s.bloodlinePoints<e.cost?{canPurchase:!1,reason:`Need ${e.cost} points (have ${s.bloodlinePoints})`}:{canPurchase:!0,reason:""}}function xe(r){const{canPurchase:s}=H(r);if(!s)return!1;const e=P.find(a=>a.id===r);return e&&g.spendBloodlinePoints(e.cost)?(g.unlockPerk(r),!0):!1}class A{static renderPortrait(s,e,a,i,t){const n=s.add.container(a,i),o=s.add.graphics();o.fillStyle(1709072,1),o.fillCircle(0,0,t/2+5),o.lineStyle(3,5917242,1),o.strokeCircle(0,0,t/2+5),n.add(o);const c=s.add.graphics();c.fillStyle(S.Display.Color.HexStringToColor(e.skinTone).color,1),c.fillCircle(0,0,t/2-5),n.add(c);const l=s.add.graphics(),h=-t*.08,u=t*.15;l.fillStyle(16777215,1),l.fillEllipse(-u,h,t*.12,t*.08),l.fillEllipse(u,h,t*.12,t*.08);const p=[{x:0,y:0},{x:1,y:0},{x:-1,y:0},{x:0,y:1},{x:0,y:-1}],y=p[e.eyeIndex%p.length];l.fillStyle(2759184,1),l.fillCircle(-u+y.x,h+y.y,t*.04),l.fillCircle(u+y.x,h+y.y,t*.04),l.lineStyle(2,S.Display.Color.HexStringToColor(e.skinTone).darken(30).color,.5),l.moveTo(0,h+t*.08),l.lineTo(0,h+t*.18),l.strokePath();const k=t*.18,b=[()=>{l.lineStyle(2,9127187,.8),l.moveTo(-t*.1,k),l.lineTo(t*.1,k),l.strokePath()},()=>{l.lineStyle(2,9127187,.8),l.beginPath(),l.arc(0,k-t*.05,t*.1,.2,Math.PI-.2),l.strokePath()},()=>{l.lineStyle(2,9127187,.8),l.beginPath(),l.arc(0,k+t*.1,t*.1,Math.PI+.2,-.2),l.strokePath()},()=>{l.fillStyle(3807760,1),l.fillEllipse(0,k,t*.1,t*.06)},()=>{l.lineStyle(2,9127187,.8),l.moveTo(-t*.08,k),l.lineTo(t*.1,k-t*.03),l.strokePath()},()=>{l.lineStyle(2,9127187,.8),l.moveTo(-t*.12,k),l.lineTo(-t*.04,k+.02),l.lineTo(t*.04,k-.02),l.lineTo(t*.12,k),l.strokePath()}];if(b[e.baseIndex%b.length](),n.add(l),e.hairIndex>0){const d=s.add.graphics();d.fillStyle(S.Display.Color.HexStringToColor(e.hairColor).color,1);const v=[()=>{},()=>{d.fillEllipse(0,-t*.35,t*.45,t*.2)},()=>{d.fillEllipse(0,-t*.3,t*.5,t*.3),d.fillRect(-t*.35,-t*.35,t*.1,t*.4),d.fillRect(t*.25,-t*.35,t*.1,t*.4)},()=>{d.fillEllipse(0,-t*.25,t*.55,t*.35),d.fillRect(-t*.4,-t*.3,t*.15,t*.7),d.fillRect(t*.25,-t*.3,t*.15,t*.7)},()=>{d.fillRect(-t*.08,-t*.5,t*.16,t*.3)},()=>{for(let B=-2;B<=2;B++)d.fillTriangle(B*t*.1,-t*.25,B*t*.1-t*.05,-t*.45-Math.abs(B)*.03,B*t*.1+t*.05,-t*.45)},()=>{d.fillEllipse(0,-t*.35,t*.4,t*.2),d.fillRect(t*.15,-t*.3,t*.08,t*.5)},()=>{d.fillRect(-t*.35,-t*.2,t*.1,t*.6),d.fillRect(t*.25,-t*.2,t*.1,t*.6),d.fillEllipse(0,-t*.3,t*.4,t*.2)}];v[e.hairIndex%v.length](),n.add(d)}if(e.beardIndex>0){const d=s.add.graphics();d.fillStyle(S.Display.Color.HexStringToColor(e.hairColor).color,1);const v=[()=>{},()=>{d.fillStyle(S.Display.Color.HexStringToColor(e.hairColor).color,.3),d.fillRect(-t*.2,t*.1,t*.4,t*.15)},()=>{d.fillRect(-t*.2,t*.12,t*.4,t*.2)},()=>{d.fillEllipse(0,t*.25,t*.35,t*.25)},()=>{d.fillEllipse(0,t*.3,t*.3,t*.35)},()=>{d.fillEllipse(0,t*.25,t*.12,t*.2)}];v[e.beardIndex%v.length](),n.add(d)}if(e.scarIndex>0){const d=s.add.graphics();d.lineStyle(2,9125984,.6);const v=[()=>{},()=>{d.moveTo(-t*.3,-t*.2),d.lineTo(-t*.05,t*.1),d.strokePath()},()=>{d.moveTo(t*.1,0),d.lineTo(t*.35,t*.1),d.strokePath()},()=>{d.moveTo(-t*.15,-t*.3),d.lineTo(t*.2,-t*.25),d.strokePath()},()=>{d.moveTo(-t*.15,-t*.1),d.lineTo(t*.15,t*.15),d.strokePath(),d.moveTo(t*.15,-t*.1),d.lineTo(-t*.15,t*.15),d.strokePath()},()=>{d.moveTo(-t*.25,-t*.15),d.lineTo(-t*.1,t*.05),d.strokePath(),d.moveTo(t*.2,-t*.05),d.lineTo(t*.3,t*.15),d.strokePath()}];v[e.scarIndex%v.length](),n.add(d)}if(e.warpaintIndex>0){const d=s.add.graphics();d.lineStyle(3,2763306,.7);const v=[()=>{},()=>{d.moveTo(-t*.3,-t*.1),d.lineTo(-t*.05,-t*.1),d.strokePath(),d.moveTo(t*.05,-t*.1),d.lineTo(t*.3,-t*.1),d.strokePath()},()=>{d.moveTo(0,-t*.4),d.lineTo(0,t*.3),d.strokePath()},()=>{d.moveTo(-t*.3,-t*.2),d.lineTo(-t*.15,-t*.15),d.lineTo(-t*.3,-t*.1),d.strokePath(),d.moveTo(t*.3,-t*.2),d.lineTo(t*.15,-t*.15),d.lineTo(t*.3,-t*.1),d.strokePath()},()=>{d.lineStyle(2,9109504,.6),d.strokeCircle(-t*.2,t*.05,t*.08),d.strokeCircle(t*.2,t*.05,t*.08)}];v[e.warpaintIndex%v.length](),n.add(d)}if(e.hoodIndex>0){const d=s.add.graphics();d.fillStyle(3811866,.9);const v=[()=>{},()=>{d.fillEllipse(0,-t*.2,t*.6,t*.4),d.fillStyle(1709072,1),d.fillEllipse(0,0,t*.4,t*.35)},()=>{d.fillStyle(5921370,1),d.fillEllipse(0,-t*.15,t*.55,t*.4),d.lineStyle(2,3815994,1),d.moveTo(0,-t*.4),d.lineTo(0,t*.1),d.strokePath()}];v[e.hoodIndex%v.length](),n.add(d)}for(const d of e.injuryOverlays){const v=s.add.graphics();d.includes("head")?(v.fillStyle(9109504,.3),v.fillCircle(-t*.15,-t*.15,t*.1)):d.includes("body")&&(v.fillStyle(9109504,.2),v.fillRect(-t*.2,t*.1,t*.4,t*.2)),n.add(v)}const w=s.add.graphics();return w.lineStyle(2,13216089,.2),w.strokeCircle(0,0,t/2+8),n.add(w),n}static renderMiniPortrait(s,e,a,i,t){return this.renderPortrait(s,e,a,i,t)}}class be extends S.Scene{constructor(){super({key:"RecruitScene"});m(this,"candidates",[]);m(this,"selectedIndex",-1);m(this,"candidateContainers",[]);m(this,"detailsContainer")}create(){const e=g.getRun();f.init(e.seed);const a=g.getMeta();this.candidates=[G(a.promoterLevel),G(a.promoterLevel),G(a.promoterLevel)];const i=ke();for(const t of this.candidates){for(const[n,o]of Object.entries(i))typeof o=="number"&&n in t.baseStats&&(t.baseStats[n]+=o);t.currentStats=he(t)}this.createBackground(),this.createHeader(),this.createCandidateCards(),this.createDetailsPanel(),this.createConfirmButton(),this.cameras.main.fadeIn(300)}createBackground(){const{width:e,height:a}=this.cameras.main,i=this.add.graphics();if(i.fillGradientStyle(1709072,1709072,2760474,2760474),i.fillRect(0,0,e,a),this.textures.exists("parchment_overlay")){const t=this.add.image(e/2,a/2,"parchment_overlay");t.setAlpha(.08),t.setDisplaySize(e,a)}}createHeader(){const{width:e}=this.cameras.main;this.add.text(e/2,40,"CHOOSE YOUR FIGHTER",{fontFamily:"Georgia, serif",fontSize:"24px",color:"#c9a959",stroke:"#000000",strokeThickness:3}).setOrigin(.5),this.add.text(e/2,70,"Three souls await judgment. Only one will enter the arena.",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b7355",fontStyle:"italic"}).setOrigin(.5)}createCandidateCards(){const{width:e}=this.cameras.main,a=110,i=e/2-a*1.5,t=180;this.candidates.forEach((n,o)=>{const c=this.createCandidateCard(n,i+o*(a+10),t,o);this.candidateContainers.push(c)})}createCandidateCard(e,a,i,t){const n=this.add.container(a,i),o=110,c=200,l=this.add.graphics();l.fillStyle(2760474,1),l.fillRoundedRect(0,0,o,c,8),l.lineStyle(2,5917242,1),l.strokeRoundedRect(0,0,o,c,8),n.add(l);const h=A.renderMiniPortrait(this,e.portrait,o/2,50,60);n.add(h);const u=this.add.text(o/2,95,e.firstName,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#c9a959"}).setOrigin(.5);n.add(u);const p=this.add.text(o/2,112,`"${e.nickname}"`,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355",fontStyle:"italic"}).setOrigin(.5);n.add(p);const y=this.add.text(o/2,130,`Age ${e.age}`,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#5a4a3a"}).setOrigin(.5);n.add(y);const k=this.add.text(o/2,155,e.signatureTrait.name,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#6b8e23"}).setOrigin(.5);if(n.add(k),e.flaws.length>0){const w=this.add.text(o/2,175,e.flaws[0].name,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b4513"}).setOrigin(.5);n.add(w)}const b=this.add.rectangle(o/2,c/2,o,c,16777215,0);return b.setInteractive({useHandCursor:!0}),n.add(b),b.on("pointerover",()=>{this.selectedIndex!==t&&(l.clear(),l.fillStyle(3813162,1),l.fillRoundedRect(0,0,o,c,8),l.lineStyle(2,9139029,1),l.strokeRoundedRect(0,0,o,c,8))}),b.on("pointerout",()=>{this.selectedIndex!==t&&(l.clear(),l.fillStyle(2760474,1),l.fillRoundedRect(0,0,o,c,8),l.lineStyle(2,5917242,1),l.strokeRoundedRect(0,0,o,c,8))}),b.on("pointerdown",()=>{this.selectCandidate(t)}),n}createDetailsPanel(){const{width:e,height:a}=this.cameras.main;this.detailsContainer=this.add.container(e/2,400);const i=this.add.text(0,0,"Select a fighter to view details",{fontFamily:"Georgia, serif",fontSize:"14px",color:"#5a4a3a",fontStyle:"italic"}).setOrigin(.5);this.detailsContainer.add(i)}updateDetailsPanel(e){this.detailsContainer.removeAll(!0);const a=-100,i=this.add.text(0,a,e.fullName,{fontFamily:"Georgia, serif",fontSize:"18px",color:"#c9a959"}).setOrigin(.5);this.detailsContainer.add(i);const t=this.add.text(0,a+30,e.backstory,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b7355",fontStyle:"italic",wordWrap:{width:320},align:"center"}).setOrigin(.5);this.detailsContainer.add(t);const n=e.currentStats,o=`HP: ${n.maxHP} | ATK: ${n.attack} | DEF: ${n.defense} | SPD: ${n.speed}`,c=this.add.text(0,a+80,o,{fontFamily:"Georgia, serif",fontSize:"12px",color:"#c9a959"}).setOrigin(.5);this.detailsContainer.add(c);const l=this.add.text(0,a+110,`Signature: ${e.signatureTrait.name}`,{fontFamily:"Georgia, serif",fontSize:"13px",color:"#6b8e23"}).setOrigin(.5);this.detailsContainer.add(l);const h=this.add.text(0,a+130,e.signatureTrait.description,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#5a4a3a",wordWrap:{width:280},align:"center"}).setOrigin(.5);if(this.detailsContainer.add(h),e.flaws.length>0){const y=this.add.text(0,a+165,`Flaw: ${e.flaws[0].name}`,{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b4513"}).setOrigin(.5);this.detailsContainer.add(y);const k=this.add.text(0,a+183,e.flaws[0].description,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#5a4a3a"}).setOrigin(.5);this.detailsContainer.add(k)}const u=this.add.text(0,a+215,`Keepsake: ${e.keepsake.name}`,{fontFamily:"Georgia, serif",fontSize:"12px",color:"#c9a959"}).setOrigin(.5);this.detailsContainer.add(u);const p=this.add.text(0,a+233,e.keepsake.effect,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355"}).setOrigin(.5);this.detailsContainer.add(p)}selectCandidate(e){if(this.selectedIndex>=0){const n=this.candidateContainers[this.selectedIndex].first;n.clear(),n.fillStyle(2760474,1),n.fillRoundedRect(0,0,110,200,8),n.lineStyle(2,5917242,1),n.strokeRoundedRect(0,0,110,200,8)}this.selectedIndex=e;const i=this.candidateContainers[e].first;i.clear(),i.fillStyle(3813162,1),i.fillRoundedRect(0,0,110,200,8),i.lineStyle(3,13216089,1),i.strokeRoundedRect(0,0,110,200,8),this.updateDetailsPanel(this.candidates[e])}createConfirmButton(){const{width:e,height:a}=this.cameras.main,i=x.createButton(this,e/2,a-60,"RECRUIT THIS FIGHTER",()=>this.confirmSelection(),{width:240,height:50,primary:!0});i.setAlpha(.5),this.events.on("update",()=>{this.selectedIndex>=0&&i.setAlpha(1)})}confirmSelection(){if(this.selectedIndex<0)return;const e=this.candidates[this.selectedIndex],a=g.getRun();a.fighter=e,g.updateRun(a),this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("PromiseScene")})}}const D=[{id:"sleepless_night",title:"Sleepless Night",description:"Your fighter tosses and turns, haunted by memories. You hear muttering in the dark.",category:"camp",choices:[{id:"comfort",text:"Sit with them, offer comfort",effects:{trust:8,stamina:-10},resultText:"You stay up talking until dawn. The bond strengthens, but rest was lost."},{id:"leave",text:"Let them work through it alone",effects:{trust:-3},resultText:"Sometimes people need space. Whether this was the right call remains to be seen."},{id:"drink",text:"Share a drink to ease the mind",effects:{trust:5,hp:-5},resultText:"The drink helps, but the hangover tomorrow won't be pleasant."}]},{id:"old_friend",title:"An Old Friend",description:"Someone from your fighter's past appears at the camp. Their expression is unreadable.",category:"camp",choices:[{id:"welcome",text:"Welcome them warmly",effects:{trust:5,gold:-15},resultText:"You provide food and drink. The visitor leaves with a smile and a lighter purse for you."},{id:"suspicious",text:"Keep them at arm's length",effects:{trust:-2},resultText:"The visitor leaves, disappointed. Your fighter seems conflicted."},{id:"private",text:"Give them privacy to talk",effects:{trust:3},resultText:"Whatever was said stays between them. Your fighter seems... different after."}]},{id:"rival_encounter",title:"Rival's Shadow",description:"Your fighter's rival has been seen nearby, watching your training sessions.",category:"camp",choices:[{id:"confront",text:"Confront them directly",effects:{trust:3,fame:5},resultText:"A tense exchange of words. The crowd nearby takes notice. Good for reputation."},{id:"ignore",text:"Ignore them completely",effects:{trust:-2},resultText:"Your fighter seems disappointed you didn't stand up for them."},{id:"wave",text:"Wave mockingly",effects:{fame:3},resultText:"A small psychological victory. The rival stalks off, fuming."}]},{id:"injured_rest",title:"The Weight of Wounds",description:"Your fighter's injuries are clearly bothering them. They wince with every movement.",category:"camp",requirements:{hasInjury:!0},choices:[{id:"force_rest",text:"Insist on complete rest",effects:{trust:5,injuryHeal:1},resultText:"A day of nothing but rest and recovery. The wounds begin to close."},{id:"push_through",text:"Tell them to push through",effects:{trust:-5,stamina:10},resultText:"They train through the pain. Tougher, but at what cost?"},{id:"healer",text:"Pay for a healer visit",effects:{gold:-30,trust:3,injuryHeal:1},resultText:"Professional care makes a difference. Money well spent."}]},{id:"crowd_recognition",title:"Famous Face",description:"People in the market are pointing and whispering. Your fighter has been recognized.",category:"camp",requirements:{minWeek:3},choices:[{id:"acknowledge",text:"Wave to the crowd",effects:{fame:8,trust:2},resultText:"The crowd cheers! Your fighter beams with pride."},{id:"humble",text:"Stay humble, keep walking",effects:{trust:5},resultText:"A quiet moment of recognition. Character matters more than fame."},{id:"showoff",text:"Put on a show",effects:{fame:15,stamina:-15,trust:-3},resultText:"A dazzling display! But the exertion takes its toll, and your fighter seems annoyed."}]},{id:"nightmare",title:"Dark Dreams",description:"Your fighter wakes screaming from a nightmare about dying in the arena.",category:"camp",choices:[{id:"promise",text:`"I won't let that happen."`,effects:{trust:10},resultText:"Your words carry weight. The promise hangs in the air between you."},{id:"realistic",text:`"It's a real risk. We both know that."`,effects:{trust:2},resultText:"Honesty is respected, if not comforting."},{id:"dismiss",text:'"Just a dream. Go back to sleep."',effects:{trust:-5},resultText:"Your fighter rolls over, alone with their fears."}]},{id:"shady_surgeon",title:"The Surgeon's Offer",description:'A hooded figure approaches with a leather bag of tools. "I can fix those injuries... permanently. For a price."',category:"offer",requirements:{hasInjury:!0},choices:[{id:"accept",text:"Accept the surgery",effects:{gold:-50,injuryHeal:3,injury:"minor",trust:-5},resultText:"The surgery is painful and the methods questionable, but the wounds heal faster. Something feels... different."},{id:"refuse",text:"Refuse firmly",effects:{trust:5},resultText:'Your fighter relaxes visibly. "Thank you for not selling me to butchers."'},{id:"bargain",text:"Negotiate a better price",effects:{gold:-25,injuryHeal:2,trust:-3},resultText:"A lesser procedure at a lesser price. The results are... acceptable."}]},{id:"cursed_weapon",title:"The Black Blade",description:'A merchant offers a blade that seems to drink in the light. "Powerful. Deadly. But demanding."',category:"offer",choices:[{id:"accept",text:"Take the blade",effects:{gold:-40,hp:-10,buff:"cursed_weapon"},resultText:"The blade feels wrong in the hand, but the power is undeniable."},{id:"refuse",text:"Walk away",effects:{trust:3},resultText:`"Wise choice," your fighter murmurs. Some things aren't worth the cost.`},{id:"examine",text:"Examine it closely first",effects:{gold:-10},resultText:"You pay for an appraisal. The blade is powerful but cursed. Knowledge gained."}]},{id:"sponsor_deal",title:"The Sponsor",description:"A wealthy patron offers gold in exchange for... loyalty. Their smile doesn't reach their eyes.",category:"offer",requirements:{minWeek:2},choices:[{id:"accept",text:"Accept the sponsorship",effects:{gold:100,reputation:-5,trust:-10},resultText:"The gold flows freely, but strings are attached. Your fighter looks at you differently now."},{id:"refuse",text:"Decline politely",effects:{trust:8},resultText:`"We don't need their kind," your fighter says with relief.`},{id:"negotiate",text:"Counter-offer with terms",effects:{gold:50,reputation:-2,trust:-3},resultText:"A compromise is reached. Less gold, fewer strings."}]},{id:"poison_offer",title:"Unfair Advantage",description:`A quiet voice in the dark offers a vial. "Coat your blade. They'll never know."`,category:"offer",choices:[{id:"accept",text:"Take the poison",effects:{gold:-30,trust:-15,buff:"poison_blade"},resultText:"Your fighter's face hardens. Honor is a luxury, after all."},{id:"refuse_loudly",text:"Refuse and report them",effects:{trust:10,fame:5},resultText:"Word spreads of your honor. Your fighter stands taller."},{id:"refuse_quietly",text:"Just say no",effects:{trust:5},resultText:"The figure melts into shadows. Some offers are better forgotten."}]},{id:"letter_home",title:"A Letter Home",description:"Your fighter sits with quill and parchment, struggling to find words.",category:"letter",choices:[{id:"help",text:"Help them write",effects:{trust:8},resultText:"Together you craft a message of hope and determination. The letter is finished."},{id:"private",text:"Give them privacy",effects:{trust:3},resultText:"Some words are too personal to share. The letter is sealed in silence."},{id:"discourage",text:"Suggest they focus on training instead",effects:{trust:-8,stamina:10},resultText:"The parchment is put away. Your fighter trains harder, but something is lost."}]},{id:"letter_response",title:"News From Home",description:"A letter arrives for your fighter. Their hands tremble as they read.",category:"letter",choices:[{id:"ask",text:"Ask what it says",effects:{trust:5},resultText:"They share the news. Family is well. A weight lifts from their shoulders."},{id:"space",text:"Give them time alone",effects:{trust:3},resultText:"When they emerge, their eyes are red but their resolve is firm."},{id:"practical",text:"Remind them we have work to do",effects:{trust:-5},resultText:"The letter is folded away. Duty calls, but at what cost?"}]},{id:"write_legacy",title:"Words for the Future",description:"Your fighter wants to write something to be read if they don't survive.",category:"letter",choices:[{id:"support",text:"Help them prepare this",effects:{trust:12},resultText:"A sobering task, but important. The letter is sealed and stored safely."},{id:"optimistic",text:`"You'll deliver it yourself."`,effects:{trust:5},resultText:"Your confidence is infectious. They smile, but keep writing anyway."},{id:"avoid",text:"Change the subject",effects:{trust:-3},resultText:"The topic is dropped, but the unwritten words hang between you."}]},{id:"stray_dog",title:"The Stray",description:"A scrawny dog has been following your fighter around camp.",category:"event",choices:[{id:"adopt",text:"Keep the dog",effects:{trust:8,gold:-10},resultText:"Your fighter names it immediately. Loyalty comes in many forms."},{id:"feed",text:"Feed it and send it away",effects:{trust:2,gold:-5},resultText:"A small kindness. The dog looks back once before leaving."},{id:"ignore",text:"Ignore it",effects:{trust:-2},resultText:"The dog eventually leaves. Your fighter watches it go with sad eyes."}]},{id:"gambler",title:"Double or Nothing",description:"Your fighter found a dice game in the back alleys.",category:"event",requirements:{minTrust:30},choices:[{id:"allow",text:"Let them gamble",effects:{gold:30,trust:5},resultText:"Lady luck smiles! Your fighter returns with a grin and coin."},{id:"forbid",text:"Forbid it",effects:{trust:-8},resultText:"They obey, but resentment simmers. You're not their parent."},{id:"join",text:"Join the game",effects:{gold:-20,trust:10},resultText:"You lose some coin but gain a memory. Worth every copper."}]},{id:"arena_tour",title:"Sacred Ground",description:"An opportunity to visit the Grand Arena at night, when it's empty.",category:"event",choices:[{id:"go",text:"Go together",effects:{trust:10,fame:3},resultText:"Standing on the sand, imagining the crowds. A moment of shared dreams."},{id:"train",text:"Use the time to train instead",effects:{stamina:15,trust:-2},resultText:"Practical, but something magical is missed."},{id:"alone",text:"Send them alone",effects:{trust:5},resultText:"Some experiences are personal. They return with fire in their eyes."}]},{id:"bad_food",title:"Spoiled Supplies",description:"Your food stores have gone bad. Someone needs to deal with this.",category:"event",choices:[{id:"buy_new",text:"Buy fresh supplies",effects:{gold:-25,trust:3},resultText:"New supplies secured. Your fighter appreciates proper meals."},{id:"make_do",text:"Make do with what's edible",effects:{hp:-10,trust:-3},resultText:"A rough few days. Stomachs suffer, but coin is saved."},{id:"hunt",text:"Go hunting for fresh meat",effects:{stamina:-10,trust:5},resultText:"A successful hunt! Fresh meat and bonding time."}]},{id:"festival",title:"Festival Night",description:"The town is celebrating. Music and laughter fill the streets.",category:"event",choices:[{id:"celebrate",text:"Join the celebration",effects:{gold:-15,trust:8,stamina:-10},resultText:"A night of joy and revelry. Some things matter more than training."},{id:"observe",text:"Watch from the edge",effects:{trust:3},resultText:"You share quiet observations about the crowd. A different kind of bonding."},{id:"train",text:"Use the empty training grounds",effects:{stamina:15,trust:-5},resultText:"Productive, but your fighter keeps glancing toward the music."}]}],ve=[{id:"survival",name:"I'll get you out alive",description:"Promise to prioritize survival. Earlier and cheaper retirement options.",effect:"-30% retirement cost, available after 3 wins",mechanicBonus:{retirementDiscount:.3,earlyRetirement:!0}},{id:"glory",name:"We'll win the belt",description:"Promise to fight for the championship. Greater rewards, harder path.",effect:"+20% gold/fame rewards, +10% enemy stats",mechanicBonus:{rewardBonus:.2,enemyStatBonus:.1}},{id:"honor",name:"We fight with honor",description:"Promise to fight fairly. Crowd loves you, fewer shady opportunities.",effect:"+30% crowd hype gain, no shady offers",mechanicBonus:{hypeBonus:.3,noShadyOffers:!0}},{id:"vengeance",name:"We'll make them pay",description:"Promise to defeat every rival. Bonus damage to rivals, they seek you out.",effect:"+25% damage to rivals, rivals appear more often",mechanicBonus:{rivalDamageBonus:.25,rivalFrequency:2}},{id:"legacy",name:"Your name will echo forever",description:"Promise to build a legend. Extra bloodline points, more fame.",effect:"+50% fame gain, +1 bloodline point per league advanced",mechanicBonus:{fameBonus:.5,bloodlineBonus:1}}];class we extends S.Scene{constructor(){super({key:"PromiseScene"});m(this,"selectedPromise",null);m(this,"promiseContainers",new Map)}create(){var t;const{width:e,height:a}=this.cameras.main,i=g.getRun();this.createBackground(),this.createHeader(((t=i.fighter)==null?void 0:t.firstName)||"Fighter"),this.createPromiseCards(),this.createConfirmButton(),this.cameras.main.fadeIn(300)}createBackground(){const{width:e,height:a}=this.cameras.main,i=this.add.graphics();if(i.fillGradientStyle(1709072,1709072,2760474,2760474),i.fillRect(0,0,e,a),this.textures.exists("parchment_overlay")){const t=this.add.image(e/2,a/2,"parchment_overlay");t.setAlpha(.08),t.setDisplaySize(e,a)}}createHeader(e){const{width:a}=this.cameras.main;this.add.text(a/2,40,"MAKE A PROMISE",{fontFamily:"Georgia, serif",fontSize:"24px",color:"#c9a959",stroke:"#000000",strokeThickness:3}).setOrigin(.5),this.add.text(a/2,70,`What will you promise ${e}?`,{fontFamily:"Georgia, serif",fontSize:"13px",color:"#8b7355",fontStyle:"italic"}).setOrigin(.5),this.add.text(a/2,90,"This choice will define your journey together.",{fontFamily:"Georgia, serif",fontSize:"11px",color:"#5a4a3a"}).setOrigin(.5)}createPromiseCards(){const{width:e}=this.cameras.main,a=320,i=100,t=130,n=110;ve.forEach((o,c)=>{const l=t+c*n,h=this.createPromiseCard(o,e/2-a/2,l,a,i);this.promiseContainers.set(o.id,h)})}createPromiseCard(e,a,i,t,n){const o=this.add.container(a,i),c=this.add.graphics();c.fillStyle(2760474,1),c.fillRoundedRect(0,0,t,n,8),c.lineStyle(2,5917242,1),c.strokeRoundedRect(0,0,t,n,8),o.add(c);const l=this.add.text(t/2,18,`"${e.name}"`,{fontFamily:"Georgia, serif",fontSize:"15px",color:"#c9a959"}).setOrigin(.5);o.add(l);const h=this.add.text(t/2,42,e.description,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b7355",wordWrap:{width:t-30},align:"center"}).setOrigin(.5);o.add(h);const u=this.add.text(t/2,75,e.effect,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#6b8e23"}).setOrigin(.5);o.add(u);const p=this.add.rectangle(t/2,n/2,t,n,16777215,0);return p.setInteractive({useHandCursor:!0}),o.add(p),p.on("pointerover",()=>{this.selectedPromise!==e.id&&(c.clear(),c.fillStyle(3813162,1),c.fillRoundedRect(0,0,t,n,8),c.lineStyle(2,9139029,1),c.strokeRoundedRect(0,0,t,n,8))}),p.on("pointerout",()=>{this.selectedPromise!==e.id&&(c.clear(),c.fillStyle(2760474,1),c.fillRoundedRect(0,0,t,n,8),c.lineStyle(2,5917242,1),c.strokeRoundedRect(0,0,t,n,8))}),p.on("pointerdown",()=>{this.selectPromise(e.id,t,n)}),o}selectPromise(e,a,i){if(this.selectedPromise){const n=this.promiseContainers.get(this.selectedPromise);if(n){const o=n.first;o.clear(),o.fillStyle(2760474,1),o.fillRoundedRect(0,0,a,i,8),o.lineStyle(2,5917242,1),o.strokeRoundedRect(0,0,a,i,8)}}this.selectedPromise=e;const t=this.promiseContainers.get(e);if(t){const n=t.first;n.clear(),n.fillStyle(3813162,1),n.fillRoundedRect(0,0,a,i,8),n.lineStyle(3,13216089,1),n.strokeRoundedRect(0,0,a,i,8)}}createConfirmButton(){const{width:e,height:a}=this.cameras.main,i=x.createButton(this,e/2,a-60,"SEAL THIS PROMISE",()=>this.confirmPromise(),{width:220,height:50,primary:!0});i.setAlpha(.5),this.events.on("update",()=>{i.setAlpha(this.selectedPromise?1:.5)})}confirmPromise(){if(!this.selectedPromise)return;g.updateRun({promise:this.selectedPromise}),this.cameras.main.fadeOut(500,0,0,0);const{width:e,height:a}=this.cameras.main,i=this.add.text(e/2,a/2,"PROMISE SEALED",{fontFamily:"Georgia, serif",fontSize:"28px",color:"#c9a959",stroke:"#000000",strokeThickness:4}).setOrigin(.5).setAlpha(0);this.tweens.add({targets:i,alpha:1,duration:300,yoyo:!0,hold:500,onComplete:()=>{this.scene.start("CampScene")}})}}class Te extends S.Scene{constructor(){super({key:"CampScene"});m(this,"fighter");m(this,"gold");m(this,"week");m(this,"league")}create(){const e=g.getRun();if(!e.fighter){this.scene.start("MainMenuScene");return}this.fighter=e.fighter,this.gold=e.gold,this.week=e.week,this.league=e.league,this.createBackground(),this.createHeader(),this.createFighterPanel(),this.createActionButtons(),this.createProgressBar(),this.checkGhostMoments(),this.cameras.main.fadeIn(300)}createBackground(){const{width:e,height:a}=this.cameras.main,i=this.add.graphics();if(i.fillGradientStyle(1709072,1709072,2760474,2760474),i.fillRect(0,0,e,a),this.textures.exists("parchment_overlay")){const t=this.add.image(e/2,a/2,"parchment_overlay");t.setAlpha(.08),t.setDisplaySize(e,a)}this.add.text(e/2,a-20,"🔥 Camp",{fontSize:"12px",color:"#5a4a3a"}).setOrigin(.5)}createHeader(){const{width:e}=this.cameras.main,a=g.getRun();this.add.text(20,20,`Week ${this.week+1}`,{fontFamily:"Georgia, serif",fontSize:"16px",color:"#c9a959"});const i={bronze:"#cd7f32",silver:"#c0c0c0",gold:"#ffd700",champion:"#ff4500"};this.add.text(20,42,`${this.league.toUpperCase()} LEAGUE`,{fontFamily:"Georgia, serif",fontSize:"12px",color:i[this.league]||"#8b7355"}),this.add.text(e-20,20,`💰 ${this.gold}`,{fontFamily:"Georgia, serif",fontSize:"16px",color:"#c9a959"}).setOrigin(1,0),this.add.text(e-20,42,`⭐ ${a.fame}`,{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b7355"}).setOrigin(1,0)}createFighterPanel(){const{width:e}=this.cameras.main,a=80;A.renderPortrait(this,this.fighter.portrait,e/2,a+60,100),this.fighter.injuries.length>0&&this.add.text(e/2+45,a+15,"🩹",{fontSize:"20px"}),this.add.text(e/2,a+120,this.fighter.fullName,{fontFamily:"Georgia, serif",fontSize:"16px",color:"#c9a959"}).setOrigin(.5);const i=this.fighter.status==="healthy"?"#6b8e23":this.fighter.status==="injured"?"#daa520":"#8b0000";this.add.text(e/2,a+142,this.fighter.status.toUpperCase(),{fontFamily:"Georgia, serif",fontSize:"11px",color:i}).setOrigin(.5);const t=this.fighter.currentStats,n=a+165;this.createStatBar(e/2,n,"HP",t.currentHP,t.maxHP,9109504),this.createStatBar(e/2,n+25,"STA",t.currentStamina,t.maxStamina,2263842);const o=n+55;this.add.text(e/2-80,o,"Trust:",{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b7355"});const c=this.add.graphics();c.fillStyle(2760474,1),c.fillRoundedRect(e/2-30,o-2,100,14,4),c.fillStyle(4286945,1),c.fillRoundedRect(e/2-30,o-2,this.fighter.trust,14,4),this.add.text(e/2+75,o,this.fighter.trustLevel,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355"});const l=o+30;this.add.text(e/2,l,`📿 ${this.fighter.keepsake.name}`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#c9a959"}).setOrigin(.5),this.add.text(e/2,l+20,`✨ ${this.fighter.signatureTrait.name}`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#6b8e23"}).setOrigin(.5);const h=this.getContextualVoiceLine();h&&this.add.text(e/2,l+50,h,{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b7355",fontStyle:"italic",wordWrap:{width:280},align:"center"}).setOrigin(.5)}createStatBar(e,a,i,t,n,o){this.add.text(e-160/2-35,a,i,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b7355"});const h=this.add.graphics();h.fillStyle(2760474,1),h.fillRoundedRect(e-160/2,a-2,160,16,4);const u=this.add.graphics();u.fillStyle(o,1),u.fillRoundedRect(e-160/2,a-2,t/n*160,16,4),this.add.text(e,a+5,`${t}/${n}`,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#ffffff"}).setOrigin(.5)}createActionButtons(){const{width:e,height:a}=this.cameras.main,i=420,t=55;x.createButton(this,e/2,i,"⚔️ TRAIN",()=>this.doTrain(),{width:200,height:45}),x.createButton(this,e/2,i+t,"🛒 SHOP",()=>this.goToShop(),{width:200,height:45}),x.createButton(this,e/2,i+t*2,"🛏️ REST",()=>this.doRest(),{width:200,height:45}),x.createButton(this,e/2,i+t*3,"✉️ WRITE LETTER",()=>this.writeLetter(),{width:200,height:45}),x.createButton(this,e/2,i+t*4+15,"🗡️ ENTER ARENA",()=>this.enterArena(),{width:220,height:55,primary:!0})}createProgressBar(){const{width:e,height:a}=this.cameras.main,i=g.getRun(),t=a-50,n=e-60;this.add.text(30,t-15,`${i.fightsInLeague}/${i.fightsToNextLeague} to next league`,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#5a4a3a"});const o=this.add.graphics();o.fillStyle(2760474,1),o.fillRoundedRect(30,t,n,10,3);const c=this.add.graphics();c.fillStyle(13216089,1),c.fillRoundedRect(30,t,i.fightsInLeague/i.fightsToNextLeague*n,10,3)}getContextualVoiceLine(){return this.fighter.injuries.length>0?E(this.fighter,"taking_damage"):this.fighter.trust<30?E(this.fighter,"idle"):E(this.fighter,"rest")}doTrain(){this.fighter.currentStats.attack+=1,this.fighter.currentStats.accuracy+=2,O(this.fighter,2),this.week++,g.updateRun({fighter:this.fighter,week:this.week,lastCampAction:"train"}),x.showNotification(this,"Training complete! +1 ATK, +2 ACC"),this.refreshScene()}goToShop(){g.updateRun({lastCampAction:"shop"}),this.cameras.main.fadeOut(200),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("ShopScene")})}doRest(){j(this.fighter),K(this.fighter,1),O(this.fighter,5),this.week++,g.updateRun({fighter:this.fighter,week:this.week,lastCampAction:"rest"}),x.showNotification(this,"Rested well! HP and Stamina restored, +5 Trust"),this.refreshScene()}writeLetter(){g.updateRun({lastCampAction:"letter"}),this.cameras.main.fadeOut(200),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("VignetteScene",{type:"letter"})})}enterArena(){j(this.fighter),g.updateRun({fighter:this.fighter,lastCampAction:"fight"}),this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("FightScene")})}checkGhostMoments(){const e=ye("camp");if(e){const a=Se(e);this.time.delayedCall(1e3,()=>{x.showNotification(this,a,4e3)})}}refreshScene(){this.cameras.main.fadeOut(150),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.restart()})}}const Re=[{name:"Bruised Ribs",location:"body",severity:"minor",effect:"Hurts to breathe deeply",statPenalty:{maxStamina:-5},healTime:1,scarChance:0},{name:"Split Lip",location:"head",severity:"minor",effect:"Looks worse than it is",statPenalty:{},healTime:1,scarChance:.1},{name:"Twisted Ankle",location:"legs",severity:"minor",effect:"Movement slightly impaired",statPenalty:{speed:-1,evasion:-3},healTime:1,scarChance:0},{name:"Black Eye",location:"head",severity:"minor",effect:"Vision slightly impaired",statPenalty:{accuracy:-5},healTime:1,scarChance:0},{name:"Strained Shoulder",location:"body",severity:"minor",effect:"Arm feels weak",statPenalty:{attack:-2},healTime:2,scarChance:0},{name:"Deep Cut",location:"body",severity:"moderate",effect:"Bleeding wound",statPenalty:{maxHP:-10,defense:-2},healTime:2,scarChance:.3},{name:"Fractured Jaw",location:"head",severity:"moderate",effect:"Speaking and eating is painful",statPenalty:{maxStamina:-8},healTime:3,scarChance:.2},{name:"Torn Muscle",location:"legs",severity:"moderate",effect:"Mobility severely limited",statPenalty:{speed:-3,evasion:-8},healTime:3,scarChance:0},{name:"Cracked Ribs",location:"body",severity:"moderate",effect:"Every breath hurts",statPenalty:{maxStamina:-12,defense:-3},healTime:3,scarChance:0},{name:"Gashed Thigh",location:"legs",severity:"moderate",effect:"Deep wound, heavy bleeding",statPenalty:{maxHP:-8,speed:-2},healTime:2,scarChance:.4},{name:"Concussion",location:"head",severity:"moderate",effect:"Head trauma, dizziness",statPenalty:{accuracy:-10,maxFocus:-10},healTime:2,scarChance:0},{name:"Broken Arm",location:"body",severity:"severe",effect:"Cannot use dominant arm properly",statPenalty:{attack:-8,accuracy:-15},healTime:4,scarChance:.1},{name:"Shattered Knee",location:"legs",severity:"severe",effect:"May never fight the same",statPenalty:{speed:-5,evasion:-15},healTime:5,scarChance:.2},{name:"Skull Fracture",location:"head",severity:"severe",effect:"Life-threatening head trauma",statPenalty:{maxHP:-20,maxFocus:-15},healTime:5,scarChance:.5},{name:"Punctured Lung",location:"body",severity:"severe",effect:"Breathing is agony",statPenalty:{maxStamina:-25,maxHP:-15},healTime:5,scarChance:.3},{name:"Severed Tendon",location:"legs",severity:"severe",effect:"Leg barely functional",statPenalty:{speed:-8,evasion:-20,attack:-3},healTime:5,scarChance:.4},{name:"Facial Disfigurement",location:"head",severity:"severe",effect:"Scarred for life",statPenalty:{},healTime:4,scarChance:1}],Be=[{id:"bandages",name:"Crude Bandages",description:"Dirty cloth strips. Better than nothing.",type:"healing",effect:"Restore 20 HP",value:20,uses:1,price:15},{id:"healing_salve",name:"Healing Salve",description:"A pungent green paste that numbs pain.",type:"healing",effect:"Restore 35 HP",value:35,uses:1,price:30},{id:"surgeons_kit",name:"Surgeon's Kit",description:"Professional medical supplies.",type:"healing",effect:"Restore 50 HP, cure Bleed",value:50,uses:1,price:60},{id:"grit_salts",name:"Grit Salts",description:"Inhale for instant alertness. Burns like hell.",type:"buff",effect:"Restore 30 Stamina",value:30,uses:1,price:25},{id:"focus_tonic",name:"Focus Tonic",description:"A bitter brew that sharpens the mind.",type:"buff",effect:"Gain 20 Focus",value:20,uses:1,price:35},{id:"berserker_draught",name:"Berserker Draught",description:"Red liquid that tastes of iron. +5 Attack for 3 turns.",type:"buff",effect:"+5 Attack (3 turns)",value:5,uses:1,price:45},{id:"iron_skin_oil",name:"Iron-Skin Oil",description:"Protective coating. +5 Defense for 3 turns.",type:"buff",effect:"+5 Defense (3 turns)",value:5,uses:1,price:45},{id:"smoke_bomb",name:"Smoke Bomb",description:"Creates a concealing cloud. Guarantees dodge next attack.",type:"utility",effect:"Guaranteed dodge (1 attack)",value:1,uses:1,price:50},{id:"flash_powder",name:"Flash Powder",description:"Blinds the opponent. -20 Accuracy for 2 turns.",type:"utility",effect:"Enemy -20 Accuracy (2 turns)",value:20,uses:1,price:40},{id:"antivenom",name:"Antivenom",description:"Neutralizes poisons and clears the blood.",type:"healing",effect:"Cure Bleed and Poison",value:0,uses:1,price:35}],Pe=[{id:"rusty_sword",name:"Rusty Sword",description:"A worn blade, but still sharp enough.",rarity:"common",attackBonus:2,accuracyBonus:0,critBonus:0,price:30},{id:"wooden_club",name:"Wooden Club",description:"Simple but effective.",rarity:"common",attackBonus:3,accuracyBonus:-5,critBonus:0,price:20},{id:"fighting_knife",name:"Fighting Knife",description:"Quick and precise.",rarity:"common",attackBonus:1,accuracyBonus:8,critBonus:3,price:35},{id:"iron_mace",name:"Iron Mace",description:"Heavy and crushing.",rarity:"common",attackBonus:4,accuracyBonus:-3,critBonus:0,price:40},{id:"soldiers_blade",name:"Soldier's Blade",description:"A proper military weapon.",rarity:"uncommon",attackBonus:5,accuracyBonus:3,critBonus:2,price:80},{id:"spiked_flail",name:"Spiked Flail",description:"Unpredictable and dangerous.",rarity:"uncommon",attackBonus:6,accuracyBonus:-5,critBonus:5,price:90},{id:"gladius",name:"Gladius",description:"Classic arena weapon.",rarity:"uncommon",attackBonus:4,accuracyBonus:5,critBonus:3,price:85},{id:"war_axe",name:"War Axe",description:"Brutal chopping power.",rarity:"uncommon",attackBonus:7,accuracyBonus:-3,critBonus:4,price:95},{id:"champion_sword",name:"Champion's Sword",description:"Wielded by a former champion.",rarity:"rare",attackBonus:8,accuracyBonus:5,critBonus:5,effect:"+10% Hype gain",price:180},{id:"blood_drinker",name:"Blood Drinker",description:"Heals on critical hits.",rarity:"rare",attackBonus:6,accuracyBonus:3,critBonus:8,effect:"Crit heals 10 HP",price:200},{id:"executioner",name:"The Executioner",description:"Heavy two-handed blade.",rarity:"rare",attackBonus:12,accuracyBonus:-8,critBonus:10,effect:"+30% damage to low HP enemies",price:220},{id:"viper_fang",name:"Viper Fang",description:"Poisoned edge.",rarity:"rare",attackBonus:5,accuracyBonus:8,critBonus:5,effect:"Attacks apply Bleed",price:190},{id:"crown_slayer",name:"Crown Slayer",description:"The weapon of legends.",rarity:"legendary",attackBonus:12,accuracyBonus:8,critBonus:10,effect:"+50% damage to champions",price:500},{id:"soulreaper",name:"Soulreaper",description:"Said to steal the dying breath.",rarity:"legendary",attackBonus:10,accuracyBonus:5,critBonus:15,effect:"Killing blows restore 25 HP",price:450}],Ae=[{id:"leather_vest",name:"Leather Vest",description:"Basic protection.",rarity:"common",defenseBonus:3,hpBonus:0,speedPenalty:0,price:25},{id:"padded_gambeson",name:"Padded Gambeson",description:"Quilted cloth armor.",rarity:"common",defenseBonus:4,hpBonus:5,speedPenalty:1,price:35},{id:"studded_leather",name:"Studded Leather",description:"Leather reinforced with metal studs.",rarity:"common",defenseBonus:5,hpBonus:0,speedPenalty:1,price:45},{id:"chainmail_shirt",name:"Chainmail Shirt",description:"Interlocked metal rings.",rarity:"uncommon",defenseBonus:8,hpBonus:5,speedPenalty:2,price:100},{id:"gladiator_harness",name:"Gladiator Harness",description:"Arena-style protective gear.",rarity:"uncommon",defenseBonus:6,hpBonus:10,speedPenalty:0,price:110},{id:"scale_mail",name:"Scale Mail",description:"Overlapping metal scales.",rarity:"uncommon",defenseBonus:9,hpBonus:0,speedPenalty:3,price:120},{id:"champion_plate",name:"Champion's Plate",description:"Worn by arena legends.",rarity:"rare",defenseBonus:12,hpBonus:15,speedPenalty:2,effect:"+10 Trust with crowd",price:250},{id:"shadow_leather",name:"Shadow Leather",description:"Dark, supple armor.",rarity:"rare",defenseBonus:8,hpBonus:5,speedPenalty:-1,effect:"+10 Evasion",price:230},{id:"berserker_hide",name:"Berserker Hide",description:"Blessed by battle priests.",rarity:"rare",defenseBonus:6,hpBonus:20,speedPenalty:0,effect:"+15% damage when injured",price:240},{id:"immortal_aegis",name:"Immortal Aegis",description:"Said to have saved a hundred lives.",rarity:"legendary",defenseBonus:15,hpBonus:25,speedPenalty:2,effect:"Survive fatal blow once per fight",price:500},{id:"bloodline_armor",name:"Bloodline Armor",description:"Passed through generations of champions.",rarity:"legendary",defenseBonus:12,hpBonus:30,speedPenalty:1,effect:"+2 Bloodline Points on victory",price:480}];class Ce extends S.Scene{constructor(){super({key:"ShopScene"});m(this,"gold");m(this,"fighter");m(this,"selectedCategory","items");m(this,"shopInventory",new Map);m(this,"goldText");m(this,"itemsContainer")}create(){const e=g.getRun();if(!e.fighter){this.scene.start("MainMenuScene");return}this.fighter=e.fighter,this.gold=e.gold,this.generateShopInventory(),this.createBackground(),this.createHeader(),this.createCategoryTabs(),this.createItemList(),this.createBackButton(),this.cameras.main.fadeIn(300)}generateShopInventory(){const e=g.getMeta(),a=3+Math.floor(e.promoterLevel/2),i=3+Math.floor(e.promoterLevel/2),t=f.shuffle([...Pe]).slice(0,a);this.shopInventory.set("weapons",t);const n=f.shuffle([...Ae]).slice(0,i);this.shopInventory.set("armor",n),this.shopInventory.set("items",[...Be])}createBackground(){const{width:e,height:a}=this.cameras.main,i=this.add.graphics();if(i.fillGradientStyle(1709072,1709072,2760474,2760474),i.fillRect(0,0,e,a),this.textures.exists("parchment_overlay")){const t=this.add.image(e/2,a/2,"parchment_overlay");t.setAlpha(.08),t.setDisplaySize(e,a)}}createHeader(){const{width:e}=this.cameras.main;this.add.text(e/2,35,"🛒 MERCHANT",{fontFamily:"Georgia, serif",fontSize:"24px",color:"#c9a959",stroke:"#000000",strokeThickness:3}).setOrigin(.5),this.add.text(e/2,65,'"Best wares this side of the arena..."',{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b7355",fontStyle:"italic"}).setOrigin(.5),this.goldText=this.add.text(e-20,20,`💰 ${this.gold}`,{fontFamily:"Georgia, serif",fontSize:"18px",color:"#ffd700"}).setOrigin(1,0)}createCategoryTabs(){const{width:e}=this.cameras.main,a=100,i=100,t=110,n=e/2-t;[{id:"items",label:"🧪 Items"},{id:"weapons",label:"⚔️ Weapons"},{id:"armor",label:"🛡️ Armor"}].forEach((c,l)=>{const h=n+l*t;x.createButton(this,h,a,c.label,()=>this.selectCategory(c.id),{width:i,height:35,fontSize:"11px"}).setData("category",c.id)})}selectCategory(e){this.selectedCategory=e,this.createItemList()}createItemList(){const{width:e,height:a}=this.cameras.main;this.itemsContainer&&this.itemsContainer.destroy(),this.itemsContainer=this.add.container(0,0);const i=this.shopInventory.get(this.selectedCategory)||[],t=150,n=80;i.forEach((o,c)=>{const l=t+c*n;this.createItemCard(o,30,l,e-60,70)}),i.length===0&&this.add.text(e/2,250,"No items available",{fontFamily:"Georgia, serif",fontSize:"14px",color:"#5a4a3a"}).setOrigin(.5)}createItemCard(e,a,i,t,n){const o=this.add.container(a,i);this.itemsContainer.add(o);const c=this.add.graphics();c.fillStyle(2760474,1),c.fillRoundedRect(0,0,t,n,8),c.lineStyle(1,5917242,1),c.strokeRoundedRect(0,0,t,n,8),o.add(c);const h={common:"#8b8b8b",uncommon:"#2e8b57",rare:"#4169e1",legendary:"#ffd700"}[e.rarity]||"#8b8b8b",u=this.add.text(15,12,e.name,{fontFamily:"Georgia, serif",fontSize:"14px",color:h});o.add(u);const p=this.add.text(15,32,e.description||e.effect,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355",wordWrap:{width:t-100}});o.add(p);const y=this.add.text(t-15,12,`💰 ${e.price}`,{fontFamily:"Georgia, serif",fontSize:"14px",color:this.gold>=e.price?"#ffd700":"#8b0000"}).setOrigin(1,0);o.add(y);const k=this.gold>=e.price,b=x.createButton(this,t-45,n-20,"BUY",()=>this.buyItem(e),{width:60,height:25,fontSize:"10px",primary:k});o.add(b),k||b.setAlpha(.5)}buyItem(e){if(this.gold<e.price){x.showNotification(this,"Not enough gold!");return}this.gold-=e.price,this.goldText.setText(`💰 ${this.gold}`),this.selectedCategory==="items"?this.fighter.inventory.push({id:e.id,name:e.name,type:"accessory",rarity:"common",stats:{},description:e.description}):this.selectedCategory==="weapons"?this.fighter.equipment.weapon={id:e.id,name:e.name,type:"weapon",rarity:e.rarity,stats:{attack:e.attackBonus,accuracy:e.accuracyBonus,critChance:e.critBonus},effect:e.effect,description:e.description}:this.selectedCategory==="armor"&&(this.fighter.equipment.armor={id:e.id,name:e.name,type:"armor",rarity:e.rarity,stats:{defense:e.defenseBonus,maxHP:e.hpBonus,speed:-e.speedPenalty},effect:e.effect,description:e.description}),g.updateRun({fighter:this.fighter,gold:this.gold}),x.showNotification(this,`Purchased ${e.name}!`),this.createItemList()}createBackButton(){const{width:e,height:a}=this.cameras.main;x.createButton(this,e/2,a-50,"← BACK TO CAMP",()=>this.returnToCamp(),{width:180,height:45})}returnToCamp(){this.cameras.main.fadeOut(200),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("CampScene")})}}const R={light_attack:{staminaCost:10,baseDamage:1,accuracy:.9,focusGain:5,hypeGain:5},heavy_attack:{staminaCost:25,baseDamage:1.8,accuracy:.75,focusGain:10,hypeGain:15},guard:{staminaCost:5,blockMultiplier:.6,focusGain:3,hypeGain:0},dodge:{staminaCost:15,evasionBonus:.3,focusGain:5,hypeGain:10},special:{staminaCost:20,focusCost:30,baseDamage:2,accuracy:.85,hypeGain:25},item:{staminaCost:0,focusGain:0,hypeGain:-5}},Oe={head:{damage:1.2,critBonus:.1,effect:"concuss"},body:{damage:1,critBonus:0,effect:null},legs:{damage:.9,critBonus:-.05,effect:"cripple"}};function Fe(r,s){return{player:U(r),enemy:U(s),round:1,turn:r.currentStats.speed>=s.currentStats.speed?"player":"enemy",phase:"select_action",crowdHype:30,log:[],isParryWindow:!1,parryWindowStart:0,winner:null,lastAction:null}}function U(r){return{fighter:r,currentHP:r.currentStats.currentHP,currentStamina:r.currentStats.currentStamina,currentFocus:0,injuryMeter:0,activeEffects:new Map,guardStance:null,lastAction:null,consecutiveGuards:0}}function V(r,s,e,a,i){const t=r[s],n=r[s==="player"?"enemy":"player"],o=R[e];let c={success:!1,damage:0,damageBlocked:0,targetZone:a,critical:!1,perfectParry:!1,counterDamage:0,statusApplied:null,staminaCost:o.staminaCost,focusGained:0,focusSpent:0,hypeGained:0,message:""};if(t.currentStamina<o.staminaCost)return c.message=`${t.fighter.firstName} is too exhausted!`,c;switch(t.currentStamina-=o.staminaCost,e){case"light_attack":case"heavy_attack":c=Me(r,t,n,e,a);break;case"guard":c=Ie(t,a);break;case"dodge":c=Ge(t);break;case"special":c=Ee(r,t,n,a);break;case"item":c=De(t);break}return t.lastAction=e,r.log.push({round:r.round,actor:s,action:e,result:c,timestamp:Date.now()}),r.crowdHype=Math.max(0,Math.min(100,r.crowdHype+c.hypeGained)),n.currentHP<=0?(r.winner=s,r.phase="end"):t.currentHP<=0&&(r.winner=s==="player"?"enemy":"player",r.phase="end"),r.lastAction=c,c}function Me(r,s,e,a,i){const t=R[a],n=Oe[i],o={success:!1,damage:0,damageBlocked:0,targetZone:i,critical:!1,perfectParry:!1,counterDamage:0,statusApplied:null,staminaCost:t.staminaCost,focusGained:0,focusSpent:0,hypeGained:0,message:""};let c=t.accuracy*(s.fighter.currentStats.accuracy/100);if(e.lastAction==="dodge"&&(c-=R.dodge.evasionBonus),s.activeEffects.has("concuss")&&(c-=.15),e.activeEffects.has("cripple")&&i==="legs"&&(c+=.1),f.chance(c)){o.success=!0;let l=s.fighter.currentStats.attack*t.baseDamage;l*=n.damage;const h=s.fighter.currentStats.critChance/100+n.critBonus;f.chance(h)&&(o.critical=!0,l*=s.fighter.currentStats.critDamage/100,o.hypeGained+=10),e.lastAction==="guard"&&e.guardStance===i&&(o.damageBlocked=l*R.guard.blockMultiplier,l-=o.damageBlocked,o.message=`${e.fighter.firstName} blocked! `);const u=e.fighter.currentStats.defense,p=Math.max(1,Math.round(l-u*.3));o.damage=p,e.currentHP-=p,e.currentHP<e.fighter.closestCall&&(e.fighter.closestCall=e.currentHP),e.injuryMeter+=p*.5,o.critical&&(e.injuryMeter+=10),n.effect&&f.chance(.2+(o.critical?.1:0))&&(o.statusApplied=n.effect,e.activeEffects.set(n.effect,3)),o.focusGained=t.focusGain,s.currentFocus=Math.min(s.fighter.currentStats.maxFocus,s.currentFocus+o.focusGained),o.hypeGained+=t.hypeGain;const y=a==="light_attack"?"quick strike":"heavy blow";o.message+=`${s.fighter.firstName}'s ${y} hits the ${i} for ${p} damage!`,o.critical&&(o.message+=" CRITICAL HIT!"),o.statusApplied&&(o.message+=` ${e.fighter.firstName} is ${o.statusApplied}ed!`)}else o.message=`${s.fighter.firstName}'s attack misses!`,e.lastAction==="dodge"&&(o.message=`${e.fighter.firstName} dodges the attack!`,o.hypeGained=5);return o}function Ie(r,s){r.guardStance=s,r.consecutiveGuards++;const e=R.guard.focusGain*Math.min(r.consecutiveGuards,3);return r.currentFocus=Math.min(r.fighter.currentStats.maxFocus,r.currentFocus+e),{success:!0,damage:0,damageBlocked:0,targetZone:s,critical:!1,perfectParry:!1,counterDamage:0,statusApplied:null,staminaCost:R.guard.staminaCost,focusGained:e,focusSpent:0,hypeGained:0,message:`${r.fighter.firstName} raises guard to protect ${s}!`}}function Ge(r){return r.guardStance=null,r.consecutiveGuards=0,{success:!0,damage:0,damageBlocked:0,targetZone:"body",critical:!1,perfectParry:!1,counterDamage:0,statusApplied:null,staminaCost:R.dodge.staminaCost,focusGained:R.dodge.focusGain,focusSpent:0,hypeGained:R.dodge.hypeGain,message:`${r.fighter.firstName} prepares to dodge!`}}function Ee(r,s,e,a){const i=R.special;if(s.currentFocus<i.focusCost)return{success:!1,damage:0,damageBlocked:0,targetZone:a,critical:!1,perfectParry:!1,counterDamage:0,statusApplied:null,staminaCost:0,focusGained:0,focusSpent:0,hypeGained:-5,message:`${s.fighter.firstName} lacks focus for a special move!`};s.currentFocus-=i.focusCost,s.fighter.signatureMoveUses++;const t=s.fighter.currentStats.attack*i.baseDamage,n=Math.round(t*f.float(.9,1.2));return e.currentHP-=n,e.injuryMeter+=n*.7,{success:!0,damage:n,damageBlocked:0,targetZone:a,critical:!1,perfectParry:!1,counterDamage:0,statusApplied:null,staminaCost:i.staminaCost,focusGained:0,focusSpent:i.focusCost,hypeGained:i.hypeGain,message:`${s.fighter.firstName} unleashes "${s.fighter.signatureTrait.name}"! ${n} damage!`}}function De(r,s){return r.currentHP=Math.min(r.fighter.currentStats.maxHP,r.currentHP+30),{success:!0,damage:0,damageBlocked:0,targetZone:"body",critical:!1,perfectParry:!1,counterDamage:0,statusApplied:null,staminaCost:0,focusGained:0,focusSpent:0,hypeGained:-5,message:`${r.fighter.firstName} uses a healing item! Restored 30 HP.`}}function _e(r){for(const s of["player","enemy"]){const e=r[s];e.currentStamina=Math.min(e.fighter.currentStats.maxStamina,e.currentStamina+10);for(const[a,i]of e.activeEffects)a==="bleed"&&(e.currentHP-=5,r.log.push({round:r.round,actor:s,action:"light_attack",result:{success:!0,damage:5,damageBlocked:0,targetZone:"body",critical:!1,perfectParry:!1,counterDamage:0,statusApplied:null,staminaCost:0,focusGained:0,focusSpent:0,hypeGained:0,message:`${e.fighter.firstName} bleeds for 5 damage!`},timestamp:Date.now()})),i<=1?e.activeEffects.delete(a):e.activeEffects.set(a,i-1);e.lastAction!=="guard"&&(e.guardStance=null,e.consecutiveGuards=0)}}function q(r){_e(r),r.turn=r.turn==="player"?"enemy":"player",r.turn==="player"&&r.round++,r.phase="select_action",r.isParryWindow=!1}function He(r,s){const e=r.injuryMeter/200;if(f.chance(e)){const a=r.injuryMeter>80?"severe":r.injuryMeter>40?"moderate":"minor";return Le(a)}return null}function Le(r){const s=Re.filter(a=>a.severity===r);return{...f.pick(s),id:`injury_${f.id(8)}`}}function Ne(r,s,e){const a=e==="bronze"?1:e==="silver"?1.5:2,i=1+r.crowdHype/100*.5,t=20+r.round*5,n=10+r.round*2,o=25+r.round*5;return{gold:Math.round(t*a*i),fame:Math.round(n*a*i),xp:Math.round(o*a)}}const $e=[{first:"Brutus",last:"Ironjaw"},{first:"Gaius",last:"Bloodhand"},{first:"Marcus",last:"the Cruel"},{first:"Varro",last:"Steelarm"},{first:"Crixus",last:"the Shadow"},{first:"Spartus",last:"Bonecrusher"},{first:"Drago",last:"the Silent"},{first:"Thorin",last:"Skullsplitter"},{first:"Ragnar",last:"the Red"},{first:"Ulric",last:"Deathbringer"},{first:"Kira",last:"Swiftblade"},{first:"Valeria",last:"the Viper"},{first:"Helena",last:"Ironmaiden"},{first:"Freya",last:"Frostbite"},{first:"Sigrid",last:"the Storm"},{first:"Malik",last:"the Merciless"},{first:"Cyrus",last:"Sandstorm"},{first:"Ajax",last:"the Giant"},{first:"Nero",last:"Blackheart"},{first:"Lucius",last:"Goldmask"},{first:"Gorm",last:"the Grim"},{first:"Fenris",last:"Wolfjaw"},{first:"Balthus",last:"the Beast"},{first:"Corvus",last:"Ravenwing"}],X=[{id:"brute",name:"Brute Force",title:"The Brute",aiType:"brutal",statMultipliers:{maxHP:1.2,attack:1.3,defense:.9,speed:.8},specialAbility:"Heavy blows deal +20% damage",flavorText:"Raw strength and aggression. No finesse, just power.",taunts:["I'll crush your skull!","Weakling! Face a real warrior!","Your bones will crack like twigs!","This ends now!"]},{id:"duelist",name:"Precise Strikes",title:"The Duelist",aiType:"tactical",statMultipliers:{attack:1,defense:1,speed:1.2,accuracy:1.15},specialAbility:"+15% critical chance",flavorText:"Elegant and deadly. Every move calculated.",taunts:["You fight like a farmer.","Too slow. Much too slow.","I've faced better.","Shall we dance?"]},{id:"tank",name:"Iron Wall",title:"The Wall",aiType:"defensive",statMultipliers:{maxHP:1.4,defense:1.4,attack:.8,speed:.7},specialAbility:"+30% block effectiveness",flavorText:"Immovable and patient. Waits for you to tire.",taunts:["Your attacks mean nothing.","I could do this all day.","Tired yet?","I am the wall."]},{id:"assassin",name:"Shadow Strike",title:"The Assassin",aiType:"trickster",statMultipliers:{maxHP:.8,attack:1.1,speed:1.4,evasion:1.3},specialAbility:"+25% dodge chance",flavorText:"Fast and elusive. Strikes from unexpected angles.",taunts:["You can't hit what you can't see.","Too predictable.","Catch me if you can.","Already behind you."]},{id:"berserker",name:"Blood Rage",title:"The Berserker",aiType:"berserker",statMultipliers:{maxHP:1.1,attack:1.2,defense:.7,maxStamina:1.2},specialAbility:"+30% damage when below 50% HP",flavorText:"Grows more dangerous as the fight progresses.",taunts:["BLOOD! MORE BLOOD!","PAIN MAKES ME STRONGER!","RAAAAAAGH!","I CANNOT BE STOPPED!"]},{id:"veteran",name:"Battle Wisdom",title:"The Veteran",aiType:"balanced",statMultipliers:{maxHP:1.1,attack:1.1,defense:1.1,accuracy:1.1},specialAbility:"No weaknesses",flavorText:"Years of experience. Knows every trick in the book.",taunts:["I've seen it all before.","Youth and enthusiasm, meet old age and treachery.","Still learning, I see.","Not bad. But not good enough."]},{id:"showman",name:"Crowd Favorite",title:"The Showman",aiType:"aggressive",statMultipliers:{maxHP:1,attack:1.15,speed:1.1},specialAbility:"+50% crowd hype gain",flavorText:"Fights for glory and applause.",taunts:["Watch closely, crowd!","Let me show you how it's done!","Are you not entertained?!","Remember this moment!"]},{id:"executioner",name:"Final Blow",title:"The Executioner",aiType:"brutal",statMultipliers:{maxHP:1.15,attack:1.25,accuracy:1.1,speed:.9},specialAbility:"+50% damage to enemies below 25% HP",flavorText:"Specializes in finishing wounded opponents.",taunts:["Your end approaches.","I smell your fear.","Time to finish this.","Accept your fate."]}];function We(r,s){const e=f.pick(X),a=f.pick($e),i={bronze:1,silver:1.3,gold:1.6,champion:2}[r],t=Math.min(s*2,20),n={maxHP:Math.round((80+t)*i*(e.statMultipliers.maxHP||1)),currentHP:0,maxStamina:Math.round((80+t*.5)*(e.statMultipliers.maxStamina||1)),currentStamina:0,maxFocus:Math.round(60*(e.statMultipliers.maxFocus||1)),currentFocus:0,attack:Math.round((10+t*.3)*i*(e.statMultipliers.attack||1)),defense:Math.round((8+t*.2)*i*(e.statMultipliers.defense||1)),speed:Math.round((8+t*.2)*(e.statMultipliers.speed||1)),accuracy:Math.round(75+t*.5),evasion:Math.round(10+t*.3),critChance:10,critDamage:150};return n.currentHP=n.maxHP,n.currentStamina=n.maxStamina,{id:`enemy_${f.id(8)}`,firstName:a.first,lastName:a.last,nickname:e.title,fullName:`${a.first} '${e.title}' ${a.last}`,age:f.int(20,50),birthplace:"Unknown",backstory:e.flavorText,personality:Ye(e.aiType),baseStats:n,currentStats:{...n},equipment:{weapon:null,armor:null,accessory:null},keepsake:{id:"enemy_keepsake",name:"Fighter's Token",backstory:"A simple token.",effect:"None",statBonus:{},upgraded:!1},inventory:[],signatureTrait:{id:e.id,name:e.name,description:e.specialAbility||"No special ability",type:"neutral",effect:e.specialAbility||""},traits:[],flaws:[],portrait:z(),level:Math.ceil(s/2),experience:0,wins:f.int(0,s*2),losses:f.int(0,s),kills:f.int(0,s),status:"healthy",injuries:[],scars:[],activeEffects:[],trust:0,trustLevel:"stranger",totalDamageDealt:0,totalDamageTaken:0,perfectParries:0,signatureMoveUses:0,closestCall:n.maxHP,bestWin:"",lettersWritten:[],weeksSurvived:s}}function Ye(r){return{aggressive:"aggressive",defensive:"stoic",trickster:"cunning",brutal:"aggressive",balanced:"stoic",cautious:"fearful",berserker:"aggressive",tactical:"cunning"}[r]}function je(r,s){const e=r.enemy,a=r.player,i=e.currentStamina>=25,t=e.currentFocus>=30&&e.currentStamina>=20,n=e.currentStamina>=15,o=e.currentHP/e.fighter.currentStats.maxHP,c=a.currentHP/a.fighter.currentStats.maxHP;let l,h;switch(s){case"aggressive":l=Ue(i,t),h=f.chance(.4)?"head":f.chance(.5)?"body":"legs";break;case"defensive":l=Ve(n,o,a.lastAction),h=a.guardStance?L(a.guardStance):"body";break;case"trickster":l=qe(n,t,r),h=ze(a);break;case"brutal":l=Ke(i,t),h="head";break;case"balanced":l=Xe(i,t,n),h=f.pick(["head","body","legs"]);break;case"cautious":l=Je(n,o,c),h="body";break;case"berserker":l=Qe(i,t,o),h=f.chance(.6)?"head":"body";break;case"tactical":l=Ze(r,i,t,n),h=et(a);break;default:l="light_attack",h="body"}return{action:l,targetZone:h}}function Ue(r,s,e){return s&&f.chance(.3)?"special":r&&f.chance(.5)?"heavy_attack":"light_attack"}function Ve(r,s,e){return s<.3&&f.chance(.6)?"guard":e==="heavy_attack"&&r?f.chance(.5)?"dodge":"guard":f.chance(.3)?"guard":r&&f.chance(.2)?"dodge":"light_attack"}function qe(r,s,e){return r&&e.player.lastAction==="heavy_attack"?"dodge":s&&f.chance(.4)?"special":f.chance(.3)?"dodge":"light_attack"}function ze(r){return r.guardStance?L(r.guardStance):f.pick(["head","body","legs"])}function Ke(r,s){return s&&f.chance(.4)?"special":r?"heavy_attack":"light_attack"}function Xe(r,s,e,a){const i=f.random();return s&&i<.15?"special":r&&i<.35?"heavy_attack":i<.45?"guard":e&&i<.55?"dodge":"light_attack"}function Je(r,s,e){if(s<.4)return f.chance(.5)?"guard":r?"dodge":"guard";if(e<.3)return f.chance(.6)?"light_attack":"heavy_attack";const a=f.random();return a<.3?"guard":r&&a<.4?"dodge":"light_attack"}function Qe(r,s,e){const a=(1-e)*.3;return s&&f.chance(.3+a)?"special":r&&f.chance(.6+a)?"heavy_attack":"light_attack"}function Ze(r,s,e,a){const i=r.player,t=r.enemy;return i.consecutiveGuards>=2&&e?"special":i.lastAction==="heavy_attack"&&a?"dodge":t.currentFocus>=50&&e?"special":(i.currentStamina<20,s?"heavy_attack":"light_attack")}function et(r){return r.activeEffects.has("cripple")?"legs":r.activeEffects.has("concuss")?"head":r.guardStance?L(r.guardStance):f.pick(["head","body","legs"])}function L(r){const e=["head","body","legs"].filter(a=>a!==r);return f.pick(e)}function tt(r){const s=X.find(e=>e.id===r.signatureTrait.id);return s!=null&&s.taunts?f.pick(s.taunts):"You'll fall like the rest."}class at extends S.Scene{constructor(){super({key:"FightScene"});m(this,"combatState");m(this,"player");m(this,"enemy");m(this,"selectedAction",null);m(this,"selectedZone","body");m(this,"playerHealthBar");m(this,"enemyHealthBar");m(this,"playerStaminaBar");m(this,"playerFocusBar");m(this,"combatLog");m(this,"actionButtons");m(this,"zoneButtons");m(this,"hypeBar")}create(){const e=g.getRun();if(!e.fighter){this.scene.start("MainMenuScene");return}this.player=e.fighter,this.enemy=We(e.league,e.week),this.combatState=Fe(this.player,this.enemy),this.createBackground(),this.createArenaView(),this.createCombatUI(),this.createActionPanel();const a=tt(this.enemy);this.showCombatMessage(a,2e3),this.cameras.main.fadeIn(300)}createBackground(){const{width:e,height:a}=this.cameras.main,i=this.add.graphics();if(i.fillGradientStyle(2760474,2760474,1709072,1709072),i.fillRect(0,0,e,a),i.fillStyle(3813146,1),i.fillRect(0,a*.5,e,a*.5),this.textures.exists("arena_overlay")){const t=this.add.image(e/2,a/2,"arena_overlay");t.setAlpha(.3),t.setDisplaySize(e,a)}if(this.textures.exists("vignette")){const t=this.add.image(e/2,a/2,"vignette");t.setDisplaySize(e,a),t.setAlpha(.6)}}createArenaView(){const{width:e,height:a}=this.cameras.main;A.renderPortrait(this,this.player.portrait,80,200,80),this.add.text(80,250,this.player.firstName,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#c9a959"}).setOrigin(.5),A.renderPortrait(this,this.enemy.portrait,e-80,200,80),this.add.text(e-80,250,this.enemy.firstName,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#8b4513"}).setOrigin(.5),this.add.text(e-80,268,`"${this.enemy.nickname}"`,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#5a4a3a",fontStyle:"italic"}).setOrigin(.5),this.add.text(e/2,200,"VS",{fontFamily:"Georgia, serif",fontSize:"24px",color:"#8b0000",stroke:"#000000",strokeThickness:3}).setOrigin(.5)}createCombatUI(){const{width:e,height:a}=this.cameras.main;this.add.text(e/2,30,`ROUND ${this.combatState.round}`,{fontFamily:"Georgia, serif",fontSize:"16px",color:"#c9a959"}).setOrigin(.5),this.createHealthBar(30,60,150,20,!0),this.createStaminaBar(30,85,120,12),this.createFocusBar(30,102,100,10),this.createHealthBar(e-180,60,150,20,!1),this.createHypeBar(e/2-75,55,150,12),this.combatLog=this.add.text(e/2,310,"",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#c9a959",wordWrap:{width:300},align:"center"}).setOrigin(.5)}createHealthBar(e,a,i,t,n){const o=this.add.graphics();o.fillStyle(2760474,1),o.fillRoundedRect(e,a,i,t,4),o.lineStyle(1,5917242,1),o.strokeRoundedRect(e,a,i,t,4);const c=this.add.graphics();n?this.playerHealthBar=c:this.enemyHealthBar=c,this.updateHealthBar(c,e,a,i,t,n),this.add.text(e,a-15,n?"HP":"Enemy HP",{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355"})}updateHealthBar(e,a,i,t,n,o){const c=o?this.combatState.player:this.combatState.enemy,l=c.currentHP/c.fighter.currentStats.maxHP;e.clear();const h=l>.5?2263842:l>.25?14329120:9109504;e.fillStyle(h,1),e.fillRoundedRect(a+2,i+2,(t-4)*Math.max(0,l),n-4,3)}createStaminaBar(e,a,i,t){const n=this.add.graphics();n.fillStyle(2760474,1),n.fillRoundedRect(e,a,i,t,3),this.playerStaminaBar=this.add.graphics(),this.updateStaminaBar(e,a,i,t),this.add.text(e,a-12,"STA",{fontFamily:"Georgia, serif",fontSize:"9px",color:"#8b7355"})}updateStaminaBar(e,a,i,t){const n=this.combatState.player.currentStamina/this.player.currentStats.maxStamina;this.playerStaminaBar.clear(),this.playerStaminaBar.fillStyle(4620980,1),this.playerStaminaBar.fillRoundedRect(e+1,a+1,(i-2)*Math.max(0,n),t-2,2)}createFocusBar(e,a,i,t){const n=this.add.graphics();n.fillStyle(2760474,1),n.fillRoundedRect(e,a,i,t,3),this.playerFocusBar=this.add.graphics(),this.updateFocusBar(e,a,i,t),this.add.text(e,a-12,"FOCUS",{fontFamily:"Georgia, serif",fontSize:"9px",color:"#8b7355"})}updateFocusBar(e,a,i,t){const n=this.combatState.player.currentFocus/this.player.currentStats.maxFocus;this.playerFocusBar.clear(),this.playerFocusBar.fillStyle(10040012,1),this.playerFocusBar.fillRoundedRect(e+1,a+1,(i-2)*Math.max(0,n),t-2,2)}createHypeBar(e,a,i,t){const n=this.add.graphics();n.fillStyle(2760474,1),n.fillRoundedRect(e,a,i,t,3),this.hypeBar=this.add.graphics(),this.updateHypeBar(e,a,i,t),this.add.text(e+i/2,a-12,"CROWD HYPE",{fontFamily:"Georgia, serif",fontSize:"9px",color:"#8b7355"}).setOrigin(.5)}updateHypeBar(e,a,i,t){const n=this.combatState.crowdHype/100;this.hypeBar.clear(),this.hypeBar.fillStyle(16766720,1),this.hypeBar.fillRoundedRect(e+1,a+1,(i-2)*n,t-2,2)}createActionPanel(){const{width:e,height:a}=this.cameras.main;this.zoneButtons=this.add.container(e/2,370),this.createZoneButtons(),this.actionButtons=this.add.container(e/2,520),this.createActionButtons()}createZoneButtons(){const e=["head","body","legs"],a={head:"🎯 HEAD",body:"🎯 BODY",legs:"🎯 LEGS"},i=95;e.forEach((t,n)=>{const o=(n-1)*i,c=x.createButton(this,o,0,a[t],()=>this.selectZone(t),{width:85,height:35,fontSize:"11px"});c.setData("zone",t),this.zoneButtons.add(c)}),this.highlightZone("body")}selectZone(e){this.selectedZone=e,this.highlightZone(e)}highlightZone(e){this.zoneButtons.each(a=>{const i=a,t=i.first,n=i.getData("zone")===e;t==null||t.clear(),t==null||t.fillStyle(n?5917242:2760474,1),t==null||t.fillRoundedRect(-42.5,-17.5,85,35,6),t==null||t.lineStyle(2,n?13216089:5917242,1),t==null||t.strokeRoundedRect(-42.5,-17.5,85,35,6)})}createActionButtons(){const e=[{action:"light_attack",label:"⚔️ LIGHT",stamina:10},{action:"heavy_attack",label:"💥 HEAVY",stamina:25},{action:"guard",label:"🛡️ GUARD",stamina:5},{action:"dodge",label:"💨 DODGE",stamina:15},{action:"special",label:"✨ SPECIAL",stamina:20},{action:"item",label:"🧪 ITEM",stamina:0}],a=3,i=100,t=50,n=110,o=60;e.forEach((c,l)=>{const h=l%a,u=Math.floor(l/a),p=(h-1)*n,y=u*o,k=x.createButton(this,p,y,c.label,()=>this.performAction(c.action),{width:i,height:t,fontSize:"12px"});this.actionButtons.add(k)})}performAction(e){if(this.combatState.turn!=="player"||this.combatState.phase==="end")return;const a={light_attack:10,heavy_attack:25,guard:5,dodge:15,special:20,item:0};if(this.combatState.player.currentStamina<a[e]){this.showCombatMessage("Not enough stamina!",1e3);return}if(e==="special"&&this.combatState.player.currentFocus<30){this.showCombatMessage("Not enough focus!",1e3);return}const i=V(this.combatState,"player",e,this.selectedZone);if(this.showCombatMessage(i.message,1500),this.updateAllBars(),this.combatState.winner){this.endCombat();return}this.disableInput(),this.time.delayedCall(1500,()=>{this.performEnemyTurn()})}performEnemyTurn(){if(this.combatState.winner)return;q(this.combatState);const e=this.enemy.signatureTrait.id||"balanced",{action:a,targetZone:i}=je(this.combatState,e),t=V(this.combatState,"enemy",a,i);if(this.showCombatMessage(t.message,1500),this.updateAllBars(),t.damage>20&&this.shakeScreen(),this.combatState.winner){this.endCombat();return}this.time.delayedCall(1500,()=>{q(this.combatState),this.updateRoundDisplay(),this.enableInput()})}updateAllBars(){const{width:e}=this.cameras.main;this.updateHealthBar(this.playerHealthBar,30,60,150,20,!0),this.updateHealthBar(this.enemyHealthBar,e-180,60,150,20,!1),this.updateStaminaBar(30,85,120,12),this.updateFocusBar(30,102,100,10),this.updateHypeBar(e/2-75,55,150,12)}updateRoundDisplay(){}showCombatMessage(e,a){this.combatLog.setText(e),this.tweens.add({targets:this.combatLog,alpha:{from:1,to:.7},duration:100,yoyo:!0})}shakeScreen(){g.getSettings().screenShake&&this.cameras.main.shake(200,.01)}disableInput(){this.actionButtons.setAlpha(.5),this.zoneButtons.setAlpha(.5)}enableInput(){this.actionButtons.setAlpha(1),this.zoneButtons.setAlpha(1)}endCombat(){var i;this.disableInput();const e=this.combatState.winner==="player",a=g.getRun();if(e){this.player.wins++,this.player.totalDamageDealt+=this.combatState.log.filter(o=>o.actor==="player").reduce((o,c)=>o+c.result.damage,0),this.player.weeksSurvived=a.week+1;const t=He(this.combatState.player);t&&le(this.player,t);const n=Ne(this.combatState,!0,a.league);g.updateRun({fighter:this.player,gold:a.gold+n.gold,fame:a.fame+n.fame,fightsInLeague:a.fightsInLeague+1}),this.time.delayedCall(2e3,()=>{this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("ResultsScene",{won:!0,rewards:n,injury:t,enemy:this.enemy})})})}else this.player.status="dead",this.player.causeOfDeath=ue({damage:((i=this.combatState.lastAction)==null?void 0:i.damage)||0,location:this.selectedZone,weaponType:"blade"},this.combatState.round,this.enemy.fullName),this.player.lastWords=fe(this.player),this.player.killedBy=this.enemy.fullName,g.updateRun({fighter:this.player}),g.endRun(!1),this.player.lastWords&&this.showCombatMessage(this.player.lastWords,3e3),this.time.delayedCall(3e3,()=>{this.cameras.main.fadeOut(500),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("DeathScene")})})}}class it extends S.Scene{constructor(){super({key:"ResultsScene"});m(this,"resultsData")}init(e){this.resultsData=e}create(){const{width:e,height:a}=this.cameras.main;if(this.createBackground(),this.createResultsDisplay(),this.createRewardsDisplay(),this.createContinueButton(),this.resultsData.won){const i=g.getRun();i.fighter&&(O(i.fighter,5),g.updateRun({fighter:i.fighter}))}this.checkLeagueAdvancement(),this.cameras.main.fadeIn(300)}createBackground(){const{width:e,height:a}=this.cameras.main,i=this.add.graphics();i.fillGradientStyle(1709072,1709072,2760474,2760474),i.fillRect(0,0,e,a)}createResultsDisplay(){const{width:e}=this.cameras.main,a=this.resultsData.won?"VICTORY!":"DEFEAT",i=this.resultsData.won?"#c9a959":"#8b0000";this.add.text(e/2,80,a,{fontFamily:"Georgia, serif",fontSize:"36px",color:i,stroke:"#000000",strokeThickness:4}).setOrigin(.5),this.resultsData.won&&this.add.text(e/2,130,`${this.resultsData.enemy.fullName} has fallen!`,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#8b7355",fontStyle:"italic"}).setOrigin(.5),this.resultsData.injury&&(this.add.text(e/2,160,`⚠️ INJURY: ${this.resultsData.injury.name}`,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#8b4513"}).setOrigin(.5),this.add.text(e/2,180,this.resultsData.injury.effect,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#5a4a3a"}).setOrigin(.5))}createRewardsDisplay(){const{width:e}=this.cameras.main,a=230;this.add.text(e/2,a,"═══ REWARDS ═══",{fontFamily:"Georgia, serif",fontSize:"16px",color:"#c9a959"}).setOrigin(.5);const i=this.add.text(e/2,a+40,`💰 ${this.resultsData.rewards.gold} Gold`,{fontFamily:"Georgia, serif",fontSize:"18px",color:"#ffd700"}).setOrigin(.5),t=this.add.text(e/2,a+70,`⭐ ${this.resultsData.rewards.fame} Fame`,{fontFamily:"Georgia, serif",fontSize:"16px",color:"#c0c0c0"}).setOrigin(.5),n=this.add.text(e/2,a+100,`📈 ${this.resultsData.rewards.xp} XP`,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#8b7355"}).setOrigin(.5);[i,t,n].forEach((o,c)=>{o.setAlpha(0),this.tweens.add({targets:o,alpha:1,y:o.y-10,duration:300,delay:200+c*200,ease:"Back.out"})})}checkLeagueAdvancement(){const e=g.getRun(),{width:a}=this.cameras.main;if(e.fightsInLeague>=e.fightsToNextLeague){const t={bronze:"silver",silver:"gold",gold:"champion"}[e.league];t&&(this.time.delayedCall(1e3,()=>{const n=this.add.text(a/2,400,`🏆 ADVANCED TO ${t.toUpperCase()} LEAGUE!`,{fontFamily:"Georgia, serif",fontSize:"18px",color:"#ffd700",stroke:"#000000",strokeThickness:2}).setOrigin(.5).setAlpha(0);this.tweens.add({targets:n,alpha:1,scale:{from:.5,to:1},duration:500,ease:"Back.out"})}),g.updateRun({league:t,fightsInLeague:0,fightsToNextLeague:t==="champion"?1:3}),g.addBloodlinePoints(5),g.addPromoterXP(25))}}createContinueButton(){const{width:e,height:a}=this.cameras.main;x.createButton(this,e/2,a-80,"CONTINUE",()=>this.continue(),{width:200,height:50,primary:!0})}continue(){this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("CampScene")})}}class st extends S.Scene{constructor(){super({key:"DeathScene"});m(this,"fighter");m(this,"legendEntry");m(this,"playerNote","")}create(){const e=g.getRun();if(!e.fighter){this.scene.start("MainMenuScene");return}this.fighter=e.fighter,this.legendEntry=me(this.fighter,"dead",e.league,e.promise||"none",!1),this.createBackground(),this.createMemorial(),this.createNoteInput(),this.createButtons(),this.cameras.main.fadeIn(1e3,0,0,0)}createBackground(){const{width:e,height:a}=this.cameras.main,i=this.add.graphics();if(i.fillGradientStyle(657414,657414,1709072,1709072),i.fillRect(0,0,e,a),this.textures.exists("vignette")){const t=this.add.image(e/2,a/2,"vignette");t.setDisplaySize(e,a),t.setAlpha(.8)}}createMemorial(){const{width:e,height:a}=this.cameras.main,i=e/2,t=320,n=500,o=i-t/2,c=40,l=this.add.graphics();l.fillStyle(1709072,.9),l.fillRoundedRect(o,c,t,n,12),l.lineStyle(3,5917242,1),l.strokeRoundedRect(o,c,t,n,12),l.lineStyle(1,3811866,.5),l.strokeRoundedRect(o+8,c+8,t-16,n-16,8),this.add.text(i,c+30,"IN MEMORIAM",{fontFamily:"Georgia, serif",fontSize:"18px",color:"#c9a959",letterSpacing:4}).setOrigin(.5);const h=c+100;A.renderPortrait(this,this.fighter.portrait,i,h,80),this.add.text(i,h+60,this.fighter.fullName,{fontFamily:"Georgia, serif",fontSize:"16px",color:"#c9a959"}).setOrigin(.5),this.add.text(i,h+82,`${this.fighter.age} winters • ${this.fighter.birthplace}`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b7355"}).setOrigin(.5),this.fighter.causeOfDeath&&this.add.text(i,h+115,this.fighter.causeOfDeath,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b4513",fontStyle:"italic",wordWrap:{width:280},align:"center"}).setOrigin(.5),this.fighter.lastWords&&this.add.text(i,h+160,`"${this.fighter.lastWords}"`,{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b7355",fontStyle:"italic"}).setOrigin(.5);const u=h+200;this.add.text(i,u,"─── LEGACY ───",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#5a4a3a"}).setOrigin(.5),[`Victories: ${this.fighter.wins}`,`Weeks Survived: ${this.fighter.weeksSurvived}`,`Signature Moves: ${this.fighter.signatureMoveUses}`,`Perfect Parries: ${this.fighter.perfectParries}`,`Closest Call: ${this.fighter.closestCall} HP`].forEach((b,w)=>{this.add.text(i,u+25+w*18,b,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b7355"}).setOrigin(.5)}),g.getRun();const y=u+120;this.add.text(i,y,"⚔️ Promise Broken",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b4513"}).setOrigin(.5),this.add.text(i,y+25,`📿 ${this.fighter.keepsake.name} - Recovered`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#6b8e23"}).setOrigin(.5)}createNoteInput(){const{width:e,height:a}=this.cameras.main;this.add.text(e/2,570,"Leave a note for the fallen:",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b7355"}).setOrigin(.5);const i=this.add.graphics();i.fillStyle(2760474,1),i.fillRoundedRect(e/2-140,585,280,60,6),i.lineStyle(1,5917242,1),i.strokeRoundedRect(e/2-140,585,280,60,6);const t=this.add.text(e/2,615,"Tap to add note...",{fontFamily:"Georgia, serif",fontSize:"11px",color:"#5a4a3a",fontStyle:"italic"}).setOrigin(.5);i.setInteractive(new S.Geom.Rectangle(e/2-140,585,280,60),S.Geom.Rectangle.Contains),i.on("pointerdown",()=>{const n=prompt("Write a note for the fallen:");if(n){this.playerNote=n,this.legendEntry.playerNote=n,t.setText(n.substring(0,40)+(n.length>40?"...":"")),t.setColor("#c9a959"),t.setFontStyle("normal");const o=g.getHallOfLegends(),c=o.find(l=>l.id===this.legendEntry.id);c&&(c.playerNote=n,g.updateMeta({hallOfLegends:o}))}})}createButtons(){const{width:e,height:a}=this.cameras.main;x.createButton(this,e/2,a-60,"RETURN TO MENU",()=>this.returnToMenu(),{width:200,height:50,primary:!0})}returnToMenu(){this.cameras.main.fadeOut(500,0,0,0),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("MainMenuScene")})}}class rt extends S.Scene{constructor(){super({key:"HallOfLegendsScene"});m(this,"legends",[]);m(this,"scrollOffset",0);m(this,"selectedLegend",null);m(this,"detailsContainer")}create(){this.legends=g.getHallOfLegends(),this.createBackground(),this.createHeader(),this.createLegendList(),this.createDetailsPanel(),this.createBackButton(),this.cameras.main.fadeIn(300)}createBackground(){const{width:e,height:a}=this.cameras.main,i=this.add.graphics();if(i.fillGradientStyle(657414,657414,1709072,1709072),i.fillRect(0,0,e,a),this.textures.exists("parchment_overlay")){const t=this.add.image(e/2,a/2,"parchment_overlay");t.setAlpha(.05),t.setDisplaySize(e,a)}}createHeader(){const{width:e}=this.cameras.main;this.add.text(e/2,35,"HALL OF LEGENDS",{fontFamily:"Georgia, serif",fontSize:"24px",color:"#c9a959",stroke:"#000000",strokeThickness:3}).setOrigin(.5),this.add.text(e/2,65,"Those who fought and fell...",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b7355",fontStyle:"italic"}).setOrigin(.5);const a=this.legends.filter(n=>n.status==="dead").length,i=this.legends.filter(n=>n.status==="retired").length,t=this.legends.filter(n=>n.status==="champion").length;this.add.text(e/2,85,`☠️ ${a}  |  🏛️ ${i}  |  🏆 ${t}`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#5a4a3a"}).setOrigin(.5)}createLegendList(){const{width:e,height:a}=this.cameras.main;if(this.legends.length===0){this.add.text(e/2,200,`No legends yet...

Your fighters will be remembered here.`,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#5a4a3a",align:"center"}).setOrigin(.5);return}const i=110,t=70,n=e-40,o=[...this.legends].sort((c,l)=>l.dateAdded-c.dateAdded);o.slice(0,5).forEach((c,l)=>{this.createLegendCard(c,20,i+l*(t+10),n,t)}),o.length>5&&this.add.text(e/2,i+5*(t+10)+10,`...and ${o.length-5} more`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#5a4a3a"}).setOrigin(.5)}createLegendCard(e,a,i,t,n){var v;const o=this.add.container(a,i),c=this.add.graphics(),l=e.status==="champion"?2763280:e.status==="retired"?1714714:2759194;c.fillStyle(l,1),c.fillRoundedRect(0,0,t,n,8),c.lineStyle(1,5917242,1),c.strokeRoundedRect(0,0,t,n,8),o.add(c);const h=A.renderMiniPortrait(this,e.fighter.portrait,35,n/2,40);o.add(h);const u=this.add.text(70,12,e.fighter.fullName,{fontFamily:"Georgia, serif",fontSize:"13px",color:"#c9a959"});o.add(u);const p=e.status==="champion"?"🏆":e.status==="retired"?"🏛️":"☠️",y=this.add.text(t-15,12,p,{fontSize:"16px"}).setOrigin(1,0);o.add(y);const k=`${e.leagueReached.toUpperCase()} | ${e.wins} wins | ${e.weeksSurvived} weeks`,b=this.add.text(70,32,k,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355"});o.add(b);const w=e.status==="dead"?((v=e.causeOfDeath)==null?void 0:v.substring(0,40))+"...":e.status==="retired"?"Retired with honor":"Became Champion!",d=this.add.text(70,48,w||"",{fontFamily:"Georgia, serif",fontSize:"9px",color:"#5a4a3a",fontStyle:"italic"});o.add(d),c.setInteractive(new S.Geom.Rectangle(0,0,t,n),S.Geom.Rectangle.Contains),c.on("pointerdown",()=>this.showDetails(e)),c.on("pointerover",()=>{c.clear(),c.fillStyle(l+1118481,1),c.fillRoundedRect(0,0,t,n,8),c.lineStyle(2,13216089,1),c.strokeRoundedRect(0,0,t,n,8)}),c.on("pointerout",()=>{c.clear(),c.fillStyle(l,1),c.fillRoundedRect(0,0,t,n,8),c.lineStyle(1,5917242,1),c.strokeRoundedRect(0,0,t,n,8)})}createDetailsPanel(){const{width:e,height:a}=this.cameras.main;this.detailsContainer=this.add.container(e/2,550),this.detailsContainer.setVisible(!1);const i=this.add.graphics();i.fillStyle(1709072,.95),i.fillRoundedRect(-160,-100,320,200,10),i.lineStyle(2,13216089,1),i.strokeRoundedRect(-160,-100,320,200,10),this.detailsContainer.add(i)}showDetails(e){this.selectedLegend=e,this.detailsContainer.removeAll(!0);const a=this.add.graphics();a.fillStyle(1709072,.95),a.fillRoundedRect(-160,-100,320,200,10),a.lineStyle(2,13216089,1),a.strokeRoundedRect(-160,-100,320,200,10),this.detailsContainer.add(a);const i=this.add.text(0,-85,e.fighter.fullName,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#c9a959"}).setOrigin(.5);this.detailsContainer.add(i);const t=this.add.text(0,-65,`✨ ${e.fighter.signatureTrait}`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#6b8e23"}).setOrigin(.5);if(this.detailsContainer.add(t),e.bestWin){const o=this.add.text(0,-45,`Best Victory: ${e.bestWin}`,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355"}).setOrigin(.5);this.detailsContainer.add(o)}if(e.lettersWritten.length>0){const o=this.add.text(0,-25,`📜 ${e.lettersWritten.length} letters written`,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355"}).setOrigin(.5);this.detailsContainer.add(o)}if(e.playerNote){const o=this.add.text(0,10,`"${e.playerNote}"`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#c9a959",fontStyle:"italic",wordWrap:{width:280},align:"center"}).setOrigin(.5);this.detailsContainer.add(o)}const n=x.createButton(this,0,70,"CLOSE",()=>this.detailsContainer.setVisible(!1),{width:80,height:30,fontSize:"11px"});this.detailsContainer.add(n),this.detailsContainer.setVisible(!0)}createBackButton(){const{width:e,height:a}=this.cameras.main;x.createButton(this,e/2,a-50,"← BACK TO MENU",()=>this.returnToMenu(),{width:180,height:45})}returnToMenu(){this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("MainMenuScene")})}}class nt extends S.Scene{constructor(){super({key:"BloodlinePerksScene"});m(this,"pointsText");m(this,"selectedPerk",null);m(this,"detailsContainer");m(this,"perkContainers",new Map)}create(){this.createBackground(),this.createHeader(),this.createPerkTree(),this.createDetailsPanel(),this.createBackButton(),this.cameras.main.fadeIn(300)}createBackground(){const{width:e,height:a}=this.cameras.main,i=this.add.graphics();i.fillGradientStyle(1709072,1709072,2760474,2760474),i.fillRect(0,0,e,a)}createHeader(){const{width:e}=this.cameras.main,a=g.getMeta();this.add.text(e/2,35,"BLOODLINE PERKS",{fontFamily:"Georgia, serif",fontSize:"24px",color:"#c9a959",stroke:"#000000",strokeThickness:3}).setOrigin(.5),this.add.text(e/2,65,"Permanent upgrades for future fighters",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b7355",fontStyle:"italic"}).setOrigin(.5),this.pointsText=this.add.text(e/2,90,`⚡ ${a.bloodlinePoints} Points Available`,{fontFamily:"Georgia, serif",fontSize:"16px",color:"#ffd700"}).setOrigin(.5),this.add.text(e/2,110,`Promoter Level: ${a.promoterLevel}`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b7355"}).setOrigin(.5)}createPerkTree(){const{width:e}=this.cameras.main,a=150,i=160,t=P.filter(c=>c.tier===1),n=P.filter(c=>c.tier===2),o=P.filter(c=>c.tier===3);this.add.text(e/2,a-15,"─── TIER 1 ───",{fontFamily:"Georgia, serif",fontSize:"11px",color:"#5a4a3a"}).setOrigin(.5),this.createPerkRow(t,a,e),this.add.text(e/2,a+i-15,"─── TIER 2 ───",{fontFamily:"Georgia, serif",fontSize:"11px",color:"#5a4a3a"}).setOrigin(.5),this.createPerkRow(n,a+i,e),this.add.text(e/2,a+i*2-15,"─── TIER 3 ───",{fontFamily:"Georgia, serif",fontSize:"11px",color:"#5a4a3a"}).setOrigin(.5),this.createPerkRow(o,a+i*2,e)}createPerkRow(e,a,i){const o=i/2-(e.length-1)*75/2;e.forEach((c,l)=>{const h=o+l*75;this.createPerkNode(c,h,a,60)})}createPerkNode(e,a,i,t){const n=this.add.container(a,i);this.perkContainers.set(e.id,n);const c=g.getMeta().unlockedPerks.includes(e.id),{canPurchase:l,reason:h}=H(e.id),u=this.add.graphics(),p=c?2771498:l?2763322:2760474;u.fillStyle(p,1),u.fillRoundedRect(-t/2,-t/2,t,t,8);const y=c?7048739:l?13216089:5917242;u.lineStyle(2,y,1),u.strokeRoundedRect(-t/2,-t/2,t,t,8),n.add(u);const k=e.tier===1?"●":e.tier===2?"◆":"★",b=this.add.text(0,-t/2-10,k,{fontSize:"12px",color:c?"#6b8e23":"#5a4a3a"}).setOrigin(.5);if(n.add(b),c){const d=this.add.text(0,0,"✓",{fontSize:"24px",color:"#6b8e23"}).setOrigin(.5);n.add(d)}else{const d=this.add.text(0,8,`${e.cost}`,{fontFamily:"Georgia, serif",fontSize:"16px",color:l?"#ffd700":"#5a4a3a"}).setOrigin(.5);n.add(d)}const w=this.add.text(0,t/2+10,e.name,{fontFamily:"Georgia, serif",fontSize:"9px",color:c?"#6b8e23":"#8b7355",wordWrap:{width:70},align:"center"}).setOrigin(.5,0);n.add(w),u.setInteractive(new S.Geom.Rectangle(-t/2,-t/2,t,t),S.Geom.Rectangle.Contains),u.on("pointerdown",()=>this.selectPerk(e)),u.on("pointerover",()=>{c||(u.clear(),u.fillStyle(p+1118481,1),u.fillRoundedRect(-t/2,-t/2,t,t,8),u.lineStyle(2,13216089,1),u.strokeRoundedRect(-t/2,-t/2,t,t,8))}),u.on("pointerout",()=>{u.clear(),u.fillStyle(p,1),u.fillRoundedRect(-t/2,-t/2,t,t,8),u.lineStyle(2,y,1),u.strokeRoundedRect(-t/2,-t/2,t,t,8)})}createDetailsPanel(){const{width:e,height:a}=this.cameras.main;this.detailsContainer=this.add.container(e/2,650),this.add.text(e/2,630,"Select a perk to view details",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#5a4a3a"}).setOrigin(.5)}selectPerk(e){this.selectedPerk=e,this.updateDetailsPanel()}updateDetailsPanel(){if(!this.selectedPerk)return;const e=this.selectedPerk;this.detailsContainer.removeAll(!0);const i=g.getMeta().unlockedPerks.includes(e.id),{canPurchase:t,reason:n}=H(e.id),o=this.add.graphics();o.fillStyle(2760474,.95),o.fillRoundedRect(-160,-70,320,140,10),o.lineStyle(2,5917242,1),o.strokeRoundedRect(-160,-70,320,140,10),this.detailsContainer.add(o);const c=this.add.text(0,-55,e.name,{fontFamily:"Georgia, serif",fontSize:"16px",color:"#c9a959"}).setOrigin(.5);this.detailsContainer.add(c);const l=this.add.text(0,-30,e.description,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b7355",wordWrap:{width:280},align:"center"}).setOrigin(.5);this.detailsContainer.add(l);const h=this.add.text(0,0,`Effect: ${e.effect}`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#6b8e23"}).setOrigin(.5);if(this.detailsContainer.add(h),i){const u=this.add.text(0,25,"✓ OWNED",{fontFamily:"Georgia, serif",fontSize:"14px",color:"#6b8e23"}).setOrigin(.5);this.detailsContainer.add(u)}else if(t){const u=x.createButton(this,0,40,`BUY (${e.cost} pts)`,()=>this.purchasePerk(e),{width:120,height:35,fontSize:"12px",primary:!0});this.detailsContainer.add(u)}else{const u=this.add.text(0,25,`🔒 ${n}`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b4513"}).setOrigin(.5);this.detailsContainer.add(u)}}purchasePerk(e){if(xe(e.id)){x.showNotification(this,`Unlocked: ${e.name}!`);const a=g.getMeta();this.pointsText.setText(`⚡ ${a.bloodlinePoints} Points Available`),this.scene.restart()}}createBackButton(){const{width:e,height:a}=this.cameras.main;x.createButton(this,e/2,a-50,"← BACK TO MENU",()=>this.returnToMenu(),{width:180,height:45})}returnToMenu(){this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("MainMenuScene")})}}class ot extends S.Scene{constructor(){super({key:"SettingsScene"});m(this,"settings");m(this,"toggleButtons",new Map)}create(){this.settings=g.getSettings(),this.createBackground(),this.createHeader(),this.createSettingsList(),this.createResetButton(),this.createBackButton(),this.cameras.main.fadeIn(300)}createBackground(){const{width:e,height:a}=this.cameras.main,i=this.add.graphics();i.fillGradientStyle(1709072,1709072,2760474,2760474),i.fillRect(0,0,e,a)}createHeader(){const{width:e}=this.cameras.main;this.add.text(e/2,40,"SETTINGS",{fontFamily:"Georgia, serif",fontSize:"28px",color:"#c9a959",stroke:"#000000",strokeThickness:3}).setOrigin(.5)}createSettingsList(){const{width:e}=this.cameras.main,a=100;this.add.text(e/2,a,"─── VISUAL ───",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#5a4a3a"}).setOrigin(.5),this.createToggle("reduceMotion","Reduce Motion","Minimize animations and particles",a+40),this.createToggle("screenShake","Screen Shake","Enable impact screen shake",a+100),this.createToggle("bloodFX","Blood Effects","Show blood during combat",a+160),this.createToggle("grainFX","Grain/Ink FX","Atmospheric visual overlay",a+220),this.add.text(e/2,a+290,"─── AUDIO ───",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#5a4a3a"}).setOrigin(.5),this.createToggle("soundEnabled","Sound Enabled","Enable all game audio",a+330),this.add.text(e/2,a+390,"(Audio features coming soon)",{fontFamily:"Georgia, serif",fontSize:"10px",color:"#5a4a3a",fontStyle:"italic"}).setOrigin(.5)}createToggle(e,a,i,t){const{width:n}=this.cameras.main;this.add.text(30,t,a,{fontFamily:"Georgia, serif",fontSize:"15px",color:"#c9a959"}),this.add.text(30,t+20,i,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355"});const o=!!this.settings[e],c=this.createToggleButton(n-80,t+10,o,l=>{this.settings[e]=l,g.updateSettings({[e]:l})});this.toggleButtons.set(e,c)}createToggleButton(e,a,i,t){const n=this.add.container(e,a);let o=i;const c=60,l=28,h=this.add.graphics(),u=()=>{h.clear(),h.fillStyle(o?3050327:3811866,1),h.fillRoundedRect(0,0,c,l,l/2),h.lineStyle(1,o?7048739:5917242,1),h.strokeRoundedRect(0,0,c,l,l/2)};u(),n.add(h);const p=l-6,y=this.add.graphics(),k=()=>{const b=o?c-p-3:3;y.clear(),y.fillStyle(o?16777215:9139029,1),y.fillCircle(b+p/2,l/2,p/2)};return k(),n.add(y),h.setInteractive(new S.Geom.Rectangle(0,0,c,l),S.Geom.Rectangle.Contains),h.on("pointerdown",()=>{o=!o,u(),k(),t(o)}),n}createResetButton(){const{width:e,height:a}=this.cameras.main;this.add.text(e/2,a-150,"─── DANGER ZONE ───",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b0000"}).setOrigin(.5);const t=x.createButton(this,e/2,a-110,"🗑️ RESET ALL DATA",()=>this.showResetConfirmation(),{width:200,height:45}).first;t.clear(),t.fillStyle(3807770,1),t.fillRoundedRect(-100,-22.5,200,45,8),t.lineStyle(2,9109504,1),t.strokeRoundedRect(-100,-22.5,200,45,8)}showResetConfirmation(){x.showConfirmDialog(this,"Reset All Data?",`This will DELETE all save data including:
• All fighters
• Hall of Legends
• Bloodline Perks
• Settings

This CANNOT be undone!`,()=>this.performReset(),()=>{},"HOLD TO CONFIRM")}performReset(){g.resetAllData(),x.showNotification(this,"All data has been reset"),this.time.delayedCall(1500,()=>{this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("MainMenuScene")})})}createBackButton(){const{width:e,height:a}=this.cameras.main;x.createButton(this,e/2,a-50,"← BACK TO MENU",()=>this.returnToMenu(),{width:180,height:45})}returnToMenu(){this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("MainMenuScene")})}}class ct extends S.Scene{constructor(){super({key:"VignetteScene"});m(this,"vignette");m(this,"fighter");m(this,"resultText")}init(e){const a=g.getRun();if(!a.fighter){this.scene.start("MainMenuScene");return}this.fighter=a.fighter,e.specificVignette?this.vignette=D.find(i=>i.id===e.specificVignette):this.vignette=this.selectRandomVignette(e.type||"camp")}selectRandomVignette(e){const a=g.getRun(),i=a.completedVignettes,t=D.filter(n=>!(n.category!==e||i.includes(n.id)||n.requirements&&(n.requirements.minWeek&&a.week<n.requirements.minWeek||n.requirements.minTrust&&this.fighter.trust<n.requirements.minTrust||n.requirements.maxTrust&&this.fighter.trust>n.requirements.maxTrust||n.requirements.hasInjury&&this.fighter.injuries.length===0)));if(t.length===0){const n=D.filter(o=>o.category===e);return f.pick(n)}return f.pick(t)}create(){this.createBackground(),this.createVignetteContent(),this.cameras.main.fadeIn(300)}createBackground(){const{width:e,height:a}=this.cameras.main,i=this.add.graphics();if(i.fillGradientStyle(1709072,1709072,2760474,2760474),i.fillRect(0,0,e,a),this.textures.exists("parchment_overlay")){const t=this.add.image(e/2,a/2,"parchment_overlay");t.setAlpha(.1),t.setDisplaySize(e,a)}}createVignetteContent(){const{width:e,height:a}=this.cameras.main;this.add.text(e/2,50,this.vignette.title,{fontFamily:"Georgia, serif",fontSize:"22px",color:"#c9a959",stroke:"#000000",strokeThickness:2}).setOrigin(.5);const i={camp:"🏕️",offer:"💀",letter:"✉️",event:"❓"};this.add.text(e/2,80,i[this.vignette.category]||"📜",{fontSize:"20px"}).setOrigin(.5),this.add.text(e/2,150,this.vignette.description,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#c9a959",wordWrap:{width:320},align:"center",lineSpacing:6}).setOrigin(.5);const t=280,n=90;this.vignette.choices.forEach((o,c)=>{this.createChoiceButton(o,e/2,t+c*n)}),this.resultText=this.add.text(e/2,a-150,"",{fontFamily:"Georgia, serif",fontSize:"13px",color:"#8b7355",fontStyle:"italic",wordWrap:{width:320},align:"center"}).setOrigin(.5)}createChoiceButton(e,a,i){const t=this.add.container(a,i),n=320,o=70,c=this.add.graphics();c.fillStyle(2760474,1),c.fillRoundedRect(-n/2,-o/2,n,o,8),c.lineStyle(2,5917242,1),c.strokeRoundedRect(-n/2,-o/2,n,o,8),t.add(c);const l=this.add.text(0,-10,e.text,{fontFamily:"Georgia, serif",fontSize:"13px",color:"#c9a959",wordWrap:{width:n-30},align:"center"}).setOrigin(.5);t.add(l);const h=[];if(e.effects.trust){const u=e.effects.trust>0?"+":"";h.push(`${u}${e.effects.trust} Trust`)}if(e.effects.gold){const u=e.effects.gold>0?"+":"";h.push(`${u}${e.effects.gold} Gold`)}if(e.effects.hp){const u=e.effects.hp>0?"+":"";h.push(`${u}${e.effects.hp} HP`)}if(e.effects.injury&&h.push(`Risk: ${e.effects.injury} injury`),e.effects.injuryHeal&&h.push(`Heal ${e.effects.injuryHeal} week(s)`),h.length>0){const u=this.add.text(0,18,h.join(" | "),{fontFamily:"Georgia, serif",fontSize:"10px",color:"#6b8e23"}).setOrigin(.5);t.add(u)}c.setInteractive(new S.Geom.Rectangle(-n/2,-o/2,n,o),S.Geom.Rectangle.Contains),c.on("pointerover",()=>{c.clear(),c.fillStyle(3813162,1),c.fillRoundedRect(-n/2,-o/2,n,o,8),c.lineStyle(2,13216089,1),c.strokeRoundedRect(-n/2,-o/2,n,o,8)}),c.on("pointerout",()=>{c.clear(),c.fillStyle(2760474,1),c.fillRoundedRect(-n/2,-o/2,n,o,8),c.lineStyle(2,5917242,1),c.strokeRoundedRect(-n/2,-o/2,n,o,8)}),c.on("pointerdown",()=>{this.selectChoice(e),t.setVisible(!1)})}selectChoice(e){const a=g.getRun();if(e.effects.trust&&O(this.fighter,e.effects.trust),e.effects.gold&&(a.gold+=e.effects.gold),e.effects.hp&&(this.fighter.currentStats.currentHP=Math.max(1,Math.min(this.fighter.currentStats.maxHP,this.fighter.currentStats.currentHP+e.effects.hp))),e.effects.stamina&&(this.fighter.currentStats.currentStamina=Math.max(0,Math.min(this.fighter.currentStats.maxStamina,this.fighter.currentStats.currentStamina+e.effects.stamina))),e.effects.injuryHeal&&K(this.fighter,e.effects.injuryHeal),a.completedVignettes.includes(this.vignette.id)||a.completedVignettes.push(this.vignette.id),this.vignette.category==="letter"){const i=`Week ${a.week+1}: ${e.resultText}`;this.fighter.lettersWritten.push(i),a.lettersWritten.push(i)}g.updateRun({fighter:this.fighter,gold:a.gold,completedVignettes:a.completedVignettes,lettersWritten:a.lettersWritten}),this.showResult(e.resultText)}showResult(e){const{width:a,height:i}=this.cameras.main;this.tweens.add({targets:this.children.getAll().filter(t=>t.y>200&&t.y<600),alpha:0,duration:300}),this.resultText.setText(e),this.resultText.setAlpha(0),this.tweens.add({targets:this.resultText,alpha:1,duration:500,delay:300}),this.time.delayedCall(800,()=>{x.createButton(this,a/2,i-70,"CONTINUE",()=>this.returnToCamp(),{width:180,height:45,primary:!0})})}returnToCamp(){this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("CampScene")})}}const lt=()=>{const r=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),s=window.innerHeight>window.innerWidth;let e=390,a=844;return!r&&!s&&(e=600,a=900),{type:S.AUTO,parent:"game-container",width:e,height:a,backgroundColor:"#1a1410",scale:{mode:S.Scale.FIT,autoCenter:S.Scale.CENTER_BOTH,min:{width:320,height:480},max:{width:600,height:1200}},render:{pixelArt:!1,antialias:!0,roundPixels:!0},input:{activePointers:3,touch:{capture:!0}},scene:[ee,se,re,be,we,Te,Ce,at,it,st,rt,nt,ot,ct],physics:{default:"arcade",arcade:{debug:!1}}}},dt=lt(),ht=new S.Game(dt);window.addEventListener("resize",()=>{ht.scale.refresh()});document.addEventListener("touchstart",r=>{r.target instanceof HTMLCanvasElement&&r.preventDefault()},{passive:!1});document.addEventListener("touchmove",r=>{r.target instanceof HTMLCanvasElement&&r.preventDefault()},{passive:!1});document.addEventListener("contextmenu",r=>{r.preventDefault()});
