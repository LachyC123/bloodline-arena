var ne=Object.defineProperty;var oe=(n,r,e)=>r in n?ne(n,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[r]=e;var d=(n,r,e)=>oe(n,typeof r!="symbol"?r+"":r,e);import{P as w}from"./phaser-0RJB29YE.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))t(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&t(s)}).observe(document,{childList:!0,subtree:!0});function e(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function t(a){if(a.ep)return;a.ep=!0;const i=e(a);fetch(a.href,i)}})();class ce extends w.Scene{constructor(){super({key:"BootScene"})}init(){console.log("[BootScene] Initializing...")}preload(){}create(){console.log("[BootScene] Created - transitioning to PreloadScene"),this.registry.set("initialized",!0),this.registry.set("gameVersion","1.0.0"),this.scene.start("PreloadScene")}}const O=2,K="bloodline_arena_save",X={reduceMotion:!1,screenShake:!0,bloodFX:!0,grainFX:!0,soundEnabled:!0,musicVolume:.7,sfxVolume:.8,showDamageNumbers:!0,showTimingRing:!0,autoSave:!0},$={totalDamageDealt:0,totalDamageTaken:0,totalPerfectParries:0,totalItemsUsed:0,totalGoldEarned:0,totalFameEarned:0,highestStreak:0,championsDefeated:0,rivalsDefeated:0,fightsWithNoDamage:0,bleedDeaths:0,maxSingleDamage:0},M={seed:0,week:0,league:"bronze",fightsInLeague:0,fightsToNextLeague:3,gold:50,fame:0,fighter:null,archetypeId:"gladiator",promise:null,rivalId:null,friendId:null,completedVignettes:[],lettersWritten:[],lastCampAction:null,inProgress:!1,relics:[],relicPityCounter:0,activeModifiers:[],fightsSinceRelic:0,consecutiveWins:0,debt:0,debtFightsRemaining:0},H={promoterXP:0,promoterLevel:1,bloodlinePoints:0,letterStamps:0,unlockedPerks:[],unlockedArchetypes:["gladiator"],hallOfLegends:[],heirlooms:[],totalRuns:0,totalWins:0,totalDeaths:0,ghostMoments:[],lifetimeStats:{...$},letterCounts:{},unlockedLetterRewards:[],purchasedStampRewards:[]};class le{constructor(){d(this,"data");d(this,"autoSaveInterval",null);this.data=this.getDefaultData()}getDefaultData(){return{version:O,settings:{...X},run:{...M},meta:{...H},lastSaved:Date.now()}}load(){try{const r=localStorage.getItem(K);if(r){const e=JSON.parse(r);return e.version!==O?(console.log(`Migrating save from v${e.version} to v${O}`),this.migrate(e)):this.data=this.mergeWithDefaults(e),console.log("Save data loaded successfully"),!0}}catch(r){console.error("Failed to load save data:",r)}return this.data=this.getDefaultData(),!1}mergeWithDefaults(r){var e,t,a,i,s,o;return{version:O,settings:{...X,...r.settings},run:{...M,...r.run,relics:((e=r.run)==null?void 0:e.relics)||[],lettersWritten:((t=r.run)==null?void 0:t.lettersWritten)||[],activeModifiers:((a=r.run)==null?void 0:a.activeModifiers)||[]},meta:{...H,...r.meta,lifetimeStats:{...$,...(i=r.meta)==null?void 0:i.lifetimeStats},letterCounts:((s=r.meta)==null?void 0:s.letterCounts)||{},unlockedArchetypes:((o=r.meta)==null?void 0:o.unlockedArchetypes)||["gladiator"]},lastSaved:r.lastSaved||Date.now()}}migrate(r){let e=r;if(e.version===1){if(console.log("Migrating v1 -> v2: Adding relics, archetypes, letters"),e.run={...M,...e.run,relics:[],relicPityCounter:0,activeModifiers:[],fightsSinceRelic:0,consecutiveWins:0,debt:0,debtFightsRemaining:0,archetypeId:"gladiator",lettersWritten:[]},e.meta={...H,...e.meta,letterStamps:0,unlockedArchetypes:["gladiator"],lifetimeStats:{...$},letterCounts:{},unlockedLetterRewards:[],purchasedStampRewards:[]},Array.isArray(e.run.lettersWritten)){const t=e.run.lettersWritten;t.length>0&&typeof t[0]=="string"&&(e.run.lettersWritten=[])}e.version=2}this.data=this.mergeWithDefaults(e),this.data.version=O,this.save()}save(){try{return this.data.lastSaved=Date.now(),localStorage.setItem(K,JSON.stringify(this.data)),!0}catch(r){return console.error("Failed to save game:",r),!1}}startAutoSave(r=3e4){this.stopAutoSave(),this.data.settings.autoSave&&(this.autoSaveInterval=window.setInterval(()=>{this.save()},r))}stopAutoSave(){this.autoSaveInterval!==null&&(clearInterval(this.autoSaveInterval),this.autoSaveInterval=null)}getSettings(){return{...this.data.settings}}updateSettings(r){this.data.settings={...this.data.settings,...r},this.save()}getRun(){return{...this.data.run}}updateRun(r){this.data.run={...this.data.run,...r},this.save()}hasActiveRun(){return this.data.run.inProgress&&this.data.run.fighter!==null}startNewRun(r,e="gladiator"){this.data.run={...M,seed:r??Math.floor(Math.random()*2147483647),archetypeId:e,inProgress:!0},this.data.meta.totalRuns++,this.save()}endRun(r){r?this.data.meta.totalWins++:this.data.meta.totalDeaths++,this.data.run.consecutiveWins>this.data.meta.lifetimeStats.highestStreak&&(this.data.meta.lifetimeStats.highestStreak=this.data.run.consecutiveWins),this.data.run.inProgress=!1,this.save()}getMeta(){return{...this.data.meta}}updateMeta(r){this.data.meta={...this.data.meta,...r},this.save()}updateLifetimeStat(r,e){this.data.meta.lifetimeStats[r]+=e,this.save()}getLifetimeStats(){return{...this.data.meta.lifetimeStats}}addPromoterXP(r){this.data.meta.promoterXP+=r;const e=Math.floor(this.data.meta.promoterXP/100)+1;e>this.data.meta.promoterLevel&&(this.data.meta.promoterLevel=e,this.data.meta.bloodlinePoints+=e),this.save()}addBloodlinePoints(r){this.data.meta.bloodlinePoints+=r,this.save()}spendBloodlinePoints(r){return this.data.meta.bloodlinePoints>=r?(this.data.meta.bloodlinePoints-=r,this.save(),!0):!1}addLetterStamps(r){this.data.meta.letterStamps+=r,this.save()}spendLetterStamps(r){return this.data.meta.letterStamps>=r?(this.data.meta.letterStamps-=r,this.save(),!0):!1}getLetterStamps(){return this.data.meta.letterStamps}incrementLetterCount(r){this.data.meta.letterCounts[r]=(this.data.meta.letterCounts[r]||0)+1,this.save()}getLetterCount(r){return this.data.meta.letterCounts[r]||0}unlockLetterReward(r){this.data.meta.unlockedLetterRewards.includes(r)||(this.data.meta.unlockedLetterRewards.push(r),this.save())}hasLetterReward(r){return this.data.meta.unlockedLetterRewards.includes(r)}addRelic(r){this.data.run.relics.includes(r)||(this.data.run.relics.push(r),this.data.run.fightsSinceRelic=0,this.data.run.relicPityCounter=0,this.save())}getRelics(){return[...this.data.run.relics]}incrementRelicPity(){this.data.run.relicPityCounter++,this.data.run.fightsSinceRelic++,this.save()}unlockArchetype(r){this.data.meta.unlockedArchetypes.includes(r)||(this.data.meta.unlockedArchetypes.push(r),this.save())}isArchetypeUnlocked(r){return this.data.meta.unlockedArchetypes.includes(r)}getUnlockedArchetypes(){return[...this.data.meta.unlockedArchetypes]}unlockPerk(r){this.data.meta.unlockedPerks.includes(r)||(this.data.meta.unlockedPerks.push(r),this.save())}hasPerk(r){return this.data.meta.unlockedPerks.includes(r)}addToHallOfLegends(r){this.data.meta.hallOfLegends.push(r),this.save()}getHallOfLegends(){return[...this.data.meta.hallOfLegends]}addHeirloom(r){this.data.meta.heirlooms.push(r),this.save()}getHeirlooms(){return[...this.data.meta.heirlooms]}addGhostMoment(r){this.data.meta.ghostMoments.push(r),this.save()}getUntriggeredGhostMoments(){return this.data.meta.ghostMoments.filter(r=>!r.triggered)}triggerGhostMoment(r,e){const t=this.data.meta.ghostMoments.find(a=>a.fighterId===r&&a.type===e&&!a.triggered);t&&(t.triggered=!0,this.save())}addDebt(r,e){this.data.run.debt+=r,this.data.run.debtFightsRemaining=Math.max(this.data.run.debtFightsRemaining,e),this.save()}collectDebt(){if(this.data.run.debt>0&&this.data.run.debtFightsRemaining>0){const r=Math.ceil(this.data.run.debt/this.data.run.debtFightsRemaining);return this.data.run.debt-=r,this.data.run.debtFightsRemaining--,this.save(),r}return 0}resetAllData(){this.data=this.getDefaultData(),this.save(),console.log("All save data has been reset")}exportSave(){return JSON.stringify(this.data,null,2)}importSave(r){try{const e=JSON.parse(r);return e.version!==O?this.migrate(e):this.data=this.mergeWithDefaults(e),this.save(),!0}catch(e){return console.error("Failed to import save:",e),!1}}getSaveVersion(){return this.data.version}}const m=new le;class de{constructor(r){d(this,"scene");this.scene=r}generateUIAssets(){this.generateParchmentOverlay(),this.generateVignette(),this.generateParticle()}generatePortraitAssets(){}generateArenaAssets(){this.generateArenaOverlay(),this.generateCrowdSilhouette()}generateEffectAssets(){this.generateSpark(),this.generateBloodDrop(),this.generateDustPuff()}generateIconAssets(){}generateParchmentOverlay(){const e=this.scene.make.graphics({x:0,y:0});for(let t=0;t<512;t+=4)for(let a=0;a<512;a+=4){const i=Math.random()*.1,s=w.Display.Color.GetColor(Math.floor(180+i*30),Math.floor(160+i*30),Math.floor(120+i*30));e.fillStyle(s,.02+Math.random()*.03),e.fillRect(a,t,4,4)}for(let t=0;t<20;t++){const a=Math.random()*512,i=Math.random()*512,s=20+Math.random()*40;e.fillStyle(9139029,.02),e.fillCircle(a,i,s)}e.generateTexture("parchment_overlay",512,512),e.destroy()}generateVignette(){const e=this.scene.make.graphics({x:0,y:0}),t=512/2,a=512/2,i=512*.7;for(let s=i;s>0;s-=2){const o=Math.pow(1-s/i,2)*.8;e.fillStyle(0,o*.1),e.fillCircle(t,a,s)}e.fillStyle(0,.3),e.fillRect(0,0,512,30),e.fillRect(0,482,512,30),e.fillRect(0,0,30,512),e.fillRect(482,0,30,512),e.generateTexture("vignette",512,512),e.destroy()}generateParticle(){const e=this.scene.make.graphics({x:0,y:0});for(let t=16/2;t>0;t--){const a=t/8;e.fillStyle(16777215,a),e.fillCircle(16/2,16/2,t)}e.generateTexture("particle",16,16),e.destroy()}generateArenaOverlay(){const t=this.scene.make.graphics({x:0,y:0});t.fillGradientStyle(0,0,1709072,1709072,.3),t.fillRect(0,0,512,512);for(let a=0;a<5;a++){const i=102.4*a;t.fillStyle(0,.05+a*.02),t.fillRect(0,i,512,512/10)}t.fillStyle(16753920,.03),t.fillCircle(50,100,80),t.fillCircle(462,100,80),t.generateTexture("arena_overlay",512,512),t.destroy()}generateCrowdSilhouette(){const t=this.scene.make.graphics({x:0,y:0});t.fillStyle(1709072,1);for(let a=0;a<256;a+=20){const i=8+Math.random()*6,s=44+Math.random()*10;t.fillCircle(a+10,s,i),t.fillRect(a+2,s+i-2,16,20)}t.generateTexture("crowd_silhouette",256,64),t.destroy()}generateSpark(){const e=this.scene.make.graphics({x:0,y:0});e.fillStyle(16776960,1),e.fillCircle(8/2,8/2,8/4),e.fillStyle(16753920,.5),e.fillCircle(8/2,8/2,8/2),e.generateTexture("spark",8,8),e.destroy()}generateBloodDrop(){const e=this.scene.make.graphics({x:0,y:0});e.fillStyle(9109504,1),e.fillCircle(12/2,12/2+2,12/3),e.fillTriangle(12/2,0,12/2-12/4,12/2,12/2+12/4,12/2),e.generateTexture("blood_drop",12,12),e.destroy()}generateDustPuff(){const e=this.scene.make.graphics({x:0,y:0});for(let t=0;t<5;t++){const a=16+(Math.random()-.5)*32*.4,i=32/2+(Math.random()-.5)*32*.4,s=4+Math.random()*6;e.fillStyle(9139029,.2),e.fillCircle(a,i,s)}e.generateTexture("dust_puff",32,32),e.destroy()}static generateIcon(r,e,t,a=32){const i=r.make.graphics({x:0,y:0});t(i,a),i.generateTexture(e,a,a),i.destroy()}}function he(n){return`./${n.replace(/^\/+/,"")}`}class ue extends w.Scene{constructor(){super({key:"PreloadScene"});d(this,"diag",{totalToLoad:0,totalComplete:0,totalFailed:0,lastFileKey:"",lastFileUrl:"",failedFiles:[],startTime:0});d(this,"progressBar");d(this,"diagText");d(this,"statusText");d(this,"failedText");d(this,"retryBtn");d(this,"continueBtn");d(this,"loadComplete",!1);d(this,"timedOut",!1);d(this,"transitionStarted",!1);d(this,"timeoutTimer");d(this,"TIMEOUT_MS",8e3);d(this,"BAR_WIDTH",260);d(this,"BAR_HEIGHT",18)}init(){this.diag={totalToLoad:0,totalComplete:0,totalFailed:0,lastFileKey:"",lastFileUrl:"",failedFiles:[],startTime:Date.now()},this.loadComplete=!1,this.timedOut=!1,this.transitionStarted=!1,console.log("═══════════════════════════════════════"),console.log("[PRELOAD] Scene initialized"),console.log('[PRELOAD] BASE_URL = "./"'),console.log("═══════════════════════════════════════")}preload(){this.createDiagnosticUI(),this.setupLoaderEvents(),this.startTimeout(),this.queueAssets(),this.generateProceduralAssets(),this.diag.totalToLoad=this.load.totalToLoad,this.updateDiagnostics(),console.log(`[PRELOAD] Queued ${this.diag.totalToLoad} files`)}createDiagnosticUI(){const{width:e,height:t}=this.cameras.main,a=e/2,i=t/2;this.add.rectangle(a,i,e,t,1709072),this.add.text(a,i-120,"BLOODLINE ARENA",{fontFamily:"Georgia, serif",fontSize:"24px",color:"#c9a959",stroke:"#000000",strokeThickness:3}).setOrigin(.5),this.add.text(a,i-90,"Loading...",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b7355",fontStyle:"italic"}).setOrigin(.5);const s=a-this.BAR_WIDTH/2,o=i-30,c=this.add.graphics();c.fillStyle(3811866,1),c.fillRoundedRect(s-2,o-2,this.BAR_WIDTH+4,this.BAR_HEIGHT+4,4),c.fillStyle(1709072,1),c.fillRoundedRect(s,o,this.BAR_WIDTH,this.BAR_HEIGHT,3),this.progressBar=this.add.graphics(),this.statusText=this.add.text(a,i+10,"Initializing...",{fontFamily:"monospace",fontSize:"11px",color:"#8b7355"}).setOrigin(.5),this.diagText=this.add.text(a,i+45,"",{fontFamily:"monospace",fontSize:"10px",color:"#6a6a5a",align:"center"}).setOrigin(.5),this.failedText=this.add.text(a,i+90,"",{fontFamily:"monospace",fontSize:"9px",color:"#aa6666",align:"center",wordWrap:{width:e-40}}).setOrigin(.5,0)}setupLoaderEvents(){this.load.on("progress",e=>{this.updateProgressBar(e)}),this.load.on("filestart",e=>{this.diag.lastFileKey=e.key;const t=typeof e.src=="string"?e.src:String(e.src??e.url??"(unknown)");this.diag.lastFileUrl=t,this.statusText.setText(`Loading: ${e.key}`),console.log(`[PRELOAD] Loading: ${e.key} -> ${t}`)}),this.load.on("filecomplete",e=>{this.diag.totalComplete++,console.log(`[PRELOAD] ✓ Complete: ${e}`),this.updateDiagnostics()}),this.load.on("loaderror",e=>{this.diag.totalFailed++;const t=typeof e.src=="string"?e.src:String(e.src??e.url??"(unknown)");this.diag.failedFiles.push({key:e.key,url:t}),console.error(`[PRELOAD] ✗ FAILED: ${e.key} -> ${t}`),this.updateDiagnostics(),this.updateFailedList(),this.createFallbackTexture(e.key)}),this.load.once("complete",()=>{this.loadComplete=!0,console.log("[PRELOAD] ═══ LOADER COMPLETE ═══"),console.log(`[PRELOAD] Success: ${this.diag.totalComplete}, Failed: ${this.diag.totalFailed}`),this.clearTimeout(),this.diag.totalFailed>0?this.showErrorUI():this.startTransition()})}startTimeout(){console.log(`[PRELOAD] Starting ${this.TIMEOUT_MS}ms timeout`),this.timeoutTimer=this.time.delayedCall(this.TIMEOUT_MS,()=>{!this.loadComplete&&!this.transitionStarted&&(this.timedOut=!0,console.error("[PRELOAD] ⚠ TIMEOUT - Loading took too long!"),console.error("[PRELOAD] Pending files may have 404ed or stalled"),this.showErrorUI())})}clearTimeout(){this.timeoutTimer&&(this.timeoutTimer.destroy(),this.timeoutTimer=void 0)}queueAssets(){[{key:"ui_panel",path:"assets/ui/panel.svg"},{key:"ui_button",path:"assets/ui/button.svg"},{key:"ui_frame",path:"assets/ui/frame.svg"},{key:"overlay_vignette",path:"assets/overlays/vignette.svg"},{key:"overlay_grain",path:"assets/overlays/grain.svg"},{key:"arena_bg",path:"assets/arena/background.svg"},{key:"icon_main",path:"assets/icons/icon.svg"}].forEach(({key:t,path:a})=>{const i=he(a);console.log(`[PRELOAD] Queue: ${t} -> ${i}`),this.load.svg(t,i)})}generateProceduralAssets(){try{const e=new de(this);e.generateUIAssets(),e.generatePortraitAssets(),e.generateArenaAssets(),e.generateEffectAssets(),e.generateIconAssets(),console.log("[PRELOAD] Procedural assets generated")}catch(e){console.error("[PRELOAD] Procedural asset error:",e)}}updateProgressBar(e){if(!this.progressBar)return;const{width:t,height:a}=this.cameras.main,i=t/2-this.BAR_WIDTH/2,s=a/2-30,o=Math.max(0,(this.BAR_WIDTH-4)*e);this.progressBar.clear(),o>0&&(this.progressBar.fillStyle(13216089,1),this.progressBar.fillRoundedRect(i+2,s+2,o,this.BAR_HEIGHT-4,2))}updateDiagnostics(){const e=((Date.now()-this.diag.startTime)/1e3).toFixed(1),t=[`Files: ${this.diag.totalComplete}/${this.diag.totalToLoad} loaded, ${this.diag.totalFailed} failed`,`Time: ${e}s`,`Last: ${this.diag.lastFileKey||"(none)"}`];this.diagText.setText(t.join(`
`))}updateFailedList(){if(this.diag.failedFiles.length===0){this.failedText.setText("");return}const e=`⚠ FAILED FILES (${this.diag.failedFiles.length}):
`,t=this.diag.failedFiles.slice(-5).map(a=>`${a.key}: ${a.url}`).join(`
`);this.failedText.setText(e+t)}createFallbackTexture(e){if(this.textures.exists(e))return;const t=this.make.graphics({x:0,y:0});t.fillStyle(3811866,1),t.fillRect(0,0,64,64),t.lineStyle(2,5917242,1),t.strokeRect(2,2,60,60),t.lineStyle(1,9127187,.5),t.moveTo(8,8),t.lineTo(56,56),t.moveTo(56,8),t.lineTo(8,56),t.strokePath(),t.generateTexture(e,64,64),t.destroy(),console.log(`[PRELOAD] Created fallback texture: ${e}`)}createAllFallbacks(){["ui_panel","ui_button","ui_frame","overlay_vignette","overlay_grain","arena_bg","icon_main","parchment_overlay","vignette","particle"].forEach(t=>{this.textures.exists(t)||this.createFallbackTexture(t)})}showErrorUI(){const{width:e,height:t}=this.cameras.main,a=e/2;this.clearTimeout();const i=this.timedOut?"TIMEOUT":`${this.diag.totalFailed} file(s) failed`;this.statusText.setText(`Loading issue: ${i}`),this.statusText.setColor("#cc8866"),this.createAllFallbacks(),this.retryBtn=this.createButton(a,t/2+150,"Retry Loading",()=>{console.log("[PRELOAD] User clicked Retry"),this.scene.restart()}),this.continueBtn=this.createButton(a,t/2+195,"Continue (Safe Mode)",()=>{console.log("[PRELOAD] User clicked Continue (Safe Mode)"),this.startTransition(!0)})}createButton(e,t,a,i){const s=this.add.container(e,t),o=this.add.graphics();o.fillStyle(3811866,1),o.fillRoundedRect(-90,-16,180,32,6),o.lineStyle(2,9139029,1),o.strokeRoundedRect(-90,-16,180,32,6);const c=this.add.text(0,0,a,{fontFamily:"Georgia, serif",fontSize:"12px",color:"#c9a959"}).setOrigin(.5);return s.add([o,c]),o.setInteractive(new w.Geom.Rectangle(-90,-16,180,32),w.Geom.Rectangle.Contains),o.on("pointerdown",i),o.on("pointerover",()=>{o.clear(),o.fillStyle(4864554,1),o.fillRoundedRect(-90,-16,180,32,6),o.lineStyle(2,13216089,1),o.strokeRoundedRect(-90,-16,180,32,6)}),o.on("pointerout",()=>{o.clear(),o.fillStyle(3811866,1),o.fillRoundedRect(-90,-16,180,32,6),o.lineStyle(2,9139029,1),o.strokeRoundedRect(-90,-16,180,32,6)}),s}startTransition(e=!1){if(this.transitionStarted)return;this.transitionStarted=!0,this.clearTimeout(),this.retryBtn&&this.retryBtn.setVisible(!1),this.continueBtn&&this.continueBtn.setVisible(!1),e&&this.createAllFallbacks();try{m.load(),m.startAutoSave(3e4)}catch(a){console.warn("[PRELOAD] SaveSystem error:",a)}const t=document.getElementById("loading-screen");t&&(t.style.opacity="0",t.style.pointerEvents="none"),this.statusText.setText("Loading complete, entering MainMenu..."),this.statusText.setColor("#8b7355"),this.updateProgressBar(1),console.log("═══════════════════════════════════════"),console.log("[PRELOAD] Starting transition to MainMenuScene"),console.log("═══════════════════════════════════════"),this.time.delayedCall(400,()=>{console.log('[PRELOAD] >>> this.scene.start("MainMenuScene")'),this.scene.start("MainMenuScene")})}create(){console.log("[PRELOAD] create() called"),!this.transitionStarted&&this.loadComplete&&(this.diag.totalFailed>0?this.showErrorUI():this.startTransition())}update(){this.transitionStarted||this.updateDiagnostics()}}class b{static createButton(r,e,t,a,i,s={}){const{width:o=180,height:c=45,fontSize:l="14px",primary:h=!1}=s,u=r.add.container(e,t),p=r.add.graphics(),y=h?4864554:2760474,S=h?13216089:5917242;p.fillStyle(y,1),p.fillRoundedRect(-o/2,-c/2,o,c,8),p.lineStyle(2,S,1),p.strokeRoundedRect(-o/2,-c/2,o,c,8),u.add(p);const k=r.add.text(0,0,a,{fontFamily:"Georgia, serif",fontSize:l,color:h?"#c9a959":"#8b7355"}).setOrigin(.5);return u.add(k),p.setInteractive(new w.Geom.Rectangle(-o/2,-c/2,o,c),w.Geom.Rectangle.Contains),p.on("pointerover",()=>{p.clear(),p.fillStyle(y+1118481,1),p.fillRoundedRect(-o/2,-c/2,o,c,8),p.lineStyle(2,13216089,1),p.strokeRoundedRect(-o/2,-c/2,o,c,8),k.setColor("#c9a959")}),p.on("pointerout",()=>{p.clear(),p.fillStyle(y,1),p.fillRoundedRect(-o/2,-c/2,o,c,8),p.lineStyle(2,S,1),p.strokeRoundedRect(-o/2,-c/2,o,c,8),k.setColor(h?"#c9a959":"#8b7355")}),p.on("pointerdown",()=>{r.tweens.add({targets:u,scaleX:.95,scaleY:.95,duration:50,yoyo:!0,onComplete:i})}),u}static showNotification(r,e,t=2e3){const{width:a,height:i}=r.cameras.main,s=r.add.container(a/2,100);s.setDepth(1e3);const o=20,c=r.add.text(0,0,e,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#c9a959"}).setOrigin(.5),l=c.width+o*2,h=c.height+o,u=r.add.graphics();return u.fillStyle(2760474,.95),u.fillRoundedRect(-l/2,-h/2,l,h,8),u.lineStyle(2,13216089,.5),u.strokeRoundedRect(-l/2,-h/2,l,h,8),s.add(u),s.add(c),s.setAlpha(0),s.y=80,r.tweens.add({targets:s,alpha:1,y:100,duration:200,ease:"Back.out"}),r.time.delayedCall(t,()=>{r.tweens.add({targets:s,alpha:0,y:80,duration:200,onComplete:()=>s.destroy()})}),s}static showConfirmDialog(r,e,t,a,i,s="CONFIRM"){const{width:o,height:c}=r.cameras.main,l=r.add.container(o/2,c/2);l.setDepth(1e3);const h=r.add.rectangle(0,0,o,c,0,.7);h.setInteractive(),l.add(h);const u=320,p=280,y=r.add.graphics();y.fillStyle(1709072,1),y.fillRoundedRect(-u/2,-p/2,u,p,12),y.lineStyle(3,13216089,1),y.strokeRoundedRect(-u/2,-p/2,u,p,12),l.add(y);const S=r.add.text(0,-p/2+30,e,{fontFamily:"Georgia, serif",fontSize:"18px",color:"#c9a959"}).setOrigin(.5);l.add(S);const k=r.add.text(0,-20,t,{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b7355",wordWrap:{width:u-40},align:"center"}).setOrigin(.5);l.add(k);const T=this.createButton(r,-70,p/2-50,"CANCEL",()=>{l.destroy(),i()},{width:100,height:40,fontSize:"12px"});l.add(T);const f=this.createButton(r,70,p/2-50,s,()=>{l.destroy(),a()},{width:100,height:40,fontSize:"12px",primary:!0});return l.add(f),l.setScale(.8),l.setAlpha(0),r.tweens.add({targets:l,scale:1,alpha:1,duration:200,ease:"Back.out"}),l}static createProgressBar(r,e,t,a,i,s,o,c=13216089){const l=r.add.container(e,t),h=r.add.graphics();h.fillStyle(2760474,1),h.fillRoundedRect(0,0,a,i,i/4),l.add(h);const u=r.add.graphics(),p=s/o*(a-4);return u.fillStyle(c,1),u.fillRoundedRect(2,2,Math.max(0,p),i-4,(i-4)/4),l.add(u),l}static createPanel(r,e,t,a,i){const s=r.add.graphics();return s.fillStyle(2760474,.95),s.fillRoundedRect(e,t,a,i,10),s.lineStyle(2,5917242,1),s.strokeRoundedRect(e,t,a,i,10),s.lineStyle(1,3811866,.5),s.strokeRoundedRect(e+5,t+5,a-10,i-10,8),s}static createDivider(r,e,t,a){const i=r.add.graphics();return i.lineStyle(1,5917242,.5),i.moveTo(e-a/2,t),i.lineTo(e+a/2,t),i.strokePath(),i.fillStyle(13216089,.5),i.fillCircle(e,t,3),i}}class fe extends w.Scene{constructor(){super({key:"MainMenuScene"});d(this,"menuContainer")}create(){const{width:e,height:t}=this.cameras.main;this.createBackground(),this.createTitle(),this.createMenu(),this.createAmbientEffects(),this.cameras.main.fadeIn(500,0,0,0),this.playAmbience()}createBackground(){const{width:e,height:t}=this.cameras.main,a=this.add.graphics();if(a.fillGradientStyle(1709072,1709072,2760474,2760474),a.fillRect(0,0,e,t),this.textures.exists("parchment_overlay")){const i=this.add.image(e/2,t/2,"parchment_overlay");i.setAlpha(.1),i.setDisplaySize(e,t)}if(this.textures.exists("vignette")){const i=this.add.image(e/2,t/2,"vignette");i.setDisplaySize(e,t),i.setAlpha(.5)}}createTitle(){const{width:e}=this.cameras.main,t=e/2;this.add.text(t,120,"BLOODLINE",{fontFamily:"Georgia, serif",fontSize:"48px",color:"#c9a959",stroke:"#000000",strokeThickness:6}).setOrigin(.5),this.add.text(t,175,"ARENA",{fontFamily:"Georgia, serif",fontSize:"36px",color:"#8b7355",stroke:"#000000",strokeThickness:4,letterSpacing:8}).setOrigin(.5);const a=this.add.graphics();a.lineStyle(2,13216089,.5),a.moveTo(t-100,210),a.lineTo(t+100,210),a.strokePath(),this.add.text(t,235,"Blood. Honor. Legacy.",{fontFamily:"Georgia, serif",fontSize:"14px",color:"#5a4a3a",fontStyle:"italic"}).setOrigin(.5)}createMenu(){const{width:e,height:t}=this.cameras.main,a=e/2,i=320,s=70;this.menuContainer=this.add.container(0,0);const o=m.hasActiveRun();if(o){const k=b.createButton(this,a,i,"CONTINUE RUN",()=>this.continueRun(),{width:260,height:55,primary:!0});this.menuContainer.add(k)}const c=o?i+s:i,l=b.createButton(this,a,c,o?"NEW RUN":"BEGIN YOUR LEGEND",()=>this.startNewRun(),{width:260,height:55,primary:!o});this.menuContainer.add(l);const h=b.createButton(this,a,c+s,"HALL OF LEGENDS",()=>this.openHallOfLegends(),{width:260,height:55});this.menuContainer.add(h);const u=b.createButton(this,a,c+s*2,"BLOODLINE PERKS",()=>this.openBloodlinePerks(),{width:260,height:55});this.menuContainer.add(u);const p=b.createButton(this,a,c+s*3,"SETTINGS",()=>this.openSettings(),{width:260,height:55});this.menuContainer.add(p);const y=m.getMeta(),S=`Runs: ${y.totalRuns} | Wins: ${y.totalWins} | Deaths: ${y.totalDeaths}`;this.add.text(a,t-60,S,{fontFamily:"Georgia, serif",fontSize:"12px",color:"#5a4a3a"}).setOrigin(.5),this.add.text(a,t-35,"v1.0.0",{fontFamily:"Georgia, serif",fontSize:"10px",color:"#3a3025"}).setOrigin(.5)}createAmbientEffects(){const{width:e,height:t}=this.cameras.main;if(!m.getSettings().reduceMotion){if(this.textures.exists("particle"))try{this.add.particles(0,0,"particle",{x:{min:0,max:e},y:{min:0,max:t},scale:{start:.5,end:0},alpha:{start:.3,end:0},speed:{min:10,max:30},angle:{min:-90,max:-90},lifespan:4e3,frequency:200,blendMode:"ADD"})}catch(i){console.warn("[MainMenu] Particle effect failed:",i)}this.tweens.add({targets:this.cameras.main,alpha:{from:1,to:.95},duration:100,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}}playAmbience(){m.getSettings().soundEnabled}continueRun(){this.cameras.main.fadeOut(300,0,0,0),this.cameras.main.once("camerafadeoutcomplete",()=>{const e=m.getRun();e.fighter&&e.lastCampAction==="fight"?this.scene.start("FightScene"):this.scene.start("CampScene")})}startNewRun(){m.hasActiveRun()?b.showConfirmDialog(this,"Abandon Current Run?","Starting a new run will end your current fighter's journey. This cannot be undone.",()=>{m.endRun(!1),this.beginNewRun()},()=>{}):this.beginNewRun()}beginNewRun(){m.startNewRun(),this.cameras.main.fadeOut(300,0,0,0),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("RecruitScene")})}openHallOfLegends(){this.cameras.main.fadeOut(300,0,0,0),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("HallOfLegendsScene")})}openBloodlinePerks(){this.cameras.main.fadeOut(300,0,0,0),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("BloodlinePerksScene")})}openSettings(){this.cameras.main.fadeOut(300,0,0,0),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("SettingsScene")})}}class Y{constructor(r){d(this,"seed");d(this,"initialSeed");this.initialSeed=r??Math.floor(Math.random()*2147483647),this.seed=this.initialSeed}reset(){this.seed=this.initialSeed}setSeed(r){this.initialSeed=r,this.seed=r}getSeed(){return this.initialSeed}mulberry32(){let r=this.seed+=1831565813;return r=Math.imul(r^r>>>15,r|1),r^=r+Math.imul(r^r>>>7,r|61),((r^r>>>14)>>>0)/4294967296}random(){return this.mulberry32()}randomInt(r,e){return Math.floor(this.random()*(e-r+1))+r}randomFloat(r,e){return this.random()*(e-r)+r}chance(r){return this.random()<r}pick(r){if(r.length===0)throw new Error("Cannot pick from empty array");return r[this.randomInt(0,r.length-1)]}pickMultiple(r,e){if(e>r.length)throw new Error("Cannot pick more elements than array length");const t=[...r],a=[];for(let i=0;i<e;i++){const s=this.randomInt(0,t.length-1);a.push(t[s]),t.splice(s,1)}return a}shuffle(r){const e=[...r];for(let t=e.length-1;t>0;t--){const a=this.randomInt(0,t);[e[t],e[a]]=[e[a],e[t]]}return e}weightedPick(r){const e=r.reduce((a,[,i])=>a+i,0);let t=this.random()*e;for(const[a,i]of r)if(t-=i,t<=0)return a;return r[r.length-1][0]}randomId(r=8){const e="abcdefghijklmnopqrstuvwxyz0123456789";let t="";for(let a=0;a<r;a++)t+=e[this.randomInt(0,e.length-1)];return t}roll(r){const e=r.match(/^(\d+)d(\d+)([+-]\d+)?$/);if(!e)throw new Error(`Invalid dice notation: ${r}`);const t=parseInt(e[1],10),a=parseInt(e[2],10);let s=e[3]?parseInt(e[3],10):0;for(let o=0;o<t;o++)s+=this.randomInt(1,a);return s}bellCurve(r,e,t=3){let a=0;for(let i=0;i<t;i++)a+=this.randomFloat(r,e);return a/t}}let R=new Y;const g={init(n){R=new Y(n)},getSeed(){return R.getSeed()},reset(){R.reset()},random(){return R.random()},int(n,r){return R.randomInt(n,r)},float(n,r){return R.randomFloat(n,r)},chance(n){return R.chance(n)},pick(n){return R.pick(n)},pickMultiple(n,r){return R.pickMultiple(n,r)},shuffle(n){return R.shuffle(n)},weightedPick(n){return R.weightedPick(n)},id(n){return R.randomId(n)},roll(n){return R.roll(n)},bellCurve(n,r,e){return R.bellCurve(n,r,e)},create(n){return new Y(n)}},_={firstNames:["Aldric","Bjorn","Cassius","Doran","Edric","Falco","Gareth","Harald","Ivan","Jorik","Kael","Lothar","Milo","Nils","Osric","Pavel","Quinn","Ragnar","Soren","Theron","Ulric","Viktor","Werner","Xander","Yoren","Zephyr","Edda","Freya","Greta","Helga","Ingrid","Jutta","Katla","Liv","Mira","Nessa","Olga","Petra","Runa","Sigrid","Thora","Una","Vera","Wren","Ylva","Zara","Brynn","Astrid"],lastNames:["Ashford","Blackwood","Coldstream","Dunmore","Elderstone","Fairweather","Grimshaw","Hartwell","Ironside","Jarvik","Korvin","Lockwood","Moorland","Northcott","Oakhart","Pembrook","Queensbury","Ravencroft","Stonebridge","Thornwood","Underhill","Varr","Windermere","Yarwood","Brann","Voss","Krenn","Dahl","Falk","Griff"],nicknames:["Tin Smile","Left Hook","The Silent","Red Fist","Iron Jaw","The Gentle","Blood Eye","One Shot","The Grim","Lucky","The Bear","Swift Blade","The Butcher","Old Bones","The Crow","Steel Shin","Thunder","The Wall","Widow Maker","The Ghost","Bone Breaker","The Hound","Scarface","The Ox","Quickdraw","The Jackal","Stone Cold","Fury","The Serpent","Nightshade","Pale Death","The Anvil","Copperhead","The Reaper","Mercy","Grudge"]},Q={birthplaces:["Nordheim","the Dustlands","Port Veras","the Iron Hills","Greymarsh","Ashenvale","the Frozen Coast","Thornwick","the Capital","Saltmere","the Border Wastes","Kingsridge","the Outer Reaches","Mirefall","Stonehaven"],snippets:["Born in {birthplace}, {age} winters have hardened this fighter. Sold into the arena to pay family debts.","A former soldier from {birthplace}, discharged after {age} years. The arena is all that remains.","Once a farmer's child in {birthplace}. At {age}, the crops failed, and fighting became the only trade.","Raised in the slums of {birthplace}. At {age}, the arena offers a chance at something more than survival.","A disgraced noble from {birthplace}, now {age} and fighting to reclaim lost honor.","Born to arena champions in {birthplace}. At {age}, the bloodline demands its due.","An orphan of {birthplace}'s plague years. Now {age}, with nothing left to lose.","A freed slave from {birthplace}, {age} years old. The arena is freedom, strange as it seems.","A wanderer from {birthplace} who found purpose at {age}. The roar of crowds calls.","Convicted of a crime in {birthplace} at a young age. Now {age}, fighting for redemption.","A blacksmith's apprentice from {birthplace}, {age} years old. Strong arms, stronger will.","Born during the siege of {birthplace}. {age} years of war made a natural fighter."]},me=[{id:"mothers_coin",name:"Mother's Coin",backstory:'A worn copper coin, pressed into small hands on the day of departure. "For luck," she said.',effect:"+5 starting Focus",statBonus:{maxFocus:5},upgradeEffect:"+10 starting Focus, +5% gold gain"},{id:"broken_whistle",name:"Broken Whistle",backstory:"Once called the family dog. Now only a memory of simpler times rattles inside.",effect:"+5 max Stamina",statBonus:{maxStamina:5},upgradeEffect:"+10 max Stamina"},{id:"old_ribbon",name:"Old Ribbon",backstory:"Faded blue, from someone who promised to wait. They probably moved on.",effect:"+1 Trust per camp rest",statBonus:{},upgradeEffect:"+2 Trust per rest, reduced injury severity"},{id:"clay_figurine",name:"Clay Figurine",backstory:"A child's crude sculpture of a warrior. Made with love, if not skill.",effect:"+5% crowd hype gain",statBonus:{},upgradeEffect:"+15% crowd hype gain"},{id:"tooth_necklace",name:"Tooth Necklace",backstory:"A beast's fang from a hunt that almost ended everything. A reminder of survival.",effect:"+3 Attack",statBonus:{attack:3},upgradeEffect:"+5 Attack, +5% crit chance"},{id:"prayer_beads",name:"Prayer Beads",backstory:"Worn smooth by generations of whispered hopes. The gods may be listening.",effect:"+8 max HP",statBonus:{maxHP:8},upgradeEffect:"+15 max HP"},{id:"lucky_dice",name:"Lucky Dice",backstory:"Won these from a dying man. He said they always rolled true. Hasn't failed yet.",effect:"+5% critical chance",statBonus:{critChance:5},upgradeEffect:"+10% critical chance"},{id:"faded_letter",name:"Faded Letter",backstory:"The ink has run, the words nearly lost. But the feeling remains.",effect:"Start with 10 extra Trust",statBonus:{},upgradeEffect:"Start with 25 extra Trust"},{id:"iron_ring",name:"Iron Ring",backstory:"A wedding band? A slave's mark? Both have the same weight now.",effect:"+3 Defense",statBonus:{defense:3},upgradeEffect:"+5 Defense, reduced bleed duration"},{id:"dried_flower",name:"Dried Flower",backstory:"Picked the morning of recruitment. Already dead, but still beautiful.",effect:"Injuries heal 1 week faster",statBonus:{},upgradeEffect:"Injuries heal 2 weeks faster, +10 HP when resting"}],D={signature:[{id:"tin_smile",name:"Tin Smile",description:"Cannot be intimidated. Fear effects have no power here.",type:"positive",effect:"Immune to Fear",evolutionNames:["Tin Smile","Iron Grin","Steel Sneer"]},{id:"gentle_giant",name:"Gentle Giant",description:"The crowd loves a merciful warrior. Showing mercy grants bonus hype.",type:"positive",effect:"+20 Hype on merciful actions",evolutionNames:["Gentle Giant","Noble Warrior","The Beloved"]},{id:"vengeful",name:"Vengeful",description:"Pain fuels rage. Damage taken increases attack power temporarily.",type:"positive",effect:"+2 Attack per 10% HP lost",evolutionNames:["Vengeful","Wrathful","Avatar of Vengeance"]},{id:"crowd_pleaser",name:"Crowd Pleaser",description:"Fighting is an art. Style matters as much as substance.",type:"positive",effect:"+50% Hype gain",evolutionNames:["Crowd Pleaser","Fan Favorite","Legend of the Arena"]},{id:"survivors_instinct",name:"Survivor's Instinct",description:"Near-death awakens hidden reserves. Low health grants bonuses.",type:"positive",effect:"+20% Evasion below 25% HP",evolutionNames:["Survivor's Instinct","Death Defier","Unkillable"]},{id:"quick_study",name:"Quick Study",description:"Learns from every blow. Accuracy improves throughout the fight.",type:"positive",effect:"+3% Accuracy per round",evolutionNames:["Quick Study","Adaptable","Master Tactician"]},{id:"berserker_rage",name:"Berserker Rage",description:"Abandon defense for overwhelming offense.",type:"positive",effect:"+30% damage, -15% defense",evolutionNames:["Berserker Rage","Blood Frenzy","Unstoppable Force"]},{id:"iron_defense",name:"Iron Defense",description:"An immovable object. Blocking is second nature.",type:"positive",effect:"+25% block effectiveness",evolutionNames:["Iron Defense","Stone Wall","Impenetrable"]},{id:"opportunist",name:"Opportunist",description:"Strikes when the enemy falters. Bonus damage to stunned enemies.",type:"positive",effect:"+40% damage to debuffed enemies",evolutionNames:["Opportunist","Exploiter","Weakness Hunter"]},{id:"last_stand",name:"Last Stand",description:"Refuses to fall. Once per fight, survive a killing blow at 1 HP.",type:"positive",effect:"Survive fatal (1x per fight)",evolutionNames:["Last Stand","Deathless","The Immortal"]},{id:"patient_fighter",name:"Patient Fighter",description:"Conserves energy. Stamina regenerates faster.",type:"positive",effect:"+50% Stamina regen",evolutionNames:["Patient Fighter","Enduring","Tireless"]},{id:"intimidating_presence",name:"Intimidating Presence",description:"Enemies falter before the fight begins.",type:"positive",effect:"Enemies start with -10 Accuracy",evolutionNames:["Intimidating Presence","Terrifying Aura","Walking Nightmare"]}],positive:[{id:"strong_arm",name:"Strong Arm",description:"Natural strength grants bonus damage.",type:"positive",effect:"+3 Attack",statModifier:{attack:3}},{id:"thick_skin",name:"Thick Skin",description:"Hardened by years of punishment.",type:"positive",effect:"+5 Defense",statModifier:{defense:5}},{id:"light_feet",name:"Light Feet",description:"Quick and agile in the arena.",type:"positive",effect:"+8 Evasion",statModifier:{evasion:8}},{id:"keen_eyes",name:"Keen Eyes",description:"Rarely misses a strike.",type:"positive",effect:"+10 Accuracy",statModifier:{accuracy:10}},{id:"endless_stamina",name:"Endless Stamina",description:"Can fight all day without tiring.",type:"positive",effect:"+15 Max Stamina",statModifier:{maxStamina:15}},{id:"born_fighter",name:"Born Fighter",description:"Combat comes naturally.",type:"positive",effect:"+10 Max HP, +2 Attack",statModifier:{maxHP:10,attack:2}},{id:"focused_mind",name:"Focused Mind",description:"Clarity in chaos.",type:"positive",effect:"+10 Max Focus",statModifier:{maxFocus:10}},{id:"quick_reflexes",name:"Quick Reflexes",description:"Reacts before thinking.",type:"positive",effect:"+3 Speed",statModifier:{speed:3}}],negative:[{id:"old_injury",name:"Old Injury",description:"An old wound that never quite healed.",type:"negative",effect:"-10 Max HP",statModifier:{maxHP:-10}},{id:"poor_eyesight",name:"Poor Eyesight",description:"Struggles to land precise hits.",type:"negative",effect:"-8 Accuracy",statModifier:{accuracy:-8}},{id:"glass_jaw",name:"Glass Jaw",description:"One good hit to the head, and it's over.",type:"negative",effect:"+50% damage from head hits",statModifier:{}},{id:"brittle_bones",name:"Brittle Bones",description:"Injuries are more severe.",type:"negative",effect:"+1 week injury heal time",statModifier:{}},{id:"slow_starter",name:"Slow Starter",description:"Takes time to warm up.",type:"negative",effect:"-20% damage rounds 1-2",statModifier:{}},{id:"arrogant",name:"Arrogant",description:"Overconfidence leads to mistakes.",type:"negative",effect:"-5 Evasion when HP > 70%",statModifier:{}},{id:"nervous",name:"Nervous",description:"Crowds make mistakes more likely.",type:"negative",effect:"-5 Accuracy at high Hype",statModifier:{}},{id:"weak_constitution",name:"Weak Constitution",description:"Tires quickly in prolonged fights.",type:"negative",effect:"-10 Max Stamina",statModifier:{maxStamina:-10}},{id:"scarred_lungs",name:"Scarred Lungs",description:"Breathes heavy, moves slow.",type:"negative",effect:"-2 Speed",statModifier:{speed:-2}},{id:"cowardly",name:"Cowardly",description:"Fear takes hold too easily.",type:"negative",effect:"+20% Fear effect duration",statModifier:{}},{id:"reckless",name:"Reckless",description:"Attacks without thinking.",type:"negative",effect:"-5 Defense",statModifier:{defense:-5}},{id:"bad_knee",name:"Bad Knee",description:"An old injury that flares up.",type:"negative",effect:"+30% damage from leg hits",statModifier:{}}]},ge={stoic:{battle_start:['"..."',`"Let's get this done."`,'"Another day."'],taking_damage:['"Tch."',`"I've had worse."`,'"..."'],dealing_damage:['"..."','"Down."','"Fall."'],low_health:['"Not yet."','"Still standing."','"..."'],victory:[`"It's done."`,'"..."','"Next."'],defeat:['"..."','"So it ends."'],rest:[`"A moment's peace."`,'"..."'],training:['"Again."','"..."'],shop:['"What do you have?"','"..."'],idle:['"..."','"Waiting."']},aggressive:{battle_start:['"Blood! Blood! BLOOD!"','"COME ON!"',`"I'll tear you apart!"`],taking_damage:['"Is that all?!"','"MORE!"','"HA! Again!"'],dealing_damage:['"YES!"','"FEEL IT!"','"DIE!"'],low_health:[`"I'm not done!"`,'"NEVER!"','"MORE BLOOD!"'],victory:[`"WHO'S NEXT?!"`,'"WEAK!"','"HA HA HA!"'],defeat:['"No... MORE!"',`"This isn't..."`],rest:['"Bah, wasting time."','"When do we fight?"'],training:['"Hit me harder!"','"AGAIN!"'],shop:['"Give me something deadly."','"Sharper. Deadlier."'],idle:[`"Where's the fight?"`,'"Boring..."']},honorable:{battle_start:['"May the best warrior win."','"I fight with honor."','"Ancestors, guide my blade."'],taking_damage:['"A fair blow."','"Well struck."','"Nngh... honorable."'],dealing_damage:['"Forgive me."','"For glory!"','"Stand down, with honor."'],low_health:['"I will not yield."','"Honor demands I stand."','"Not like this..."'],victory:['"A good fight. You have my respect."','"The ancestors smile."','"Glory earned."'],defeat:['"I die... with honor."','"A worthy opponent."'],rest:['"I must center myself."','"Quiet contemplation."'],training:['"Discipline makes the warrior."','"Honor in preparation."'],shop:['"A fine blade for a fair price."','"Quality, not trickery."'],idle:['"Patience is a virtue."','"The fight will come."']},cunning:{battle_start:['"I already know how this ends."',`"You've already lost."`,'"Interesting..."'],taking_damage:['"As expected."','"I let you have that one."','"Clever. But not clever enough."'],dealing_damage:['"Predictable."','"Just as planned."','"Too easy."'],low_health:['"All part of the plan."',`"You think you've won?"`,'"Not yet..."'],victory:['"Exactly as I foresaw."','"Was there ever any doubt?"','"Outplayed."'],defeat:['"Impossible... how did..."','"I miscalculated."'],rest:['"Time to think."','"Planning the next move."'],training:['"Mind over muscle."','"Knowing the enemy."'],shop:['"What advantages can I gain?"','"Everything has a use."'],idle:['"Observing. Always observing."','"Everyone has a weakness."']},fearful:{battle_start:['"Oh gods, oh gods..."',`"I don't want to do this."`,'"Please... I just want to live."'],taking_damage:['"AHHH!"','"No no no!"','"Please stop!"'],dealing_damage:['"S-sorry!"','"I had to!"','"Please fall!"'],low_health:[`"I don't want to die!"`,'"Please, mercy!"','"Gods save me!"'],victory:['"I... I did it?"',`"I'm alive! I'm alive!"`,'"Thank the gods..."'],defeat:['"I knew it... I knew..."','"Mother..."'],rest:['"Safe... for now."','"Maybe I can run..."'],training:[`"I'll try..."`,`"Please don't hit too hard."`],shop:['"Something protective, please."','"Anything to help me survive."'],idle:['"Why am I here?"','"There has to be another way..."']},jovial:{battle_start:[`"Let's have some fun!"`,'"Nice day for a fight, eh?"','"May the best looking one win!"'],taking_damage:['"Ow! Good one!"','"Ha! That tickled!"',`"Oh, you're serious!"`],dealing_damage:['"Haha! How about that?"',`"Didn't see that coming!"`,`"Tag! You're it!"`],low_health:['"Getting interesting now!"','"Ha... ha... okay, serious time."',`"You're making this dramatic!"`],victory:['"Good game! Drinks are on me!"','"That was fun! Again sometime?"','"Haha! What a rush!"'],defeat:['"Heh... well played..."',`"Guess the joke's on me..."`],rest:['"Time for ale and stories!"','"Rest is good for the soul!"'],training:[`"Let's make it a game!"`,'"Winner buys the drinks!"'],shop:['"Got anything shiny?"',`"Ooh, what's this do?"`],idle:['"Anyone want to hear a joke?"','"Bored bored bored..."']}};function L(n=1){var B;const r=g.pick(_.firstNames),e=g.pick(_.lastNames),t=g.pick(_.nicknames),a=g.int(18,45),i=g.pick(Q.birthplaces),s=g.pick(Q.snippets).replace("{birthplace}",i).replace("{age}",String(a)),o=g.pick(["stoic","aggressive","honorable","cunning","fearful","jovial"]),c=Math.floor(n/2),l=pe(c),h=ie(),u=g.pick(me),p={id:u.id,name:u.name,backstory:u.backstory,effect:u.effect,statBonus:u.statBonus,upgraded:!1,upgradeEffect:u.upgradeEffect},y=g.pick(D.signature),S={...y,evolutionStage:0,maxEvolution:((B=y.evolutionNames)==null?void 0:B.length)||3},k=g.int(1,2),T=g.pickMultiple(D.positive,k).map(re=>({...re})),f=[{...g.pick(D.negative)}];return{id:g.id(12),firstName:r,lastName:e,nickname:t,fullName:`${r} '${t}' ${e}`,age:a,birthplace:i,backstory:s,personality:o,baseStats:l,currentStats:{...l},equipment:{weapon:null,armor:null,accessory:null},keepsake:p,inventory:[],signatureTrait:S,traits:T,flaws:f,portrait:h,level:1,experience:0,wins:0,losses:0,kills:0,status:"healthy",injuries:[],scars:[],activeEffects:[],trust:20,trustLevel:"stranger",totalDamageDealt:0,totalDamageTaken:0,perfectParries:0,signatureMoveUses:0,closestCall:l.maxHP,bestWin:"",lettersWritten:[],weeksSurvived:0}}function pe(n=0){return{maxHP:g.int(80,120)+n*5,currentHP:0,maxStamina:g.int(80,100)+n*3,currentStamina:0,maxFocus:g.int(50,80)+n*2,currentFocus:0,attack:g.int(8,15)+n,defense:g.int(5,12)+n,speed:g.int(5,12)+n,accuracy:g.int(70,90)+n,evasion:g.int(5,15)+n,critChance:g.int(5,15),critDamage:g.int(140,180)}}function ie(){const n=["#f5d0b9","#d4a574","#8b5a3c","#5c3d2e","#3b2417"],r=["#1a1a1a","#3d2314","#6b4423","#8b6914","#a08060","#c0c0c0","#8b0000"];return{baseIndex:g.int(0,5),eyeIndex:g.int(0,4),hairIndex:g.int(0,7),beardIndex:g.int(0,5),scarIndex:0,warpaintIndex:g.chance(.3)?g.int(1,4):0,hoodIndex:0,skinTone:g.pick(n),hairColor:g.pick(r),injuryOverlays:[]}}function J(n){n.currentStats.currentHP=n.currentStats.maxHP,n.currentStats.currentStamina=n.currentStats.maxStamina,n.currentStats.currentFocus=0,n.activeEffects=[]}function ye(n,r){n.injuries.push(r),n.status=r.severity==="severe"?"critical":"injured";for(const[e,t]of Object.entries(r.statPenalty)){const a=e;typeof n.currentStats[a]=="number"&&typeof t=="number"&&(n.currentStats[a]-=t)}if(n.portrait.injuryOverlays.push(`injury_${r.location}_${r.severity}`),g.chance(r.scarChance)){const e=`scar_${r.location}_${n.scars.length}`;n.scars.push(e),n.portrait.scarIndex=Math.min(n.portrait.scarIndex+1,5)}}function ae(n,r=1){const e=[];n.injuries=n.injuries.filter(t=>{if(t.healTime-=r,t.healTime<=0){e.push(t.id);for(const[a,i]of Object.entries(t.statPenalty)){const s=a;typeof n.currentStats[s]=="number"&&typeof i=="number"&&(n.currentStats[s]+=i)}return!1}return!0}),n.portrait.injuryOverlays=n.portrait.injuryOverlays.filter(t=>!e.some(a=>t.includes(a.split("_")[1]))),n.injuries.length===0?n.status="healthy":n.injuries.some(t=>t.severity==="severe")?n.status="critical":n.status="injured"}function Se(n){n.trust>=90?n.trustLevel="legendary":n.trust>=70?n.trustLevel="bonded":n.trust>=50?n.trustLevel="ally":n.trust>=25?n.trustLevel="acquaintance":n.trustLevel="stranger"}function F(n,r){n.trust=Math.max(0,Math.min(100,n.trust+r)),Se(n)}function N(n,r){const e=ge[n.personality];return e&&e[r]?g.pick(e[r]):""}function we(n){const r={...n.baseStats};for(const e of Object.values(n.equipment))if(e!=null&&e.stats)for(const[t,a]of Object.entries(e.stats))typeof a=="number"&&(r[t]+=a);if(n.keepsake.statBonus)for(const[e,t]of Object.entries(n.keepsake.statBonus))typeof t=="number"&&(r[e]+=t);for(const e of[...n.traits,...n.flaws])if(e.statModifier)for(const[t,a]of Object.entries(e.statModifier))typeof a=="number"&&(r[t]+=a);return r.currentHP=r.maxHP,r.currentStamina=r.maxStamina,r.currentFocus=0,r}function be(n,r,e){const t=[`Fell to ${e} in round ${r}. ${n.location} strike proved fatal.`,`Collapsed from a ${n.weaponType} wound to the ${n.location} in round ${r}.`,`${n.location==="head"?"Skull cracked":n.location==="body"?"Heart pierced":"Leg shattered"} by ${e}'s ${n.weaponType}.`,`Bled out from wounds sustained in round ${r}. The crowd fell silent.`,`${e}'s final blow to the ${n.location} ended it all in round ${r}.`];return g.pick(t)}function ke(n){if(!g.chance(.3))return;const r=["Tell them... I tried.","Don't sell my keepsake...","Run... while you can...","It was... worth it...","Remember my name...","The crowd... they loved me...",`Tell ${n.birthplace}... I'm sorry...`,"One more fight... I could have...","My keepsake... keep it safe...","Honor... above all..."];return g.pick(r)}const I=[{id:"hardy_stock",name:"Hardy Stock",description:"Your bloodline is tough. Start with +10 max HP.",effect:"+10 Max HP",cost:5,tier:1,statBonus:{maxHP:10}},{id:"fighting_spirit",name:"Fighting Spirit",description:"Generations of warriors flow through you. +5 max Stamina.",effect:"+5 Max Stamina",cost:5,tier:1,statBonus:{maxStamina:5}},{id:"quick_learner",name:"Quick Learner",description:"Experience comes faster. +10% XP from all sources.",effect:"+10% XP",cost:5,tier:1},{id:"silver_tongue",name:"Silver Tongue",description:"Better deals at shops. -10% shop prices.",effect:"-10% Shop Prices",cost:5,tier:1},{id:"crowd_favorite",name:"Crowd Favorite",description:"The crowd remembers your lineage. Start with +10 Hype.",effect:"+10 Starting Hype",cost:5,tier:1},{id:"iron_will",name:"Iron Will",description:"Resist fear and panic. Immune to Fear status.",effect:"Fear Immunity",cost:10,tier:2,prerequisite:"hardy_stock"},{id:"second_wind",name:"Second Wind",description:"Recover faster between fights. +20% stamina regen.",effect:"+20% Stamina Regen",cost:10,tier:2,prerequisite:"fighting_spirit"},{id:"veterans_insight",name:"Veteran's Insight",description:"Start with one extra trait choice.",effect:"+1 Trait Choice",cost:10,tier:2,prerequisite:"quick_learner"},{id:"haggler",name:"Haggler",description:"Even better deals. Additional -15% shop prices.",effect:"-15% More Shop Prices",cost:10,tier:2,prerequisite:"silver_tongue"},{id:"showman",name:"Showman",description:"Hype gains increased by 25%.",effect:"+25% Hype Gain",cost:10,tier:2,prerequisite:"crowd_favorite"},{id:"unbreakable",name:"Unbreakable",description:"Survive one fatal blow per run at 1 HP.",effect:"Survive Fatal (1x)",cost:20,tier:3,prerequisite:"iron_will"},{id:"berserker_blood",name:"Berserker Blood",description:"Deal 20% more damage when below 30% HP.",effect:"+20% Low HP Damage",cost:20,tier:3,prerequisite:"second_wind"},{id:"legendary_lineage",name:"Legendary Lineage",description:"All stat bonuses from bloodline perks doubled.",effect:"2x Bloodline Stats",cost:20,tier:3,prerequisite:"veterans_insight"}];function ve(n,r,e,t,a){const i={id:`legend_${n.id}`,fighter:{id:n.id,fullName:n.fullName,nickname:n.nickname,age:n.age,birthplace:n.birthplace,portrait:{...n.portrait},signatureTrait:n.signatureTrait.name},leagueReached:e,wins:n.wins,kills:n.kills,weeksSurvived:n.weeksSurvived,status:r,causeOfDeath:n.causeOfDeath,lastWords:n.lastWords,promiseType:t,promiseKept:a,bestWin:n.bestWin||"No notable victories",closestCall:n.closestCall,signatureMoveUses:n.signatureMoveUses,perfectParries:n.perfectParries,lettersWritten:[...n.lettersWritten],dateAdded:Date.now()};return m.addToHallOfLegends(i),xe(n),Te(n),i}function xe(n,r){m.addGhostMoment({fighterId:n.id,fighterName:n.firstName,nickname:n.nickname,type:"crowd_chant",triggered:!1}),(n.equipment.weapon||n.equipment.armor)&&m.addGhostMoment({fighterId:n.id,fighterName:n.firstName,nickname:n.nickname,type:"item_drop",triggered:!1}),g.chance(.5)&&m.addGhostMoment({fighterId:n.id,fighterName:n.firstName,nickname:n.nickname,type:"story",triggered:!1})}function Te(n){const e=.3+m.getMeta().promoterLevel*.05;if(g.chance(e)){const t={id:`heirloom_${n.id}`,name:n.keepsake.name,description:`${n.keepsake.backstory} Once belonged to ${n.fullName}.`,fromFighter:n.fullName,effect:n.keepsake.effect,recovered:!0};m.addHeirloom(t)}}function Re(n){const r=m.getUntriggeredGhostMoments();if(r.length===0)return null;const e={arena:["crowd_chant","statue"],camp:["story"],shop:["item_drop"]},t=r.filter(i=>e[n].includes(i.type));if(t.length===0||!g.chance(.15))return null;const a=g.pick(t);return m.triggerGhostMoment(a.fighterId,a.type),a}function Ce(n){switch(n.type){case"crowd_chant":return`The crowd chants: "${n.nickname}! ${n.nickname}!" Someone remembers...`;case"item_drop":return`You find a worn item. A tag reads: "Property of ${n.fighterName} '${n.nickname}'"`;case"statue":return`A weathered statue stands in the corner. The plaque reads: "${n.fighterName} '${n.nickname}' - Never Forgotten"`;case"story":return`An old fighter tells tales of ${n.fighterName} '${n.nickname}'. The legend lives on.`;default:return""}}function Be(){const n=m.getMeta(),r={};let e=!1;for(const t of n.unlockedPerks){const a=I.find(i=>i.id===t);if(a!=null&&a.statBonus)for(const[i,s]of Object.entries(a.statBonus))r[i]=(r[i]||0)+s;t==="legendary_lineage"&&(e=!0)}if(e)for(const t of Object.keys(r))r[t]*=2;return r}function j(n){const r=m.getMeta(),e=I.find(t=>t.id===n);if(!e)return{canPurchase:!1,reason:"Perk not found"};if(r.unlockedPerks.includes(n))return{canPurchase:!1,reason:"Already owned"};if(e.prerequisite&&!r.unlockedPerks.includes(e.prerequisite)){const t=I.find(a=>a.id===e.prerequisite);return{canPurchase:!1,reason:`Requires: ${(t==null?void 0:t.name)||e.prerequisite}`}}return r.bloodlinePoints<e.cost?{canPurchase:!1,reason:`Need ${e.cost} points (have ${r.bloodlinePoints})`}:{canPurchase:!0,reason:""}}function Pe(n){const{canPurchase:r}=j(n);if(!r)return!1;const e=I.find(t=>t.id===n);return e&&m.spendBloodlinePoints(e.cost)?(m.unlockPerk(n),!0):!1}class E{static renderPortrait(r,e,t,a,i){const s=r.add.container(t,a),o=r.add.graphics();o.fillStyle(1709072,1),o.fillCircle(0,0,i/2+5),o.lineStyle(3,5917242,1),o.strokeCircle(0,0,i/2+5),s.add(o);const c=r.add.graphics();c.fillStyle(w.Display.Color.HexStringToColor(e.skinTone).color,1),c.fillCircle(0,0,i/2-5),s.add(c);const l=r.add.graphics(),h=-i*.08,u=i*.15;l.fillStyle(16777215,1),l.fillEllipse(-u,h,i*.12,i*.08),l.fillEllipse(u,h,i*.12,i*.08);const p=[{x:0,y:0},{x:1,y:0},{x:-1,y:0},{x:0,y:1},{x:0,y:-1}],y=p[e.eyeIndex%p.length];l.fillStyle(2759184,1),l.fillCircle(-u+y.x,h+y.y,i*.04),l.fillCircle(u+y.x,h+y.y,i*.04),l.lineStyle(2,w.Display.Color.HexStringToColor(e.skinTone).darken(30).color,.5),l.moveTo(0,h+i*.08),l.lineTo(0,h+i*.18),l.strokePath();const S=i*.18,k=[()=>{l.lineStyle(2,9127187,.8),l.moveTo(-i*.1,S),l.lineTo(i*.1,S),l.strokePath()},()=>{l.lineStyle(2,9127187,.8),l.beginPath(),l.arc(0,S-i*.05,i*.1,.2,Math.PI-.2),l.strokePath()},()=>{l.lineStyle(2,9127187,.8),l.beginPath(),l.arc(0,S+i*.1,i*.1,Math.PI+.2,-.2),l.strokePath()},()=>{l.fillStyle(3807760,1),l.fillEllipse(0,S,i*.1,i*.06)},()=>{l.lineStyle(2,9127187,.8),l.moveTo(-i*.08,S),l.lineTo(i*.1,S-i*.03),l.strokePath()},()=>{l.lineStyle(2,9127187,.8),l.moveTo(-i*.12,S),l.lineTo(-i*.04,S+.02),l.lineTo(i*.04,S-.02),l.lineTo(i*.12,S),l.strokePath()}];if(k[e.baseIndex%k.length](),s.add(l),e.hairIndex>0){const f=r.add.graphics();f.fillStyle(w.Display.Color.HexStringToColor(e.hairColor).color,1);const v=[()=>{},()=>{f.fillEllipse(0,-i*.35,i*.45,i*.2)},()=>{f.fillEllipse(0,-i*.3,i*.5,i*.3),f.fillRect(-i*.35,-i*.35,i*.1,i*.4),f.fillRect(i*.25,-i*.35,i*.1,i*.4)},()=>{f.fillEllipse(0,-i*.25,i*.55,i*.35),f.fillRect(-i*.4,-i*.3,i*.15,i*.7),f.fillRect(i*.25,-i*.3,i*.15,i*.7)},()=>{f.fillRect(-i*.08,-i*.5,i*.16,i*.3)},()=>{for(let B=-2;B<=2;B++)f.fillTriangle(B*i*.1,-i*.25,B*i*.1-i*.05,-i*.45-Math.abs(B)*.03,B*i*.1+i*.05,-i*.45)},()=>{f.fillEllipse(0,-i*.35,i*.4,i*.2),f.fillRect(i*.15,-i*.3,i*.08,i*.5)},()=>{f.fillRect(-i*.35,-i*.2,i*.1,i*.6),f.fillRect(i*.25,-i*.2,i*.1,i*.6),f.fillEllipse(0,-i*.3,i*.4,i*.2)}];v[e.hairIndex%v.length](),s.add(f)}if(e.beardIndex>0){const f=r.add.graphics();f.fillStyle(w.Display.Color.HexStringToColor(e.hairColor).color,1);const v=[()=>{},()=>{f.fillStyle(w.Display.Color.HexStringToColor(e.hairColor).color,.3),f.fillRect(-i*.2,i*.1,i*.4,i*.15)},()=>{f.fillRect(-i*.2,i*.12,i*.4,i*.2)},()=>{f.fillEllipse(0,i*.25,i*.35,i*.25)},()=>{f.fillEllipse(0,i*.3,i*.3,i*.35)},()=>{f.fillEllipse(0,i*.25,i*.12,i*.2)}];v[e.beardIndex%v.length](),s.add(f)}if(e.scarIndex>0){const f=r.add.graphics();f.lineStyle(2,9125984,.6);const v=[()=>{},()=>{f.moveTo(-i*.3,-i*.2),f.lineTo(-i*.05,i*.1),f.strokePath()},()=>{f.moveTo(i*.1,0),f.lineTo(i*.35,i*.1),f.strokePath()},()=>{f.moveTo(-i*.15,-i*.3),f.lineTo(i*.2,-i*.25),f.strokePath()},()=>{f.moveTo(-i*.15,-i*.1),f.lineTo(i*.15,i*.15),f.strokePath(),f.moveTo(i*.15,-i*.1),f.lineTo(-i*.15,i*.15),f.strokePath()},()=>{f.moveTo(-i*.25,-i*.15),f.lineTo(-i*.1,i*.05),f.strokePath(),f.moveTo(i*.2,-i*.05),f.lineTo(i*.3,i*.15),f.strokePath()}];v[e.scarIndex%v.length](),s.add(f)}if(e.warpaintIndex>0){const f=r.add.graphics();f.lineStyle(3,2763306,.7);const v=[()=>{},()=>{f.moveTo(-i*.3,-i*.1),f.lineTo(-i*.05,-i*.1),f.strokePath(),f.moveTo(i*.05,-i*.1),f.lineTo(i*.3,-i*.1),f.strokePath()},()=>{f.moveTo(0,-i*.4),f.lineTo(0,i*.3),f.strokePath()},()=>{f.moveTo(-i*.3,-i*.2),f.lineTo(-i*.15,-i*.15),f.lineTo(-i*.3,-i*.1),f.strokePath(),f.moveTo(i*.3,-i*.2),f.lineTo(i*.15,-i*.15),f.lineTo(i*.3,-i*.1),f.strokePath()},()=>{f.lineStyle(2,9109504,.6),f.strokeCircle(-i*.2,i*.05,i*.08),f.strokeCircle(i*.2,i*.05,i*.08)}];v[e.warpaintIndex%v.length](),s.add(f)}if(e.hoodIndex>0){const f=r.add.graphics();f.fillStyle(3811866,.9);const v=[()=>{},()=>{f.fillEllipse(0,-i*.2,i*.6,i*.4),f.fillStyle(1709072,1),f.fillEllipse(0,0,i*.4,i*.35)},()=>{f.fillStyle(5921370,1),f.fillEllipse(0,-i*.15,i*.55,i*.4),f.lineStyle(2,3815994,1),f.moveTo(0,-i*.4),f.lineTo(0,i*.1),f.strokePath()}];v[e.hoodIndex%v.length](),s.add(f)}for(const f of e.injuryOverlays){const v=r.add.graphics();f.includes("head")?(v.fillStyle(9109504,.3),v.fillCircle(-i*.15,-i*.15,i*.1)):f.includes("body")&&(v.fillStyle(9109504,.2),v.fillRect(-i*.2,i*.1,i*.4,i*.2)),s.add(v)}const T=r.add.graphics();return T.lineStyle(2,13216089,.2),T.strokeCircle(0,0,i/2+8),s.add(T),s}static renderMiniPortrait(r,e,t,a,i){return this.renderPortrait(r,e,t,a,i)}}class Ae extends w.Scene{constructor(){super({key:"RecruitScene"});d(this,"candidates",[]);d(this,"selectedIndex",-1);d(this,"candidateContainers",[]);d(this,"detailsContainer")}create(){const e=m.getRun();g.init(e.seed);const t=m.getMeta();this.candidates=[L(t.promoterLevel),L(t.promoterLevel),L(t.promoterLevel)];const a=Be();for(const i of this.candidates){for(const[s,o]of Object.entries(a))typeof o=="number"&&s in i.baseStats&&(i.baseStats[s]+=o);i.currentStats=we(i)}this.createBackground(),this.createHeader(),this.createCandidateCards(),this.createDetailsPanel(),this.createConfirmButton(),this.cameras.main.fadeIn(300)}createBackground(){const{width:e,height:t}=this.cameras.main,a=this.add.graphics();if(a.fillGradientStyle(1709072,1709072,2760474,2760474),a.fillRect(0,0,e,t),this.textures.exists("parchment_overlay")){const i=this.add.image(e/2,t/2,"parchment_overlay");i.setAlpha(.08),i.setDisplaySize(e,t)}}createHeader(){const{width:e}=this.cameras.main;this.add.text(e/2,40,"CHOOSE YOUR FIGHTER",{fontFamily:"Georgia, serif",fontSize:"24px",color:"#c9a959",stroke:"#000000",strokeThickness:3}).setOrigin(.5),this.add.text(e/2,70,"Three souls await judgment. Only one will enter the arena.",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b7355",fontStyle:"italic"}).setOrigin(.5)}createCandidateCards(){const{width:e}=this.cameras.main,t=110,a=e/2-t*1.5,i=180;this.candidates.forEach((s,o)=>{const c=this.createCandidateCard(s,a+o*(t+10),i,o);this.candidateContainers.push(c)})}createCandidateCard(e,t,a,i){const s=this.add.container(t,a),o=110,c=200,l=this.add.graphics();l.fillStyle(2760474,1),l.fillRoundedRect(0,0,o,c,8),l.lineStyle(2,5917242,1),l.strokeRoundedRect(0,0,o,c,8),s.add(l);const h=E.renderMiniPortrait(this,e.portrait,o/2,50,60);s.add(h);const u=this.add.text(o/2,95,e.firstName,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#c9a959"}).setOrigin(.5);s.add(u);const p=this.add.text(o/2,112,`"${e.nickname}"`,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355",fontStyle:"italic"}).setOrigin(.5);s.add(p);const y=this.add.text(o/2,130,`Age ${e.age}`,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#5a4a3a"}).setOrigin(.5);s.add(y);const S=this.add.text(o/2,155,e.signatureTrait.name,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#6b8e23"}).setOrigin(.5);if(s.add(S),e.flaws.length>0){const T=this.add.text(o/2,175,e.flaws[0].name,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b4513"}).setOrigin(.5);s.add(T)}const k=this.add.rectangle(o/2,c/2,o,c,16777215,0);return k.setInteractive({useHandCursor:!0}),s.add(k),k.on("pointerover",()=>{this.selectedIndex!==i&&(l.clear(),l.fillStyle(3813162,1),l.fillRoundedRect(0,0,o,c,8),l.lineStyle(2,9139029,1),l.strokeRoundedRect(0,0,o,c,8))}),k.on("pointerout",()=>{this.selectedIndex!==i&&(l.clear(),l.fillStyle(2760474,1),l.fillRoundedRect(0,0,o,c,8),l.lineStyle(2,5917242,1),l.strokeRoundedRect(0,0,o,c,8))}),k.on("pointerdown",()=>{this.selectCandidate(i)}),s}createDetailsPanel(){const{width:e,height:t}=this.cameras.main;this.detailsContainer=this.add.container(e/2,400);const a=this.add.text(0,0,"Select a fighter to view details",{fontFamily:"Georgia, serif",fontSize:"14px",color:"#5a4a3a",fontStyle:"italic"}).setOrigin(.5);this.detailsContainer.add(a)}updateDetailsPanel(e){this.detailsContainer.removeAll(!0);const t=-100,a=this.add.text(0,t,e.fullName,{fontFamily:"Georgia, serif",fontSize:"18px",color:"#c9a959"}).setOrigin(.5);this.detailsContainer.add(a);const i=this.add.text(0,t+30,e.backstory,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b7355",fontStyle:"italic",wordWrap:{width:320},align:"center"}).setOrigin(.5);this.detailsContainer.add(i);const s=e.currentStats,o=`HP: ${s.maxHP} | ATK: ${s.attack} | DEF: ${s.defense} | SPD: ${s.speed}`,c=this.add.text(0,t+80,o,{fontFamily:"Georgia, serif",fontSize:"12px",color:"#c9a959"}).setOrigin(.5);this.detailsContainer.add(c);const l=this.add.text(0,t+110,`Signature: ${e.signatureTrait.name}`,{fontFamily:"Georgia, serif",fontSize:"13px",color:"#6b8e23"}).setOrigin(.5);this.detailsContainer.add(l);const h=this.add.text(0,t+130,e.signatureTrait.description,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#5a4a3a",wordWrap:{width:280},align:"center"}).setOrigin(.5);if(this.detailsContainer.add(h),e.flaws.length>0){const y=this.add.text(0,t+165,`Flaw: ${e.flaws[0].name}`,{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b4513"}).setOrigin(.5);this.detailsContainer.add(y);const S=this.add.text(0,t+183,e.flaws[0].description,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#5a4a3a"}).setOrigin(.5);this.detailsContainer.add(S)}const u=this.add.text(0,t+215,`Keepsake: ${e.keepsake.name}`,{fontFamily:"Georgia, serif",fontSize:"12px",color:"#c9a959"}).setOrigin(.5);this.detailsContainer.add(u);const p=this.add.text(0,t+233,e.keepsake.effect,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355"}).setOrigin(.5);this.detailsContainer.add(p)}selectCandidate(e){if(this.selectedIndex>=0){const s=this.candidateContainers[this.selectedIndex].first;s.clear(),s.fillStyle(2760474,1),s.fillRoundedRect(0,0,110,200,8),s.lineStyle(2,5917242,1),s.strokeRoundedRect(0,0,110,200,8)}this.selectedIndex=e;const a=this.candidateContainers[e].first;a.clear(),a.fillStyle(3813162,1),a.fillRoundedRect(0,0,110,200,8),a.lineStyle(3,13216089,1),a.strokeRoundedRect(0,0,110,200,8),this.updateDetailsPanel(this.candidates[e])}createConfirmButton(){const{width:e,height:t}=this.cameras.main,a=b.createButton(this,e/2,t-60,"RECRUIT THIS FIGHTER",()=>this.confirmSelection(),{width:240,height:50,primary:!0});a.setAlpha(.5),this.events.on("update",()=>{this.selectedIndex>=0&&a.setAlpha(1)})}confirmSelection(){if(this.selectedIndex<0)return;const e=this.candidates[this.selectedIndex],t=m.getRun();t.fighter=e,m.updateRun(t),this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("PromiseScene")})}}const W=[{id:"sleepless_night",title:"Sleepless Night",description:"Your fighter tosses and turns, haunted by memories. You hear muttering in the dark.",category:"camp",choices:[{id:"comfort",text:"Sit with them, offer comfort",effects:{trust:8,stamina:-10},resultText:"You stay up talking until dawn. The bond strengthens, but rest was lost."},{id:"leave",text:"Let them work through it alone",effects:{trust:-3},resultText:"Sometimes people need space. Whether this was the right call remains to be seen."},{id:"drink",text:"Share a drink to ease the mind",effects:{trust:5,hp:-5},resultText:"The drink helps, but the hangover tomorrow won't be pleasant."}]},{id:"old_friend",title:"An Old Friend",description:"Someone from your fighter's past appears at the camp. Their expression is unreadable.",category:"camp",choices:[{id:"welcome",text:"Welcome them warmly",effects:{trust:5,gold:-15},resultText:"You provide food and drink. The visitor leaves with a smile and a lighter purse for you."},{id:"suspicious",text:"Keep them at arm's length",effects:{trust:-2},resultText:"The visitor leaves, disappointed. Your fighter seems conflicted."},{id:"private",text:"Give them privacy to talk",effects:{trust:3},resultText:"Whatever was said stays between them. Your fighter seems... different after."}]},{id:"rival_encounter",title:"Rival's Shadow",description:"Your fighter's rival has been seen nearby, watching your training sessions.",category:"camp",choices:[{id:"confront",text:"Confront them directly",effects:{trust:3,fame:5},resultText:"A tense exchange of words. The crowd nearby takes notice. Good for reputation."},{id:"ignore",text:"Ignore them completely",effects:{trust:-2},resultText:"Your fighter seems disappointed you didn't stand up for them."},{id:"wave",text:"Wave mockingly",effects:{fame:3},resultText:"A small psychological victory. The rival stalks off, fuming."}]},{id:"injured_rest",title:"The Weight of Wounds",description:"Your fighter's injuries are clearly bothering them. They wince with every movement.",category:"camp",requirements:{hasInjury:!0},choices:[{id:"force_rest",text:"Insist on complete rest",effects:{trust:5,injuryHeal:1},resultText:"A day of nothing but rest and recovery. The wounds begin to close."},{id:"push_through",text:"Tell them to push through",effects:{trust:-5,stamina:10},resultText:"They train through the pain. Tougher, but at what cost?"},{id:"healer",text:"Pay for a healer visit",effects:{gold:-30,trust:3,injuryHeal:1},resultText:"Professional care makes a difference. Money well spent."}]},{id:"crowd_recognition",title:"Famous Face",description:"People in the market are pointing and whispering. Your fighter has been recognized.",category:"camp",requirements:{minWeek:3},choices:[{id:"acknowledge",text:"Wave to the crowd",effects:{fame:8,trust:2},resultText:"The crowd cheers! Your fighter beams with pride."},{id:"humble",text:"Stay humble, keep walking",effects:{trust:5},resultText:"A quiet moment of recognition. Character matters more than fame."},{id:"showoff",text:"Put on a show",effects:{fame:15,stamina:-15,trust:-3},resultText:"A dazzling display! But the exertion takes its toll, and your fighter seems annoyed."}]},{id:"nightmare",title:"Dark Dreams",description:"Your fighter wakes screaming from a nightmare about dying in the arena.",category:"camp",choices:[{id:"promise",text:`"I won't let that happen."`,effects:{trust:10},resultText:"Your words carry weight. The promise hangs in the air between you."},{id:"realistic",text:`"It's a real risk. We both know that."`,effects:{trust:2},resultText:"Honesty is respected, if not comforting."},{id:"dismiss",text:'"Just a dream. Go back to sleep."',effects:{trust:-5},resultText:"Your fighter rolls over, alone with their fears."}]},{id:"shady_surgeon",title:"The Surgeon's Offer",description:'A hooded figure approaches with a leather bag of tools. "I can fix those injuries... permanently. For a price."',category:"offer",requirements:{hasInjury:!0},choices:[{id:"accept",text:"Accept the surgery",effects:{gold:-50,injuryHeal:3,injury:"minor",trust:-5},resultText:"The surgery is painful and the methods questionable, but the wounds heal faster. Something feels... different."},{id:"refuse",text:"Refuse firmly",effects:{trust:5},resultText:'Your fighter relaxes visibly. "Thank you for not selling me to butchers."'},{id:"bargain",text:"Negotiate a better price",effects:{gold:-25,injuryHeal:2,trust:-3},resultText:"A lesser procedure at a lesser price. The results are... acceptable."}]},{id:"cursed_weapon",title:"The Black Blade",description:'A merchant offers a blade that seems to drink in the light. "Powerful. Deadly. But demanding."',category:"offer",choices:[{id:"accept",text:"Take the blade",effects:{gold:-40,hp:-10,buff:"cursed_weapon"},resultText:"The blade feels wrong in the hand, but the power is undeniable."},{id:"refuse",text:"Walk away",effects:{trust:3},resultText:`"Wise choice," your fighter murmurs. Some things aren't worth the cost.`},{id:"examine",text:"Examine it closely first",effects:{gold:-10},resultText:"You pay for an appraisal. The blade is powerful but cursed. Knowledge gained."}]},{id:"sponsor_deal",title:"The Sponsor",description:"A wealthy patron offers gold in exchange for... loyalty. Their smile doesn't reach their eyes.",category:"offer",requirements:{minWeek:2},choices:[{id:"accept",text:"Accept the sponsorship",effects:{gold:100,reputation:-5,trust:-10},resultText:"The gold flows freely, but strings are attached. Your fighter looks at you differently now."},{id:"refuse",text:"Decline politely",effects:{trust:8},resultText:`"We don't need their kind," your fighter says with relief.`},{id:"negotiate",text:"Counter-offer with terms",effects:{gold:50,reputation:-2,trust:-3},resultText:"A compromise is reached. Less gold, fewer strings."}]},{id:"poison_offer",title:"Unfair Advantage",description:`A quiet voice in the dark offers a vial. "Coat your blade. They'll never know."`,category:"offer",choices:[{id:"accept",text:"Take the poison",effects:{gold:-30,trust:-15,buff:"poison_blade"},resultText:"Your fighter's face hardens. Honor is a luxury, after all."},{id:"refuse_loudly",text:"Refuse and report them",effects:{trust:10,fame:5},resultText:"Word spreads of your honor. Your fighter stands taller."},{id:"refuse_quietly",text:"Just say no",effects:{trust:5},resultText:"The figure melts into shadows. Some offers are better forgotten."}]},{id:"letter_home",title:"A Letter Home",description:"Your fighter sits with quill and parchment, struggling to find words.",category:"letter",choices:[{id:"help",text:"Help them write",effects:{trust:8},resultText:"Together you craft a message of hope and determination. The letter is finished."},{id:"private",text:"Give them privacy",effects:{trust:3},resultText:"Some words are too personal to share. The letter is sealed in silence."},{id:"discourage",text:"Suggest they focus on training instead",effects:{trust:-8,stamina:10},resultText:"The parchment is put away. Your fighter trains harder, but something is lost."}]},{id:"letter_response",title:"News From Home",description:"A letter arrives for your fighter. Their hands tremble as they read.",category:"letter",choices:[{id:"ask",text:"Ask what it says",effects:{trust:5},resultText:"They share the news. Family is well. A weight lifts from their shoulders."},{id:"space",text:"Give them time alone",effects:{trust:3},resultText:"When they emerge, their eyes are red but their resolve is firm."},{id:"practical",text:"Remind them we have work to do",effects:{trust:-5},resultText:"The letter is folded away. Duty calls, but at what cost?"}]},{id:"write_legacy",title:"Words for the Future",description:"Your fighter wants to write something to be read if they don't survive.",category:"letter",choices:[{id:"support",text:"Help them prepare this",effects:{trust:12},resultText:"A sobering task, but important. The letter is sealed and stored safely."},{id:"optimistic",text:`"You'll deliver it yourself."`,effects:{trust:5},resultText:"Your confidence is infectious. They smile, but keep writing anyway."},{id:"avoid",text:"Change the subject",effects:{trust:-3},resultText:"The topic is dropped, but the unwritten words hang between you."}]},{id:"stray_dog",title:"The Stray",description:"A scrawny dog has been following your fighter around camp.",category:"event",choices:[{id:"adopt",text:"Keep the dog",effects:{trust:8,gold:-10},resultText:"Your fighter names it immediately. Loyalty comes in many forms."},{id:"feed",text:"Feed it and send it away",effects:{trust:2,gold:-5},resultText:"A small kindness. The dog looks back once before leaving."},{id:"ignore",text:"Ignore it",effects:{trust:-2},resultText:"The dog eventually leaves. Your fighter watches it go with sad eyes."}]},{id:"gambler",title:"Double or Nothing",description:"Your fighter found a dice game in the back alleys.",category:"event",requirements:{minTrust:30},choices:[{id:"allow",text:"Let them gamble",effects:{gold:30,trust:5},resultText:"Lady luck smiles! Your fighter returns with a grin and coin."},{id:"forbid",text:"Forbid it",effects:{trust:-8},resultText:"They obey, but resentment simmers. You're not their parent."},{id:"join",text:"Join the game",effects:{gold:-20,trust:10},resultText:"You lose some coin but gain a memory. Worth every copper."}]},{id:"arena_tour",title:"Sacred Ground",description:"An opportunity to visit the Grand Arena at night, when it's empty.",category:"event",choices:[{id:"go",text:"Go together",effects:{trust:10,fame:3},resultText:"Standing on the sand, imagining the crowds. A moment of shared dreams."},{id:"train",text:"Use the time to train instead",effects:{stamina:15,trust:-2},resultText:"Practical, but something magical is missed."},{id:"alone",text:"Send them alone",effects:{trust:5},resultText:"Some experiences are personal. They return with fire in their eyes."}]},{id:"bad_food",title:"Spoiled Supplies",description:"Your food stores have gone bad. Someone needs to deal with this.",category:"event",choices:[{id:"buy_new",text:"Buy fresh supplies",effects:{gold:-25,trust:3},resultText:"New supplies secured. Your fighter appreciates proper meals."},{id:"make_do",text:"Make do with what's edible",effects:{hp:-10,trust:-3},resultText:"A rough few days. Stomachs suffer, but coin is saved."},{id:"hunt",text:"Go hunting for fresh meat",effects:{stamina:-10,trust:5},resultText:"A successful hunt! Fresh meat and bonding time."}]},{id:"festival",title:"Festival Night",description:"The town is celebrating. Music and laughter fill the streets.",category:"event",choices:[{id:"celebrate",text:"Join the celebration",effects:{gold:-15,trust:8,stamina:-10},resultText:"A night of joy and revelry. Some things matter more than training."},{id:"observe",text:"Watch from the edge",effects:{trust:3},resultText:"You share quiet observations about the crowd. A different kind of bonding."},{id:"train",text:"Use the empty training grounds",effects:{stamina:15,trust:-5},resultText:"Productive, but your fighter keeps glancing toward the music."}]}],Ie=[{id:"survival",name:"I'll get you out alive",description:"Promise to prioritize survival. Earlier and cheaper retirement options.",effect:"-30% retirement cost, available after 3 wins",mechanicBonus:{retirementDiscount:.3,earlyRetirement:!0}},{id:"glory",name:"We'll win the belt",description:"Promise to fight for the championship. Greater rewards, harder path.",effect:"+20% gold/fame rewards, +10% enemy stats",mechanicBonus:{rewardBonus:.2,enemyStatBonus:.1}},{id:"honor",name:"We fight with honor",description:"Promise to fight fairly. Crowd loves you, fewer shady opportunities.",effect:"+30% crowd hype gain, no shady offers",mechanicBonus:{hypeBonus:.3,noShadyOffers:!0}},{id:"vengeance",name:"We'll make them pay",description:"Promise to defeat every rival. Bonus damage to rivals, they seek you out.",effect:"+25% damage to rivals, rivals appear more often",mechanicBonus:{rivalDamageBonus:.25,rivalFrequency:2}},{id:"legacy",name:"Your name will echo forever",description:"Promise to build a legend. Extra bloodline points, more fame.",effect:"+50% fame gain, +1 bloodline point per league advanced",mechanicBonus:{fameBonus:.5,bloodlineBonus:1}}];class Oe extends w.Scene{constructor(){super({key:"PromiseScene"});d(this,"selectedPromise",null);d(this,"promiseContainers",new Map)}create(){var i;const{width:e,height:t}=this.cameras.main,a=m.getRun();this.createBackground(),this.createHeader(((i=a.fighter)==null?void 0:i.firstName)||"Fighter"),this.createPromiseCards(),this.createConfirmButton(),this.cameras.main.fadeIn(300)}createBackground(){const{width:e,height:t}=this.cameras.main,a=this.add.graphics();if(a.fillGradientStyle(1709072,1709072,2760474,2760474),a.fillRect(0,0,e,t),this.textures.exists("parchment_overlay")){const i=this.add.image(e/2,t/2,"parchment_overlay");i.setAlpha(.08),i.setDisplaySize(e,t)}}createHeader(e){const{width:t}=this.cameras.main;this.add.text(t/2,40,"MAKE A PROMISE",{fontFamily:"Georgia, serif",fontSize:"24px",color:"#c9a959",stroke:"#000000",strokeThickness:3}).setOrigin(.5),this.add.text(t/2,70,`What will you promise ${e}?`,{fontFamily:"Georgia, serif",fontSize:"13px",color:"#8b7355",fontStyle:"italic"}).setOrigin(.5),this.add.text(t/2,90,"This choice will define your journey together.",{fontFamily:"Georgia, serif",fontSize:"11px",color:"#5a4a3a"}).setOrigin(.5)}createPromiseCards(){const{width:e}=this.cameras.main,t=320,a=100,i=130,s=110;Ie.forEach((o,c)=>{const l=i+c*s,h=this.createPromiseCard(o,e/2-t/2,l,t,a);this.promiseContainers.set(o.id,h)})}createPromiseCard(e,t,a,i,s){const o=this.add.container(t,a),c=this.add.graphics();c.fillStyle(2760474,1),c.fillRoundedRect(0,0,i,s,8),c.lineStyle(2,5917242,1),c.strokeRoundedRect(0,0,i,s,8),o.add(c);const l=this.add.text(i/2,18,`"${e.name}"`,{fontFamily:"Georgia, serif",fontSize:"15px",color:"#c9a959"}).setOrigin(.5);o.add(l);const h=this.add.text(i/2,42,e.description,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b7355",wordWrap:{width:i-30},align:"center"}).setOrigin(.5);o.add(h);const u=this.add.text(i/2,75,e.effect,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#6b8e23"}).setOrigin(.5);o.add(u);const p=this.add.rectangle(i/2,s/2,i,s,16777215,0);return p.setInteractive({useHandCursor:!0}),o.add(p),p.on("pointerover",()=>{this.selectedPromise!==e.id&&(c.clear(),c.fillStyle(3813162,1),c.fillRoundedRect(0,0,i,s,8),c.lineStyle(2,9139029,1),c.strokeRoundedRect(0,0,i,s,8))}),p.on("pointerout",()=>{this.selectedPromise!==e.id&&(c.clear(),c.fillStyle(2760474,1),c.fillRoundedRect(0,0,i,s,8),c.lineStyle(2,5917242,1),c.strokeRoundedRect(0,0,i,s,8))}),p.on("pointerdown",()=>{this.selectPromise(e.id,i,s)}),o}selectPromise(e,t,a){if(this.selectedPromise){const s=this.promiseContainers.get(this.selectedPromise);if(s){const o=s.first;o.clear(),o.fillStyle(2760474,1),o.fillRoundedRect(0,0,t,a,8),o.lineStyle(2,5917242,1),o.strokeRoundedRect(0,0,t,a,8)}}this.selectedPromise=e;const i=this.promiseContainers.get(e);if(i){const s=i.first;s.clear(),s.fillStyle(3813162,1),s.fillRoundedRect(0,0,t,a,8),s.lineStyle(3,13216089,1),s.strokeRoundedRect(0,0,t,a,8)}}createConfirmButton(){const{width:e,height:t}=this.cameras.main,a=b.createButton(this,e/2,t-60,"SEAL THIS PROMISE",()=>this.confirmPromise(),{width:220,height:50,primary:!0});a.setAlpha(.5),this.events.on("update",()=>{a.setAlpha(this.selectedPromise?1:.5)})}confirmPromise(){if(!this.selectedPromise)return;m.updateRun({promise:this.selectedPromise}),this.cameras.main.fadeOut(500,0,0,0);const{width:e,height:t}=this.cameras.main,a=this.add.text(e/2,t/2,"PROMISE SEALED",{fontFamily:"Georgia, serif",fontSize:"28px",color:"#c9a959",stroke:"#000000",strokeThickness:4}).setOrigin(.5).setAlpha(0);this.tweens.add({targets:a,alpha:1,duration:300,yoyo:!0,hold:500,onComplete:()=>{this.scene.start("CampScene")}})}}const P=class P extends w.GameObjects.Container{constructor(e,t,a,i,s){super(e,t,a);d(this,"bg");d(this,"iconText");d(this,"titleText");d(this,"subtitleText");d(this,"costText");d(this,"config");d(this,"isPressed",!1);d(this,"isHovered",!1);d(this,"callback");d(this,"tooltipContainer");this.config=i,this.callback=s,this.createCard(),this.setupInteraction(),e.add.existing(this)}createCard(){if(this.bg=this.scene.add.graphics(),this.drawBackground(!1,!1),this.add(this.bg),this.iconText=this.scene.add.text(0,-35,this.config.icon,{fontSize:"36px"}).setOrigin(.5),this.add(this.iconText),this.titleText=this.scene.add.text(0,10,this.config.title,{fontFamily:"Georgia, serif",fontSize:"13px",color:this.config.disabled?"#5a4a3a":"#c9a959",fontStyle:"bold"}).setOrigin(.5),this.add(this.titleText),this.subtitleText=this.scene.add.text(0,28,this.config.subtitle,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355",fontStyle:"italic"}).setOrigin(.5),this.add(this.subtitleText),this.config.cost){const e=this.config.cost.type==="gold"?"💰":this.config.cost.type==="stamina"?"⚡":"❤️";this.costText=this.scene.add.text(0,50,`${e} ${this.config.cost.value}`,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#aa6666"}).setOrigin(.5),this.add(this.costText)}else this.config.benefit&&(this.costText=this.scene.add.text(0,50,this.config.benefit,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#6b8e23"}).setOrigin(.5),this.add(this.costText));this.config.disabled&&this.setAlpha(.6),this.config.highlighted&&this.addHighlightEffect()}drawBackground(e,t){const a=P.WIDTH,i=P.HEIGHT;this.bg.clear(),this.config.disabled||(this.bg.fillStyle(0,.3),this.bg.fillRoundedRect(-a/2+3,-i/2+3,a,i,10));const s=t?4864554:e?3813151:2760474;this.bg.fillStyle(s,.95),this.bg.fillRoundedRect(-a/2,-i/2,a,i,10);const o=this.config.highlighted?16766720:e?13216089:5917242;this.bg.lineStyle(e?3:2,o,1),this.bg.strokeRoundedRect(-a/2,-i/2,a,i,10),this.bg.lineStyle(1,3811866,.5),this.bg.strokeRoundedRect(-a/2+5,-i/2+5,a-10,i-10,8),this.bg.lineStyle(1,1709072,.1);for(let c=0;c<5;c++){const l=-i/2+20+c*25;this.bg.moveTo(-a/2+10,l),this.bg.lineTo(a/2-10,l)}this.bg.strokePath()}addHighlightEffect(){this.scene.tweens.add({targets:this.bg,alpha:{from:1,to:.8},duration:800,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}setupInteraction(){if(this.config.disabled)return;const e=new w.Geom.Rectangle(-160/2,-140/2,P.WIDTH,P.HEIGHT);this.setSize(P.WIDTH,P.HEIGHT),this.setInteractive(e,w.Geom.Rectangle.Contains),this.on("pointerover",this.onHover,this),this.on("pointerout",this.onOut,this),this.on("pointerdown",this.onDown,this),this.on("pointerup",this.onUp,this)}onHover(){this.config.disabled||(this.isHovered=!0,this.drawBackground(!0,!1),this.scene.tweens.add({targets:this,scaleX:1.05,scaleY:1.05,duration:100,ease:"Back.out"}),this.config.description&&this.showTooltip())}onOut(){this.isHovered=!1,this.isPressed=!1,this.drawBackground(!1,!1),this.scene.tweens.add({targets:this,scaleX:1,scaleY:1,duration:100}),this.hideTooltip()}onDown(){this.config.disabled||(this.isPressed=!0,this.drawBackground(!0,!0),this.createRippleEffect(),this.scene.tweens.add({targets:this,scaleX:.95,scaleY:.95,duration:50}))}onUp(){this.config.disabled||!this.isPressed||(this.isPressed=!1,this.scene.tweens.add({targets:this,scaleX:this.isHovered?1.05:1,scaleY:this.isHovered?1.05:1,duration:50,onComplete:()=>{this.config.disabled||this.callback()}}),this.drawBackground(this.isHovered,!1))}createRippleEffect(){const e=this.scene.add.graphics();e.fillStyle(13216089,.3),e.fillCircle(0,0,10),this.add(e),this.scene.tweens.add({targets:e,scaleX:8,scaleY:8,alpha:0,duration:400,ease:"Quad.out",onComplete:()=>e.destroy()})}showTooltip(){if(!this.config.description||this.tooltipContainer)return;this.tooltipContainer=this.scene.add.container(0,-140/2-40);const e=this.scene.add.text(0,0,this.config.description,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#c9a959",wordWrap:{width:150},align:"center"}).setOrigin(.5),t=10,a=this.scene.add.graphics();a.fillStyle(1709072,.95),a.fillRoundedRect(-e.width/2-t,-e.height/2-t,e.width+t*2,e.height+t*2,6),a.lineStyle(1,13216089,.5),a.strokeRoundedRect(-e.width/2-t,-e.height/2-t,e.width+t*2,e.height+t*2,6),this.tooltipContainer.add([a,e]),this.add(this.tooltipContainer),this.tooltipContainer.setAlpha(0),this.scene.tweens.add({targets:this.tooltipContainer,alpha:1,y:-140/2-50,duration:150})}hideTooltip(){this.tooltipContainer&&(this.tooltipContainer.destroy(),this.tooltipContainer=void 0)}setDisabled(e,t){this.config.disabled=e,this.config.disabledReason=t,this.setAlpha(e?.6:1),this.drawBackground(!1,!1),e?this.disableInteractive():this.setupInteraction()}updateConfig(e){Object.assign(this.config,e),this.titleText.setText(this.config.title),this.subtitleText.setText(this.config.subtitle),this.iconText.setText(this.config.icon),this.drawBackground(!1,!1)}};d(P,"WIDTH",160),d(P,"HEIGHT",140);let U=P;class Ee extends w.Scene{constructor(){super({key:"CampScene"});d(this,"fighter");d(this,"gold");d(this,"week");d(this,"league");d(this,"fighterSprite");d(this,"campfireGlow");d(this,"bannerCloth")}create(){const e=m.getRun();if(!e.fighter){this.scene.start("MainMenuScene");return}this.fighter=e.fighter,this.gold=e.gold,this.week=e.week,this.league=e.league,this.createBackground(),this.createCampDiorama(),this.createHeader(),this.createFighterDisplay(),this.createActionCards(),this.createProgressBar(),this.checkGhostMoments(),this.checkRelicOpportunity(),this.cameras.main.fadeIn(300)}createBackground(){const{width:e,height:t}=this.cameras.main,a=this.add.graphics();a.fillGradientStyle(657426,657426,1710112,1710112),a.fillRect(0,0,e,t);for(let i=0;i<30;i++){const s=this.add.graphics();s.fillStyle(16777215,Math.random()*.5+.2),s.fillCircle(Math.random()*e,Math.random()*t*.4,1),this.tweens.add({targets:s,alpha:{from:.3,to:.8},duration:1e3+Math.random()*2e3,yoyo:!0,repeat:-1})}a.fillStyle(2762016,1),a.fillRect(0,t*.65,e,t*.35),a.fillStyle(1709333,1),a.beginPath(),a.moveTo(0,t*.5),a.lineTo(80,t*.35),a.lineTo(150,t*.45),a.lineTo(250,t*.3),a.lineTo(320,t*.42),a.lineTo(e,t*.38),a.lineTo(e,t*.65),a.lineTo(0,t*.65),a.closePath(),a.fillPath()}createCampDiorama(){const{width:e,height:t}=this.cameras.main,a=this.add.graphics();a.fillStyle(4864554,1),a.beginPath(),a.moveTo(e*.15,t*.65),a.lineTo(e*.25,t*.45),a.lineTo(e*.35,t*.65),a.closePath(),a.fillPath(),a.lineStyle(2,3811866,1),a.strokePath(),a.fillStyle(1709072,1),a.fillTriangle(e*.22,t*.65,e*.25,t*.52,e*.28,t*.65);const i=this.add.graphics();i.fillStyle(3811866,1),i.fillEllipse(e*.55,t*.68,40,15),this.campfireGlow=this.add.graphics(),this.animateCampfire(),this.createAnimatedBanner(e*.75,t*.35),this.createSmokeEffect(e*.55,t*.58),this.add.graphics().fillStyle(5917242,1).fillRect(e*.8,t*.58,30,25).fillRect(e*.82,t*.53,25,20);const s=this.add.graphics();s.lineStyle(3,3811866,1),s.moveTo(e*.1,t*.65),s.lineTo(e*.1,t*.5),s.moveTo(e*.08,t*.52),s.lineTo(e*.12,t*.52),s.strokePath()}animateCampfire(){const{width:e,height:t}=this.cameras.main,a=e*.55,i=t*.62,s=o=>{var c,l,h,u,p,y,S;(c=this.campfireGlow)==null||c.clear(),(l=this.campfireGlow)==null||l.fillStyle(16737792,.1*o),(h=this.campfireGlow)==null||h.fillCircle(a,i,60*o),(u=this.campfireGlow)==null||u.fillStyle(16750848,.15*o),(p=this.campfireGlow)==null||p.fillCircle(a,i,40*o),(y=this.campfireGlow)==null||y.fillStyle(16763904,.3*o),(S=this.campfireGlow)==null||S.fillCircle(a,i-5,15)};this.tweens.add({targets:{intensity:1},intensity:1.2,duration:200,yoyo:!0,repeat:-1,ease:"Sine.easeInOut",onUpdate:o=>{const c=o.getValue();typeof c=="number"&&s(c)}}),s(1)}createAnimatedBanner(e,t){const a=this.add.graphics();a.fillStyle(4864554,1),a.fillRect(e-3,t,6,150),this.bannerCloth=this.add.graphics();const i=s=>{var o,c,l,h,u,p,y,S,k,T,f;(o=this.bannerCloth)==null||o.clear(),(c=this.bannerCloth)==null||c.fillStyle(9109504,1),(l=this.bannerCloth)==null||l.beginPath(),(h=this.bannerCloth)==null||h.moveTo(e+3,t+10);for(let v=0;v<60;v+=10){const B=Math.sin((v+s)*.1)*5;(u=this.bannerCloth)==null||u.lineTo(e+50+B,t+10+v)}(p=this.bannerCloth)==null||p.lineTo(e+45,t+70),(y=this.bannerCloth)==null||y.lineTo(e+3,t+70),(S=this.bannerCloth)==null||S.closePath(),(k=this.bannerCloth)==null||k.fillPath(),(T=this.bannerCloth)==null||T.fillStyle(13216089,1),(f=this.bannerCloth)==null||f.fillCircle(e+25,t+40,8)};this.tweens.add({targets:{wave:0},wave:100,duration:3e3,repeat:-1,onUpdate:s=>{const o=s.getValue();typeof o=="number"&&i(o)}}),i(0)}createSmokeEffect(e,t){this.time.addEvent({delay:300,callback:()=>{const a=this.add.graphics();a.fillStyle(8947848,.3),a.fillCircle(0,0,5+Math.random()*5),a.setPosition(e+(Math.random()-.5)*20,t),this.tweens.add({targets:a,y:t-80,alpha:0,scale:2,duration:2e3,ease:"Quad.out",onComplete:()=>a.destroy()})},loop:!0})}createHeader(){const{width:e}=this.cameras.main,t=m.getRun();this.add.text(20,20,`Week ${this.week+1}`,{fontFamily:"Georgia, serif",fontSize:"16px",color:"#c9a959"});const a={bronze:"#cd7f32",silver:"#c0c0c0",gold:"#ffd700",champion:"#ff4500"};this.add.text(20,42,`${this.league.toUpperCase()} LEAGUE`,{fontFamily:"Georgia, serif",fontSize:"12px",color:a[this.league]||"#8b7355"}),this.add.text(e-20,20,`💰 ${this.gold}`,{fontFamily:"Georgia, serif",fontSize:"16px",color:"#c9a959"}).setOrigin(1,0),this.add.text(e-20,42,`⭐ ${t.fame}`,{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b7355"}).setOrigin(1,0),t.relics.length>0&&this.add.text(e-20,62,`🔮 ${t.relics.length} Relics`,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#9932cc"}).setOrigin(1,0)}createFighterDisplay(){const{width:e,height:t}=this.cameras.main;this.fighterSprite=this.add.container(e*.55,t*.45);const a=E.renderPortrait(this,this.fighter.portrait,0,0,70);if(this.fighterSprite.add(a),this.fighter.injuries.length>0){const o=this.add.text(35,-35,"🩹",{fontSize:"16px"});this.fighterSprite.add(o)}this.animateFighter(),this.add.text(e*.55,t*.55,this.fighter.firstName,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#c9a959"}).setOrigin(.5);const i=this.fighter.status==="healthy"?"#6b8e23":this.fighter.status==="injured"?"#daa520":"#8b0000";this.add.text(e*.55,t*.58,this.fighter.status.toUpperCase(),{fontFamily:"Georgia, serif",fontSize:"10px",color:i}).setOrigin(.5);const s=this.getContextualVoiceLine();s&&this.createSpeechBubble(e*.55,t*.35,s),this.fighterSprite.setSize(80,80),this.fighterSprite.setInteractive(),this.fighterSprite.on("pointerdown",()=>this.showCharacterSheet())}animateFighter(){this.fighterSprite&&(this.fighter.injuries.length>0?this.tweens.add({targets:this.fighterSprite,x:this.fighterSprite.x-3,duration:1500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}):this.fighter.trust>=70?this.tweens.add({targets:this.fighterSprite,y:this.fighterSprite.y-3,duration:2e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}):this.tweens.add({targets:this.fighterSprite,scaleX:1.02,scaleY:.98,duration:2500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}))}createSpeechBubble(e,t,a){const i=this.add.container(e,t),s=this.add.graphics();s.fillStyle(2760474,.9),s.fillRoundedRect(-80,-25,160,40,8),s.lineStyle(1,13216089,.5),s.strokeRoundedRect(-80,-25,160,40,8),s.fillStyle(2760474,.9),s.fillTriangle(0,15,-10,25,10,25);const o=this.add.text(0,-5,`"${a}"`,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355",fontStyle:"italic",wordWrap:{width:150},align:"center"}).setOrigin(.5);i.add([s,o]),i.setAlpha(0),this.tweens.add({targets:i,alpha:1,duration:500,delay:500})}createActionCards(){const{width:e,height:t}=this.cameras.main;m.getRun();const a=[{id:"train",title:"TRAIN",subtitle:"Improve your skills",icon:"⚔️",benefit:"+ATK +ACC",description:"Spend time honing combat skills. Gain +1 Attack and +2 Accuracy."},{id:"shop",title:"SHOP",subtitle:"Buy equipment",icon:"🛒",description:"Browse weapons, armor, and supplies at the market."},{id:"rest",title:"REST",subtitle:"Recover strength",icon:"🛏️",benefit:"+HP +Trust",description:"Rest and recover. Restore HP/Stamina, heal injuries, gain Trust."},{id:"letter",title:"WRITE LETTER",subtitle:"Send correspondence",icon:"✉️",benefit:"Unique rewards",highlighted:!0,description:"Write to family, patrons, or rivals. Letters provide valuable bonuses!"}],i=e*.25,s=t*.72,o=2,c=170;a.forEach((l,h)=>{const u=h%o,p=Math.floor(h/o),y=i+u*c,S=s+p*75;new U(this,y,S,l,()=>this.handleAction(l.id))}),b.createButton(this,e/2,t-45,"🗡️ ENTER ARENA",()=>this.enterArena(),{width:200,height:50,primary:!0})}handleAction(e){switch(e){case"train":this.doTrain();break;case"shop":this.goToShop();break;case"rest":this.doRest();break;case"letter":this.writeLetter();break}}createProgressBar(){const{width:e,height:t}=this.cameras.main,a=m.getRun(),i=t-95,s=e-60;this.add.text(30,i-12,`${a.fightsInLeague}/${a.fightsToNextLeague} to next league`,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#5a4a3a"});const o=this.add.graphics();o.fillStyle(2760474,1),o.fillRoundedRect(30,i,s,8,3);const c=this.add.graphics();c.fillStyle(13216089,1),c.fillRoundedRect(30,i,a.fightsInLeague/a.fightsToNextLeague*s,8,3)}getContextualVoiceLine(){return this.fighter.injuries.length>0?N(this.fighter,"taking_damage"):this.fighter.trust<30?N(this.fighter,"idle"):N(this.fighter,"rest")}showCharacterSheet(){b.showNotification(this,"Character sheet coming soon!",2e3)}doTrain(){this.fighter.currentStats.attack+=1,this.fighter.currentStats.accuracy+=2,F(this.fighter,2),this.week++,m.updateRun({fighter:this.fighter,week:this.week,lastCampAction:"train"}),b.showNotification(this,"Training complete! +1 ATK, +2 ACC"),this.refreshScene()}goToShop(){m.updateRun({lastCampAction:"shop"}),this.cameras.main.fadeOut(200),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("ShopScene")})}doRest(){J(this.fighter),ae(this.fighter,1),F(this.fighter,5),this.week++,m.updateRun({fighter:this.fighter,week:this.week,lastCampAction:"rest"}),b.showNotification(this,"Rested well! +5 Trust, HP restored"),this.refreshScene()}writeLetter(){m.updateRun({lastCampAction:"letter"}),this.cameras.main.fadeOut(200),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("LetterScene")})}enterArena(){J(this.fighter),m.updateRun({fighter:this.fighter,lastCampAction:"fight"}),this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("FightScene")})}checkGhostMoments(){const e=Re("camp");if(e){const t=Ce(e);this.time.delayedCall(1e3,()=>{b.showNotification(this,t,4e3)})}}checkRelicOpportunity(){const e=m.getRun();e.fightsSinceRelic>=3&&e.consecutiveWins>=2&&this.time.delayedCall(1500,()=>{b.showConfirmDialog(this,"Relic Opportunity!","A mysterious merchant offers you a choice of relics...",()=>{this.scene.start("RelicChoiceScene")},()=>{m.updateRun({fightsSinceRelic:0})},"VIEW RELICS")})}refreshScene(){this.cameras.main.fadeOut(150),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.restart()})}}const Ge=[{name:"Bruised Ribs",location:"body",severity:"minor",effect:"Hurts to breathe deeply",statPenalty:{maxStamina:-5},healTime:1,scarChance:0},{name:"Split Lip",location:"head",severity:"minor",effect:"Looks worse than it is",statPenalty:{},healTime:1,scarChance:.1},{name:"Twisted Ankle",location:"legs",severity:"minor",effect:"Movement slightly impaired",statPenalty:{speed:-1,evasion:-3},healTime:1,scarChance:0},{name:"Black Eye",location:"head",severity:"minor",effect:"Vision slightly impaired",statPenalty:{accuracy:-5},healTime:1,scarChance:0},{name:"Strained Shoulder",location:"body",severity:"minor",effect:"Arm feels weak",statPenalty:{attack:-2},healTime:2,scarChance:0},{name:"Deep Cut",location:"body",severity:"moderate",effect:"Bleeding wound",statPenalty:{maxHP:-10,defense:-2},healTime:2,scarChance:.3},{name:"Fractured Jaw",location:"head",severity:"moderate",effect:"Speaking and eating is painful",statPenalty:{maxStamina:-8},healTime:3,scarChance:.2},{name:"Torn Muscle",location:"legs",severity:"moderate",effect:"Mobility severely limited",statPenalty:{speed:-3,evasion:-8},healTime:3,scarChance:0},{name:"Cracked Ribs",location:"body",severity:"moderate",effect:"Every breath hurts",statPenalty:{maxStamina:-12,defense:-3},healTime:3,scarChance:0},{name:"Gashed Thigh",location:"legs",severity:"moderate",effect:"Deep wound, heavy bleeding",statPenalty:{maxHP:-8,speed:-2},healTime:2,scarChance:.4},{name:"Concussion",location:"head",severity:"moderate",effect:"Head trauma, dizziness",statPenalty:{accuracy:-10,maxFocus:-10},healTime:2,scarChance:0},{name:"Broken Arm",location:"body",severity:"severe",effect:"Cannot use dominant arm properly",statPenalty:{attack:-8,accuracy:-15},healTime:4,scarChance:.1},{name:"Shattered Knee",location:"legs",severity:"severe",effect:"May never fight the same",statPenalty:{speed:-5,evasion:-15},healTime:5,scarChance:.2},{name:"Skull Fracture",location:"head",severity:"severe",effect:"Life-threatening head trauma",statPenalty:{maxHP:-20,maxFocus:-15},healTime:5,scarChance:.5},{name:"Punctured Lung",location:"body",severity:"severe",effect:"Breathing is agony",statPenalty:{maxStamina:-25,maxHP:-15},healTime:5,scarChance:.3},{name:"Severed Tendon",location:"legs",severity:"severe",effect:"Leg barely functional",statPenalty:{speed:-8,evasion:-20,attack:-3},healTime:5,scarChance:.4},{name:"Facial Disfigurement",location:"head",severity:"severe",effect:"Scarred for life",statPenalty:{},healTime:4,scarChance:1}],Me=[{id:"bandages",name:"Crude Bandages",description:"Dirty cloth strips. Better than nothing.",type:"healing",effect:"Restore 20 HP",value:20,uses:1,price:15},{id:"healing_salve",name:"Healing Salve",description:"A pungent green paste that numbs pain.",type:"healing",effect:"Restore 35 HP",value:35,uses:1,price:30},{id:"surgeons_kit",name:"Surgeon's Kit",description:"Professional medical supplies.",type:"healing",effect:"Restore 50 HP, cure Bleed",value:50,uses:1,price:60},{id:"grit_salts",name:"Grit Salts",description:"Inhale for instant alertness. Burns like hell.",type:"buff",effect:"Restore 30 Stamina",value:30,uses:1,price:25},{id:"focus_tonic",name:"Focus Tonic",description:"A bitter brew that sharpens the mind.",type:"buff",effect:"Gain 20 Focus",value:20,uses:1,price:35},{id:"berserker_draught",name:"Berserker Draught",description:"Red liquid that tastes of iron. +5 Attack for 3 turns.",type:"buff",effect:"+5 Attack (3 turns)",value:5,uses:1,price:45},{id:"iron_skin_oil",name:"Iron-Skin Oil",description:"Protective coating. +5 Defense for 3 turns.",type:"buff",effect:"+5 Defense (3 turns)",value:5,uses:1,price:45},{id:"smoke_bomb",name:"Smoke Bomb",description:"Creates a concealing cloud. Guarantees dodge next attack.",type:"utility",effect:"Guaranteed dodge (1 attack)",value:1,uses:1,price:50},{id:"flash_powder",name:"Flash Powder",description:"Blinds the opponent. -20 Accuracy for 2 turns.",type:"utility",effect:"Enemy -20 Accuracy (2 turns)",value:20,uses:1,price:40},{id:"antivenom",name:"Antivenom",description:"Neutralizes poisons and clears the blood.",type:"healing",effect:"Cure Bleed and Poison",value:0,uses:1,price:35}],Fe=[{id:"rusty_sword",name:"Rusty Sword",description:"A worn blade, but still sharp enough.",rarity:"common",attackBonus:2,accuracyBonus:0,critBonus:0,price:30},{id:"wooden_club",name:"Wooden Club",description:"Simple but effective.",rarity:"common",attackBonus:3,accuracyBonus:-5,critBonus:0,price:20},{id:"fighting_knife",name:"Fighting Knife",description:"Quick and precise.",rarity:"common",attackBonus:1,accuracyBonus:8,critBonus:3,price:35},{id:"iron_mace",name:"Iron Mace",description:"Heavy and crushing.",rarity:"common",attackBonus:4,accuracyBonus:-3,critBonus:0,price:40},{id:"soldiers_blade",name:"Soldier's Blade",description:"A proper military weapon.",rarity:"uncommon",attackBonus:5,accuracyBonus:3,critBonus:2,price:80},{id:"spiked_flail",name:"Spiked Flail",description:"Unpredictable and dangerous.",rarity:"uncommon",attackBonus:6,accuracyBonus:-5,critBonus:5,price:90},{id:"gladius",name:"Gladius",description:"Classic arena weapon.",rarity:"uncommon",attackBonus:4,accuracyBonus:5,critBonus:3,price:85},{id:"war_axe",name:"War Axe",description:"Brutal chopping power.",rarity:"uncommon",attackBonus:7,accuracyBonus:-3,critBonus:4,price:95},{id:"champion_sword",name:"Champion's Sword",description:"Wielded by a former champion.",rarity:"rare",attackBonus:8,accuracyBonus:5,critBonus:5,effect:"+10% Hype gain",price:180},{id:"blood_drinker",name:"Blood Drinker",description:"Heals on critical hits.",rarity:"rare",attackBonus:6,accuracyBonus:3,critBonus:8,effect:"Crit heals 10 HP",price:200},{id:"executioner",name:"The Executioner",description:"Heavy two-handed blade.",rarity:"rare",attackBonus:12,accuracyBonus:-8,critBonus:10,effect:"+30% damage to low HP enemies",price:220},{id:"viper_fang",name:"Viper Fang",description:"Poisoned edge.",rarity:"rare",attackBonus:5,accuracyBonus:8,critBonus:5,effect:"Attacks apply Bleed",price:190},{id:"crown_slayer",name:"Crown Slayer",description:"The weapon of legends.",rarity:"legendary",attackBonus:12,accuracyBonus:8,critBonus:10,effect:"+50% damage to champions",price:500},{id:"soulreaper",name:"Soulreaper",description:"Said to steal the dying breath.",rarity:"legendary",attackBonus:10,accuracyBonus:5,critBonus:15,effect:"Killing blows restore 25 HP",price:450}],He=[{id:"leather_vest",name:"Leather Vest",description:"Basic protection.",rarity:"common",defenseBonus:3,hpBonus:0,speedPenalty:0,price:25},{id:"padded_gambeson",name:"Padded Gambeson",description:"Quilted cloth armor.",rarity:"common",defenseBonus:4,hpBonus:5,speedPenalty:1,price:35},{id:"studded_leather",name:"Studded Leather",description:"Leather reinforced with metal studs.",rarity:"common",defenseBonus:5,hpBonus:0,speedPenalty:1,price:45},{id:"chainmail_shirt",name:"Chainmail Shirt",description:"Interlocked metal rings.",rarity:"uncommon",defenseBonus:8,hpBonus:5,speedPenalty:2,price:100},{id:"gladiator_harness",name:"Gladiator Harness",description:"Arena-style protective gear.",rarity:"uncommon",defenseBonus:6,hpBonus:10,speedPenalty:0,price:110},{id:"scale_mail",name:"Scale Mail",description:"Overlapping metal scales.",rarity:"uncommon",defenseBonus:9,hpBonus:0,speedPenalty:3,price:120},{id:"champion_plate",name:"Champion's Plate",description:"Worn by arena legends.",rarity:"rare",defenseBonus:12,hpBonus:15,speedPenalty:2,effect:"+10 Trust with crowd",price:250},{id:"shadow_leather",name:"Shadow Leather",description:"Dark, supple armor.",rarity:"rare",defenseBonus:8,hpBonus:5,speedPenalty:-1,effect:"+10 Evasion",price:230},{id:"berserker_hide",name:"Berserker Hide",description:"Blessed by battle priests.",rarity:"rare",defenseBonus:6,hpBonus:20,speedPenalty:0,effect:"+15% damage when injured",price:240},{id:"immortal_aegis",name:"Immortal Aegis",description:"Said to have saved a hundred lives.",rarity:"legendary",defenseBonus:15,hpBonus:25,speedPenalty:2,effect:"Survive fatal blow once per fight",price:500},{id:"bloodline_armor",name:"Bloodline Armor",description:"Passed through generations of champions.",rarity:"legendary",defenseBonus:12,hpBonus:30,speedPenalty:1,effect:"+2 Bloodline Points on victory",price:480}];class _e extends w.Scene{constructor(){super({key:"ShopScene"});d(this,"gold");d(this,"fighter");d(this,"selectedCategory","items");d(this,"shopInventory",new Map);d(this,"goldText");d(this,"itemsContainer")}create(){const e=m.getRun();if(!e.fighter){this.scene.start("MainMenuScene");return}this.fighter=e.fighter,this.gold=e.gold,this.generateShopInventory(),this.createBackground(),this.createHeader(),this.createCategoryTabs(),this.createItemList(),this.createBackButton(),this.cameras.main.fadeIn(300)}generateShopInventory(){const e=m.getMeta(),t=3+Math.floor(e.promoterLevel/2),a=3+Math.floor(e.promoterLevel/2),i=g.shuffle([...Fe]).slice(0,t);this.shopInventory.set("weapons",i);const s=g.shuffle([...He]).slice(0,a);this.shopInventory.set("armor",s),this.shopInventory.set("items",[...Me])}createBackground(){const{width:e,height:t}=this.cameras.main,a=this.add.graphics();if(a.fillGradientStyle(1709072,1709072,2760474,2760474),a.fillRect(0,0,e,t),this.textures.exists("parchment_overlay")){const i=this.add.image(e/2,t/2,"parchment_overlay");i.setAlpha(.08),i.setDisplaySize(e,t)}}createHeader(){const{width:e}=this.cameras.main;this.add.text(e/2,35,"🛒 MERCHANT",{fontFamily:"Georgia, serif",fontSize:"24px",color:"#c9a959",stroke:"#000000",strokeThickness:3}).setOrigin(.5),this.add.text(e/2,65,'"Best wares this side of the arena..."',{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b7355",fontStyle:"italic"}).setOrigin(.5),this.goldText=this.add.text(e-20,20,`💰 ${this.gold}`,{fontFamily:"Georgia, serif",fontSize:"18px",color:"#ffd700"}).setOrigin(1,0)}createCategoryTabs(){const{width:e}=this.cameras.main,t=100,a=100,i=110,s=e/2-i;[{id:"items",label:"🧪 Items"},{id:"weapons",label:"⚔️ Weapons"},{id:"armor",label:"🛡️ Armor"}].forEach((c,l)=>{const h=s+l*i;b.createButton(this,h,t,c.label,()=>this.selectCategory(c.id),{width:a,height:35,fontSize:"11px"}).setData("category",c.id)})}selectCategory(e){this.selectedCategory=e,this.createItemList()}createItemList(){const{width:e,height:t}=this.cameras.main;this.itemsContainer&&this.itemsContainer.destroy(),this.itemsContainer=this.add.container(0,0);const a=this.shopInventory.get(this.selectedCategory)||[],i=150,s=80;a.forEach((o,c)=>{const l=i+c*s;this.createItemCard(o,30,l,e-60,70)}),a.length===0&&this.add.text(e/2,250,"No items available",{fontFamily:"Georgia, serif",fontSize:"14px",color:"#5a4a3a"}).setOrigin(.5)}createItemCard(e,t,a,i,s){const o=this.add.container(t,a);this.itemsContainer.add(o);const c=this.add.graphics();c.fillStyle(2760474,1),c.fillRoundedRect(0,0,i,s,8),c.lineStyle(1,5917242,1),c.strokeRoundedRect(0,0,i,s,8),o.add(c);const h={common:"#8b8b8b",uncommon:"#2e8b57",rare:"#4169e1",legendary:"#ffd700"}[e.rarity]||"#8b8b8b",u=this.add.text(15,12,e.name,{fontFamily:"Georgia, serif",fontSize:"14px",color:h});o.add(u);const p=this.add.text(15,32,e.description||e.effect,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355",wordWrap:{width:i-100}});o.add(p);const y=this.add.text(i-15,12,`💰 ${e.price}`,{fontFamily:"Georgia, serif",fontSize:"14px",color:this.gold>=e.price?"#ffd700":"#8b0000"}).setOrigin(1,0);o.add(y);const S=this.gold>=e.price,k=b.createButton(this,i-45,s-20,"BUY",()=>this.buyItem(e),{width:60,height:25,fontSize:"10px",primary:S});o.add(k),S||k.setAlpha(.5)}buyItem(e){if(this.gold<e.price){b.showNotification(this,"Not enough gold!");return}this.gold-=e.price,this.goldText.setText(`💰 ${this.gold}`),this.selectedCategory==="items"?this.fighter.inventory.push({id:e.id,name:e.name,type:"accessory",rarity:"common",stats:{},description:e.description}):this.selectedCategory==="weapons"?this.fighter.equipment.weapon={id:e.id,name:e.name,type:"weapon",rarity:e.rarity,stats:{attack:e.attackBonus,accuracy:e.accuracyBonus,critChance:e.critBonus},effect:e.effect,description:e.description}:this.selectedCategory==="armor"&&(this.fighter.equipment.armor={id:e.id,name:e.name,type:"armor",rarity:e.rarity,stats:{defense:e.defenseBonus,maxHP:e.hpBonus,speed:-e.speedPenalty},effect:e.effect,description:e.description}),m.updateRun({fighter:this.fighter,gold:this.gold}),b.showNotification(this,`Purchased ${e.name}!`),this.createItemList()}createBackButton(){const{width:e,height:t}=this.cameras.main;b.createButton(this,e/2,t-50,"← BACK TO CAMP",()=>this.returnToCamp(),{width:180,height:45})}returnToCamp(){this.cameras.main.fadeOut(200),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("CampScene")})}}const A={light_attack:{staminaCost:10,baseDamage:1,accuracy:.9,focusGain:5,hypeGain:5},heavy_attack:{staminaCost:25,baseDamage:1.8,accuracy:.75,focusGain:10,hypeGain:15},guard:{staminaCost:5,blockMultiplier:.6,focusGain:3,hypeGain:0},dodge:{staminaCost:15,evasionBonus:.3,focusGain:5,hypeGain:10},special:{staminaCost:20,focusCost:30,baseDamage:2,accuracy:.85,hypeGain:25},item:{staminaCost:0,focusGain:0,hypeGain:-5}},De={head:{damage:1.2,critBonus:.1,effect:"concuss"},body:{damage:1,critBonus:0,effect:null},legs:{damage:.9,critBonus:-.05,effect:"cripple"}};function Le(n,r){return{player:Z(n),enemy:Z(r),round:1,turn:n.currentStats.speed>=r.currentStats.speed?"player":"enemy",phase:"select_action",crowdHype:30,log:[],isParryWindow:!1,parryWindowStart:0,winner:null,lastAction:null}}function Z(n){return{fighter:n,currentHP:n.currentStats.currentHP,currentStamina:n.currentStats.currentStamina,currentFocus:0,injuryMeter:0,activeEffects:new Map,guardStance:null,lastAction:null,consecutiveGuards:0}}function ee(n,r,e,t,a){const i=n[r],s=n[r==="player"?"enemy":"player"],o=A[e];let c={success:!1,damage:0,damageBlocked:0,targetZone:t,critical:!1,perfectParry:!1,counterDamage:0,statusApplied:null,staminaCost:o.staminaCost,focusGained:0,focusSpent:0,hypeGained:0,message:""};if(i.currentStamina<o.staminaCost)return c.message=`${i.fighter.firstName} is too exhausted!`,c;switch(i.currentStamina-=o.staminaCost,e){case"light_attack":case"heavy_attack":c=Ne(n,i,s,e,t);break;case"guard":c=We(i,t);break;case"dodge":c=$e(i);break;case"special":c=Ye(n,i,s,t);break;case"item":c=je(i);break}return i.lastAction=e,n.log.push({round:n.round,actor:r,action:e,result:c,timestamp:Date.now()}),n.crowdHype=Math.max(0,Math.min(100,n.crowdHype+c.hypeGained)),s.currentHP<=0?(n.winner=r,n.phase="end"):i.currentHP<=0&&(n.winner=r==="player"?"enemy":"player",n.phase="end"),n.lastAction=c,c}function Ne(n,r,e,t,a){const i=A[t],s=De[a],o={success:!1,damage:0,damageBlocked:0,targetZone:a,critical:!1,perfectParry:!1,counterDamage:0,statusApplied:null,staminaCost:i.staminaCost,focusGained:0,focusSpent:0,hypeGained:0,message:""};let c=i.accuracy*(r.fighter.currentStats.accuracy/100);if(e.lastAction==="dodge"&&(c-=A.dodge.evasionBonus),r.activeEffects.has("concuss")&&(c-=.15),e.activeEffects.has("cripple")&&a==="legs"&&(c+=.1),g.chance(c)){o.success=!0;let l=r.fighter.currentStats.attack*i.baseDamage;l*=s.damage;const h=r.fighter.currentStats.critChance/100+s.critBonus;g.chance(h)&&(o.critical=!0,l*=r.fighter.currentStats.critDamage/100,o.hypeGained+=10),e.lastAction==="guard"&&e.guardStance===a&&(o.damageBlocked=l*A.guard.blockMultiplier,l-=o.damageBlocked,o.message=`${e.fighter.firstName} blocked! `);const u=e.fighter.currentStats.defense,p=Math.max(1,Math.round(l-u*.3));o.damage=p,e.currentHP-=p,e.currentHP<e.fighter.closestCall&&(e.fighter.closestCall=e.currentHP),e.injuryMeter+=p*.5,o.critical&&(e.injuryMeter+=10),s.effect&&g.chance(.2+(o.critical?.1:0))&&(o.statusApplied=s.effect,e.activeEffects.set(s.effect,3)),o.focusGained=i.focusGain,r.currentFocus=Math.min(r.fighter.currentStats.maxFocus,r.currentFocus+o.focusGained),o.hypeGained+=i.hypeGain;const y=t==="light_attack"?"quick strike":"heavy blow";o.message+=`${r.fighter.firstName}'s ${y} hits the ${a} for ${p} damage!`,o.critical&&(o.message+=" CRITICAL HIT!"),o.statusApplied&&(o.message+=` ${e.fighter.firstName} is ${o.statusApplied}ed!`)}else o.message=`${r.fighter.firstName}'s attack misses!`,e.lastAction==="dodge"&&(o.message=`${e.fighter.firstName} dodges the attack!`,o.hypeGained=5);return o}function We(n,r){n.guardStance=r,n.consecutiveGuards++;const e=A.guard.focusGain*Math.min(n.consecutiveGuards,3);return n.currentFocus=Math.min(n.fighter.currentStats.maxFocus,n.currentFocus+e),{success:!0,damage:0,damageBlocked:0,targetZone:r,critical:!1,perfectParry:!1,counterDamage:0,statusApplied:null,staminaCost:A.guard.staminaCost,focusGained:e,focusSpent:0,hypeGained:0,message:`${n.fighter.firstName} raises guard to protect ${r}!`}}function $e(n){return n.guardStance=null,n.consecutiveGuards=0,{success:!0,damage:0,damageBlocked:0,targetZone:"body",critical:!1,perfectParry:!1,counterDamage:0,statusApplied:null,staminaCost:A.dodge.staminaCost,focusGained:A.dodge.focusGain,focusSpent:0,hypeGained:A.dodge.hypeGain,message:`${n.fighter.firstName} prepares to dodge!`}}function Ye(n,r,e,t){const a=A.special;if(r.currentFocus<a.focusCost)return{success:!1,damage:0,damageBlocked:0,targetZone:t,critical:!1,perfectParry:!1,counterDamage:0,statusApplied:null,staminaCost:0,focusGained:0,focusSpent:0,hypeGained:-5,message:`${r.fighter.firstName} lacks focus for a special move!`};r.currentFocus-=a.focusCost,r.fighter.signatureMoveUses++;const i=r.fighter.currentStats.attack*a.baseDamage,s=Math.round(i*g.float(.9,1.2));return e.currentHP-=s,e.injuryMeter+=s*.7,{success:!0,damage:s,damageBlocked:0,targetZone:t,critical:!1,perfectParry:!1,counterDamage:0,statusApplied:null,staminaCost:a.staminaCost,focusGained:0,focusSpent:a.focusCost,hypeGained:a.hypeGain,message:`${r.fighter.firstName} unleashes "${r.fighter.signatureTrait.name}"! ${s} damage!`}}function je(n,r){return n.currentHP=Math.min(n.fighter.currentStats.maxHP,n.currentHP+30),{success:!0,damage:0,damageBlocked:0,targetZone:"body",critical:!1,perfectParry:!1,counterDamage:0,statusApplied:null,staminaCost:0,focusGained:0,focusSpent:0,hypeGained:-5,message:`${n.fighter.firstName} uses a healing item! Restored 30 HP.`}}function Ue(n){for(const r of["player","enemy"]){const e=n[r];e.currentStamina=Math.min(e.fighter.currentStats.maxStamina,e.currentStamina+10);for(const[t,a]of e.activeEffects)t==="bleed"&&(e.currentHP-=5,n.log.push({round:n.round,actor:r,action:"light_attack",result:{success:!0,damage:5,damageBlocked:0,targetZone:"body",critical:!1,perfectParry:!1,counterDamage:0,statusApplied:null,staminaCost:0,focusGained:0,focusSpent:0,hypeGained:0,message:`${e.fighter.firstName} bleeds for 5 damage!`},timestamp:Date.now()})),a<=1?e.activeEffects.delete(t):e.activeEffects.set(t,a-1);e.lastAction!=="guard"&&(e.guardStance=null,e.consecutiveGuards=0)}}function te(n){Ue(n),n.turn=n.turn==="player"?"enemy":"player",n.turn==="player"&&n.round++,n.phase="select_action",n.isParryWindow=!1}function qe(n,r){const e=n.injuryMeter/200;if(g.chance(e)){const t=n.injuryMeter>80?"severe":n.injuryMeter>40?"moderate":"minor";return ze(t)}return null}function ze(n){const r=Ge.filter(t=>t.severity===n);return{...g.pick(r),id:`injury_${g.id(8)}`}}function Ve(n,r,e){const t=e==="bronze"?1:e==="silver"?1.5:2,a=1+n.crowdHype/100*.5,i=20+n.round*5,s=10+n.round*2,o=25+n.round*5;return{gold:Math.round(i*t*a),fame:Math.round(s*t*a),xp:Math.round(o*t)}}const Ke=[{first:"Brutus",last:"Ironjaw"},{first:"Gaius",last:"Bloodhand"},{first:"Marcus",last:"the Cruel"},{first:"Varro",last:"Steelarm"},{first:"Crixus",last:"the Shadow"},{first:"Spartus",last:"Bonecrusher"},{first:"Drago",last:"the Silent"},{first:"Thorin",last:"Skullsplitter"},{first:"Ragnar",last:"the Red"},{first:"Ulric",last:"Deathbringer"},{first:"Kira",last:"Swiftblade"},{first:"Valeria",last:"the Viper"},{first:"Helena",last:"Ironmaiden"},{first:"Freya",last:"Frostbite"},{first:"Sigrid",last:"the Storm"},{first:"Malik",last:"the Merciless"},{first:"Cyrus",last:"Sandstorm"},{first:"Ajax",last:"the Giant"},{first:"Nero",last:"Blackheart"},{first:"Lucius",last:"Goldmask"},{first:"Gorm",last:"the Grim"},{first:"Fenris",last:"Wolfjaw"},{first:"Balthus",last:"the Beast"},{first:"Corvus",last:"Ravenwing"}],se=[{id:"brute",name:"Brute Force",title:"The Brute",aiType:"brutal",statMultipliers:{maxHP:1.2,attack:1.3,defense:.9,speed:.8},specialAbility:"Heavy blows deal +20% damage",flavorText:"Raw strength and aggression. No finesse, just power.",taunts:["I'll crush your skull!","Weakling! Face a real warrior!","Your bones will crack like twigs!","This ends now!"]},{id:"duelist",name:"Precise Strikes",title:"The Duelist",aiType:"tactical",statMultipliers:{attack:1,defense:1,speed:1.2,accuracy:1.15},specialAbility:"+15% critical chance",flavorText:"Elegant and deadly. Every move calculated.",taunts:["You fight like a farmer.","Too slow. Much too slow.","I've faced better.","Shall we dance?"]},{id:"tank",name:"Iron Wall",title:"The Wall",aiType:"defensive",statMultipliers:{maxHP:1.4,defense:1.4,attack:.8,speed:.7},specialAbility:"+30% block effectiveness",flavorText:"Immovable and patient. Waits for you to tire.",taunts:["Your attacks mean nothing.","I could do this all day.","Tired yet?","I am the wall."]},{id:"assassin",name:"Shadow Strike",title:"The Assassin",aiType:"trickster",statMultipliers:{maxHP:.8,attack:1.1,speed:1.4,evasion:1.3},specialAbility:"+25% dodge chance",flavorText:"Fast and elusive. Strikes from unexpected angles.",taunts:["You can't hit what you can't see.","Too predictable.","Catch me if you can.","Already behind you."]},{id:"berserker",name:"Blood Rage",title:"The Berserker",aiType:"berserker",statMultipliers:{maxHP:1.1,attack:1.2,defense:.7,maxStamina:1.2},specialAbility:"+30% damage when below 50% HP",flavorText:"Grows more dangerous as the fight progresses.",taunts:["BLOOD! MORE BLOOD!","PAIN MAKES ME STRONGER!","RAAAAAAGH!","I CANNOT BE STOPPED!"]},{id:"veteran",name:"Battle Wisdom",title:"The Veteran",aiType:"balanced",statMultipliers:{maxHP:1.1,attack:1.1,defense:1.1,accuracy:1.1},specialAbility:"No weaknesses",flavorText:"Years of experience. Knows every trick in the book.",taunts:["I've seen it all before.","Youth and enthusiasm, meet old age and treachery.","Still learning, I see.","Not bad. But not good enough."]},{id:"showman",name:"Crowd Favorite",title:"The Showman",aiType:"aggressive",statMultipliers:{maxHP:1,attack:1.15,speed:1.1},specialAbility:"+50% crowd hype gain",flavorText:"Fights for glory and applause.",taunts:["Watch closely, crowd!","Let me show you how it's done!","Are you not entertained?!","Remember this moment!"]},{id:"executioner",name:"Final Blow",title:"The Executioner",aiType:"brutal",statMultipliers:{maxHP:1.15,attack:1.25,accuracy:1.1,speed:.9},specialAbility:"+50% damage to enemies below 25% HP",flavorText:"Specializes in finishing wounded opponents.",taunts:["Your end approaches.","I smell your fear.","Time to finish this.","Accept your fate."]}];function Xe(n,r){const e=g.pick(se),t=g.pick(Ke),a={bronze:1,silver:1.3,gold:1.6,champion:2}[n],i=Math.min(r*2,20),s={maxHP:Math.round((80+i)*a*(e.statMultipliers.maxHP||1)),currentHP:0,maxStamina:Math.round((80+i*.5)*(e.statMultipliers.maxStamina||1)),currentStamina:0,maxFocus:Math.round(60*(e.statMultipliers.maxFocus||1)),currentFocus:0,attack:Math.round((10+i*.3)*a*(e.statMultipliers.attack||1)),defense:Math.round((8+i*.2)*a*(e.statMultipliers.defense||1)),speed:Math.round((8+i*.2)*(e.statMultipliers.speed||1)),accuracy:Math.round(75+i*.5),evasion:Math.round(10+i*.3),critChance:10,critDamage:150};return s.currentHP=s.maxHP,s.currentStamina=s.maxStamina,{id:`enemy_${g.id(8)}`,firstName:t.first,lastName:t.last,nickname:e.title,fullName:`${t.first} '${e.title}' ${t.last}`,age:g.int(20,50),birthplace:"Unknown",backstory:e.flavorText,personality:Qe(e.aiType),baseStats:s,currentStats:{...s},equipment:{weapon:null,armor:null,accessory:null},keepsake:{id:"enemy_keepsake",name:"Fighter's Token",backstory:"A simple token.",effect:"None",statBonus:{},upgraded:!1},inventory:[],signatureTrait:{id:e.id,name:e.name,description:e.specialAbility||"No special ability",type:"neutral",effect:e.specialAbility||""},traits:[],flaws:[],portrait:ie(),level:Math.ceil(r/2),experience:0,wins:g.int(0,r*2),losses:g.int(0,r),kills:g.int(0,r),status:"healthy",injuries:[],scars:[],activeEffects:[],trust:0,trustLevel:"stranger",totalDamageDealt:0,totalDamageTaken:0,perfectParries:0,signatureMoveUses:0,closestCall:s.maxHP,bestWin:"",lettersWritten:[],weeksSurvived:r}}function Qe(n){return{aggressive:"aggressive",defensive:"stoic",trickster:"cunning",brutal:"aggressive",balanced:"stoic",cautious:"fearful",berserker:"aggressive",tactical:"cunning"}[n]}function Je(n,r){const e=n.enemy,t=n.player,a=e.currentStamina>=25,i=e.currentFocus>=30&&e.currentStamina>=20,s=e.currentStamina>=15,o=e.currentHP/e.fighter.currentStats.maxHP,c=t.currentHP/t.fighter.currentStats.maxHP;let l,h;switch(r){case"aggressive":l=Ze(a,i),h=g.chance(.4)?"head":g.chance(.5)?"body":"legs";break;case"defensive":l=et(s,o,t.lastAction),h=t.guardStance?V(t.guardStance):"body";break;case"trickster":l=tt(s,i,n),h=it(t);break;case"brutal":l=at(a,i),h="head";break;case"balanced":l=st(a,i,s),h=g.pick(["head","body","legs"]);break;case"cautious":l=rt(s,o,c),h="body";break;case"berserker":l=nt(a,i,o),h=g.chance(.6)?"head":"body";break;case"tactical":l=ot(n,a,i,s),h=ct(t);break;default:l="light_attack",h="body"}return{action:l,targetZone:h}}function Ze(n,r,e){return r&&g.chance(.3)?"special":n&&g.chance(.5)?"heavy_attack":"light_attack"}function et(n,r,e){return r<.3&&g.chance(.6)?"guard":e==="heavy_attack"&&n?g.chance(.5)?"dodge":"guard":g.chance(.3)?"guard":n&&g.chance(.2)?"dodge":"light_attack"}function tt(n,r,e){return n&&e.player.lastAction==="heavy_attack"?"dodge":r&&g.chance(.4)?"special":g.chance(.3)?"dodge":"light_attack"}function it(n){return n.guardStance?V(n.guardStance):g.pick(["head","body","legs"])}function at(n,r){return r&&g.chance(.4)?"special":n?"heavy_attack":"light_attack"}function st(n,r,e,t){const a=g.random();return r&&a<.15?"special":n&&a<.35?"heavy_attack":a<.45?"guard":e&&a<.55?"dodge":"light_attack"}function rt(n,r,e){if(r<.4)return g.chance(.5)?"guard":n?"dodge":"guard";if(e<.3)return g.chance(.6)?"light_attack":"heavy_attack";const t=g.random();return t<.3?"guard":n&&t<.4?"dodge":"light_attack"}function nt(n,r,e){const t=(1-e)*.3;return r&&g.chance(.3+t)?"special":n&&g.chance(.6+t)?"heavy_attack":"light_attack"}function ot(n,r,e,t){const a=n.player,i=n.enemy;return a.consecutiveGuards>=2&&e?"special":a.lastAction==="heavy_attack"&&t?"dodge":i.currentFocus>=50&&e?"special":(a.currentStamina<20,r?"heavy_attack":"light_attack")}function ct(n){return n.activeEffects.has("cripple")?"legs":n.activeEffects.has("concuss")?"head":n.guardStance?V(n.guardStance):g.pick(["head","body","legs"])}function V(n){const e=["head","body","legs"].filter(t=>t!==n);return g.pick(e)}function lt(n){const r=se.find(e=>e.id===n.signatureTrait.id);return r!=null&&r.taunts?g.pick(r.taunts):"You'll fall like the rest."}class dt extends w.Scene{constructor(){super({key:"FightScene"});d(this,"combatState");d(this,"player");d(this,"enemy");d(this,"selectedAction",null);d(this,"selectedZone","body");d(this,"playerHealthBar");d(this,"enemyHealthBar");d(this,"playerStaminaBar");d(this,"playerFocusBar");d(this,"combatLog");d(this,"actionButtons");d(this,"zoneButtons");d(this,"hypeBar")}create(){const e=m.getRun();if(!e.fighter){this.scene.start("MainMenuScene");return}this.player=e.fighter,this.enemy=Xe(e.league,e.week),this.combatState=Le(this.player,this.enemy),this.createBackground(),this.createArenaView(),this.createCombatUI(),this.createActionPanel();const t=lt(this.enemy);this.showCombatMessage(t,2e3),this.cameras.main.fadeIn(300)}createBackground(){const{width:e,height:t}=this.cameras.main,a=this.add.graphics();if(a.fillGradientStyle(2760474,2760474,1709072,1709072),a.fillRect(0,0,e,t),a.fillStyle(3813146,1),a.fillRect(0,t*.5,e,t*.5),this.textures.exists("arena_overlay")){const i=this.add.image(e/2,t/2,"arena_overlay");i.setAlpha(.3),i.setDisplaySize(e,t)}if(this.textures.exists("vignette")){const i=this.add.image(e/2,t/2,"vignette");i.setDisplaySize(e,t),i.setAlpha(.6)}}createArenaView(){const{width:e,height:t}=this.cameras.main;E.renderPortrait(this,this.player.portrait,80,200,80),this.add.text(80,250,this.player.firstName,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#c9a959"}).setOrigin(.5),E.renderPortrait(this,this.enemy.portrait,e-80,200,80),this.add.text(e-80,250,this.enemy.firstName,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#8b4513"}).setOrigin(.5),this.add.text(e-80,268,`"${this.enemy.nickname}"`,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#5a4a3a",fontStyle:"italic"}).setOrigin(.5),this.add.text(e/2,200,"VS",{fontFamily:"Georgia, serif",fontSize:"24px",color:"#8b0000",stroke:"#000000",strokeThickness:3}).setOrigin(.5)}createCombatUI(){const{width:e,height:t}=this.cameras.main;this.add.text(e/2,30,`ROUND ${this.combatState.round}`,{fontFamily:"Georgia, serif",fontSize:"16px",color:"#c9a959"}).setOrigin(.5),this.createHealthBar(30,60,150,20,!0),this.createStaminaBar(30,85,120,12),this.createFocusBar(30,102,100,10),this.createHealthBar(e-180,60,150,20,!1),this.createHypeBar(e/2-75,55,150,12),this.combatLog=this.add.text(e/2,310,"",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#c9a959",wordWrap:{width:300},align:"center"}).setOrigin(.5)}createHealthBar(e,t,a,i,s){const o=this.add.graphics();o.fillStyle(2760474,1),o.fillRoundedRect(e,t,a,i,4),o.lineStyle(1,5917242,1),o.strokeRoundedRect(e,t,a,i,4);const c=this.add.graphics();s?this.playerHealthBar=c:this.enemyHealthBar=c,this.updateHealthBar(c,e,t,a,i,s),this.add.text(e,t-15,s?"HP":"Enemy HP",{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355"})}updateHealthBar(e,t,a,i,s,o){const c=o?this.combatState.player:this.combatState.enemy,l=c.currentHP/c.fighter.currentStats.maxHP;e.clear();const h=l>.5?2263842:l>.25?14329120:9109504;e.fillStyle(h,1),e.fillRoundedRect(t+2,a+2,(i-4)*Math.max(0,l),s-4,3)}createStaminaBar(e,t,a,i){const s=this.add.graphics();s.fillStyle(2760474,1),s.fillRoundedRect(e,t,a,i,3),this.playerStaminaBar=this.add.graphics(),this.updateStaminaBar(e,t,a,i),this.add.text(e,t-12,"STA",{fontFamily:"Georgia, serif",fontSize:"9px",color:"#8b7355"})}updateStaminaBar(e,t,a,i){const s=this.combatState.player.currentStamina/this.player.currentStats.maxStamina;this.playerStaminaBar.clear(),this.playerStaminaBar.fillStyle(4620980,1),this.playerStaminaBar.fillRoundedRect(e+1,t+1,(a-2)*Math.max(0,s),i-2,2)}createFocusBar(e,t,a,i){const s=this.add.graphics();s.fillStyle(2760474,1),s.fillRoundedRect(e,t,a,i,3),this.playerFocusBar=this.add.graphics(),this.updateFocusBar(e,t,a,i),this.add.text(e,t-12,"FOCUS",{fontFamily:"Georgia, serif",fontSize:"9px",color:"#8b7355"})}updateFocusBar(e,t,a,i){const s=this.combatState.player.currentFocus/this.player.currentStats.maxFocus;this.playerFocusBar.clear(),this.playerFocusBar.fillStyle(10040012,1),this.playerFocusBar.fillRoundedRect(e+1,t+1,(a-2)*Math.max(0,s),i-2,2)}createHypeBar(e,t,a,i){const s=this.add.graphics();s.fillStyle(2760474,1),s.fillRoundedRect(e,t,a,i,3),this.hypeBar=this.add.graphics(),this.updateHypeBar(e,t,a,i),this.add.text(e+a/2,t-12,"CROWD HYPE",{fontFamily:"Georgia, serif",fontSize:"9px",color:"#8b7355"}).setOrigin(.5)}updateHypeBar(e,t,a,i){const s=this.combatState.crowdHype/100;this.hypeBar.clear(),this.hypeBar.fillStyle(16766720,1),this.hypeBar.fillRoundedRect(e+1,t+1,(a-2)*s,i-2,2)}createActionPanel(){const{width:e,height:t}=this.cameras.main;this.zoneButtons=this.add.container(e/2,370),this.createZoneButtons(),this.actionButtons=this.add.container(e/2,520),this.createActionButtons()}createZoneButtons(){const e=["head","body","legs"],t={head:"🎯 HEAD",body:"🎯 BODY",legs:"🎯 LEGS"},a=95;e.forEach((i,s)=>{const o=(s-1)*a,c=b.createButton(this,o,0,t[i],()=>this.selectZone(i),{width:85,height:35,fontSize:"11px"});c.setData("zone",i),this.zoneButtons.add(c)}),this.highlightZone("body")}selectZone(e){this.selectedZone=e,this.highlightZone(e)}highlightZone(e){this.zoneButtons.each(t=>{const a=t,i=a.first,s=a.getData("zone")===e;i==null||i.clear(),i==null||i.fillStyle(s?5917242:2760474,1),i==null||i.fillRoundedRect(-42.5,-17.5,85,35,6),i==null||i.lineStyle(2,s?13216089:5917242,1),i==null||i.strokeRoundedRect(-42.5,-17.5,85,35,6)})}createActionButtons(){const e=[{action:"light_attack",label:"⚔️ LIGHT",stamina:10},{action:"heavy_attack",label:"💥 HEAVY",stamina:25},{action:"guard",label:"🛡️ GUARD",stamina:5},{action:"dodge",label:"💨 DODGE",stamina:15},{action:"special",label:"✨ SPECIAL",stamina:20},{action:"item",label:"🧪 ITEM",stamina:0}],t=3,a=100,i=50,s=110,o=60;e.forEach((c,l)=>{const h=l%t,u=Math.floor(l/t),p=(h-1)*s,y=u*o,S=b.createButton(this,p,y,c.label,()=>this.performAction(c.action),{width:a,height:i,fontSize:"12px"});this.actionButtons.add(S)})}performAction(e){if(this.combatState.turn!=="player"||this.combatState.phase==="end")return;const t={light_attack:10,heavy_attack:25,guard:5,dodge:15,special:20,item:0};if(this.combatState.player.currentStamina<t[e]){this.showCombatMessage("Not enough stamina!",1e3);return}if(e==="special"&&this.combatState.player.currentFocus<30){this.showCombatMessage("Not enough focus!",1e3);return}const a=ee(this.combatState,"player",e,this.selectedZone);if(this.showCombatMessage(a.message,1500),this.updateAllBars(),this.combatState.winner){this.endCombat();return}this.disableInput(),this.time.delayedCall(1500,()=>{this.performEnemyTurn()})}performEnemyTurn(){if(this.combatState.winner)return;te(this.combatState);const e=this.enemy.signatureTrait.id||"balanced",{action:t,targetZone:a}=Je(this.combatState,e),i=ee(this.combatState,"enemy",t,a);if(this.showCombatMessage(i.message,1500),this.updateAllBars(),i.damage>20&&this.shakeScreen(),this.combatState.winner){this.endCombat();return}this.time.delayedCall(1500,()=>{te(this.combatState),this.updateRoundDisplay(),this.enableInput()})}updateAllBars(){const{width:e}=this.cameras.main;this.updateHealthBar(this.playerHealthBar,30,60,150,20,!0),this.updateHealthBar(this.enemyHealthBar,e-180,60,150,20,!1),this.updateStaminaBar(30,85,120,12),this.updateFocusBar(30,102,100,10),this.updateHypeBar(e/2-75,55,150,12)}updateRoundDisplay(){}showCombatMessage(e,t){this.combatLog.setText(e),this.tweens.add({targets:this.combatLog,alpha:{from:1,to:.7},duration:100,yoyo:!0})}shakeScreen(){m.getSettings().screenShake&&this.cameras.main.shake(200,.01)}disableInput(){this.actionButtons.setAlpha(.5),this.zoneButtons.setAlpha(.5)}enableInput(){this.actionButtons.setAlpha(1),this.zoneButtons.setAlpha(1)}endCombat(){var a;this.disableInput();const e=this.combatState.winner==="player",t=m.getRun();if(e){this.player.wins++,this.player.totalDamageDealt+=this.combatState.log.filter(o=>o.actor==="player").reduce((o,c)=>o+c.result.damage,0),this.player.weeksSurvived=t.week+1;const i=qe(this.combatState.player);i&&ye(this.player,i);const s=Ve(this.combatState,!0,t.league);m.updateRun({fighter:this.player,gold:t.gold+s.gold,fame:t.fame+s.fame,fightsInLeague:t.fightsInLeague+1}),this.time.delayedCall(2e3,()=>{this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("ResultsScene",{won:!0,rewards:s,injury:i,enemy:this.enemy})})})}else this.player.status="dead",this.player.causeOfDeath=be({damage:((a=this.combatState.lastAction)==null?void 0:a.damage)||0,location:this.selectedZone,weaponType:"blade"},this.combatState.round,this.enemy.fullName),this.player.lastWords=ke(this.player),this.player.killedBy=this.enemy.fullName,m.updateRun({fighter:this.player}),m.endRun(!1),this.player.lastWords&&this.showCombatMessage(this.player.lastWords,3e3),this.time.delayedCall(3e3,()=>{this.cameras.main.fadeOut(500),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("DeathScene")})})}}class ht extends w.Scene{constructor(){super({key:"ResultsScene"});d(this,"resultsData")}init(e){this.resultsData=e}create(){const{width:e,height:t}=this.cameras.main;if(this.createBackground(),this.createResultsDisplay(),this.createRewardsDisplay(),this.createContinueButton(),this.resultsData.won){const a=m.getRun();a.fighter&&(F(a.fighter,5),m.updateRun({fighter:a.fighter}))}this.checkLeagueAdvancement(),this.cameras.main.fadeIn(300)}createBackground(){const{width:e,height:t}=this.cameras.main,a=this.add.graphics();a.fillGradientStyle(1709072,1709072,2760474,2760474),a.fillRect(0,0,e,t)}createResultsDisplay(){const{width:e}=this.cameras.main,t=this.resultsData.won?"VICTORY!":"DEFEAT",a=this.resultsData.won?"#c9a959":"#8b0000";this.add.text(e/2,80,t,{fontFamily:"Georgia, serif",fontSize:"36px",color:a,stroke:"#000000",strokeThickness:4}).setOrigin(.5),this.resultsData.won&&this.add.text(e/2,130,`${this.resultsData.enemy.fullName} has fallen!`,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#8b7355",fontStyle:"italic"}).setOrigin(.5),this.resultsData.injury&&(this.add.text(e/2,160,`⚠️ INJURY: ${this.resultsData.injury.name}`,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#8b4513"}).setOrigin(.5),this.add.text(e/2,180,this.resultsData.injury.effect,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#5a4a3a"}).setOrigin(.5))}createRewardsDisplay(){const{width:e}=this.cameras.main,t=230;this.add.text(e/2,t,"═══ REWARDS ═══",{fontFamily:"Georgia, serif",fontSize:"16px",color:"#c9a959"}).setOrigin(.5);const a=this.add.text(e/2,t+40,`💰 ${this.resultsData.rewards.gold} Gold`,{fontFamily:"Georgia, serif",fontSize:"18px",color:"#ffd700"}).setOrigin(.5),i=this.add.text(e/2,t+70,`⭐ ${this.resultsData.rewards.fame} Fame`,{fontFamily:"Georgia, serif",fontSize:"16px",color:"#c0c0c0"}).setOrigin(.5),s=this.add.text(e/2,t+100,`📈 ${this.resultsData.rewards.xp} XP`,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#8b7355"}).setOrigin(.5);[a,i,s].forEach((o,c)=>{o.setAlpha(0),this.tweens.add({targets:o,alpha:1,y:o.y-10,duration:300,delay:200+c*200,ease:"Back.out"})})}checkLeagueAdvancement(){const e=m.getRun(),{width:t}=this.cameras.main;if(e.fightsInLeague>=e.fightsToNextLeague){const i={bronze:"silver",silver:"gold",gold:"champion"}[e.league];i&&(this.time.delayedCall(1e3,()=>{const s=this.add.text(t/2,400,`🏆 ADVANCED TO ${i.toUpperCase()} LEAGUE!`,{fontFamily:"Georgia, serif",fontSize:"18px",color:"#ffd700",stroke:"#000000",strokeThickness:2}).setOrigin(.5).setAlpha(0);this.tweens.add({targets:s,alpha:1,scale:{from:.5,to:1},duration:500,ease:"Back.out"})}),m.updateRun({league:i,fightsInLeague:0,fightsToNextLeague:i==="champion"?1:3}),m.addBloodlinePoints(5),m.addPromoterXP(25))}}createContinueButton(){const{width:e,height:t}=this.cameras.main;b.createButton(this,e/2,t-80,"CONTINUE",()=>this.continue(),{width:200,height:50,primary:!0})}continue(){this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("CampScene")})}}class ut extends w.Scene{constructor(){super({key:"DeathScene"});d(this,"fighter");d(this,"legendEntry");d(this,"playerNote","")}create(){const e=m.getRun();if(!e.fighter){this.scene.start("MainMenuScene");return}this.fighter=e.fighter,this.legendEntry=ve(this.fighter,"dead",e.league,e.promise||"none",!1),this.createBackground(),this.createMemorial(),this.createNoteInput(),this.createButtons(),this.cameras.main.fadeIn(1e3,0,0,0)}createBackground(){const{width:e,height:t}=this.cameras.main,a=this.add.graphics();if(a.fillGradientStyle(657414,657414,1709072,1709072),a.fillRect(0,0,e,t),this.textures.exists("vignette")){const i=this.add.image(e/2,t/2,"vignette");i.setDisplaySize(e,t),i.setAlpha(.8)}}createMemorial(){const{width:e,height:t}=this.cameras.main,a=e/2,i=320,s=500,o=a-i/2,c=40,l=this.add.graphics();l.fillStyle(1709072,.9),l.fillRoundedRect(o,c,i,s,12),l.lineStyle(3,5917242,1),l.strokeRoundedRect(o,c,i,s,12),l.lineStyle(1,3811866,.5),l.strokeRoundedRect(o+8,c+8,i-16,s-16,8),this.add.text(a,c+30,"IN MEMORIAM",{fontFamily:"Georgia, serif",fontSize:"18px",color:"#c9a959",letterSpacing:4}).setOrigin(.5);const h=c+100;E.renderPortrait(this,this.fighter.portrait,a,h,80),this.add.text(a,h+60,this.fighter.fullName,{fontFamily:"Georgia, serif",fontSize:"16px",color:"#c9a959"}).setOrigin(.5),this.add.text(a,h+82,`${this.fighter.age} winters • ${this.fighter.birthplace}`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b7355"}).setOrigin(.5),this.fighter.causeOfDeath&&this.add.text(a,h+115,this.fighter.causeOfDeath,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b4513",fontStyle:"italic",wordWrap:{width:280},align:"center"}).setOrigin(.5),this.fighter.lastWords&&this.add.text(a,h+160,`"${this.fighter.lastWords}"`,{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b7355",fontStyle:"italic"}).setOrigin(.5);const u=h+200;this.add.text(a,u,"─── LEGACY ───",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#5a4a3a"}).setOrigin(.5),[`Victories: ${this.fighter.wins}`,`Weeks Survived: ${this.fighter.weeksSurvived}`,`Signature Moves: ${this.fighter.signatureMoveUses}`,`Perfect Parries: ${this.fighter.perfectParries}`,`Closest Call: ${this.fighter.closestCall} HP`].forEach((k,T)=>{this.add.text(a,u+25+T*18,k,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b7355"}).setOrigin(.5)}),m.getRun();const y=u+120;this.add.text(a,y,"⚔️ Promise Broken",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b4513"}).setOrigin(.5),this.add.text(a,y+25,`📿 ${this.fighter.keepsake.name} - Recovered`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#6b8e23"}).setOrigin(.5)}createNoteInput(){const{width:e,height:t}=this.cameras.main;this.add.text(e/2,570,"Leave a note for the fallen:",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b7355"}).setOrigin(.5);const a=this.add.graphics();a.fillStyle(2760474,1),a.fillRoundedRect(e/2-140,585,280,60,6),a.lineStyle(1,5917242,1),a.strokeRoundedRect(e/2-140,585,280,60,6);const i=this.add.text(e/2,615,"Tap to add note...",{fontFamily:"Georgia, serif",fontSize:"11px",color:"#5a4a3a",fontStyle:"italic"}).setOrigin(.5);a.setInteractive(new w.Geom.Rectangle(e/2-140,585,280,60),w.Geom.Rectangle.Contains),a.on("pointerdown",()=>{const s=prompt("Write a note for the fallen:");if(s){this.playerNote=s,this.legendEntry.playerNote=s,i.setText(s.substring(0,40)+(s.length>40?"...":"")),i.setColor("#c9a959"),i.setFontStyle("normal");const o=m.getHallOfLegends(),c=o.find(l=>l.id===this.legendEntry.id);c&&(c.playerNote=s,m.updateMeta({hallOfLegends:o}))}})}createButtons(){const{width:e,height:t}=this.cameras.main;b.createButton(this,e/2,t-60,"RETURN TO MENU",()=>this.returnToMenu(),{width:200,height:50,primary:!0})}returnToMenu(){this.cameras.main.fadeOut(500,0,0,0),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("MainMenuScene")})}}class ft extends w.Scene{constructor(){super({key:"HallOfLegendsScene"});d(this,"legends",[]);d(this,"scrollOffset",0);d(this,"selectedLegend",null);d(this,"detailsContainer")}create(){this.legends=m.getHallOfLegends(),this.createBackground(),this.createHeader(),this.createLegendList(),this.createDetailsPanel(),this.createBackButton(),this.cameras.main.fadeIn(300)}createBackground(){const{width:e,height:t}=this.cameras.main,a=this.add.graphics();if(a.fillGradientStyle(657414,657414,1709072,1709072),a.fillRect(0,0,e,t),this.textures.exists("parchment_overlay")){const i=this.add.image(e/2,t/2,"parchment_overlay");i.setAlpha(.05),i.setDisplaySize(e,t)}}createHeader(){const{width:e}=this.cameras.main;this.add.text(e/2,35,"HALL OF LEGENDS",{fontFamily:"Georgia, serif",fontSize:"24px",color:"#c9a959",stroke:"#000000",strokeThickness:3}).setOrigin(.5),this.add.text(e/2,65,"Those who fought and fell...",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b7355",fontStyle:"italic"}).setOrigin(.5);const t=this.legends.filter(s=>s.status==="dead").length,a=this.legends.filter(s=>s.status==="retired").length,i=this.legends.filter(s=>s.status==="champion").length;this.add.text(e/2,85,`☠️ ${t}  |  🏛️ ${a}  |  🏆 ${i}`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#5a4a3a"}).setOrigin(.5)}createLegendList(){const{width:e,height:t}=this.cameras.main;if(this.legends.length===0){this.add.text(e/2,200,`No legends yet...

Your fighters will be remembered here.`,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#5a4a3a",align:"center"}).setOrigin(.5);return}const a=110,i=70,s=e-40,o=[...this.legends].sort((c,l)=>l.dateAdded-c.dateAdded);o.slice(0,5).forEach((c,l)=>{this.createLegendCard(c,20,a+l*(i+10),s,i)}),o.length>5&&this.add.text(e/2,a+5*(i+10)+10,`...and ${o.length-5} more`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#5a4a3a"}).setOrigin(.5)}createLegendCard(e,t,a,i,s){var v;const o=this.add.container(t,a),c=this.add.graphics(),l=e.status==="champion"?2763280:e.status==="retired"?1714714:2759194;c.fillStyle(l,1),c.fillRoundedRect(0,0,i,s,8),c.lineStyle(1,5917242,1),c.strokeRoundedRect(0,0,i,s,8),o.add(c);const h=E.renderMiniPortrait(this,e.fighter.portrait,35,s/2,40);o.add(h);const u=this.add.text(70,12,e.fighter.fullName,{fontFamily:"Georgia, serif",fontSize:"13px",color:"#c9a959"});o.add(u);const p=e.status==="champion"?"🏆":e.status==="retired"?"🏛️":"☠️",y=this.add.text(i-15,12,p,{fontSize:"16px"}).setOrigin(1,0);o.add(y);const S=`${e.leagueReached.toUpperCase()} | ${e.wins} wins | ${e.weeksSurvived} weeks`,k=this.add.text(70,32,S,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355"});o.add(k);const T=e.status==="dead"?((v=e.causeOfDeath)==null?void 0:v.substring(0,40))+"...":e.status==="retired"?"Retired with honor":"Became Champion!",f=this.add.text(70,48,T||"",{fontFamily:"Georgia, serif",fontSize:"9px",color:"#5a4a3a",fontStyle:"italic"});o.add(f),c.setInteractive(new w.Geom.Rectangle(0,0,i,s),w.Geom.Rectangle.Contains),c.on("pointerdown",()=>this.showDetails(e)),c.on("pointerover",()=>{c.clear(),c.fillStyle(l+1118481,1),c.fillRoundedRect(0,0,i,s,8),c.lineStyle(2,13216089,1),c.strokeRoundedRect(0,0,i,s,8)}),c.on("pointerout",()=>{c.clear(),c.fillStyle(l,1),c.fillRoundedRect(0,0,i,s,8),c.lineStyle(1,5917242,1),c.strokeRoundedRect(0,0,i,s,8)})}createDetailsPanel(){const{width:e,height:t}=this.cameras.main;this.detailsContainer=this.add.container(e/2,550),this.detailsContainer.setVisible(!1);const a=this.add.graphics();a.fillStyle(1709072,.95),a.fillRoundedRect(-160,-100,320,200,10),a.lineStyle(2,13216089,1),a.strokeRoundedRect(-160,-100,320,200,10),this.detailsContainer.add(a)}showDetails(e){this.selectedLegend=e,this.detailsContainer.removeAll(!0);const t=this.add.graphics();t.fillStyle(1709072,.95),t.fillRoundedRect(-160,-100,320,200,10),t.lineStyle(2,13216089,1),t.strokeRoundedRect(-160,-100,320,200,10),this.detailsContainer.add(t);const a=this.add.text(0,-85,e.fighter.fullName,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#c9a959"}).setOrigin(.5);this.detailsContainer.add(a);const i=this.add.text(0,-65,`✨ ${e.fighter.signatureTrait}`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#6b8e23"}).setOrigin(.5);if(this.detailsContainer.add(i),e.bestWin){const o=this.add.text(0,-45,`Best Victory: ${e.bestWin}`,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355"}).setOrigin(.5);this.detailsContainer.add(o)}if(e.lettersWritten.length>0){const o=this.add.text(0,-25,`📜 ${e.lettersWritten.length} letters written`,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355"}).setOrigin(.5);this.detailsContainer.add(o)}if(e.playerNote){const o=this.add.text(0,10,`"${e.playerNote}"`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#c9a959",fontStyle:"italic",wordWrap:{width:280},align:"center"}).setOrigin(.5);this.detailsContainer.add(o)}const s=b.createButton(this,0,70,"CLOSE",()=>this.detailsContainer.setVisible(!1),{width:80,height:30,fontSize:"11px"});this.detailsContainer.add(s),this.detailsContainer.setVisible(!0)}createBackButton(){const{width:e,height:t}=this.cameras.main;b.createButton(this,e/2,t-50,"← BACK TO MENU",()=>this.returnToMenu(),{width:180,height:45})}returnToMenu(){this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("MainMenuScene")})}}class mt extends w.Scene{constructor(){super({key:"BloodlinePerksScene"});d(this,"pointsText");d(this,"selectedPerk",null);d(this,"detailsContainer");d(this,"perkContainers",new Map)}create(){this.createBackground(),this.createHeader(),this.createPerkTree(),this.createDetailsPanel(),this.createBackButton(),this.cameras.main.fadeIn(300)}createBackground(){const{width:e,height:t}=this.cameras.main,a=this.add.graphics();a.fillGradientStyle(1709072,1709072,2760474,2760474),a.fillRect(0,0,e,t)}createHeader(){const{width:e}=this.cameras.main,t=m.getMeta();this.add.text(e/2,35,"BLOODLINE PERKS",{fontFamily:"Georgia, serif",fontSize:"24px",color:"#c9a959",stroke:"#000000",strokeThickness:3}).setOrigin(.5),this.add.text(e/2,65,"Permanent upgrades for future fighters",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b7355",fontStyle:"italic"}).setOrigin(.5),this.pointsText=this.add.text(e/2,90,`⚡ ${t.bloodlinePoints} Points Available`,{fontFamily:"Georgia, serif",fontSize:"16px",color:"#ffd700"}).setOrigin(.5),this.add.text(e/2,110,`Promoter Level: ${t.promoterLevel}`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b7355"}).setOrigin(.5)}createPerkTree(){const{width:e}=this.cameras.main,t=150,a=160,i=I.filter(c=>c.tier===1),s=I.filter(c=>c.tier===2),o=I.filter(c=>c.tier===3);this.add.text(e/2,t-15,"─── TIER 1 ───",{fontFamily:"Georgia, serif",fontSize:"11px",color:"#5a4a3a"}).setOrigin(.5),this.createPerkRow(i,t,e),this.add.text(e/2,t+a-15,"─── TIER 2 ───",{fontFamily:"Georgia, serif",fontSize:"11px",color:"#5a4a3a"}).setOrigin(.5),this.createPerkRow(s,t+a,e),this.add.text(e/2,t+a*2-15,"─── TIER 3 ───",{fontFamily:"Georgia, serif",fontSize:"11px",color:"#5a4a3a"}).setOrigin(.5),this.createPerkRow(o,t+a*2,e)}createPerkRow(e,t,a){const o=a/2-(e.length-1)*75/2;e.forEach((c,l)=>{const h=o+l*75;this.createPerkNode(c,h,t,60)})}createPerkNode(e,t,a,i){const s=this.add.container(t,a);this.perkContainers.set(e.id,s);const c=m.getMeta().unlockedPerks.includes(e.id),{canPurchase:l,reason:h}=j(e.id),u=this.add.graphics(),p=c?2771498:l?2763322:2760474;u.fillStyle(p,1),u.fillRoundedRect(-i/2,-i/2,i,i,8);const y=c?7048739:l?13216089:5917242;u.lineStyle(2,y,1),u.strokeRoundedRect(-i/2,-i/2,i,i,8),s.add(u);const S=e.tier===1?"●":e.tier===2?"◆":"★",k=this.add.text(0,-i/2-10,S,{fontSize:"12px",color:c?"#6b8e23":"#5a4a3a"}).setOrigin(.5);if(s.add(k),c){const f=this.add.text(0,0,"✓",{fontSize:"24px",color:"#6b8e23"}).setOrigin(.5);s.add(f)}else{const f=this.add.text(0,8,`${e.cost}`,{fontFamily:"Georgia, serif",fontSize:"16px",color:l?"#ffd700":"#5a4a3a"}).setOrigin(.5);s.add(f)}const T=this.add.text(0,i/2+10,e.name,{fontFamily:"Georgia, serif",fontSize:"9px",color:c?"#6b8e23":"#8b7355",wordWrap:{width:70},align:"center"}).setOrigin(.5,0);s.add(T),u.setInteractive(new w.Geom.Rectangle(-i/2,-i/2,i,i),w.Geom.Rectangle.Contains),u.on("pointerdown",()=>this.selectPerk(e)),u.on("pointerover",()=>{c||(u.clear(),u.fillStyle(p+1118481,1),u.fillRoundedRect(-i/2,-i/2,i,i,8),u.lineStyle(2,13216089,1),u.strokeRoundedRect(-i/2,-i/2,i,i,8))}),u.on("pointerout",()=>{u.clear(),u.fillStyle(p,1),u.fillRoundedRect(-i/2,-i/2,i,i,8),u.lineStyle(2,y,1),u.strokeRoundedRect(-i/2,-i/2,i,i,8)})}createDetailsPanel(){const{width:e,height:t}=this.cameras.main;this.detailsContainer=this.add.container(e/2,650),this.add.text(e/2,630,"Select a perk to view details",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#5a4a3a"}).setOrigin(.5)}selectPerk(e){this.selectedPerk=e,this.updateDetailsPanel()}updateDetailsPanel(){if(!this.selectedPerk)return;const e=this.selectedPerk;this.detailsContainer.removeAll(!0);const a=m.getMeta().unlockedPerks.includes(e.id),{canPurchase:i,reason:s}=j(e.id),o=this.add.graphics();o.fillStyle(2760474,.95),o.fillRoundedRect(-160,-70,320,140,10),o.lineStyle(2,5917242,1),o.strokeRoundedRect(-160,-70,320,140,10),this.detailsContainer.add(o);const c=this.add.text(0,-55,e.name,{fontFamily:"Georgia, serif",fontSize:"16px",color:"#c9a959"}).setOrigin(.5);this.detailsContainer.add(c);const l=this.add.text(0,-30,e.description,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b7355",wordWrap:{width:280},align:"center"}).setOrigin(.5);this.detailsContainer.add(l);const h=this.add.text(0,0,`Effect: ${e.effect}`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#6b8e23"}).setOrigin(.5);if(this.detailsContainer.add(h),a){const u=this.add.text(0,25,"✓ OWNED",{fontFamily:"Georgia, serif",fontSize:"14px",color:"#6b8e23"}).setOrigin(.5);this.detailsContainer.add(u)}else if(i){const u=b.createButton(this,0,40,`BUY (${e.cost} pts)`,()=>this.purchasePerk(e),{width:120,height:35,fontSize:"12px",primary:!0});this.detailsContainer.add(u)}else{const u=this.add.text(0,25,`🔒 ${s}`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b4513"}).setOrigin(.5);this.detailsContainer.add(u)}}purchasePerk(e){if(Pe(e.id)){b.showNotification(this,`Unlocked: ${e.name}!`);const t=m.getMeta();this.pointsText.setText(`⚡ ${t.bloodlinePoints} Points Available`),this.scene.restart()}}createBackButton(){const{width:e,height:t}=this.cameras.main;b.createButton(this,e/2,t-50,"← BACK TO MENU",()=>this.returnToMenu(),{width:180,height:45})}returnToMenu(){this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("MainMenuScene")})}}class gt extends w.Scene{constructor(){super({key:"SettingsScene"});d(this,"settings");d(this,"toggleButtons",new Map)}create(){this.settings=m.getSettings(),this.createBackground(),this.createHeader(),this.createSettingsList(),this.createResetButton(),this.createBackButton(),this.cameras.main.fadeIn(300)}createBackground(){const{width:e,height:t}=this.cameras.main,a=this.add.graphics();a.fillGradientStyle(1709072,1709072,2760474,2760474),a.fillRect(0,0,e,t)}createHeader(){const{width:e}=this.cameras.main;this.add.text(e/2,40,"SETTINGS",{fontFamily:"Georgia, serif",fontSize:"28px",color:"#c9a959",stroke:"#000000",strokeThickness:3}).setOrigin(.5)}createSettingsList(){const{width:e}=this.cameras.main,t=100;this.add.text(e/2,t,"─── VISUAL ───",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#5a4a3a"}).setOrigin(.5),this.createToggle("reduceMotion","Reduce Motion","Minimize animations and particles",t+40),this.createToggle("screenShake","Screen Shake","Enable impact screen shake",t+100),this.createToggle("bloodFX","Blood Effects","Show blood during combat",t+160),this.createToggle("grainFX","Grain/Ink FX","Atmospheric visual overlay",t+220),this.add.text(e/2,t+290,"─── AUDIO ───",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#5a4a3a"}).setOrigin(.5),this.createToggle("soundEnabled","Sound Enabled","Enable all game audio",t+330),this.add.text(e/2,t+390,"(Audio features coming soon)",{fontFamily:"Georgia, serif",fontSize:"10px",color:"#5a4a3a",fontStyle:"italic"}).setOrigin(.5)}createToggle(e,t,a,i){const{width:s}=this.cameras.main;this.add.text(30,i,t,{fontFamily:"Georgia, serif",fontSize:"15px",color:"#c9a959"}),this.add.text(30,i+20,a,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#8b7355"});const o=!!this.settings[e],c=this.createToggleButton(s-80,i+10,o,l=>{this.settings[e]=l,m.updateSettings({[e]:l})});this.toggleButtons.set(e,c)}createToggleButton(e,t,a,i){const s=this.add.container(e,t);let o=a;const c=60,l=28,h=this.add.graphics(),u=()=>{h.clear(),h.fillStyle(o?3050327:3811866,1),h.fillRoundedRect(0,0,c,l,l/2),h.lineStyle(1,o?7048739:5917242,1),h.strokeRoundedRect(0,0,c,l,l/2)};u(),s.add(h);const p=l-6,y=this.add.graphics(),S=()=>{const k=o?c-p-3:3;y.clear(),y.fillStyle(o?16777215:9139029,1),y.fillCircle(k+p/2,l/2,p/2)};return S(),s.add(y),h.setInteractive(new w.Geom.Rectangle(0,0,c,l),w.Geom.Rectangle.Contains),h.on("pointerdown",()=>{o=!o,u(),S(),i(o)}),s}createResetButton(){const{width:e,height:t}=this.cameras.main;this.add.text(e/2,t-150,"─── DANGER ZONE ───",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b0000"}).setOrigin(.5);const i=b.createButton(this,e/2,t-110,"🗑️ RESET ALL DATA",()=>this.showResetConfirmation(),{width:200,height:45}).first;i.clear(),i.fillStyle(3807770,1),i.fillRoundedRect(-100,-22.5,200,45,8),i.lineStyle(2,9109504,1),i.strokeRoundedRect(-100,-22.5,200,45,8)}showResetConfirmation(){b.showConfirmDialog(this,"Reset All Data?",`This will DELETE all save data including:
• All fighters
• Hall of Legends
• Bloodline Perks
• Settings

This CANNOT be undone!`,()=>this.performReset(),()=>{},"HOLD TO CONFIRM")}performReset(){m.resetAllData(),b.showNotification(this,"All data has been reset"),this.time.delayedCall(1500,()=>{this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("MainMenuScene")})})}createBackButton(){const{width:e,height:t}=this.cameras.main;b.createButton(this,e/2,t-50,"← BACK TO MENU",()=>this.returnToMenu(),{width:180,height:45})}returnToMenu(){this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("MainMenuScene")})}}class pt extends w.Scene{constructor(){super({key:"VignetteScene"});d(this,"vignette");d(this,"fighter");d(this,"resultText")}init(e){const t=m.getRun();if(!t.fighter){this.scene.start("MainMenuScene");return}this.fighter=t.fighter,e.specificVignette?this.vignette=W.find(a=>a.id===e.specificVignette):this.vignette=this.selectRandomVignette(e.type||"camp")}selectRandomVignette(e){const t=m.getRun(),a=t.completedVignettes,i=W.filter(s=>!(s.category!==e||a.includes(s.id)||s.requirements&&(s.requirements.minWeek&&t.week<s.requirements.minWeek||s.requirements.minTrust&&this.fighter.trust<s.requirements.minTrust||s.requirements.maxTrust&&this.fighter.trust>s.requirements.maxTrust||s.requirements.hasInjury&&this.fighter.injuries.length===0)));if(i.length===0){const s=W.filter(o=>o.category===e);return g.pick(s)}return g.pick(i)}create(){this.createBackground(),this.createVignetteContent(),this.cameras.main.fadeIn(300)}createBackground(){const{width:e,height:t}=this.cameras.main,a=this.add.graphics();if(a.fillGradientStyle(1709072,1709072,2760474,2760474),a.fillRect(0,0,e,t),this.textures.exists("parchment_overlay")){const i=this.add.image(e/2,t/2,"parchment_overlay");i.setAlpha(.1),i.setDisplaySize(e,t)}}createVignetteContent(){const{width:e,height:t}=this.cameras.main;this.add.text(e/2,50,this.vignette.title,{fontFamily:"Georgia, serif",fontSize:"22px",color:"#c9a959",stroke:"#000000",strokeThickness:2}).setOrigin(.5);const a={camp:"🏕️",offer:"💀",letter:"✉️",event:"❓"};this.add.text(e/2,80,a[this.vignette.category]||"📜",{fontSize:"20px"}).setOrigin(.5),this.add.text(e/2,150,this.vignette.description,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#c9a959",wordWrap:{width:320},align:"center",lineSpacing:6}).setOrigin(.5);const i=280,s=90;this.vignette.choices.forEach((o,c)=>{this.createChoiceButton(o,e/2,i+c*s)}),this.resultText=this.add.text(e/2,t-150,"",{fontFamily:"Georgia, serif",fontSize:"13px",color:"#8b7355",fontStyle:"italic",wordWrap:{width:320},align:"center"}).setOrigin(.5)}createChoiceButton(e,t,a){const i=this.add.container(t,a),s=320,o=70,c=this.add.graphics();c.fillStyle(2760474,1),c.fillRoundedRect(-s/2,-o/2,s,o,8),c.lineStyle(2,5917242,1),c.strokeRoundedRect(-s/2,-o/2,s,o,8),i.add(c);const l=this.add.text(0,-10,e.text,{fontFamily:"Georgia, serif",fontSize:"13px",color:"#c9a959",wordWrap:{width:s-30},align:"center"}).setOrigin(.5);i.add(l);const h=[];if(e.effects.trust){const u=e.effects.trust>0?"+":"";h.push(`${u}${e.effects.trust} Trust`)}if(e.effects.gold){const u=e.effects.gold>0?"+":"";h.push(`${u}${e.effects.gold} Gold`)}if(e.effects.hp){const u=e.effects.hp>0?"+":"";h.push(`${u}${e.effects.hp} HP`)}if(e.effects.injury&&h.push(`Risk: ${e.effects.injury} injury`),e.effects.injuryHeal&&h.push(`Heal ${e.effects.injuryHeal} week(s)`),h.length>0){const u=this.add.text(0,18,h.join(" | "),{fontFamily:"Georgia, serif",fontSize:"10px",color:"#6b8e23"}).setOrigin(.5);i.add(u)}c.setInteractive(new w.Geom.Rectangle(-s/2,-o/2,s,o),w.Geom.Rectangle.Contains),c.on("pointerover",()=>{c.clear(),c.fillStyle(3813162,1),c.fillRoundedRect(-s/2,-o/2,s,o,8),c.lineStyle(2,13216089,1),c.strokeRoundedRect(-s/2,-o/2,s,o,8)}),c.on("pointerout",()=>{c.clear(),c.fillStyle(2760474,1),c.fillRoundedRect(-s/2,-o/2,s,o,8),c.lineStyle(2,5917242,1),c.strokeRoundedRect(-s/2,-o/2,s,o,8)}),c.on("pointerdown",()=>{this.selectChoice(e),i.setVisible(!1)})}selectChoice(e){const t=m.getRun();e.effects.trust&&F(this.fighter,e.effects.trust),e.effects.gold&&(t.gold+=e.effects.gold),e.effects.hp&&(this.fighter.currentStats.currentHP=Math.max(1,Math.min(this.fighter.currentStats.maxHP,this.fighter.currentStats.currentHP+e.effects.hp))),e.effects.stamina&&(this.fighter.currentStats.currentStamina=Math.max(0,Math.min(this.fighter.currentStats.maxStamina,this.fighter.currentStats.currentStamina+e.effects.stamina))),e.effects.injuryHeal&&ae(this.fighter,e.effects.injuryHeal),t.completedVignettes.includes(this.vignette.id)||t.completedVignettes.push(this.vignette.id),m.updateRun({fighter:this.fighter,gold:t.gold,completedVignettes:t.completedVignettes,lettersWritten:t.lettersWritten}),this.showResult(e.resultText)}showResult(e){const{width:t,height:a}=this.cameras.main;this.tweens.add({targets:this.children.getAll().filter(i=>i.y>200&&i.y<600),alpha:0,duration:300}),this.resultText.setText(e),this.resultText.setAlpha(0),this.tweens.add({targets:this.resultText,alpha:1,duration:500,delay:300}),this.time.delayedCall(800,()=>{b.createButton(this,t/2,a-70,"CONTINUE",()=>this.returnToCamp(),{width:180,height:45,primary:!0})})}returnToCamp(){this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("CampScene")})}}const yt=[{id:"letter_home",type:"home",name:"Letter Home",icon:"🏠",description:"Write to family or loved ones. Brings comfort and strengthens resolve.",recipient:"your family",guaranteedEffects:[{type:"trust",value:10,description:"+10 Trust"},{type:"resolve",value:15,description:"+15 Resolve (reduces fear effects)"},{type:"letter_stamp",value:1,description:"+1 Letter Stamp"}],positiveChance:.4,positiveEffect:{type:"hp",value:15,description:"The act of writing brings peace. +15 HP"},negativeChance:.1,negativeEffect:{type:"trust",value:-5,description:"Memories bring sadness. -5 Trust"},letterSnippets:["I hope this letter finds you well. The arena is harsh, but I think of you often.","The crowd cheers, but it's your faces I see when I fight.","They call me {nickname} now. I wonder if you'd recognize me.","I've made friends here. And enemies. But I survive.","The gold I've sent should help with the farm. There will be more.","I dream of home. Of the smell of bread. Of peace.","Tell the children I'm fighting for their future.","I've seen death here. It makes me appreciate life more."],closingLines:["With love, {name}","Until we meet again, {name}","Your devoted {name}","Forever yours, {name}"],milestoneRewards:[{count:3,reward:{type:"ability",id:"rally_cry",name:"Rally Cry",description:"Once per fight, read your letter to gain +20 Focus instantly"}},{count:7,reward:{type:"keepsake_upgrade",id:"family_blessing",name:"Family Blessing",description:"Your keepsake now also grants +5% HP regeneration between fights"}},{count:12,reward:{type:"cosmetic",id:"home_banner",name:"Home Banner",description:"A banner with your family crest flies in the arena"}}]},{id:"letter_patron",type:"patron",name:"Letter to a Patron",icon:"💰",description:"Request support from a wealthy sponsor. Risky but lucrative.",recipient:"a wealthy patron",guaranteedEffects:[{type:"gold",value:30,description:"+30 Gold immediately"},{type:"letter_stamp",value:1,description:"+1 Letter Stamp"}],positiveChance:.5,positiveEffect:{type:"gold",value:50,description:"Your patron sends extra! +50 Gold"},negativeChance:.25,negativeEffect:{type:"debt",value:40,description:"You now owe them. Debt: 40 gold from next 2 victories"},letterSnippets:["Honorable Patron, your investment in me has not been misplaced.","I write seeking your continued support in the arena.","My victories bring glory to your name as well as mine.","The crowds chant {nickname}. Soon they'll know who backs me.","With better equipment, I could win you greater fame.","I've proven my worth. Now I ask for your faith.","My enemies grow stronger. I need stronger steel to match.","Every coin you invest returns tenfold in glory."],closingLines:["Your humble servant, {name}","In your debt, {name}","Gratefully, {name}","Your champion, {name}"],milestoneRewards:[{count:3,reward:{type:"perk_point",id:"patron_connection",name:"Patron Connection",description:"+1 Bloodline Point and permanent 5% shop discount"}},{count:7,reward:{type:"ability",id:"emergency_funds",name:"Emergency Funds",description:"Once per run, receive 100 gold in desperate times"}},{count:12,reward:{type:"cosmetic",id:"patron_sigil",name:"Patron's Sigil",description:"A golden sigil marks your equipment"}}]},{id:"letter_rival",type:"rival",name:"Letter to a Rival",icon:"⚔️",description:"Taunt your rival or attempt diplomacy. High risk, high reward.",recipient:"your rival",guaranteedEffects:[{type:"hype",value:10,description:"+10 Crowd Hype (carries to next fight)"},{type:"letter_stamp",value:1,description:"+1 Letter Stamp"}],positiveChance:.45,positiveEffect:{type:"enemy_debuff",value:15,description:"Your rival is rattled! -15% accuracy next encounter"},negativeChance:.3,negativeEffect:{type:"buff",value:-1,description:"They use your words against you. Rival gains +10% damage next fight"},letterSnippets:["I know you're watching. Good. Watch me win.","We both know how this ends. In blood. Probably yours.","Perhaps we are not so different, you and I.","Your technique is good. But mine is better.","I've studied your fights. I see your weaknesses.","The crowd will cheer when we finally meet.","May the better fighter win. That would be me.","You think you're special? I've beaten better."],closingLines:["See you in the sand, {name}","Until we dance, {name}","Your future conqueror, {name}","With grudging respect, {name}"],milestoneRewards:[{count:3,reward:{type:"ability",id:"psychological_warfare",name:"Psychological Warfare",description:"Start fights against rivals with +15 Focus"}},{count:7,reward:{type:"perk_point",id:"rival_hunter",name:"Rival Hunter",description:"+25% gold and fame from defeating rivals"}},{count:12,reward:{type:"archetype_hint",id:"duelist_unlock",name:"Duelist's Path",description:"Progress toward unlocking the Street Duelist archetype"}}]},{id:"letter_chaplain",type:"chaplain",name:"Letter to the Chaplain",icon:"✝️",description:"Seek spiritual guidance and healing. Pure benefits but costly.",recipient:"the arena chaplain",guaranteedEffects:[{type:"hp",value:20,description:"+20 HP healing"},{type:"status_cure",value:1,description:"Cure Fear and Concussion"},{type:"letter_stamp",value:1,description:"+1 Letter Stamp"}],positiveChance:.35,positiveEffect:{type:"injury_heal",value:1,description:"Blessed recovery! Heal 1 injury week"},negativeChance:.2,negativeEffect:{type:"gold",value:-25,description:"The chaplain requests a donation. -25 Gold"},letterSnippets:["Father, I seek your blessing before my next trial.","I confess my sins and ask for absolution.","The arena tests my faith. Help me stay true.","I've done terrible things. Can I still be forgiven?","Pray for me, Father. The enemy is strong.","I fight not for glory, but for those I love.","Grant me your blessing, that I might survive.","In this world of blood, I seek something pure."],closingLines:["In faith, {name}","Your humble penitent, {name}","Seeking grace, {name}","Bless me, {name}"],milestoneRewards:[{count:3,reward:{type:"ability",id:"divine_protection",name:"Divine Protection",description:"Once per fight, survive a killing blow with 1 HP"}},{count:7,reward:{type:"keepsake_upgrade",id:"blessed_keepsake",name:"Blessed Keepsake",description:"Your keepsake now reduces injury severity by one tier"}},{count:12,reward:{type:"cosmetic",id:"holy_symbol",name:"Holy Symbol",description:"A blessed symbol adorns your equipment"}}]},{id:"letter_future",type:"future_self",name:"Letter to Your Future Self",icon:"📜",description:"Write wisdom for the next generation. Boosts legacy rewards.",recipient:"your future self",guaranteedEffects:[{type:"trust",value:5,description:"+5 Trust (self-reflection)"},{type:"letter_stamp",value:2,description:"+2 Letter Stamps"}],positiveChance:.6,positiveEffect:{type:"buff",value:1,description:"Clarity of purpose! +10% all rewards next fight"},negativeChance:.05,negativeEffect:{type:"focus",value:-10,description:"Dark thoughts intrude. -10 starting Focus next fight"},letterSnippets:["If you're reading this, I'm gone. Learn from my mistakes.","Remember: defense wins fights, offense wins crowds.","Trust your instincts. They've kept you alive this long.","The rival to fear is the one you underestimate.","Your keepsake is more than metal. It's who you are.","Win or lose, fight with honor. That's what matters.","I've learned that trust is earned in blood, not words.","The arena takes everything. Give it nothing but your best."],closingLines:["From the past, {name}","Learn and survive, {name}","Your former self, {name}","Remember me, {name}"],milestoneRewards:[{count:3,reward:{type:"perk_point",id:"legacy_wisdom",name:"Legacy Wisdom",description:"+1 Bloodline Point and new recruits start with +5 in a random stat"}},{count:7,reward:{type:"ability",id:"ghost_guidance",name:"Ghost Guidance",description:"Fallen fighters may appear as ghosts to give combat hints"}},{count:12,reward:{type:"cosmetic",id:"memorial_wings",name:"Memorial Wings",description:"Spectral wings appear on your memorial portrait"}}]}];function St(n,r,e){const t=n.letterSnippets[Math.floor(Math.random()*n.letterSnippets.length)],a=n.closingLines[Math.floor(Math.random()*n.closingLines.length)];return t.replace("{name}",r).replace("{nickname}",e)+`

`+a.replace("{name}",r)}function wt(n){const r=[...n.guaranteedEffects];return Math.random()<n.positiveChance&&r.push(n.positiveEffect),Math.random()<n.negativeChance&&r.push(n.negativeEffect),r}const C=class C extends w.GameObjects.Container{constructor(e,t,a,i,s){super(e,t,a);d(this,"bg");d(this,"textObj");d(this,"effectsContainer");d(this,"riskIndicator");d(this,"config");d(this,"callback");d(this,"isHovered",!1);this.config=i,this.callback=s,this.createCard(),this.setupInteraction(),this.setScale(.8),this.setAlpha(0),e.tweens.add({targets:this,scale:1,alpha:1,duration:300,ease:"Back.out"}),e.add.existing(this)}createCard(){const e=C.WIDTH;this.bg=this.scene.add.graphics(),this.drawBackground(!1),this.add(this.bg);let t=-e/2+15;if(this.config.icon){const a=this.scene.add.text(-e/2+25,0,this.config.icon,{fontSize:"24px"}).setOrigin(.5);this.add(a),t+=35}this.textObj=this.scene.add.text(t,-15,this.config.text,{fontFamily:"Georgia, serif",fontSize:"13px",color:"#c9a959",wordWrap:{width:e-80}}).setOrigin(0,.5),this.add(this.textObj),this.effectsContainer=this.scene.add.container(-e/2+15,20),this.createEffectsPreviews(),this.add(this.effectsContainer),this.config.riskLevel&&this.config.riskLevel!=="safe"&&this.createRiskIndicator()}drawBackground(e){const t=C.WIDTH,a=C.HEIGHT;this.bg.clear(),this.bg.fillStyle(0,.2),this.bg.fillRoundedRect(-t/2+2,-a/2+2,t,a,8);const s={safe:2767402,risky:3815978,dangerous:3811882}[this.config.riskLevel||"safe"],o=e?s+1118481:s;this.bg.fillStyle(o,.95),this.bg.fillRoundedRect(-t/2,-a/2,t,a,8);const l=e?13216089:{safe:7048739,risky:14329120,dangerous:13458524}[this.config.riskLevel||"safe"];this.bg.lineStyle(e?2:1,l,1),this.bg.strokeRoundedRect(-t/2,-a/2,t,a,8),this.bg.fillStyle(l,.5),this.bg.fillRect(-t/2,-a/2+5,4,a-10)}createEffectsPreviews(){let e=0;this.config.effects.slice(0,3).forEach(t=>{const a=t.isPositive?"▲":"▼",i=t.isPositive?"#6b8e23":"#cd5c5c",s=this.scene.add.text(e,0,`${a} ${t.description}`,{fontFamily:"Georgia, serif",fontSize:"10px",color:i});this.effectsContainer.add(s),e+=s.width+15})}createRiskIndicator(){const e={risky:"⚠️ RISKY",dangerous:"☠️ DANGEROUS"},t={risky:"#daa520",dangerous:"#cd5c5c"};this.riskIndicator=this.scene.add.text(C.WIDTH/2-10,-100/2+10,e[this.config.riskLevel],{fontFamily:"Georgia, serif",fontSize:"9px",color:t[this.config.riskLevel]}).setOrigin(1,0),this.add(this.riskIndicator)}setupInteraction(){const e=new w.Geom.Rectangle(-140,-50,C.WIDTH,C.HEIGHT);this.setSize(C.WIDTH,C.HEIGHT),this.setInteractive(e,w.Geom.Rectangle.Contains),this.on("pointerover",()=>{this.isHovered=!0,this.drawBackground(!0),this.scene.tweens.add({targets:this,x:this.x+5,scaleX:1.02,scaleY:1.02,duration:100})}),this.on("pointerout",()=>{this.isHovered=!1,this.drawBackground(!1),this.scene.tweens.add({targets:this,x:this.x-5,scaleX:1,scaleY:1,duration:100})}),this.on("pointerdown",()=>{this.scene.tweens.add({targets:this,scaleX:.98,scaleY:.98,duration:50})}),this.on("pointerup",()=>{this.scene.tweens.add({targets:this,scaleX:1.1,scaleY:1.1,alpha:0,duration:200,ease:"Quad.in",onComplete:()=>{this.callback()}})})}select(){this.emit("pointerup")}fadeOut(){this.scene.tweens.add({targets:this,alpha:0,y:this.y+20,duration:200,onComplete:()=>this.destroy()})}};d(C,"WIDTH",280),d(C,"HEIGHT",100);let q=C;class bt extends w.Scene{constructor(){super({key:"LetterScene"});d(this,"fighter");d(this,"selectedTemplate");d(this,"letterContent");d(this,"effects",[]);d(this,"phase","select");d(this,"quillSprite");d(this,"parchmentGroup");d(this,"letterTextObj");d(this,"waxSeal")}create(){const e=m.getRun();if(!e.fighter){this.scene.start("MainMenuScene");return}this.fighter=e.fighter,this.phase="select",this.createBackground(),this.showLetterTypeSelection(),this.cameras.main.fadeIn(300)}createBackground(){const{width:e,height:t}=this.cameras.main,a=this.add.graphics();a.fillGradientStyle(1709072,1709072,985605,985605),a.fillRect(0,0,e,t);const i=this.add.graphics();i.fillStyle(16753920,.1),i.fillCircle(e*.8,t*.2,100),this.tweens.add({targets:i,alpha:{from:.1,to:.15},duration:200,yoyo:!0,repeat:-1}),this.add.text(e/2,40,"WRITE A LETTER",{fontFamily:"Georgia, serif",fontSize:"20px",color:"#c9a959"}).setOrigin(.5),this.add.text(e/2,65,"Choose your words carefully...",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b7355",fontStyle:"italic"}).setOrigin(.5),b.createButton(this,50,35,"← BACK",()=>this.goBack(),{width:80,height:35,fontSize:"11px"})}showLetterTypeSelection(){const{width:e,height:t}=this.cameras.main,a=this.add.container(0,0);a.setData("phase","select");const i=120,s=100;yt.forEach((c,l)=>{const h=i+l*s,u=c.guaranteedEffects.map(S=>({type:S.type,value:S.value,isPositive:S.value>0||["letter_stamp","status_cure","injury_heal"].includes(S.type),description:S.description}));c.positiveChance>0&&u.push({type:"chance",value:Math.round(c.positiveChance*100),isPositive:!0,description:`${Math.round(c.positiveChance*100)}%: ${c.positiveEffect.description}`});const p=new q(this,e/2,h,{id:c.id,text:`${c.icon} ${c.name}`,effects:u.slice(0,3),riskLevel:c.negativeChance>.2?"risky":"safe",icon:c.icon},()=>this.selectLetterType(c)),y=this.add.text(e/2,h+55,c.description,{fontFamily:"Georgia, serif",fontSize:"10px",color:"#6a5a4a",align:"center"}).setOrigin(.5);a.add(p),a.add(y)});const o=m.getLetterStamps();this.add.text(e-20,t-30,`📜 Letter Stamps: ${o}`,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#8b7355"}).setOrigin(1,.5)}selectLetterType(e){this.selectedTemplate=e,this.phase="write",this.letterContent=St(e,this.fighter.firstName,this.fighter.nickname),this.effects=wt(e),this.children.each(t=>{t.getData("phase")==="select"&&t.destroy()}),this.showWritingPhase()}showWritingPhase(){var s;const{width:e,height:t}=this.cameras.main;this.parchmentGroup=this.add.container(e/2,t/2-50);const a=this.add.graphics();a.fillStyle(13943968,1),a.fillRoundedRect(-160,-180,320,360,5),a.lineStyle(2,9139029,1),a.strokeRoundedRect(-160,-180,320,360,5),a.fillStyle(13219990,.5),a.fillCircle(-100,-100,30),a.fillCircle(80,50,25),this.parchmentGroup.add(a);const i=this.add.text(0,-150,`To ${(s=this.selectedTemplate)==null?void 0:s.recipient}`,{fontFamily:"Georgia, serif",fontSize:"12px",color:"#3a2a1a",fontStyle:"italic"}).setOrigin(.5);this.parchmentGroup.add(i),this.letterTextObj=this.add.text(0,-50,"",{fontFamily:"Georgia, serif",fontSize:"11px",color:"#2a1a0a",wordWrap:{width:280},align:"center",lineSpacing:6}).setOrigin(.5),this.parchmentGroup.add(this.letterTextObj),this.typewriterEffect(this.letterContent||"",()=>{this.showSealButton()}),this.createQuill()}createQuill(){this.quillSprite=this.add.graphics(),this.quillSprite.fillStyle(4864554,1),this.quillSprite.fillTriangle(0,0,-5,30,5,30),this.quillSprite.fillStyle(16119260,1),this.quillSprite.fillTriangle(-2,30,2,30,0,80);const{width:e,height:t}=this.cameras.main;this.quillSprite.setPosition(e/2+100,t/2-100),this.tweens.add({targets:this.quillSprite,x:{from:e/2+80,to:e/2+120},y:{from:t/2-120,to:t/2},duration:2e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}typewriterEffect(e,t){let a=0;const i=e;this.time.addEvent({delay:30,callback:()=>{var s;a++,(s=this.letterTextObj)==null||s.setText(i.substring(0,a)),a>=i.length&&t()},repeat:i.length-1})}showSealButton(){var i,s;const{width:e,height:t}=this.cameras.main;(i=this.quillSprite)==null||i.destroy();const a=this.add.text(e/2,t/2+80,`— ${this.fighter.firstName}`,{fontFamily:"Georgia, serif",fontSize:"12px",color:"#2a1a0a",fontStyle:"italic"}).setOrigin(.5);(s=this.parchmentGroup)==null||s.add(a),b.createButton(this,e/2,t-80,"🔴 SEAL WITH WAX",()=>this.sealLetter(),{width:180,height:50,primary:!0})}sealLetter(){this.phase="seal";const{width:e,height:t}=this.cameras.main;this.waxSeal=this.add.container(e/2,t/2+130);const a=this.add.graphics();a.fillStyle(9109504,1),a.fillCircle(0,0,0),this.waxSeal.add(a),this.tweens.add({targets:{radius:0},radius:25,duration:500,ease:"Quad.out",onUpdate:i=>{const s=i.getValue();typeof s=="number"&&(a.clear(),a.fillStyle(9109504,1),a.fillCircle(0,0,s))},onComplete:()=>{this.stampSeal()}})}stampSeal(){var t;this.cameras.main.flash(100,255,200,200);const e=this.add.text(0,0,"⚔️",{fontSize:"20px"}).setOrigin(.5);(t=this.waxSeal)==null||t.add(e),e.setScale(2),e.setAlpha(0),this.tweens.add({targets:e,scale:1,alpha:1,duration:200,ease:"Back.out",onComplete:()=>{this.time.delayedCall(500,()=>this.showResults())}})}showResults(){this.phase="result";const{width:e,height:t}=this.cameras.main;this.tweens.add({targets:[this.parchmentGroup,this.waxSeal],alpha:0,y:"+=50",duration:500}),this.time.delayedCall(600,()=>{this.displayEffects(),this.applyEffects()})}displayEffects(){const{width:e,height:t}=this.cameras.main;this.add.text(e/2,100,"LETTER SENT",{fontFamily:"Georgia, serif",fontSize:"24px",color:"#c9a959"}).setOrigin(.5);let a=160;this.effects.forEach((i,s)=>{this.time.delayedCall(s*200,()=>{const o=i.value>0||["letter_stamp","status_cure","injury_heal","resolve","buff"].includes(i.type),c=o?"✓":"✗",l=o?"#6b8e23":"#cd5c5c",h=this.add.text(e/2,a,`${c} ${i.description}`,{fontFamily:"Georgia, serif",fontSize:"14px",color:l}).setOrigin(.5);h.setAlpha(0),this.tweens.add({targets:h,alpha:1,x:e/2,duration:300,ease:"Back.out"}),a+=35})}),this.time.delayedCall(this.effects.length*200+500,()=>{b.createButton(this,e/2,t-80,"CONTINUE",()=>{this.goBack()},{width:160,height:50,primary:!0})})}applyEffects(){const e=m.getRun();let t=0,a=0;this.effects.forEach(o=>{switch(o.type){case"trust":a+=o.value;break;case"gold":t+=o.value;break;case"hp":this.fighter.currentStats&&(this.fighter.currentStats.currentHP=Math.min(this.fighter.currentStats.maxHP,this.fighter.currentStats.currentHP+o.value));break;case"letter_stamp":m.addLetterStamps(o.value);break;case"debt":m.addDebt(Math.abs(o.value),2);break}}),a!==0&&(this.fighter.trust=Math.max(0,Math.min(100,this.fighter.trust+a)));const i={id:`letter_${Date.now()}`,type:this.selectedTemplate.type,templateId:this.selectedTemplate.id,content:this.letterContent||"",fighterName:this.fighter.fullName,fighterId:this.fighter.id,weekWritten:e.week,wasRead:!1,effects:this.effects,timestamp:Date.now()},s=[...e.lettersWritten,i];m.updateRun({fighter:this.fighter,gold:e.gold+t,lettersWritten:s,lastCampAction:"letter"}),m.incrementLetterCount(this.selectedTemplate.type),this.checkMilestones()}checkMilestones(){if(!this.selectedTemplate)return;const e=m.getLetterCount(this.selectedTemplate.type);for(const t of this.selectedTemplate.milestoneRewards)e>=t.count&&!m.hasLetterReward(t.reward.id)&&(m.unlockLetterReward(t.reward.id),this.time.delayedCall(1e3,()=>{b.showNotification(this,`🎉 UNLOCKED: ${t.reward.name}!`,3e3)}))}goBack(){this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("CampScene")})}}const G=[{id:"iron_ring",name:"Iron Ring",description:"+5 Defense",rarity:"common",icon:"💍",auraColor:"#808080",particleType:"none",statModifiers:{defense:5},lore:"Simple iron, but reassuring."},{id:"fighters_tooth",name:"Fighter's Tooth",description:"+3 Attack",rarity:"common",icon:"🦷",auraColor:"#f5f5dc",particleType:"none",statModifiers:{attack:3},lore:"A trophy from your first kill."},{id:"worn_boots",name:"Worn Boots",description:"+2 Speed, +5 Evasion",rarity:"common",icon:"👢",auraColor:"#8b4513",particleType:"none",statModifiers:{speed:2,evasion:5},lore:"Comfortable and broken in."},{id:"lucky_coin",name:"Lucky Coin",description:"+10% Gold rewards",rarity:"common",icon:"🪙",auraColor:"#ffd700",particleType:"sparkle",passiveEffect:"gold_bonus_10",lore:"Tails you win."},{id:"bandolier",name:"Bandolier",description:"+1 Item slot, items 10% more effective",rarity:"common",icon:"🎒",auraColor:"#654321",particleType:"none",passiveEffect:"extra_item_slot",lore:"Room for more tricks."},{id:"crowd_favor",name:"Crowd's Favor",description:"+15% Hype gain",rarity:"common",icon:"📣",auraColor:"#ffa500",particleType:"sparkle",passiveEffect:"hype_bonus_15",lore:"They love you. For now."},{id:"blood_amulet",name:"Blood Amulet",description:"Heal 5 HP on kill",rarity:"uncommon",icon:"📿",auraColor:"#8b0000",particleType:"blood",triggerEffect:{condition:"on_kill",effect:"heal",value:5},lore:"Drinks deep from the dying."},{id:"berserker_band",name:"Berserker Band",description:"+20% damage when below 50% HP",rarity:"uncommon",icon:"🔴",auraColor:"#ff4500",particleType:"flame",triggerEffect:{condition:"on_low_hp",effect:"damage_boost",value:20},lore:"Pain is just weakness leaving."},{id:"focused_lens",name:"Focused Lens",description:"+10 Accuracy, +5% Crit Chance",rarity:"uncommon",icon:"🔍",auraColor:"#87ceeb",particleType:"sparkle",statModifiers:{accuracy:10,critChance:5},lore:"See the gaps in their defense."},{id:"shadow_cloak",name:"Shadow Cloak",description:"+15 Evasion, 20% chance to dodge on turn start",rarity:"uncommon",icon:"🧥",auraColor:"#2f2f4f",particleType:"shadow",statModifiers:{evasion:15},triggerEffect:{condition:"on_turn_start",effect:"auto_dodge",value:1,chance:.2},lore:"Become one with darkness."},{id:"wrath_stone",name:"Wrath Stone",description:"Gain +2 Focus per hit taken",rarity:"uncommon",icon:"💎",auraColor:"#9932cc",particleType:"sparkle",passiveEffect:"focus_on_hit",lore:"Channel your rage."},{id:"healers_charm",name:"Healer's Charm",description:"All healing +30%",rarity:"uncommon",icon:"💚",auraColor:"#32cd32",particleType:"holy",passiveEffect:"healing_boost_30",lore:"Blessed by temple healers."},{id:"warriors_belt",name:"Warrior's Belt",description:"+20 Max Stamina, Stamina regen +20%",rarity:"uncommon",icon:"🥋",auraColor:"#8b4513",particleType:"none",statModifiers:{maxStamina:20},passiveEffect:"stamina_regen_20",lore:"Hold everything together."},{id:"champions_medal",name:"Champion's Medal",description:"+5 to all stats",rarity:"rare",icon:"🏅",auraColor:"#ffd700",particleType:"sparkle",statModifiers:{attack:5,defense:5,speed:5,accuracy:5,evasion:5,maxHP:10,maxStamina:10},lore:"Earned by a true champion."},{id:"phoenix_feather",name:"Phoenix Feather",description:"Survive fatal blow once per fight with 20% HP",rarity:"rare",icon:"🪶",auraColor:"#ff6347",particleType:"flame",triggerEffect:{condition:"on_low_hp",effect:"death_save",value:20},lore:"Rise from the ashes."},{id:"vampiric_blade",name:"Vampiric Essence",description:"Heal 10% of damage dealt",rarity:"rare",icon:"🩸",auraColor:"#8b0000",particleType:"blood",triggerEffect:{condition:"on_hit",effect:"lifesteal",value:10},lore:"Your wounds feed on theirs."},{id:"executioners_eye",name:"Executioner's Eye",description:"+50% damage to enemies below 30% HP",rarity:"rare",icon:"👁️",auraColor:"#4b0082",particleType:"shadow",triggerEffect:{condition:"on_hit",effect:"execute_bonus",value:50},lore:"See the moment of death."},{id:"mirror_shield",name:"Mirror Shield",description:"Perfect parries deal 150% counter damage",rarity:"rare",icon:"🪞",auraColor:"#c0c0c0",particleType:"sparkle",triggerEffect:{condition:"on_parry",effect:"counter_boost",value:150},lore:"Return their violence twofold."},{id:"crowd_roar",name:"Crowd's Roar",description:"At 80+ Hype, +30% damage and heal 5 HP per turn",rarity:"rare",icon:"🎭",auraColor:"#ffd700",particleType:"sparkle",passiveEffect:"crowd_power",lore:"Their cheers fuel your strength."},{id:"storm_caller",name:"Storm Caller",description:"Critical hits chain to deal 30% damage to all",rarity:"rare",icon:"⚡",auraColor:"#1e90ff",particleType:"sparkle",triggerEffect:{condition:"on_crit",effect:"chain_lightning",value:30},lore:"Call down the thunder."},{id:"crown_of_blood",name:"Crown of Blood",description:"Killing an enemy fully heals you and grants +5 permanent HP",rarity:"legendary",icon:"👑",auraColor:"#8b0000",particleType:"blood",triggerEffect:{condition:"on_kill",effect:"full_heal_plus",value:5},lore:"The arena throne, paid in blood."},{id:"gods_hand",name:"God's Hand",description:"Start every fight with full Focus. Special costs no Focus.",rarity:"legendary",icon:"✋",auraColor:"#ffd700",particleType:"holy",passiveEffect:"unlimited_special",lore:"Touched by the divine."},{id:"shadow_twin",name:"Shadow Twin",description:"25% chance for attacks to hit twice",rarity:"legendary",icon:"👥",auraColor:"#2f2f4f",particleType:"shadow",triggerEffect:{condition:"on_hit",effect:"double_strike",value:25,chance:.25},lore:"Your shadow fights beside you."},{id:"immortal_will",name:"Immortal Will",description:"Cannot die while you have Stamina. Damage drains Stamina instead.",rarity:"legendary",icon:"💀",auraColor:"#4b0082",particleType:"shadow",passiveEffect:"stamina_as_hp",lore:"Death cannot claim the determined."},{id:"arena_heart",name:"Heart of the Arena",description:"Crowd Hype starts at 100 and never decreases. +50% all rewards.",rarity:"legendary",icon:"❤️‍🔥",auraColor:"#ff4500",particleType:"flame",passiveEffect:"permanent_hype",lore:"The arena itself fights for you."}];G.filter(n=>n.rarity==="common").map(n=>n.id),G.filter(n=>n.rarity==="uncommon").map(n=>n.id),G.filter(n=>n.rarity==="rare").map(n=>n.id),G.filter(n=>n.rarity==="legendary").map(n=>n.id);const kt={common:50,uncommon:35,rare:12,legendary:3};function vt(n=0){const r={...kt};r.legendary+=Math.floor(n/3),r.rare+=Math.floor(n/2);const e=Object.values(r).reduce((a,i)=>a+i,0);let t=Math.random()*e;for(const[a,i]of Object.entries(r))if(t-=i,t<=0)return a;return"common"}function xt(n=3,r=[]){const e=G.filter(a=>!r.includes(a.id)),t=[];for(let a=0;a<n&&e.length>0;a++){const i=vt(),s=e.filter(o=>o.rarity===i);if(s.length>0){const o=Math.floor(Math.random()*s.length);t.push(s[o]);const c=e.findIndex(l=>l.id===s[o].id);e.splice(c,1)}else{const o=Math.floor(Math.random()*e.length);t.push(e[o]),e.splice(o,1)}}return t}const x=class x extends w.GameObjects.Container{constructor(e,t,a,i,s){super(e,t,a);d(this,"bg");d(this,"glowLayer");d(this,"particleEmitter");d(this,"relic");d(this,"callback");d(this,"revealed",!1);this.relic=i,this.callback=s,this.createCard(),e.add.existing(this)}createCard(){const e=x.WIDTH,t=x.HEIGHT,a=x.RARITY_COLORS[this.relic.rarity];this.glowLayer=this.scene.add.graphics(),this.add(this.glowLayer),this.animateGlow(a),this.bg=this.scene.add.graphics(),this.drawBackground(!1),this.add(this.bg);const i=this.scene.add.graphics();i.fillStyle(a,.8),i.fillRect(-e/2,-t/2,e,30),this.add(i);const s=this.scene.add.text(0,-t/2+15,this.relic.rarity.toUpperCase(),{fontFamily:"Georgia, serif",fontSize:"12px",color:"#ffffff",fontStyle:"bold"}).setOrigin(.5);this.add(s);const o=this.scene.add.text(0,-35,this.relic.icon,{fontSize:"48px"}).setOrigin(.5);this.add(o),this.createAuraEffect(a);const c=this.scene.add.text(0,15,this.relic.name,{fontFamily:"Georgia, serif",fontSize:"14px",color:"#c9a959",fontStyle:"bold",wordWrap:{width:e-20},align:"center"}).setOrigin(.5);this.add(c);const l=this.scene.add.text(0,50,this.relic.description,{fontFamily:"Georgia, serif",fontSize:"11px",color:"#ffffff",wordWrap:{width:e-30},align:"center"}).setOrigin(.5,0);this.add(l);const h=this.scene.add.text(0,t/2-30,`"${this.relic.lore}"`,{fontFamily:"Georgia, serif",fontSize:"9px",color:"#8b7355",fontStyle:"italic",wordWrap:{width:e-20},align:"center"}).setOrigin(.5);this.add(h),this.setupInteraction()}drawBackground(e){const t=x.WIDTH,a=x.HEIGHT,i=x.RARITY_COLORS[this.relic.rarity];this.bg.clear(),this.bg.fillStyle(0,.4),this.bg.fillRoundedRect(-t/2+4,-a/2+4,t,a,12);const s=e?3815994:2763306;this.bg.fillStyle(s,.95),this.bg.fillRoundedRect(-t/2,-a/2,t,a,12),this.bg.lineStyle(e?4:3,i,1),this.bg.strokeRoundedRect(-t/2,-a/2,t,a,12),this.bg.lineStyle(1,i,.3),this.bg.strokeRoundedRect(-t/2+8,-a/2+8,t-16,a-16,8)}animateGlow(e){const t=x.WIDTH,a=x.HEIGHT,i=s=>{this.glowLayer.clear(),this.glowLayer.fillStyle(e,s*.3),this.glowLayer.fillRoundedRect(-t/2-10,-a/2-10,t+20,a+20,15)};this.scene.tweens.add({targets:{alpha:.5},alpha:1,duration:1e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut",onUpdate:s=>{const o=s.getValue();typeof o=="number"&&i(o)}}),i(.5)}createAuraEffect(e){const t=this.scene.add.graphics();this.add(t);let a=0;this.scene.time.addEvent({delay:50,callback:()=>{t.clear();for(let i=0;i<6;i++){const s=a+i*Math.PI/3,o=Math.cos(s)*40,c=Math.sin(s)*40-35;t.fillStyle(e,.5-i*.08),t.fillCircle(o,c,3-i*.3)}a+=.05},loop:!0})}setupInteraction(){const e=x.WIDTH,t=x.HEIGHT,a=new w.Geom.Rectangle(-e/2,-t/2,e,t);this.setSize(e,t),this.setInteractive(a,w.Geom.Rectangle.Contains),this.on("pointerover",()=>{this.drawBackground(!0),this.scene.tweens.add({targets:this,scaleX:1.05,scaleY:1.05,y:this.y-10,duration:150,ease:"Back.out"})}),this.on("pointerout",()=>{this.drawBackground(!1),this.scene.tweens.add({targets:this,scaleX:1,scaleY:1,y:this.y+10,duration:150})}),this.on("pointerdown",()=>{this.scene.tweens.add({targets:this,scaleX:.95,scaleY:.95,duration:50})}),this.on("pointerup",()=>{this.selectAnimation()})}selectAnimation(){const e=x.RARITY_COLORS[this.relic.rarity];for(let t=0;t<20;t++){const a=Math.random()*Math.PI*2,i=100+Math.random()*150,s=this.scene.add.graphics();s.fillStyle(e,1),s.fillCircle(0,0,4),this.add(s),this.scene.tweens.add({targets:s,x:Math.cos(a)*i,y:Math.sin(a)*i,alpha:0,scale:0,duration:500,ease:"Quad.out",onComplete:()=>s.destroy()})}this.scene.tweens.add({targets:this,scaleX:1.5,scaleY:1.5,alpha:0,duration:400,ease:"Quad.in",onComplete:()=>{this.callback()}})}reveal(){return new Promise(e=>{if(this.revealed){e();return}this.setScale(1,0),this.scene.tweens.add({targets:this,scaleY:1,duration:400,ease:"Back.out",delay:Math.random()*200,onComplete:()=>{this.revealed=!0,this.playRevealEffect(),e()}})})}playRevealEffect(){const e=x.RARITY_COLORS[this.relic.rarity],t=this.scene.add.graphics();t.fillStyle(e,.5),t.fillRoundedRect(-180/2,-240/2,x.WIDTH,x.HEIGHT,12),this.add(t),this.scene.tweens.add({targets:t,alpha:0,duration:300,onComplete:()=>t.destroy()}),this.relic.rarity==="legendary"&&this.scene.cameras.main.shake(200,.01)}};d(x,"WIDTH",180),d(x,"HEIGHT",240),d(x,"RARITY_COLORS",{common:8421504,uncommon:2031360,rare:28893,legendary:16744448});let z=x;class Tt extends w.Scene{constructor(){super({key:"RelicChoiceScene"});d(this,"relicChoices",[]);d(this,"relicCards",[]);d(this,"selectedRelic")}create(){const e=m.getRun();this.relicChoices=xt(3,e.relics),this.createBackground(),this.createHeader(),this.revealRelics(),this.cameras.main.fadeIn(300)}createBackground(){const{width:e,height:t}=this.cameras.main,a=this.add.graphics();a.fillGradientStyle(657429,657429,1708069,1708069),a.fillRect(0,0,e,t);for(let s=0;s<50;s++){const o=this.add.graphics();o.fillStyle(10040012,Math.random()*.3),o.fillCircle(0,0,2),o.setPosition(Math.random()*e,Math.random()*t),this.tweens.add({targets:o,y:o.y-100,alpha:0,duration:3e3+Math.random()*2e3,repeat:-1,delay:Math.random()*2e3})}const i=this.add.graphics();i.fillStyle(0,.5),i.fillRect(0,0,e,60),i.fillRect(0,t-60,e,60)}createHeader(){const{width:e}=this.cameras.main,t=this.add.text(e/2,50,"CHOOSE A RELIC",{fontFamily:"Georgia, serif",fontSize:"28px",color:"#c9a959",stroke:"#000000",strokeThickness:4}).setOrigin(.5);this.tweens.add({targets:t,alpha:{from:1,to:.8},duration:1e3,yoyo:!0,repeat:-1}),this.add.text(e/2,85,"A mysterious power calls to you...",{fontFamily:"Georgia, serif",fontSize:"12px",color:"#8b7355",fontStyle:"italic"}).setOrigin(.5)}async revealRelics(){const{width:e,height:t}=this.cameras.main,a=200,i=e/2-a;for(let s=0;s<this.relicChoices.length;s++){const o=this.relicChoices[s],c=i+s*a,l=new z(this,c,t/2,o,()=>{this.selectRelic(o,s)});l.setScale(1,0),this.relicCards.push(l)}await this.playRevealSequence()}async playRevealSequence(){this.cameras.main.flash(200,150,100,200);for(let e=0;e<this.relicCards.length;e++)await this.delay(300),await this.relicCards[e].reveal();this.time.delayedCall(500,()=>{this.createSkipButton()})}delay(e){return new Promise(t=>{this.time.delayedCall(e,t)})}createSkipButton(){const{width:e,height:t}=this.cameras.main;b.createButton(this,e/2,t-50,"SKIP (No Relic)",()=>this.skipRelic(),{width:150,height:40,fontSize:"11px"})}selectRelic(e,t){this.selectedRelic||(this.selectedRelic=e,this.relicCards.forEach((a,i)=>{i!==t&&this.tweens.add({targets:a,alpha:0,y:a.y+50,duration:300})}),m.addRelic(e.id),this.time.delayedCall(500,()=>{this.showAcquisitionEffect(e)}))}showAcquisitionEffect(e){const{width:t,height:a}=this.cameras.main,i=this.add.text(t/2,a/2,e.icon,{fontSize:"64px"}).setOrigin(.5);i.setScale(0),this.tweens.add({targets:i,scale:2,duration:500,ease:"Back.out"});const s=this.add.text(t/2,a/2+80,e.name,{fontFamily:"Georgia, serif",fontSize:"24px",color:"#c9a959"}).setOrigin(.5);s.setAlpha(0),this.tweens.add({targets:s,alpha:1,duration:300,delay:300}),this.time.delayedCall(1500,()=>{this.returnToCamp()})}skipRelic(){b.showConfirmDialog(this,"Skip Relic?","Are you sure you want to pass on this opportunity?",()=>this.returnToCamp(),()=>{},"YES, SKIP")}returnToCamp(){m.updateRun({fightsSinceRelic:0}),this.cameras.main.fadeOut(300),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("CampScene")})}}const Rt=()=>{const n=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),r=window.innerHeight>window.innerWidth;let e=390,t=844;return!n&&!r&&(e=600,t=900),{type:w.AUTO,parent:"game-container",width:e,height:t,backgroundColor:"#1a1410",scale:{mode:w.Scale.FIT,autoCenter:w.Scale.CENTER_BOTH,min:{width:320,height:480},max:{width:600,height:1200}},render:{pixelArt:!1,antialias:!0,roundPixels:!0},input:{activePointers:3,touch:{capture:!0}},scene:[ce,ue,fe,Ae,Oe,Ee,_e,dt,ht,ut,ft,mt,gt,pt,bt,Tt],physics:{default:"arcade",arcade:{debug:!1}}}},Ct=Rt(),Bt=new w.Game(Ct);window.addEventListener("resize",()=>{Bt.scale.refresh()});document.addEventListener("touchstart",n=>{n.target instanceof HTMLCanvasElement&&n.preventDefault()},{passive:!1});document.addEventListener("touchmove",n=>{n.target instanceof HTMLCanvasElement&&n.preventDefault()},{passive:!1});document.addEventListener("contextmenu",n=>{n.preventDefault()});
